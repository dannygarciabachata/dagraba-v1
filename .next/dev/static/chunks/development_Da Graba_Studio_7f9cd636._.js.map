{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/lib/utils.ts"],"sourcesContent":["import { type ClassValue, clsx } from 'clsx';\nimport { twMerge } from 'tailwind-merge';\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,4MAAO,EAAC,IAAA,mLAAI,EAAC;AACtB"}},
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/ui/Slider.tsx"],"sourcesContent":["import { forwardRef } from 'react';\nimport { cn } from '@/lib/utils';\n\nexport interface SliderProps extends React.InputHTMLAttributes<HTMLInputElement> {\n    orientation?: 'horizontal' | 'vertical';\n}\n\nconst Slider = forwardRef<HTMLInputElement, SliderProps>(\n    ({ className, orientation = 'horizontal', ...props }, ref) => {\n        return (\n            <input\n                type=\"range\"\n                ref={ref}\n                className={cn(\n                    'appearance-none bg-transparent cursor-pointer',\n                    // Custom track sizing and colors\n                    '[&::-webkit-slider-runnable-track]:bg-carbon [&::-webkit-slider-runnable-track]:border [&::-webkit-slider-runnable-track]:border-silver-dark/30',\n                    '[&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:bg-silver-light',\n                    '[&::-webkit-slider-thumb]:shadow-[0_0_10px_rgba(255,107,0,0.3)] hover:[&::-webkit-slider-thumb]:shadow-[0_0_15px_rgba(255,107,0,0.6)]',\n                    {\n                        'w-full h-2 [&::-webkit-slider-runnable-track]:rounded-full [&::-webkit-slider-runnable-track]:h-2 [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:-mt-1': orientation === 'horizontal',\n                        // Vertical slider hacks\n                        '[writing-mode:vertical-lr] [direction:rtl] h-full w-2 [&::-webkit-slider-runnable-track]:w-2 [&::-webkit-slider-thumb]:h-8 [&::-webkit-slider-thumb]:w-6 [&::-webkit-slider-thumb]:rounded-sm [&::-webkit-slider-thumb]:border [&::-webkit-slider-thumb]:border-carbon': orientation === 'vertical',\n                    },\n                    className\n                )}\n                {...props}\n            />\n        );\n    }\n);\nSlider.displayName = 'Slider';\n\nexport { Slider };\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;AAMA,MAAM,uBAAS,IAAA,8MAAU,OACrB,CAAC,EAAE,SAAS,EAAE,cAAc,YAAY,EAAE,GAAG,OAAO,EAAE;IAClD,qBACI,gOAAC;QACG,MAAK;QACL,KAAK;QACL,WAAW,IAAA,wJAAE,EACT,iDACA,iCAAiC;QACjC,mJACA,uFACA,yIACA;YACI,wOAAwO,gBAAgB;YACxP,wBAAwB;YACxB,0QAA0Q,gBAAgB;QAC9R,GACA;QAEH,GAAG,KAAK;;;;;;AAGrB;;AAEJ,OAAO,WAAW,GAAG"}},
    {"offset": {"line": 62, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/VUMeter.tsx"],"sourcesContent":["import { cn } from '@/lib/utils';\n\ninterface VUMeterProps {\n    level: number; // 0 to 127\n    className?: string;\n}\n\nexport function VUMeter({ level, className }: VUMeterProps) {\n    // Simple segmentation\n    const totalSegments = 30;\n    const activeSegments = Math.round((level / 127) * totalSegments);\n\n    return (\n        <div className={cn(\"flex flex-col justify-end bg-black/40 rounded-sm overflow-hidden p-[1px] gap-[1px] border border-white/5 shadow-inner relative\", className)}>\n            <div className=\"absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent pointer-events-none\" />\n            {Array.from({ length: totalSegments }).map((_, i) => {\n                const segmentIndex = totalSegments - 1 - i;\n                const isActive = segmentIndex < activeSegments;\n                let colorClass = '';\n\n                if (isActive) {\n                    if (segmentIndex > totalSegments - 4) {\n                        colorClass = 'bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.6)]';\n                    } else if (segmentIndex > totalSegments - 10) {\n                        colorClass = 'bg-yellow-400 shadow-[0_0_8px_rgba(250,204,21,0.6)]';\n                    } else {\n                        colorClass = 'bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.6)]';\n                    }\n                } else {\n                    colorClass = 'bg-white/5';\n                }\n\n                return (\n                    <div\n                        key={i}\n                        className={cn(\"w-full h-[3px] transition-all duration-75 rounded-[0.5px]\", colorClass)}\n                    />\n                );\n            })}\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAAA;;;AAOO,SAAS,QAAQ,EAAE,KAAK,EAAE,SAAS,EAAgB;IACtD,sBAAsB;IACtB,MAAM,gBAAgB;IACtB,MAAM,iBAAiB,KAAK,KAAK,CAAC,AAAC,QAAQ,MAAO;IAElD,qBACI,gOAAC;QAAI,WAAW,IAAA,wJAAE,EAAC,kIAAkI;;0BACjJ,gOAAC;gBAAI,WAAU;;;;;;YACd,MAAM,IAAI,CAAC;gBAAE,QAAQ;YAAc,GAAG,GAAG,CAAC,CAAC,GAAG;gBAC3C,MAAM,eAAe,gBAAgB,IAAI;gBACzC,MAAM,WAAW,eAAe;gBAChC,IAAI,aAAa;gBAEjB,IAAI,UAAU;oBACV,IAAI,eAAe,gBAAgB,GAAG;wBAClC,aAAa;oBACjB,OAAO,IAAI,eAAe,gBAAgB,IAAI;wBAC1C,aAAa;oBACjB,OAAO;wBACH,aAAa;oBACjB;gBACJ,OAAO;oBACH,aAAa;gBACjB;gBAEA,qBACI,gOAAC;oBAEG,WAAW,IAAA,wJAAE,EAAC,6DAA6D;mBADtE;;;;;YAIjB;;;;;;;AAGZ;KAlCgB"}},
    {"offset": {"line": 126, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/SpectrumAnalyzer.tsx"],"sourcesContent":["'use client';\n\nimport React, { useEffect, useRef } from 'react';\nimport { cn } from '@/lib/utils';\nimport { useDAWStore } from '@/store/useDAWStore';\n\ninterface SpectrumAnalyzerProps {\n    analyzer?: AnalyserNode; // Optional: If provided, uses real audio data\n    naked?: boolean; // If true, removes background and border\n    isPlaying?: boolean; // Optional override\n}\n\nexport function SpectrumAnalyzer({ analyzer, naked, isPlaying }: SpectrumAnalyzerProps) {\n    const dawIsPlaying = useDAWStore((state) => state.isPlaying);\n    const actualIsPlaying = isPlaying !== undefined ? isPlaying : dawIsPlaying;\n    \n    const isPlayingRef = useRef(actualIsPlaying);\n    useEffect(() => {\n        isPlayingRef.current = actualIsPlaying;\n    }, [actualIsPlaying]);\n\n    const canvasRef = useRef<HTMLCanvasElement>(null);\n    const requestRef = useRef<number>(0);\n\n    // Smooth falloff state holding the max peaks\n    const peaksRef = useRef<number[]>([]);\n\n    useEffect(() => {\n        const canvas = canvasRef.current;\n        if (!canvas) return;\n\n        const ctx = canvas.getContext('2d');\n        if (!ctx) return;\n\n        // Ensure canvas renders sharply on high-DPI displays\n        const scale = window.devicePixelRatio || 1;\n        canvas.width = canvas.clientWidth * scale;\n        canvas.height = canvas.clientHeight * scale;\n        ctx.scale(scale, scale);\n\n        const width = canvas.clientWidth;\n        const height = canvas.clientHeight;\n\n        let dataArray: Uint8Array;\n        let bufferLength = 128; // Default if no analyzer\n\n        if (analyzer) {\n            bufferLength = analyzer.frequencyBinCount;\n            dataArray = new Uint8Array(bufferLength);\n        } else {\n            dataArray = new Uint8Array(bufferLength);\n        }\n\n        // Initialize peaks array\n        if (peaksRef.current.length !== bufferLength) {\n            peaksRef.current = new Array(bufferLength).fill(0);\n        }\n\n        const renderFrame = () => {\n            requestRef.current = requestAnimationFrame(renderFrame);\n\n            if (!isPlayingRef.current) {\n                // Dim the display when not playing\n                ctx.clearRect(0, 0, canvas.width, canvas.height);\n                // Slowly decay any existing peaks\n                peaksRef.current = peaksRef.current.map(p => p * 0.9);\n\n                // Draw static low baseline\n                const barWidth = Math.ceil(canvas.width / bufferLength);\n                for (let i = 0; i < bufferLength; i++) {\n                    const x = i * barWidth;\n                    ctx.fillStyle = `rgba(255, 107, 0, 0.05)`;\n                    ctx.fillRect(x, canvas.height - 2, barWidth - 1, 2);\n                }\n                return;\n            }\n\n            // Get audio data\n            if (analyzer) {\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                analyzer.getByteFrequencyData(dataArray as any);\n            } else {\n                // Simulate data for visual placeholder\n                const time = Date.now() / 1000;\n                for (let i = 0; i < bufferLength; i++) {\n                    // Create some dynamic peaks that look like music\n                    const noise = Math.random() * 20;\n                    const wave1 = Math.sin(time * 2 + i * 0.1) * 50 + 50;\n                    const wave2 = Math.cos(time * 5 - i * 0.3) * 60 + 60;\n\n                    // Emphasize bass (lower indices)\n                    const bassBoost = i < 20 ? (20 - i) * 3 : 0;\n\n                    // Attenuate highs\n                    const highCut = i > 80 ? (i - 80) * 2 : 0;\n\n                    let val = (wave1 + wave2) / 2 + noise + bassBoost - highCut;\n\n                    // Occasional random spikes (like kick/snare)\n                    if (Math.random() > 0.95 && i < 40) val += 80;\n\n                    dataArray[i] = Math.max(0, Math.min(255, val));\n                }\n            }\n\n            // Clear canvas\n            ctx.clearRect(0, 0, width, height);\n\n            // Calculate bar width (leaving some gap)\n            // We use a subset of the buffer for better aesthetics (skipping the very highest dead frequencies)\n            const displayBins = Math.floor(bufferLength * 0.7);\n            const barWidth = (width / displayBins) - 1; // 1px gap\n            let x = 0;\n\n            const peaks = peaksRef.current;\n            const gravity = 1.5; // Speed at which peaks fall\n\n            for (let i = 0; i < displayBins; i++) {\n                const value = dataArray[i];\n\n                // Update peak for smooth falloff\n                if (value > peaks[i]) {\n                    peaks[i] = value;\n                } else {\n                    peaks[i] = Math.max(0, peaks[i] - gravity);\n                }\n\n                // Normalize values to canvas height\n                const barHeight = (value / 255) * height;\n                const peakHeight = (peaks[i] / 255) * height;\n\n                // --- Draw Main Bar ---\n                // Gradient from Metallic Gray to DA GRABA Naranja (#FF6B00)\n                const barGradient = ctx.createLinearGradient(0, height, 0, height - barHeight);\n                barGradient.addColorStop(0, '#5A5A60');      // Metallic gray base\n                barGradient.addColorStop(0.5, '#8C8C91');    // Lighter gray middle\n                barGradient.addColorStop(1, '#FF6B00');      // Orange peak\n\n                ctx.fillStyle = barGradient;\n                ctx.fillRect(x, height - barHeight, barWidth, barHeight);\n\n                // --- Draw Floating Peak (Cap) ---\n                // To enhance the 2D/3D feel, draw a bright cap at the peak level\n                ctx.fillStyle = '#FF9A4A'; // Slightly brighter orange for the cap\n                ctx.fillRect(x, height - peakHeight - 2, barWidth, 2);\n\n                x += barWidth + 1;\n            }\n        };\n\n        renderFrame();\n\n        return () => {\n            if (requestRef.current) {\n                cancelAnimationFrame(requestRef.current);\n            }\n        };\n    }, [analyzer]);\n\n    return (\n        <div className={cn(\n            \"w-full h-full relative p-2 overflow-hidden\",\n            !naked && \"bg-[#111113]/60 backdrop-blur-md rounded-lg border border-[#333] shadow-[inset_0_0_20px_rgba(0,0,0,0.8)]\"\n        )}>\n            {/* Glassmorphism reflection highlight */}\n            <div className=\"absolute top-0 left-0 right-0 h-1/3 bg-gradient-to-b from-white/5 to-transparent pointer-events-none rounded-t-lg\" />\n\n            <canvas\n                ref={canvasRef}\n                className=\"w-full h-full block\"\n            />\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 312, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/PluginPicker.tsx"],"sourcesContent":["'use client';\n\nimport React from 'react';\nimport { FXInsert } from '@/store/useDAWStore';\n\ninterface PluginPickerProps {\n    onSelect: (pluginId: FXInsert['pluginId']) => void;\n    onClose: () => void;\n}\n\nexport function PluginPicker({ onSelect, onClose }: PluginPickerProps) {\n    const plugins: { id: FXInsert['pluginId']; name: string; color: string }[] = [\n        { id: 'gate', name: 'Gate', color: 'text-cyan-400' },\n        { id: 'eq', name: 'Equalizer', color: 'text-cyan-400' },\n        { id: 'leveler', name: 'Leveler', color: 'text-cyan-400' },\n        { id: 'compressor', name: 'Compressor', color: 'text-cyan-400' },\n        { id: 'multiband', name: 'Multiband', color: 'text-cyan-400' },\n        { id: 'limiter', name: 'Limiter', color: 'text-cyan-400' },\n        { id: 'reverb', name: 'Reverb', color: 'text-cyan-300' },\n        { id: 'delay', name: 'Delay', color: 'text-orange-400' },\n        { id: 'chorus', name: 'Chorus', color: 'text-purple-400' },\n        { id: 'distortion', name: 'Distortion', color: 'text-red-400' },\n    ];\n\n    const wasmPlugins: { id: FXInsert['pluginId']; name: string; color: string }[] = [\n        { id: 'saturator', name: 'Saturator ⚡', color: 'text-orange-400' },\n    ];\n\n    return (\n        <div className=\"absolute top-0 left-0 w-56 bg-[#1A1A1A] border border-white/10 rounded-md shadow-2xl z-[150] p-1 animate-in fade-in zoom-in-95 duration-100\">\n            <div className=\"px-3 py-1.5 border-b border-white/5 mb-1\">\n                <span className=\"text-[9px] font-black text-white/40 uppercase tracking-widest\">Select Effect</span>\n            </div>\n            <div className=\"mb-1\">\n                <span className=\"px-3 text-[8px] font-black text-white/20 uppercase tracking-widest\">Dynamics</span>\n                {plugins.slice(0, 6).map((plugin) => (\n                    <button\n                        key={plugin.id}\n                        onClick={() => { onSelect(plugin.id); onClose(); }}\n                        className={`w-full text-left px-3 py-1.5 text-[10px] hover:text-white hover:bg-cyan-500/20 rounded-sm transition-colors uppercase font-bold tracking-tight ${plugin.color}`}\n                    >\n                        {plugin.name}\n                    </button>\n                ))}\n            </div>\n            <div className=\"mb-1 border-t border-white/5 pt-1\">\n                <span className=\"px-3 text-[8px] font-black text-white/20 uppercase tracking-widest\">Time FX</span>\n                {plugins.slice(6).map((plugin) => (\n                    <button\n                        key={plugin.id}\n                        onClick={() => { onSelect(plugin.id); onClose(); }}\n                        className={`w-full text-left px-3 py-1.5 text-[10px] hover:text-white rounded-sm transition-colors uppercase font-bold tracking-tight ${plugin.color} hover:bg-white/10`}\n                    >\n                        {plugin.name}\n                    </button>\n                ))}\n            </div>\n            <div className=\"mb-1 border-t border-white/5 pt-1\">\n                <span className=\"px-3 text-[8px] font-black text-orange-400/40 uppercase tracking-widest\">WASM DSP ⚡</span>\n                {wasmPlugins.map((plugin) => (\n                    <button\n                        key={plugin.id}\n                        onClick={() => { onSelect(plugin.id); onClose(); }}\n                        className={`w-full text-left px-3 py-1.5 text-[10px] hover:text-white rounded-sm transition-colors uppercase font-bold tracking-tight ${plugin.color} hover:bg-orange-500/10`}\n                    >\n                        {plugin.name}\n                    </button>\n                ))}\n            </div>\n            <div className=\"mt-1 pt-1 border-t border-white/5\">\n                <button\n                    onClick={onClose}\n                    className=\"w-full text-left px-3 py-1.5 text-[10px] text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded-sm transition-colors uppercase font-bold tracking-tight\"\n                >\n                    Cancel\n                </button>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAAA;;AAUO,SAAS,aAAa,EAAE,QAAQ,EAAE,OAAO,EAAqB;IACjE,MAAM,UAAuE;QACzE;YAAE,IAAI;YAAQ,MAAM;YAAQ,OAAO;QAAgB;QACnD;YAAE,IAAI;YAAM,MAAM;YAAa,OAAO;QAAgB;QACtD;YAAE,IAAI;YAAW,MAAM;YAAW,OAAO;QAAgB;QACzD;YAAE,IAAI;YAAc,MAAM;YAAc,OAAO;QAAgB;QAC/D;YAAE,IAAI;YAAa,MAAM;YAAa,OAAO;QAAgB;QAC7D;YAAE,IAAI;YAAW,MAAM;YAAW,OAAO;QAAgB;QACzD;YAAE,IAAI;YAAU,MAAM;YAAU,OAAO;QAAgB;QACvD;YAAE,IAAI;YAAS,MAAM;YAAS,OAAO;QAAkB;QACvD;YAAE,IAAI;YAAU,MAAM;YAAU,OAAO;QAAkB;QACzD;YAAE,IAAI;YAAc,MAAM;YAAc,OAAO;QAAe;KACjE;IAED,MAAM,cAA2E;QAC7E;YAAE,IAAI;YAAa,MAAM;YAAe,OAAO;QAAkB;KACpE;IAED,qBACI,gOAAC;QAAI,WAAU;;0BACX,gOAAC;gBAAI,WAAU;0BACX,cAAA,gOAAC;oBAAK,WAAU;8BAAgE;;;;;;;;;;;0BAEpF,gOAAC;gBAAI,WAAU;;kCACX,gOAAC;wBAAK,WAAU;kCAAqE;;;;;;oBACpF,QAAQ,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,CAAC,uBACtB,gOAAC;4BAEG,SAAS;gCAAQ,SAAS,OAAO,EAAE;gCAAG;4BAAW;4BACjD,WAAW,CAAC,+IAA+I,EAAE,OAAO,KAAK,EAAE;sCAE1K,OAAO,IAAI;2BAJP,OAAO,EAAE;;;;;;;;;;;0BAQ1B,gOAAC;gBAAI,WAAU;;kCACX,gOAAC;wBAAK,WAAU;kCAAqE;;;;;;oBACpF,QAAQ,KAAK,CAAC,GAAG,GAAG,CAAC,CAAC,uBACnB,gOAAC;4BAEG,SAAS;gCAAQ,SAAS,OAAO,EAAE;gCAAG;4BAAW;4BACjD,WAAW,CAAC,0HAA0H,EAAE,OAAO,KAAK,CAAC,kBAAkB,CAAC;sCAEvK,OAAO,IAAI;2BAJP,OAAO,EAAE;;;;;;;;;;;0BAQ1B,gOAAC;gBAAI,WAAU;;kCACX,gOAAC;wBAAK,WAAU;kCAA0E;;;;;;oBACzF,YAAY,GAAG,CAAC,CAAC,uBACd,gOAAC;4BAEG,SAAS;gCAAQ,SAAS,OAAO,EAAE;gCAAG;4BAAW;4BACjD,WAAW,CAAC,0HAA0H,EAAE,OAAO,KAAK,CAAC,uBAAuB,CAAC;sCAE5K,OAAO,IAAI;2BAJP,OAAO,EAAE;;;;;;;;;;;0BAQ1B,gOAAC;gBAAI,WAAU;0BACX,cAAA,gOAAC;oBACG,SAAS;oBACT,WAAU;8BACb;;;;;;;;;;;;;;;;;AAMjB;KArEgB"}},
    {"offset": {"line": 517, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/lib/audio/WebAudioEngine.ts"],"sourcesContent":["export interface TrackChain {\n    input: GainNode;\n    inserts: AudioNode[];\n    gate?: DynamicsCompressorNode;\n    eqBands?: BiquadFilterNode[]; // [lowShelf, midPeak, highShelf, presencePeak]\n    compressor?: DynamicsCompressorNode;\n    makeup?: GainNode;\n    limiter?: DynamicsCompressorNode;\n    wasmLimiter?: AudioWorkletNode;\n    muteGain: GainNode; // Dedicated node for Mute/Solo\n    output: GainNode;\n    panner: StereoPannerNode;\n    analyser: AnalyserNode;\n    stemDSP?: {\n        splitter: ChannelSplitterNode;\n        merger: ChannelMergerNode;\n        midGain: GainNode;\n        sideGain: GainNode;\n        filters: BiquadFilterNode[];\n    };\n    source?: MediaElementAudioSourceNode | AudioBufferSourceNode;\n    isMuted: boolean;\n    isSoloed: boolean;\n}\n\nclass WebAudioEngine {\n    private ctx: AudioContext | null = null;\n    private masterGain: GainNode | null = null;\n    private trackChains: Map<string, TrackChain> = new Map();\n    private sourceNodeMap: WeakMap<HTMLMediaElement, MediaElementAudioSourceNode> = new WeakMap();\n    private isPlaying = false;\n    private playhead = 0;\n    private startTime = 0;\n    private soloedTracks: Set<string> = new Set();\n    private dspWorkletReady = false;\n\n    constructor() {\n        // We delay context creation until a user interaction (play)\n    }\n\n    public initContext() {\n        if (!this.ctx) {\n            this.ctx = new (window.AudioContext || (window as any).webkitAudioContext)();\n            this.masterGain = this.ctx.createGain();\n            this.masterGain.connect(this.ctx.destination);\n        }\n        if (this.ctx.state === 'suspended') {\n            this.ctx.resume();\n        }\n    }\n\n    private getOrCreateTrack(trackId: string): TrackChain {\n        this.initContext();\n        if (!this.trackChains.has(trackId)) {\n            const ctx = this.ctx!;\n            const input = ctx.createGain();\n            const muteGain = ctx.createGain();\n            const output = ctx.createGain();\n            const panner = ctx.createStereoPanner();\n            const analyser = ctx.createAnalyser();\n\n            analyser.fftSize = 256;\n\n            // Initial chain: Input -> Pan -> MuteGain -> Output -> Analyser -> Master\n            input.connect(panner);\n            panner.connect(muteGain);\n            muteGain.connect(output);\n            output.connect(analyser);\n            analyser.connect(this.masterGain!);\n\n            this.trackChains.set(trackId, {\n                input,\n                muteGain,\n                output,\n                panner,\n                analyser,\n                inserts: [],\n                isMuted: false,\n                isSoloed: false\n            });\n        }\n        return this.trackChains.get(trackId)!;\n    }\n\n    init(sampleRate: number, bufferSize: number) {\n        console.log(`[WebAudioEngine] Ready for initialization. context will start on play.`);\n        return true;\n    }\n\n    /**\n     * Loads the AudioWorklet for the WebAssembly C++ engine.\n     * To be called when the user wants to switch to the professional offline engine.\n     */\n    async loadWasmLimiter() {\n        this.initContext();\n        try {\n            await this.ctx!.audioWorklet.addModule('/wasm/phaselimiter-worklet.js');\n            console.log(\"[WebAudioEngine] WASM AudioWorklet module loaded successfully.\");\n            return true;\n        } catch (error) {\n            console.error(\"[WebAudioEngine] Failed to load WASM AudioWorklet module:\", error);\n            return false;\n        }\n    }\n\n    /**\n     * Loads the Da Graba professional DSP suite (Compressor, Saturator, EQ).\n     * Call once on user interaction. The worklet runs C++ WASM on the audio thread.\n     */\n    async loadDaGrabaDSP(): Promise<boolean> {\n        if (this.dspWorkletReady) return true;\n        this.initContext();\n        try {\n            await this.ctx!.audioWorklet.addModule('/wasm/dagraba-dsp-worklet.js');\n            this.dspWorkletReady = true;\n            console.log('[WebAudioEngine] Da Graba DSP WASM worklet loaded.');\n            return true;\n        } catch (error) {\n            console.error('[WebAudioEngine] Failed to load Da Graba DSP worklet:', error);\n            return false;\n        }\n    }\n\n    /**\n     * Insert a WASM DSP plugin on a track.\n     * plugin: 'compressor' | 'saturator' | 'eq'\n     * Returns the AudioWorkletNode for parameter control.\n     */\n    async insertWasmPlugin(trackId: string, plugin: 'compressor' | 'saturator' | 'eq'): Promise<AudioWorkletNode | null> {\n        await this.loadDaGrabaDSP();\n        if (!this.dspWorkletReady || !this.ctx) return null;\n\n        const chain = this.getOrCreateTrack(trackId);\n\n        const node = new AudioWorkletNode(this.ctx, 'dagraba-dsp-processor', {\n            processorOptions: { plugin },\n            numberOfInputs: 1,\n            numberOfOutputs: 1,\n            outputChannelCount: [2]\n        });\n\n        // Insert into chain: after input, before panner\n        // For simplicity, chain the worklet between input and panner\n        const prevLast = chain.inserts.length > 0 ? chain.inserts[chain.inserts.length - 1] : chain.input;\n        try { prevLast.disconnect(chain.panner); } catch (e) { }\n        prevLast.connect(node);\n        node.connect(chain.panner);\n        chain.inserts.push(node);\n\n        console.log(`[WebAudioEngine] Inserted WASM ${plugin} on track ${trackId}`);\n        return node;\n    }\n\n    play() {\n        if (this.isPlaying) return;\n        this.initContext();\n        this.isPlaying = true;\n        this.startTime = this.ctx!.currentTime - this.playhead;\n        console.log(`[WebAudioEngine] Playback started.`);\n    }\n\n    pause() {\n        this.isPlaying = false;\n        if (this.ctx) {\n            this.playhead = this.ctx.currentTime - this.startTime;\n        }\n        console.log(`[WebAudioEngine] Playback paused.`);\n    }\n\n    stop() {\n        this.isPlaying = false;\n        this.playhead = 0;\n        console.log(`[WebAudioEngine] Playback stopped.`);\n    }\n\n    setPlayheadPosition(seconds: number) {\n        this.playhead = seconds;\n        if (this.isPlaying && this.ctx) {\n            this.startTime = this.ctx.currentTime - seconds;\n        }\n    }\n\n    getPlayheadPosition() {\n        if (this.isPlaying && this.ctx) {\n            return this.ctx.currentTime - this.startTime;\n        }\n        return this.playhead;\n    }\n\n    setTrackVolume(trackId: string, value: number) {\n        // value 0-100 to gain 0-1\n        const chain = this.getOrCreateTrack(trackId);\n        const gainValue = value / 100;\n        chain.output.gain.setTargetAtTime(gainValue, this.ctx!.currentTime, 0.05);\n    }\n\n    setTrackPan(trackId: string, value: number) {\n        // value -50 to 50 to pan -1 to 1\n        const chain = this.getOrCreateTrack(trackId);\n        const panValue = value / 50;\n        chain.panner.pan.setTargetAtTime(panValue, this.ctx!.currentTime, 0.05);\n    }\n\n    setTrackMute(trackId: string, isMuted: boolean) {\n        const chain = this.getOrCreateTrack(trackId);\n        chain.isMuted = isMuted;\n        this.updateRoutingLevels();\n    }\n\n    setTrackSolo(trackId: string, isSolo: boolean) {\n        const chain = this.getOrCreateTrack(trackId);\n        chain.isSoloed = isSolo;\n\n        if (isSolo) {\n            this.soloedTracks.add(trackId);\n        } else {\n            this.soloedTracks.delete(trackId);\n        }\n\n        this.updateRoutingLevels();\n    }\n\n    private updateRoutingLevels() {\n        // A track is audible IF (no tracks are soloed OR it is soloed) AND (it is not muted)\n        const hasSolo = this.soloedTracks.size > 0;\n\n        this.trackChains.forEach((chain, id) => {\n            const shouldBeHeard = (hasSolo ? chain.isSoloed : true) && !chain.isMuted;\n            const targetGain = shouldBeHeard ? 1 : 0;\n            chain.muteGain.gain.setTargetAtTime(targetGain, this.ctx!.currentTime, 0.05);\n        });\n    }\n\n    moveAudioClip(clipId: string, newTime: number) {\n        // Dummy implementation\n    }\n\n    getWaveformData(clipId: string, arg2?: any): number[] {\n        // Dummy implementation\n        return [];\n    }\n\n    // New method to connect a real audio element (like in the mastering page)\n    connectAudioElement(trackId: string, element: HTMLMediaElement) {\n        this.initContext();\n        const chain = this.getOrCreateTrack(trackId);\n\n        // Disconnect previous source associated with this track chain to prevent accumulation\n        if (chain.source) {\n            try { chain.source.disconnect(); } catch (e) { }\n        }\n\n        let source = this.sourceNodeMap.get(element);\n        if (!source) {\n            try {\n                source = this.ctx!.createMediaElementSource(element);\n                this.sourceNodeMap.set(element, source);\n            } catch (e) {\n                console.warn('Failed to create media element source', e);\n                return;\n            }\n        }\n\n        try { source.disconnect(); } catch (e) { }\n        source.connect(chain.input);\n        chain.source = source;\n\n        // Apply automatic stem separation if URL contains stem parameter\n        const url = new URL(element.src, window.location.href);\n        let stemType = url.searchParams.get('stem');\n\n        // Handle proxy URL case where stem parameter is encoded inside the 'url' parameter\n        if (!stemType) {\n            const innerUrlStr = url.searchParams.get('url');\n            if (innerUrlStr) {\n                try {\n                    // Try to parse as URL\n                    const innerUrl = new URL(innerUrlStr, window.location.href);\n                    stemType = innerUrl.searchParams.get('stem');\n                } catch (e) {\n                    // Fallback to simple query string parsing if it's just a path\n                    const match = innerUrlStr.match(/[?&]stem=([^&]+)/);\n                    if (match) stemType = match[1];\n                }\n            }\n        }\n\n        if (stemType) {\n            this.applyStemSeparation(trackId, stemType);\n        }\n    }\n\n    private applyStemSeparation(trackId: string, type: string) {\n        const chain = this.getOrCreateTrack(trackId);\n        const ctx = this.ctx!;\n\n        // Clean up previous stem DSP if any\n        if (chain.stemDSP) {\n            try {\n                chain.input.disconnect(chain.stemDSP.splitter);\n                chain.stemDSP.merger.disconnect();\n                chain.stemDSP.filters.forEach(f => f.disconnect());\n            } catch (e) { }\n        }\n\n        const splitter = ctx.createChannelSplitter(2);\n        const merger = ctx.createChannelMerger(2);\n        const midGain = ctx.createGain();\n        const sideGain = ctx.createGain();\n        const filters: BiquadFilterNode[] = [];\n\n        // Mid-Side Logic for Separation\n        // Mid = (L + R) / 2\n        // Side = (L - R) / 2\n        const midInverter = ctx.createGain();\n        midInverter.gain.value = -1;\n\n        splitter.connect(midGain, 0); // L\n        splitter.connect(midGain, 1); // R\n        midGain.gain.value = 0.5;\n\n        splitter.connect(sideGain, 0); // L\n        splitter.connect(midInverter, 1); // -R\n        midInverter.connect(sideGain);\n        sideGain.gain.value = 0.5;\n\n        // Routing based on Stem Type\n        const dspOutput = ctx.createGain();\n\n        if (type === 'vocal') {\n            // Vocals are usually centered (Mid channel)\n            const hp = ctx.createBiquadFilter();\n            hp.type = 'highpass';\n            hp.frequency.value = 250;\n\n            const lp = ctx.createBiquadFilter();\n            lp.type = 'lowpass';\n            lp.frequency.value = 4000;\n\n            const peak = ctx.createBiquadFilter();\n            peak.type = 'peaking';\n            peak.frequency.value = 3000;\n            peak.gain.value = 3;\n\n            midGain.connect(hp);\n            hp.connect(lp);\n            lp.connect(peak);\n            peak.connect(dspOutput);\n            filters.push(hp, lp, peak);\n\n            // Kill sides for isolation\n            sideGain.gain.value = 0;\n        } else if (type === 'beat' || type === 'bajo') {\n            // Beat/Bass are Mid heavy but need different EQ\n            const lp = ctx.createBiquadFilter();\n            lp.type = 'lowpass';\n            lp.frequency.value = type === 'bajo' ? 200 : 800;\n\n            midGain.connect(lp);\n            lp.connect(dspOutput);\n            filters.push(lp);\n            sideGain.gain.value = 0.1; // Minimal sides\n        } else {\n            // Melody/FX are often panned or wide (Sides)\n            const hp = ctx.createBiquadFilter();\n            hp.type = 'highpass';\n            hp.frequency.value = 400;\n\n            sideGain.connect(hp);\n            hp.connect(dspOutput);\n            filters.push(hp);\n            midGain.gain.value = 0.3; // Low mid to avoid echo\n        }\n\n        // Connect chain: Input -> Splitter -> (Mid/Side processing) -> dspOutput -> Panner\n        chain.input.disconnect();\n        chain.input.connect(splitter);\n        dspOutput.connect(chain.panner);\n\n        chain.stemDSP = { splitter, merger, midGain, sideGain, filters };\n        console.log(`[WebAudioEngine] Applied SSE separation for stem: ${type} on track: ${trackId}`);\n    }\n\n    /**\n     * Performs an offline analysis of an audio file to determine its \"DNA\" (RMS, Peak, Crest Factor).\n     * Used by the AI to set accurate dynamic and loudness targets.\n     */\n    async analyzeAudioBuffer(audioUrl: string): Promise<{ rms: number, peak: number, crestFactor: number } | null> {\n        try {\n            console.log('[WebAudioEngine] Fetching audio for analysis...');\n            const response = await fetch(audioUrl);\n            const arrayBuffer = await response.arrayBuffer();\n\n            // Use an OfflineAudioContext just to decode (or use main ctx)\n            this.initContext();\n            console.log('[WebAudioEngine] Decoding audio data...');\n            const audioBuffer = await this.ctx!.decodeAudioData(arrayBuffer);\n\n            const channelData = audioBuffer.getChannelData(0); // Analyze left/mono channel for speed\n            let sumSquares = 0;\n            let peak = 0;\n\n            // Calculate RMS and Peak\n            console.log('[WebAudioEngine] Calculating RMS and Peak...');\n            const length = channelData.length;\n            const step = Math.max(1, Math.floor(length / 441000)); // Sample every ~100ms to speed up analysis if huge, or just process all if fast\n\n            // For true accuracy, process all samples, it's usually less than 100ms in a Wasm/V8 loop\n            for (let i = 0; i < length; i += 1) {\n                const sample = channelData[i];\n                const abs = Math.abs(sample);\n                sumSquares += sample * sample;\n                if (abs > peak) {\n                    peak = abs;\n                }\n            }\n\n            const rms = Math.sqrt(sumSquares / length);\n\n            // Convert to dB\n            const rmsDb = 20 * Math.log10(rms || 0.0001);\n            const peakDb = 20 * Math.log10(peak || 0.0001);\n            const crestFactor = peakDb - rmsDb; // Difference between peak and average\n\n            console.log(`[WebAudioEngine] Analysis complete. RMS: ${rmsDb.toFixed(2)}dB, Peak: ${peakDb.toFixed(2)}dB, CF: ${crestFactor.toFixed(2)}dB`);\n\n            return {\n                rms: rmsDb,\n                peak: peakDb,\n                crestFactor: crestFactor\n            };\n\n        } catch (error) {\n            console.error('[WebAudioEngine] Audio analysis failed:', error);\n            return null;\n        }\n    }\n\n    getVUMeterLevel(trackId: string): number {\n        const chain = this.trackChains.get(trackId);\n        if (!chain) return 0;\n\n        const dataArray = new Uint8Array(chain.analyser.frequencyBinCount);\n        chain.analyser.getByteFrequencyData(dataArray);\n\n        let sum = 0;\n        for (let i = 0; i < dataArray.length; i++) {\n            sum += dataArray[i];\n        }\n        return Math.floor((sum / dataArray.length) * 1.5);\n    }\n\n    getFrequencyLevel(trackId: string, minFreq: number, maxFreq: number): number {\n        const chain = this.trackChains.get(trackId);\n        if (!chain || !this.ctx) return 0;\n\n        const bufferLength = chain.analyser.frequencyBinCount;\n        const dataArray = new Uint8Array(bufferLength);\n        chain.analyser.getByteFrequencyData(dataArray);\n\n        const nyquist = this.ctx.sampleRate / 2;\n        const indexMin = Math.round((minFreq / nyquist) * bufferLength);\n        const indexMax = Math.round((maxFreq / nyquist) * bufferLength);\n\n        let sum = 0;\n        let count = 0;\n        for (let i = indexMin; i <= indexMax; i++) {\n            sum += dataArray[i];\n            count++;\n        }\n\n        return count > 0 ? sum / count / 255 : 0;\n    }\n\n    getTrackAnalyser(trackId: string): AnalyserNode | undefined {\n        return this.trackChains.get(trackId)?.analyser;\n    }\n\n    // --- Plugin System ---\n\n    updateGate(trackId: string, threshold: number, bypass: boolean) {\n        const chain = this.getOrCreateTrack(trackId);\n        if (!chain.gate) {\n            // Real noise gates are complex in WebAudio without script processors.\n            // A compressor acts backwards (reduces loud, not quiet).\n            // We'll leave the node for routing but keep it fully transparent.\n            const gate = this.ctx!.createDynamicsCompressor();\n            gate.ratio.value = 1; // 1:1 ratio (no compression)\n            gate.threshold.value = 0; // 0 dB \n            chain.gate = gate;\n\n            // Route: input -> gate -> [eqBands] -> [compressor] -> [makeup] -> [limiter] -> panner\n            chain.input.disconnect();\n            chain.input.connect(gate);\n            const nextNode = (chain.eqBands ? chain.eqBands[0] : null) || chain.compressor || chain.makeup || chain.limiter || chain.panner;\n            gate.connect(nextNode);\n        }\n\n        // Always bypass to prevent volume destruction\n        chain.gate.ratio.setTargetAtTime(1, this.ctx!.currentTime, 0.1);\n        chain.gate.threshold.setTargetAtTime(0, this.ctx!.currentTime, 0.1);\n    }\n\n    updateEQ(trackId: string, highpass: number, tilt: number, sideGain: number, sideFreq: number, bypass: boolean) {\n        const chain = this.getOrCreateTrack(trackId);\n        if (!chain.eqBands) {\n            const low = this.ctx!.createBiquadFilter();\n            low.type = 'lowshelf';\n            low.frequency.value = 80;\n\n            const mid = this.ctx!.createBiquadFilter();\n            mid.type = 'peaking';\n            mid.frequency.value = 1000;\n            mid.Q.value = 0.5;\n\n            const high = this.ctx!.createBiquadFilter();\n            high.type = 'highshelf';\n            high.frequency.value = 6000;\n\n            const presence = this.ctx!.createBiquadFilter();\n            presence.type = 'peaking';\n            presence.frequency.value = 3500;\n            presence.Q.value = 1.0;\n\n            low.connect(mid);\n            mid.connect(high);\n            high.connect(presence);\n\n            chain.eqBands = [low, mid, high, presence];\n\n            // Re-route\n            const prevNode = chain.gate || chain.input;\n            prevNode.disconnect();\n            prevNode.connect(low);\n            const nextNode = chain.compressor || chain.makeup || chain.limiter || chain.panner;\n            presence.connect(nextNode);\n        }\n\n        const [low, mid, high, presence] = chain.eqBands;\n\n        if (bypass) {\n            low.gain.setTargetAtTime(0, this.ctx!.currentTime, 0.1);\n            mid.gain.setTargetAtTime(0, this.ctx!.currentTime, 0.1);\n            high.gain.setTargetAtTime(0, this.ctx!.currentTime, 0.1);\n            presence.gain.setTargetAtTime(0, this.ctx!.currentTime, 0.1);\n        } else {\n            // Knob (0-100) Maps to (-12dB to +12dB). Neutral is 50.\n            low.gain.setTargetAtTime((highpass - 50) * 0.24, this.ctx!.currentTime, 0.1);\n            mid.gain.setTargetAtTime((tilt - 50) * 0.24, this.ctx!.currentTime, 0.1);\n            high.gain.setTargetAtTime((sideGain - 50) * 0.24, this.ctx!.currentTime, 0.1);\n            // Presence (0-100) maps to (0dB to +6dB). Neutral is 0.\n            presence.gain.setTargetAtTime((sideFreq / 100) * 6, this.ctx!.currentTime, 0.1);\n        }\n    }\n\n    updateCompressor(trackId: string, strength: number, attack: number, release: number, bypass: boolean) {\n        const chain = this.getOrCreateTrack(trackId);\n        if (!chain.compressor) {\n            chain.compressor = this.ctx!.createDynamicsCompressor();\n            // Re-route\n            const prevNode = (chain.eqBands ? chain.eqBands[chain.eqBands.length - 1] : null) || chain.gate || chain.input;\n            prevNode.disconnect();\n            prevNode.connect(chain.compressor);\n            const nextNode = chain.makeup || chain.limiter || chain.panner;\n            chain.compressor.connect(nextNode);\n        }\n\n        if (bypass) {\n            chain.compressor.ratio.setTargetAtTime(1, this.ctx!.currentTime, 0.1);\n        } else {\n            // Strength (0-100) -> Threshold (-10 to -25dB), Ratio (1.2 to 4.0)\n            const threshold = -10 - ((strength / 100) * 15);\n            const ratio = 1.2 + ((strength / 100) * 2.8);\n\n            chain.compressor.threshold.setTargetAtTime(threshold, this.ctx!.currentTime, 0.1);\n            chain.compressor.ratio.setTargetAtTime(ratio, this.ctx!.currentTime, 0.1);\n            chain.compressor.attack.setTargetAtTime(attack / 1000, this.ctx!.currentTime, 0.1);\n            chain.compressor.release.setTargetAtTime(release / 1000, this.ctx!.currentTime, 0.1);\n        }\n    }\n\n    updateLeveler(trackId: string, target: number, bypass: boolean) {\n        // We use Leveler as the Makeup Gain before the Limiter!\n        const chain = this.getOrCreateTrack(trackId);\n\n        if (!chain.makeup) {\n            chain.makeup = this.ctx!.createGain();\n            const prevNode = chain.compressor || (chain.eqBands ? chain.eqBands[chain.eqBands.length - 1] : null) || chain.gate || chain.input;\n            prevNode.disconnect();\n            prevNode.connect(chain.makeup);\n            const nextNode = chain.limiter || chain.panner;\n            chain.makeup.connect(nextNode);\n        }\n\n        if (bypass) {\n            chain.makeup.gain.setTargetAtTime(1, this.ctx!.currentTime, 0.1);\n        } else {\n            // Target (0-100) maps to 0dB to +15dB of gain!\n            // This gain pushes the signal into the limiter (Loudness Maximizer)\n            const dbGain = (target / 100) * 15; // 0 to +15 dB\n            const gainValue = Math.pow(10, dbGain / 20);\n            chain.makeup.gain.setTargetAtTime(gainValue, this.ctx!.currentTime, 0.1);\n        }\n    }\n\n    updateLimiter(trackId: string, strength: number, ceiling: number, bypass: boolean, useWasm: boolean = false) {\n        const chain = this.getOrCreateTrack(trackId);\n\n        if (useWasm) {\n            if (!chain.wasmLimiter) {\n                try {\n                    chain.wasmLimiter = new AudioWorkletNode(this.ctx!, 'phaselimiter-worklet');\n                    const prevNode = chain.makeup || chain.compressor || (chain.eqBands ? chain.eqBands[chain.eqBands.length - 1] : null) || chain.gate || chain.input;\n                    prevNode.disconnect();\n                    prevNode.connect(chain.wasmLimiter);\n                    chain.wasmLimiter.connect(chain.panner);\n                    console.log(\"[WebAudioEngine] Routed through WASM Limiter.\");\n                } catch (e) {\n                    console.warn(\"[WebAudioEngine] WASM Worklet not ready. Falling back to native limiter.\", e);\n                    useWasm = false;\n                }\n            }\n\n            // Send parameter updates to the worklet\n            if (chain.wasmLimiter) {\n                const ceilingDb = -0.3 - ((strength / 100) * 2.7); // -0.3 to -3 dBFS\n                chain.wasmLimiter.port.postMessage({\n                    type: 'params',\n                    ceiling: bypass ? 0 : ceilingDb,\n                    strength: strength / 100,\n                    bypass,\n                });\n                return;\n            }\n        }\n\n        // Disconnect WASM if it was connected and we're falling back\n        if (chain.wasmLimiter) {\n            chain.wasmLimiter.disconnect();\n        }\n\n        if (!chain.limiter) {\n            chain.limiter = this.ctx!.createDynamicsCompressor();\n            chain.limiter.ratio.value = 50;\n            chain.limiter.attack.value = 0.001;\n            chain.limiter.release.value = 0.05;\n            const prevNode = chain.makeup || chain.compressor || (chain.eqBands ? chain.eqBands[chain.eqBands.length - 1] : null) || chain.gate || chain.input;\n            prevNode.disconnect();\n            prevNode.connect(chain.limiter);\n            chain.limiter.connect(chain.panner);\n        }\n\n        if (bypass) {\n            chain.limiter.ratio.setTargetAtTime(1, this.ctx!.currentTime, 0.1);\n        } else {\n            const threshold = ceiling - ((strength / 100) * 3);\n            chain.limiter.threshold.setTargetAtTime(threshold, this.ctx!.currentTime, 0.1);\n        }\n    }\n\n\n    updateMultiband(trackId: string, lowStr: number, highStr: number, bypass: boolean) {\n        // Placeholder for multiband - logic would require a splitter and multiple compressors\n        // For now, let's just use it as a global tone shaper or additional compression\n    }\n}\n\nexport const audioEngine = new WebAudioEngine();\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1089, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/lib/audio-engine-bridge.ts"],"sourcesContent":["import { audioEngine } from './audio/WebAudioEngine';\n\nexport { audioEngine };\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 1100, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/Fader.tsx"],"sourcesContent":["'use client';\n\nimport { useDAWStore } from '@/store/useDAWStore';\nimport { Slider } from '@/components/ui/Slider';\nimport { VUMeter } from '@/components/daw/VUMeter';\nimport { SpectrumAnalyzer } from '@/components/daw/SpectrumAnalyzer';\nimport { cn } from '@/lib/utils';\nimport { PluginPicker } from './PluginPicker';\nimport { Power } from 'lucide-react';\nimport { useState, useEffect } from 'react';\nimport { audioEngine } from '@/lib/audio-engine-bridge';\n\ninterface FaderProps {\n    id: string;\n}\n\nexport function Fader({ id }: FaderProps) {\n    const fader = useDAWStore((state) => state.faders.find((f) => f.id === id));\n    const setFaderValue = useDAWStore((state) => state.setFaderValue);\n    const toggleSolo = useDAWStore((state) => state.toggleSolo);\n    const toggleMute = useDAWStore((state) => state.toggleMute);\n    const setPan = useDAWStore((state) => state.setPan);\n    const isFullMixer = useDAWStore((state) => state.isFullMixer);\n\n    const addInsert = useDAWStore((state) => state.addInsert);\n    const openPlugin = useDAWStore((state) => state.openPlugin);\n    const toggleInsertBypass = useDAWStore((state) => state.toggleInsertBypass);\n\n    const [pickerOpen, setPickerOpen] = useState(false);\n    const [realLevel, setRealLevel] = useState(0);\n\n    // Sync with Audio Engine\n    useEffect(() => {\n        if (!fader) return;\n        audioEngine.setTrackVolume(id, fader.value);\n        audioEngine.setTrackPan(id, fader.pan);\n        audioEngine.setTrackMute(id, fader.isMuted);\n    }, [id, fader?.value, fader?.pan, fader?.isMuted]);\n\n    if (!fader) return null;\n\n    // Level Update Loop\n    useEffect(() => {\n        let animationFrameId: number;\n        const updateLevel = () => {\n            const level = audioEngine.getVUMeterLevel(id);\n            setRealLevel(level);\n            animationFrameId = requestAnimationFrame(updateLevel);\n        };\n        updateLevel();\n        return () => cancelAnimationFrame(animationFrameId);\n    }, [id]);\n\n    if (!fader) return null;\n\n    return (\n        <div className={cn(\"flex flex-col items-center group transition-all duration-500\", isFullMixer ? \"w-24\" : \"w-16\")}>\n\n            {/* Top Digital Section: Spectrum Analyzer */}\n            <div className=\"w-full h-16 mb-2 bg-black border border-white/5 rounded-sm overflow-hidden shadow-inner relative group-hover:border-white/10 transition-colors\">\n                <SpectrumAnalyzer naked />\n                <div className=\"absolute inset-x-0 bottom-0 h-[1px] bg-cyan-400/20 shadow-[0_0_10px_rgba(34,211,238,0.5)]\" />\n            </div>\n\n            {/* FX Slots (Dynamic Inserts) */}\n            <div className=\"grid grid-cols-1 gap-1 w-full mb-3 px-1 relative\">\n                {[0, 1, 2, 3].map((index) => {\n                    const insert = fader.inserts[index];\n                    return (\n                        <div key={index} className=\"relative group/insert\">\n                            {insert ? (\n                                <div className=\"flex gap-0.5 h-5 w-full\">\n                                    <button\n                                        onClick={() => toggleInsertBypass(id, insert.id)}\n                                        className={cn(\n                                            \"w-4 h-full rounded-l-[1px] border border-white/5 flex items-center justify-center transition-all\",\n                                            insert.bypass ? \"bg-zinc-900 text-zinc-700\" : \"bg-cyan-900/40 text-cyan-400 shadow-[inset_0_0_10px_rgba(34,211,238,0.2)]\"\n                                        )}\n                                    >\n                                        <Power size={8} />\n                                    </button>\n                                    <button\n                                        onClick={() => openPlugin(insert.id)}\n                                        className={cn(\n                                            \"flex-1 rounded-r-[1px] bg-[#111] border-y border-r border-white/5 text-[7px] font-black transition-all tracking-tighter uppercase ring-1 ring-black flex items-center px-1.5\",\n                                            insert.bypass ? \"text-white/10\" : \"text-white/60 hover:text-white hover:bg-[#222]\"\n                                        )}\n                                    >\n                                        <span className=\"truncate\">{insert.pluginId}</span>\n                                    </button>\n                                </div>\n                            ) : (\n                                <button\n                                    onClick={() => setPickerOpen(true)}\n                                    className=\"h-5 w-full rounded-[1px] bg-black/40 border border-dashed border-white/5 text-[6px] font-bold text-white/5 hover:text-white/20 hover:border-white/10 hover:bg-white/5 transition-all uppercase tracking-widest\"\n                                >\n                                    Empty\n                                </button>\n                            )}\n                        </div>\n                    );\n                })}\n\n                {pickerOpen && (\n                    <PluginPicker\n                        onSelect={(pluginId) => addInsert(id, pluginId)}\n                        onClose={() => setPickerOpen(false)}\n                    />\n                )}\n            </div>\n\n            {/* Top Section: Buttons & Small Screen */}\n            <div className=\"flex flex-col gap-2 items-center mb-6 w-full px-1\">\n\n                {/* Mini Routing/Pan Screen (OLED style) */}\n                <div className=\"w-full h-10 bg-black border border-white/10 rounded-sm flex flex-col items-center justify-center shadow-[inset_0_2px_10px_rgba(0,0,0,1)] mb-2 overflow-hidden relative group\">\n                    <div className=\"absolute inset-0 bg-cyan-500/5 animate-pulse\" />\n                    <span className=\"text-[10px] font-mono text-cyan-400 tracking-widest drop-shadow-[0_0_5px_rgba(34,211,238,0.5)]\">\n                        {fader.pan === 0 ? 'C' : fader.pan > 0 ? `R${fader.pan}` : `L${Math.abs(fader.pan)}`}\n                    </span>\n                    <div className=\"w-4/5 h-[1px] bg-white/5 mt-1\" />\n                    <span className=\"text-[7px] font-mono text-white/20 mt-0.5 tracking-tighter uppercase\">Stereo Out</span>\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-1 w-full\">\n                    <button\n                        onClick={() => toggleSolo(id)}\n                        className={`h-7 rounded-sm text-[9px] font-black tracking-widest border transition-all duration-300 shadow-md ${fader.isSoloed ? 'bg-orange-500 border-orange-400 text-black shadow-[0_0_15px_rgba(249,115,22,0.5)] ring-1 ring-orange-300/50' : 'bg-neutral-900 border-white/5 text-white/30 hover:text-white/60 hover:bg-neutral-800'}`}\n                    >\n                        S\n                    </button>\n                    <button\n                        onClick={() => toggleMute(id)}\n                        className={`h-7 rounded-sm text-[9px] font-black tracking-widest border transition-all duration-300 shadow-md ${fader.isMuted ? 'bg-red-600 border-red-500 text-black shadow-[0_0_15px_rgba(220,38,38,0.5)] ring-1 ring-red-400/50' : 'bg-neutral-900 border-white/5 text-white/30 hover:text-white/60 hover:bg-neutral-800'}`}\n                    >\n                        M\n                    </button>\n                </div>\n\n                {/* Pan Knob */}\n                <div className=\"flex flex-col items-center gap-1 w-full mt-1\">\n                    <div className=\"flex items-center justify-between w-full px-1\">\n                        <span className=\"text-[7px] font-black text-white/20\">L</span>\n                        <span className={`text-[9px] font-mono font-black ${fader.pan === 0 ? 'text-cyan-400' : 'text-orange-400'}`}>\n                            {fader.pan === 0 ? 'C' : fader.pan > 0 ? `R${fader.pan}` : `L${Math.abs(fader.pan)}`}\n                        </span>\n                        <span className=\"text-[7px] font-black text-white/20\">R</span>\n                    </div>\n                    <input\n                        type=\"range\"\n                        min={-100}\n                        max={100}\n                        step={1}\n                        value={fader.pan}\n                        onChange={(e) => setPan(id, parseInt(e.target.value))}\n                        onDoubleClick={() => setPan(id, 0)}\n                        className=\"w-full h-1 accent-cyan-400 cursor-pointer\"\n                        style={{\n                            background: fader.pan === 0\n                                ? 'rgba(255,255,255,0.1)'\n                                : fader.pan > 0\n                                    ? `linear-gradient(to right, rgba(255,255,255,0.1) 50%, rgb(249,115,22) ${50 + fader.pan / 2}%, rgba(255,255,255,0.05) ${50 + fader.pan / 2}%)`\n                                    : `linear-gradient(to right, rgba(255,255,255,0.05) ${50 + fader.pan / 2}%, rgb(6,182,212) ${50 + fader.pan / 2}%, rgba(255,255,255,0.1) 50%)`\n                        }}\n                    />\n                    <span className=\"text-[6px] font-black text-white/10 uppercase tracking-widest\">Pan  ·  dbl-click reset</span>\n                </div>\n            </div>\n\n            {/* Main Fader Track Area */}\n            <div className=\"relative h-[300px] w-full bg-[#111] border-x border-[#222] flex shadow-inner group-hover:bg-[#141414] transition-colors rounded-t-sm\">\n\n                {/* Scale Markings Container */}\n                <div className=\"absolute left-1 inset-y-0 w-2 flex flex-col justify-between py-4 pointer-events-none z-0\">\n                    {[10, 5, 0, -5, -10, -20, -30, -60].map((val, i) => (\n                        <div key={i} className=\"w-full border-t border-silver-dark/40 relative\">\n                            {(val === 0 || val === 10 || val === -60) && (\n                                <span className={`absolute left-3 -top-2 text-[7px] font-mono ${(val === 0) ? 'text-primary' : 'text-silver-dark'}`}>\n                                    {val === -60 ? '-∞' : val}\n                                </span>\n                            )}\n                        </div>\n                    ))}\n                </div>\n\n                {/* LED VU Meter integrated into fader track */}\n                <div className=\"absolute right-1 top-4 bottom-4 w-1.5 opacity-80 pointer-events-none z-0\">\n                    <VUMeter level={fader.isMuted ? 0 : realLevel} className=\"h-full w-full rounded-sm\" />\n                </div>\n\n                {/* Functional Slider Track */}\n                <div className=\"absolute inset-0 flex justify-center z-10 w-full\">\n                    {/* The physical slit */}\n                    <div className=\"absolute top-4 bottom-4 w-1.5 bg-black rounded-full shadow-[inset_0_2px_5px_rgba(0,0,0,0.8)]\" />\n\n                    <Slider\n                        orientation=\"vertical\"\n                        min={0}\n                        max={100}\n                        value={fader.value}\n                        onChange={(e) => setFaderValue(id, parseInt(e.target.value))}\n                        className=\"h-full w-full cursor-grab active:cursor-grabbing transition-all duration-700 ease-in-out opacity-0 z-20\"\n                        style={{ writingMode: 'vertical-lr', direction: 'rtl' } as React.CSSProperties}\n                    />\n\n                    {/* Simulated 3D Fader Cap (Brushed Metal) */}\n                    <div\n                        className=\"absolute w-8 h-14 bg-[#CCCCCC] border-x border-[#999] shadow-[0_10px_30px_rgba(0,0,0,0.8),_inset_0_1px_4px_rgba(255,255,255,0.8)] rounded-[2px] pointer-events-none z-10 transition-all duration-700 ease-in-out flex flex-col items-center justify-center transform-gpu\"\n                        style={{ bottom: `calc(${fader.value}% - 28px)` }}\n                    >\n                        <div className=\"absolute inset-0 bg-gradient-to-r from-transparent via-white/40 to-transparent opacity-50\" />\n                        <div className=\"w-full h-[3px] bg-black/60 shadow-[0_1px_2px_rgba(255,255,255,0.2)]\" />\n                        <div className=\"w-full h-[4px] bg-gradient-to-b from-white/20 to-transparent mt-[1px]\" />\n                        <div className=\"mt-auto mb-1 flex flex-col gap-[2px]\">\n                            <div className=\"w-5 h-[1px] bg-black/20\" />\n                            <div className=\"w-5 h-[1px] bg-black/20\" />\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n\n            {/* Scribble Strip (Aluminium look) */}\n            <div className=\"w-full min-h-[48px] bg-gradient-to-b from-[#DEDEDE] to-[#B0B0B0] mt-1 rounded-b-md flex items-center justify-center shadow-[inset_0_2px_10px_rgba(255,255,255,0.8),_0_5px_15px_rgba(0,0,0,0.3)] border-b border-black/40 border-x border-black/20 px-1 overflow-hidden\">\n                <span className=\"font-mono text-[10px] font-black text-black/80 tracking-widest uppercase text-center break-words leading-tight\">{fader.label}</span>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1631, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/WaveformCanvas.tsx"],"sourcesContent":["'use client';\n\nimport React, { useEffect, useRef, useState } from 'react';\n\ninterface WaveformCanvasProps {\n    audioUrl?: string;\n    color: string;\n    width: number;\n    height: number;\n}\n\n// Global cache for waveforms to avoid re-decoding\nconst waveformCache = new Map<string, Float32Array>();\n\nexport function WaveformCanvas({ audioUrl, color, width, height }: WaveformCanvasProps) {\n    const canvasRef = useRef<HTMLCanvasElement>(null);\n    const [isLoading, setIsLoading] = useState(false);\n\n    useEffect(() => {\n        if (!audioUrl || !canvasRef.current) return;\n\n        const canvas = canvasRef.current;\n        const ctx = canvas.getContext('2d');\n        if (!ctx) return;\n\n        let cancelled = false;\n\n        async function drawWaveform() {\n            if (!audioUrl) return;\n\n            setIsLoading(true);\n\n            try {\n                let data: Float32Array;\n\n                if (waveformCache.has(audioUrl)) {\n                    data = waveformCache.get(audioUrl)!;\n                } else {\n                    // Fetch via proxy to avoid CORS\n                    const proxyUrl = `/api/audio-proxy?url=${encodeURIComponent(audioUrl)}`;\n                    const response = await fetch(proxyUrl);\n                    const arrayBuffer = await response.arrayBuffer();\n\n                    // Decode\n                    const audioCtx = new (window.AudioContext || (window as any).webkitAudioContext)();\n                    const audioBuffer = await audioCtx.decodeAudioData(arrayBuffer);\n\n                    // Downsample to 1000 points (or more if needed)\n                    const rawData = audioBuffer.getChannelData(0);\n                    const samplesPerPoint = Math.floor(rawData.length / 500); // 500 bars for waveform\n                    data = new Float32Array(500);\n\n                    for (let i = 0; i < 500; i++) {\n                        let sum = 0;\n                        for (let j = 0; j < samplesPerPoint; j++) {\n                            sum += Math.abs(rawData[i * samplesPerPoint + j]);\n                        }\n                        data[i] = sum / samplesPerPoint;\n                    }\n\n                    waveformCache.set(audioUrl, data);\n                    await audioCtx.close();\n                }\n\n                if (cancelled) return;\n\n                // Render on canvas\n                if (!ctx) return;\n                ctx.clearRect(0, 0, width, height);\n                ctx.fillStyle = color;\n                ctx.globalAlpha = 0.5;\n\n                const barWidth = width / data.length;\n                for (let i = 0; i < data.length; i++) {\n                    const barHeight = data[i] * height * 2.5; // Scale for visibility\n                    const x = i * barWidth;\n                    const y = (height - barHeight) / 2;\n                    ctx.fillRect(x, y, barWidth - 1, barHeight);\n                }\n            } catch (err) {\n                console.error('[WaveformCanvas] Error:', err);\n            } finally {\n                if (!cancelled) setIsLoading(false);\n            }\n        }\n\n        drawWaveform();\n\n        return () => {\n            cancelled = true;\n        };\n    }, [audioUrl, width, height, color]);\n\n    return (\n        <canvas\n            ref={canvasRef}\n            width={width}\n            height={height}\n            className={`absolute inset-0 pointer-events-none transition-opacity duration-500 ${isLoading ? 'opacity-20' : 'opacity-100'}`}\n        />\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;;;AAFA;;AAWA,kDAAkD;AAClD,MAAM,gBAAgB,IAAI;AAEnB,SAAS,eAAe,EAAE,QAAQ,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,EAAuB;;IAClF,MAAM,YAAY,IAAA,0MAAM,EAAoB;IAC5C,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,4MAAQ,EAAC;IAE3C,IAAA,6MAAS;oCAAC;YACN,IAAI,CAAC,YAAY,CAAC,UAAU,OAAO,EAAE;YAErC,MAAM,SAAS,UAAU,OAAO;YAChC,MAAM,MAAM,OAAO,UAAU,CAAC;YAC9B,IAAI,CAAC,KAAK;YAEV,IAAI,YAAY;YAEhB,eAAe;gBACX,IAAI,CAAC,UAAU;gBAEf,aAAa;gBAEb,IAAI;oBACA,IAAI;oBAEJ,IAAI,cAAc,GAAG,CAAC,WAAW;wBAC7B,OAAO,cAAc,GAAG,CAAC;oBAC7B,OAAO;wBACH,gCAAgC;wBAChC,MAAM,WAAW,CAAC,qBAAqB,EAAE,mBAAmB,WAAW;wBACvE,MAAM,WAAW,MAAM,MAAM;wBAC7B,MAAM,cAAc,MAAM,SAAS,WAAW;wBAE9C,SAAS;wBACT,MAAM,WAAW,IAAI,CAAC,OAAO,YAAY,IAAI,AAAC,OAAe,kBAAkB;wBAC/E,MAAM,cAAc,MAAM,SAAS,eAAe,CAAC;wBAEnD,gDAAgD;wBAChD,MAAM,UAAU,YAAY,cAAc,CAAC;wBAC3C,MAAM,kBAAkB,KAAK,KAAK,CAAC,QAAQ,MAAM,GAAG,MAAM,wBAAwB;wBAClF,OAAO,IAAI,aAAa;wBAExB,IAAK,IAAI,IAAI,GAAG,IAAI,KAAK,IAAK;4BAC1B,IAAI,MAAM;4BACV,IAAK,IAAI,IAAI,GAAG,IAAI,iBAAiB,IAAK;gCACtC,OAAO,KAAK,GAAG,CAAC,OAAO,CAAC,IAAI,kBAAkB,EAAE;4BACpD;4BACA,IAAI,CAAC,EAAE,GAAG,MAAM;wBACpB;wBAEA,cAAc,GAAG,CAAC,UAAU;wBAC5B,MAAM,SAAS,KAAK;oBACxB;oBAEA,IAAI,WAAW;oBAEf,mBAAmB;oBACnB,IAAI,CAAC,KAAK;oBACV,IAAI,SAAS,CAAC,GAAG,GAAG,OAAO;oBAC3B,IAAI,SAAS,GAAG;oBAChB,IAAI,WAAW,GAAG;oBAElB,MAAM,WAAW,QAAQ,KAAK,MAAM;oBACpC,IAAK,IAAI,IAAI,GAAG,IAAI,KAAK,MAAM,EAAE,IAAK;wBAClC,MAAM,YAAY,IAAI,CAAC,EAAE,GAAG,SAAS,KAAK,uBAAuB;wBACjE,MAAM,IAAI,IAAI;wBACd,MAAM,IAAI,CAAC,SAAS,SAAS,IAAI;wBACjC,IAAI,QAAQ,CAAC,GAAG,GAAG,WAAW,GAAG;oBACrC;gBACJ,EAAE,OAAO,KAAK;oBACV,QAAQ,KAAK,CAAC,2BAA2B;gBAC7C,SAAU;oBACN,IAAI,CAAC,WAAW,aAAa;gBACjC;YACJ;YAEA;YAEA;4CAAO;oBACH,YAAY;gBAChB;;QACJ;mCAAG;QAAC;QAAU;QAAO;QAAQ;KAAM;IAEnC,qBACI,gOAAC;QACG,KAAK;QACL,OAAO;QACP,QAAQ;QACR,WAAW,CAAC,qEAAqE,EAAE,YAAY,eAAe,eAAe;;;;;;AAGzI;GAvFgB;KAAA"}},
    {"offset": {"line": 1737, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/AudioTimeline.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useRef, useEffect, useMemo, useCallback } from 'react';\nimport { Trash2, Scissors, MousePointer2, Maximize2, ZoomIn, ZoomOut, Play, Pause, Grid, Layers, ChevronUp, ChevronDown } from 'lucide-react';\nimport { useDAWStore } from '@/store/useDAWStore';\nimport { WaveformCanvas } from './WaveformCanvas';\nimport { audioEngine } from '@/lib/audio-engine-bridge';\n\n/* ─────────────────────── Types ────────────────────────────────────────── */\ninterface AudioClip {\n    id: string;\n    trackId: string;\n    startTime: number;   // seconds\n    duration: number;    // seconds\n    color: string;\n    name: string;\n    audioUrl?: string;\n}\n\nconst DEFAULT_TRACK_HEIGHT = 64;\nconst MIN_TRACK_HEIGHT = 28;\nconst MAX_TRACK_HEIGHT = 180;\n\n/* ─────────────────────── Component ────────────────────────────────────── */\nexport function AudioTimeline() {\n    const tracks = useDAWStore((state) => state.tracks);\n\n    /* ── Playback ─────────────────────────────────────────────────── */\n    const [isPlaying, setIsPlaying] = useState(false);\n    const [playhead, setPlayhead] = useState(0);\n\n    // All mutable playback state lives in refs to avoid stale closures\n    const rafRef = useRef<number | null>(null);\n    const wallStartRef = useRef(0);   // performance.now() at last play()\n    const offsetRef = useRef(0);   // playhead seconds at last play()\n    const playheadRef = useRef(0);   // live current playhead\n    const audioElemsRef = useRef<Map<string, HTMLAudioElement>>(new Map());\n    const timeoutsRef = useRef<number[]>([]);\n    const isPendingRef = useRef(false);\n\n    /* ── Scale & track heights ────────────────────────────────────── */\n    const [pps, setPps] = useState(60);           // pixels per second\n    const trackHeights = useDAWStore((state) => state.trackHeights);\n    const setTrackHeight = useDAWStore((state) => state.setTrackHeight);\n    const setAllTrackHeights = useDAWStore((state) => state.setAllTrackHeights);\n\n    /* ── Tools & Selection ────────────────────────────────────────── */\n    const [activeTool, setActiveTool] = useState<'select' | 'cut'>('select');\n    const [selection, setSelection] = useState<{ start: number; end: number } | null>(null);\n    const selectionRef = useRef<{ start: number; end: number } | null>(null);\n\n    const getH = (id: string) => trackHeights[id] ?? DEFAULT_TRACK_HEIGHT;\n    const setH = (id: string, h: number) => setTrackHeight(id, Math.max(MIN_TRACK_HEIGHT, Math.min(MAX_TRACK_HEIGHT, h)));\n    const setAllH = (delta: number) => setAllTrackHeights(delta, MIN_TRACK_HEIGHT, MAX_TRACK_HEIGHT);\n\n    const timelineDuration = 240;\n    const timelineWidth = timelineDuration * pps;\n\n    /* ── Clips ────────────────────────────────────────────────────── */\n    const [manualClips, setManualClips] = useState<AudioClip[]>([]);\n\n    const trackClips = useMemo<AudioClip[]>(() =>\n        tracks.filter(t => t.audioUrl).map(t => ({\n            id: `clip-${t.id}`,\n            trackId: t.id,\n            startTime: 0,\n            duration: 120,\n            color: t.color,\n            name: t.name,\n            audioUrl: t.audioUrl,\n        })),\n        [tracks]);\n\n    const clips = useMemo<AudioClip[]>(() => {\n        const all = [...trackClips];\n        manualClips.forEach(mc => {\n            const idx = all.findIndex(c => c.id === mc.id);\n            if (idx >= 0) all[idx] = mc; else all.push(mc);\n        });\n        return all;\n    }, [trackClips, manualClips]);\n\n    /* ── Drag ─────────────────────────────────────────────────────── */\n    const [draggingClip, setDraggingClip] = useState<string | null>(null);\n    const dragOffsetRef = useRef(0);\n    const containerRef = useRef<HTMLDivElement>(null);\n\n    /* ── RAF loop ─────────────────────────────────────────────────── */\n    function startRAF() {\n        function tick() {\n            const pos = offsetRef.current + (performance.now() - wallStartRef.current) / 1000;\n            playheadRef.current = pos;\n            setPlayhead(pos);\n            rafRef.current = requestAnimationFrame(tick);\n        }\n        rafRef.current = requestAnimationFrame(tick);\n    }\n\n    function stopRAF() {\n        if (rafRef.current !== null) {\n            cancelAnimationFrame(rafRef.current);\n            rafRef.current = null;\n        }\n    }\n\n    /* ── Audio helpers ────────────────────────────────────────────── */\n    function stopAllAudio() {\n        // Clear all scheduled starts\n        timeoutsRef.current.forEach(t => clearTimeout(t));\n        timeoutsRef.current = [];\n\n        audioElemsRef.current.forEach(el => {\n            try {\n                el.pause();\n                el.src = '';\n                el.load(); // Force stop buffered audio\n            } catch (e) { }\n        });\n        audioElemsRef.current.clear();\n    }\n\n    function play() {\n        if (isPlaying || isPendingRef.current) return;\n        isPendingRef.current = true;\n\n        // Ensure store and local state are in sync if triggered internally\n        if (!useDAWStore.getState().isPlaying) {\n            useDAWStore.getState().setIsPlaying(true);\n        }\n\n        stopAllAudio();\n        const now = offsetRef.current; // context time in seconds from start\n\n        clips.filter(c => c.audioUrl).forEach(c => {\n            const delay = Math.max(0, c.startTime - now);\n            const offset = Math.max(0, now - c.startTime);\n\n            // Use the proxy to avoid CORS issues with CDNs, unless it's a local object URL\n            const url = c.audioUrl!;\n            const proxyUrl = (url.startsWith('blob:') || url.startsWith('data:'))\n                ? url\n                : `/api/audio-proxy?url=${encodeURIComponent(url)}`;\n            const el = new Audio(proxyUrl);\n            el.crossOrigin = \"anonymous\";\n            el.currentTime = offset;\n            el.volume = 1.0;\n\n            // Connect to Audio Engine for processing and mixer support\n            audioEngine.connectAudioElement(c.trackId, el);\n\n            if (delay > 0) {\n                setTimeout(() => {\n                    // Check if we are still playing before starting delayed audio\n                    if (useDAWStore.getState().isPlaying) {\n                        el.play().catch(() => { });\n                    }\n                }, delay * 1000);\n            } else {\n                el.play().catch(() => { });\n            }\n            audioElemsRef.current.set(c.id, el);\n        });\n\n        // Prevent GlobalFooterPlayer from conflicting\n        useDAWStore.getState().setPreviewTrack(null);\n\n        wallStartRef.current = performance.now();\n        setIsPlaying(true);\n        isPendingRef.current = false;\n        startRAF();\n    }\n\n    function pause() {\n        stopRAF();\n        audioElemsRef.current.forEach(el => el.pause());\n        offsetRef.current = playheadRef.current;\n        setIsPlaying(false);\n    }\n\n    // ── RAZOR / CUT Logic ───────────────────────────────────────────\n    const splitClipAtTime = (clipId: string, time: number) => {\n        setManualClips(prev => {\n            const clip = clips.find(c => c.id === clipId);\n            if (!clip || time <= clip.startTime || time >= clip.startTime + clip.duration) return prev;\n\n            const part1Duration = time - clip.startTime;\n            const part2Duration = clip.duration - part1Duration;\n\n            const part1 = { ...clip, duration: part1Duration };\n            const part2 = {\n                ...clip,\n                id: `${clip.id}-split-${Date.now()}`,\n                startTime: time,\n                duration: part2Duration\n            };\n\n            const otherManual = prev.filter(c => c.id !== clipId);\n            return [...otherManual, part1, part2];\n        });\n    };\n\n    // ── SELECTION DELETE Logic ──────────────────────────────────────\n    const deleteSelection = () => {\n        if (!selection) return;\n        const { start, end } = selection.start < selection.end\n            ? { start: selection.start, end: selection.end }\n            : { start: selection.end, end: selection.start };\n\n        setManualClips(prev => {\n            const newClips: AudioClip[] = [];\n\n            clips.forEach(clip => {\n                const clipEnd = clip.startTime + clip.duration;\n\n                // 1. Clip completely inside selection -> delete\n                if (clip.startTime >= start && clipEnd <= end) return;\n\n                // 2. Selection completely inside clip -> split into two\n                if (clip.startTime < start && clipEnd > end) {\n                    newClips.push({ ...clip, duration: start - clip.startTime });\n                    newClips.push({\n                        ...clip,\n                        id: `${clip.id}-del-split-${Date.now()}`,\n                        startTime: end,\n                        duration: clipEnd - end\n                    });\n                    return;\n                }\n\n                // 3. Selection overlaps start of clip -> trim start\n                if (start <= clip.startTime && end > clip.startTime) {\n                    newClips.push({ ...clip, startTime: end, duration: clipEnd - end });\n                    return;\n                }\n\n                // 4. Selection overlaps end of clip -> trim end\n                if (start < clipEnd && end >= clipEnd) {\n                    newClips.push({ ...clip, duration: start - clip.startTime });\n                    return;\n                }\n\n                // 5. No overlap\n                newClips.push(clip);\n            });\n\n            return newClips;\n        });\n        setSelection(null);\n    };\n\n    // ── QUANTIZE Logic ──────────────────────────────────────────────\n    const quantizeAll = () => {\n        const bpm = 120; // Default or from store\n        const beatLength = 60 / bpm;\n\n        setManualClips(prev => {\n            return clips.map(clip => ({\n                ...clip,\n                startTime: Math.round(clip.startTime / beatLength) * beatLength\n            }));\n        });\n    };\n\n    /* ── Sync with Global Playback ────────────────────────────────── */\n    const isPlayingGlobal = useDAWStore((state) => state.isPlaying);\n\n    useEffect(() => {\n        if (isPlayingGlobal && !isPlaying) {\n            play();\n        } else if (!isPlayingGlobal && isPlaying) {\n            pause();\n        }\n    }, [isPlayingGlobal]);\n\n    /* ── Cleanup on unmount ───────────────────────────────────────── */\n    useEffect(() => () => { stopRAF(); stopAllAudio(); }, []);\n\n    /* ── Timeline Interaction ─────────────────────────────────────── */\n    const handleTimelineMouseDown = (e: React.MouseEvent) => {\n        if (!containerRef.current) return;\n        const rect = containerRef.current.getBoundingClientRect();\n        const t = Math.max(0, (e.clientX - rect.left + containerRef.current.scrollLeft) / pps);\n\n        if (activeTool === 'select') {\n            setSelection({ start: t, end: t });\n            selectionRef.current = { start: t, end: t };\n        } else {\n            // Scissors Tool: split playhead or clicked pos? Let's split clicked pos\n            setSelection(null);\n        }\n\n        // Seek Logic: Update playhead and current audio elements\n        offsetRef.current = t;\n        playheadRef.current = t;\n        wallStartRef.current = performance.now();\n        setPlayhead(t);\n\n        if (isPlaying) {\n            audioElemsRef.current.forEach((el, clipId) => {\n                const clip = clips.find(c => c.id === clipId);\n                if (clip) {\n                    const clipOffset = Math.max(0, t - clip.startTime);\n                    if (t >= clip.startTime && t < clip.startTime + clip.duration) {\n                        el.currentTime = clipOffset;\n                        if (el.paused) el.play().catch(() => { });\n                    } else {\n                        el.pause();\n                        el.currentTime = 0;\n                    }\n                }\n            });\n        }\n    };\n\n    const handleMouseMove = (e: React.MouseEvent) => {\n        if (!containerRef.current) return;\n        const rect = containerRef.current.getBoundingClientRect();\n        const t = Math.max(0, (e.clientX - rect.left + containerRef.current.scrollLeft) / pps);\n\n        if (draggingClip) {\n            const newX = e.clientX - rect.left + containerRef.current.scrollLeft - dragOffsetRef.current;\n            const newStart = Math.max(0, newX / pps);\n            const existing = clips.find(c => c.id === draggingClip);\n            if (!existing) return;\n            const updated = { ...existing, startTime: newStart };\n            setManualClips(prev => {\n                const idx = prev.findIndex(c => c.id === draggingClip);\n                return idx >= 0 ? prev.map(c => c.id === draggingClip ? updated : c) : [...prev, updated];\n            });\n        } else if (selectionRef.current) {\n            const start = selectionRef.current.start;\n            setSelection({ start, end: t });\n        }\n    };\n\n    const handleMouseUp = () => {\n        setDraggingClip(null);\n        selectionRef.current = null;\n    };\n\n    /* ── Keyboard Shortcuts ────────────────────────────────────────── */\n    useEffect(() => {\n        const handleKeyDown = (e: KeyboardEvent) => {\n            if (e.key === 'Delete' || e.key === 'Backspace') {\n                deleteSelection();\n            }\n        };\n        window.addEventListener('keydown', handleKeyDown);\n        return () => window.removeEventListener('keydown', handleKeyDown);\n    }, [selection]);\n\n    /* ── Clip Interaction ─────────────────────────────────────────── */\n    const handleClipClick = (e: React.MouseEvent, clip: AudioClip) => {\n        e.stopPropagation();\n        if (activeTool === 'cut') {\n            const rect = (e.currentTarget as HTMLElement).getBoundingClientRect();\n            const timeInsideClip = (e.clientX - rect.left) / pps;\n            splitClipAtTime(clip.id, clip.startTime + timeInsideClip);\n        }\n    };\n\n    const handleClipMouseDown = (e: React.MouseEvent, clip: AudioClip) => {\n        if (activeTool !== 'select') return;\n        e.stopPropagation();\n        setDraggingClip(clip.id);\n        dragOffsetRef.current = e.clientX - (e.currentTarget as HTMLElement).getBoundingClientRect().left;\n    };\n\n    /* ── Track resize ─────────────────────────────────────────────── */\n    const handleResizeMouseDown = (e: React.MouseEvent, trackId: string) => {\n        e.stopPropagation(); e.preventDefault();\n        const startY = e.clientY;\n        const startH = getH(trackId);\n        const onMove = (ev: MouseEvent) => setH(trackId, startH + (ev.clientY - startY));\n        const onUp = () => { window.removeEventListener('mousemove', onMove); window.removeEventListener('mouseup', onUp); };\n        window.addEventListener('mousemove', onMove);\n        window.addEventListener('mouseup', onUp);\n    };\n\n    /* ── Empty state ──────────────────────────────────────────────── */\n    if (tracks.length === 0) {\n        return (\n            <div className=\"flex-1 flex flex-col items-center justify-center h-full text-center p-8\">\n                <div className=\"w-12 h-12 rounded-full border border-white/10 flex items-center justify-center mb-4 bg-white/5 animate-pulse\">\n                    <div className=\"w-4 h-4 rounded-full bg-cyan-400 shadow-[0_0_10px_#00F0FF]\" />\n                </div>\n                <h3 className=\"text-white font-bold tracking-widest text-sm mb-2 uppercase\">Espacio de Trabajo Limpio</h3>\n                <p className=\"text-white/30 text-xs max-w-xs leading-relaxed\">\n                    Usa <span className=\"text-cyan-400 font-bold\">EXTRAER STEMS</span> para cargar pistas de una canción.\n                </p>\n            </div>\n        );\n    }\n\n    /* ── Render ───────────────────────────────────────────────────── */\n    return (\n        <div className=\"flex flex-col w-full h-full bg-[#18181A] border border-[#222] rounded-xl overflow-hidden font-mono select-none\">\n\n            {/* Toolbar */}\n            <div className=\"h-10 border-b border-[#222] bg-[#111113] flex items-center px-4 gap-3 shrink-0 z-20\">\n                {/* Tools */}\n                <button\n                    onClick={() => setActiveTool('select')}\n                    className={`w-8 h-8 rounded flex items-center justify-center transition-all ${activeTool === 'select'\n                        ? 'bg-cyan-500/20 text-cyan-400 border border-cyan-500/60'\n                        : 'hover:bg-white/5 text-white/40 border border-transparent'\n                        }`}\n                >\n                    <MousePointer2 size={14} />\n                </button>\n                <button\n                    onClick={() => setActiveTool('cut')}\n                    className={`w-8 h-8 rounded flex items-center justify-center transition-all ${activeTool === 'cut'\n                        ? 'bg-cyan-500/20 text-red-400 border border-red-500/60 shadow-[0_0_8px_rgba(239,68,68,0.2)]'\n                        : 'hover:bg-white/5 text-white/40 border border-transparent'\n                        }`}\n                >\n                    <Scissors size={14} />\n                </button>\n\n                <div className=\"w-px h-4 bg-[#333]\" />\n\n                {selection && (\n                    <button\n                        onClick={deleteSelection}\n                        className=\"w-8 h-8 rounded flex items-center justify-center bg-red-500/20 text-red-400 border border-red-500/60 hover:bg-red-500/30 transition-all\"\n                        title=\"Eliminar Selección\"\n                    >\n                        <Trash2 size={14} />\n                    </button>\n                )}\n\n                <div className=\"w-px h-4 bg-[#333]\" />\n\n                {/* Track height */}\n                <span className=\"text-[9px] text-white/20 uppercase tracking-widest\">Altura</span>\n                <button onClick={() => setAllH(-16)} className=\"w-6 h-6 rounded flex items-center justify-center hover:bg-white/5 text-white/30 hover:text-white transition-colors\"><ChevronUp size={12} /></button>\n                <button onClick={() => setAllH(+16)} className=\"w-6 h-6 rounded flex items-center justify-center hover:bg-white/5 text-white/30 hover:text-white transition-colors\"><ChevronDown size={12} /></button>\n\n                <div className=\"w-px h-4 bg-[#333]\" />\n\n                {/* Zoom */}\n                <span className=\"text-[9px] text-white/20 uppercase tracking-widest\">Zoom</span>\n                <button onClick={() => setPps(p => Math.max(15, p - 15))} className=\"w-6 h-6 rounded flex items-center justify-center hover:bg-white/5 text-white/30 hover:text-white transition-colors\"><ZoomOut size={12} /></button>\n                <button onClick={() => setPps(p => Math.min(200, p + 15))} className=\"w-6 h-6 rounded flex items-center justify-center hover:bg-white/5 text-white/30 hover:text-white transition-colors\"><ZoomIn size={12} /></button>\n\n                <div className=\"w-px h-4 bg-[#333]\" />\n\n                <button\n                    onClick={quantizeAll}\n                    className=\"flex items-center gap-1.5 px-2.5 py-1 rounded bg-[#222] border border-white/5 text-[10px] text-white/50 hover:text-white hover:bg-white/5 transition-all\"\n                >\n                    <Grid size={12} /> Quantize\n                </button>\n\n                {/* Timecode */}\n                <div className=\"ml-auto text-cyan-400 text-xs font-bold tracking-widest bg-black/60 px-3 py-1 rounded border border-white/5 tabular-nums\">\n                    {Math.floor(playhead / 60).toString().padStart(2, '0')}:\n                    {Math.floor(playhead % 60).toString().padStart(2, '0')}.\n                    {Math.floor((playhead % 1) * 100).toString().padStart(2, '0')}\n                </div>\n            </div>\n\n            {/* Scrollable Timeline */}\n            <div\n                ref={containerRef}\n                className=\"flex-1 overflow-auto relative scrollbar-hide\"\n                onMouseMove={handleMouseMove}\n                onMouseUp={handleMouseUp}\n                onMouseLeave={handleMouseUp}\n                onMouseDown={handleTimelineMouseDown}\n                style={{ cursor: draggingClip ? 'grabbing' : activeTool === 'cut' ? 'crosshair' : 'default' }}\n            >\n                <div style={{ width: `${timelineWidth}px`, minHeight: '100%', position: 'relative' }} className=\"bg-[#1A1A1C]\">\n\n                    {/* Time Ruler */}\n                    <div className=\"sticky top-0 w-full h-6 border-b border-[#2A2A2D] bg-[#111] z-20 flex\">\n                        {Array.from({ length: timelineDuration }).map((_, i) => (\n                            <div key={i} className=\"h-full border-l border-[#333] relative shrink-0\" style={{ width: `${pps}px` }}>\n                                {i % Math.max(1, Math.round(300 / pps)) === 0 && (\n                                    <span className=\"absolute top-1 left-1 text-[8px] text-[#555] select-none\">\n                                        {i >= 60 ? `${Math.floor(i / 60)}m${i % 60 > 0 ? `${i % 60}s` : ''}` : `${i}s`}\n                                    </span>\n                                )}\n                            </div>\n                        ))}\n                    </div>\n\n                    {/* Grid */}\n                    <div className=\"absolute top-6 left-0 w-full bottom-0 flex pointer-events-none opacity-[0.07]\">\n                        {Array.from({ length: timelineDuration }).map((_, i) => (\n                            <div key={i} className=\"h-full border-l border-white shrink-0\" style={{ width: `${pps}px` }} />\n                        ))}\n                    </div>\n\n                    {/* Tracks */}\n                    <div className=\"absolute top-6 left-0 w-full flex flex-col\">\n                        {tracks.map((track) => {\n                            const h = getH(track.id);\n                            const trackClipsRow = clips.filter(c => c.trackId === track.id);\n                            return (\n                                <div\n                                    key={track.id}\n                                    className=\"w-full relative border-b border-[#18181A] group\"\n                                    style={{ height: `${h}px`, background: 'linear-gradient(180deg,#202022 0%,#1A1A1C 100%)' }}\n                                >\n                                    {/* Track colour stripe */}\n                                    <div className=\"absolute left-0 top-0 bottom-0 w-0.5 opacity-40\" style={{ background: track.color }} />\n\n                                    {/* Clips */}\n                                    {trackClipsRow.map(clip => (\n                                        <div\n                                            key={clip.id}\n                                            onClick={e => handleClipClick(e, clip)}\n                                            onMouseDown={e => handleClipMouseDown(e, clip)}\n                                            className={`absolute top-1 rounded cursor-grab active:cursor-grabbing transition-shadow overflow-hidden ${draggingClip === clip.id ? 'z-20 shadow-[0_5px_20px_rgba(0,0,0,0.6)]' : 'z-10'}`}\n                                            style={{\n                                                left: `${clip.startTime * pps}px`,\n                                                width: `${clip.duration * pps}px`,\n                                                bottom: '8px',\n                                                backgroundColor: `${clip.color}08`,\n                                                border: `1px solid ${clip.color}40`,\n                                                borderRadius: 4,\n                                            }}\n                                        >\n                                            {/* Waveform Visualization */}\n                                            <WaveformCanvas\n                                                audioUrl={clip.audioUrl}\n                                                color={clip.color}\n                                                width={clip.duration * pps}\n                                                height={h - 22}\n                                            />\n\n                                            {/* Clip header */}\n                                            <div className=\"relative z-10 h-3.5 px-1.5 flex items-center text-[7px] font-bold truncate tracking-widest uppercase opacity-60\" style={{ background: `${clip.color}20`, color: clip.color }}>\n                                                {clip.name}\n                                            </div>\n\n                                            {/* Playback progress fill */}\n                                            {isPlaying && playhead > clip.startTime && playhead < clip.startTime + clip.duration && (\n                                                <div\n                                                    className=\"absolute top-0 left-0 bottom-0 pointer-events-none rounded opacity-10 bg-white\"\n                                                    style={{ width: `${((playhead - clip.startTime) / clip.duration) * 100}%` }}\n                                                />\n                                            )}\n                                        </div>\n                                    ))}\n\n                                    {/* Resize handle */}\n                                    <div\n                                        onMouseDown={e => handleResizeMouseDown(e, track.id)}\n                                        className=\"absolute bottom-0 left-0 right-0 h-2 cursor-ns-resize z-30 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity\"\n                                    >\n                                        <div className=\"w-8 h-0.5 rounded bg-white/20 hover:bg-white/50 transition-colors\" />\n                                    </div>\n                                </div>\n                            );\n                        })}\n                    </div>\n\n                    {/* Selection Overlay */}\n                    {selection && (\n                        <div\n                            className=\"absolute top-6 bottom-0 bg-cyan-500/10 border-x border-cyan-500/30 z-10 pointer-events-none\"\n                            style={{\n                                left: `${Math.min(selection.start, selection.end) * pps}px`,\n                                width: `${Math.abs(selection.end - selection.start) * pps}px`\n                            }}\n                        />\n                    )}\n\n                    {/* Playhead */}\n                    <div className=\"absolute top-0 bottom-0 z-30 pointer-events-none\" style={{ left: `${playhead * pps}px` }}>\n                        <div className=\"absolute top-0 bottom-0 w-px bg-yellow-400 shadow-[0_0_6px_rgba(250,204,21,0.8)]\" />\n                        <div className=\"absolute -top-0 -left-[5px] w-0 h-0 border-l-[5px] border-r-[5px] border-t-[7px] border-l-transparent border-r-transparent border-t-yellow-400\" />\n                    </div>\n\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2624, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/DawTrackControl.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Volume2, Power, Trash2 } from 'lucide-react';\nimport { audioEngine } from '@/lib/audio-engine-bridge';\nimport { useDAWStore } from '@/store/useDAWStore';\n\ninterface DawTrackControlProps {\n    trackId: string;\n    trackName: string;\n    color: string;\n}\n\nexport function DawTrackControl({ trackId, trackName, color }: DawTrackControlProps) {\n    const fader = useDAWStore((state) => state.faders.find((f) => f.id === trackId));\n    const trackHeight = useDAWStore((state) => state.trackHeights[trackId] ?? 64);\n    const setFaderValue = useDAWStore((state) => state.setFaderValue);\n    const setPanStore = useDAWStore((state) => state.setPan);\n    const toggleSoloStore = useDAWStore((state) => state.toggleSolo);\n    const toggleMuteStore = useDAWStore((state) => state.toggleMute);\n    const removeTrack = useDAWStore((state) => state.removeTrack);\n\n    if (!fader) return null;\n\n    // Communication with Bridge\n    useEffect(() => { audioEngine.setTrackVolume(trackId, fader.value); }, [fader.value, trackId]);\n    useEffect(() => { audioEngine.setTrackPan(trackId, fader.pan); }, [fader.pan, trackId]);\n    useEffect(() => { audioEngine.setTrackMute(trackId, fader.isMuted); }, [fader.isMuted, trackId]);\n    useEffect(() => { audioEngine.setTrackSolo(trackId, fader.isSoloed); }, [fader.isSoloed, trackId]);\n\n    // Simple Circular Knob Renderer (SVG)\n    const renderKnob = (\n        value: number,\n        min: number,\n        max: number,\n        label: string,\n        onChange: (v: number) => void,\n        isBipolar: boolean = false\n    ) => {\n        // Map value to angle (-135 to 135 deg)\n        const percent = (value - min) / (max - min);\n        const angle = -135 + percent * 270;\n\n        const handleMouseDown = (e: React.MouseEvent) => {\n            e.preventDefault();\n            const startY = e.clientY;\n            const startVal = value;\n\n            const onMouseMove = (moveEvent: MouseEvent) => {\n                const deltaY = (startY - moveEvent.clientY) * 0.5; // Sensitivity adj\n                let newVal = startVal + deltaY;\n                newVal = Math.max(min, Math.min(max, newVal));\n                onChange(Math.round(newVal));\n            };\n\n            const onMouseUp = () => {\n                window.removeEventListener('mousemove', onMouseMove);\n                window.removeEventListener('mouseup', onMouseUp);\n            };\n\n            window.addEventListener('mousemove', onMouseMove);\n            window.addEventListener('mouseup', onMouseUp);\n        };\n\n        return (\n            <div className=\"flex flex-col items-center gap-1 group\">\n                <div\n                    className=\"w-8 h-8 rounded-full bg-[#18181A] shadow-[inset_0_2px_4px_rgba(0,0,0,0.8)] border border-white/5 relative flex items-center justify-center cursor-ns-resize\"\n                    onMouseDown={handleMouseDown}\n                >\n                    <svg className=\"absolute inset-0 w-full h-full -rotate-[135deg]\" viewBox=\"0 0 32 32\">\n                        <circle cx=\"16\" cy=\"16\" r=\"12\" fill=\"none\" stroke=\"#222\" strokeWidth=\"2\" strokeDasharray=\"56.5\" />\n                        <circle cx=\"16\" cy=\"16\" r=\"12\" fill=\"none\" stroke={color} strokeWidth=\"2\" strokeDasharray=\"56.5\" strokeDashoffset={56.5 - (percent * 56.5)} className=\"transition-all\" />\n                    </svg>\n\n                    <div className=\"absolute w-full h-full\" style={{ transform: `rotate(${angle}deg)` }}>\n                        <div className=\"mx-auto mt-1 w-0.5 h-1.5 rounded bg-white shadow-[0_0_2px_#fff]\" />\n                    </div>\n                </div>\n                <span className=\"text-[8px] font-mono text-[#666] uppercase group-hover:text-silver-dark\">{label}</span>\n            </div>\n        );\n    };\n\n    return (\n        <div\n            className=\"w-[200px] bg-[#111] border-b border-[#222] flex items-center justify-between px-3 shadow-2xl shrink-0 z-30 group/trackControl hover:bg-[#151517] transition-colors\"\n            style={{ height: `${trackHeight}px` }}\n        >\n            <div className=\"flex flex-col gap-1 w-24\">\n                <div className=\"flex justify-between items-center\">\n                    <span className=\"text-[9px] font-bold truncate tracking-widest uppercase\" style={{ color }}>{trackName}</span>\n                    <button onClick={() => removeTrack(trackId)} className=\"opacity-0 group-hover/trackControl:opacity-100 text-red-500/50 hover:text-red-500 transition-all\">\n                        <Trash2 size={10} />\n                    </button>\n                </div>\n                <div className=\"flex gap-1.5 mt-1\">\n                    <button\n                        onClick={() => toggleMuteStore(trackId)}\n                        className={`w-7 py-1 rounded-sm text-[8px] font-bold transition-all ${fader.isMuted ? 'bg-red-600 border-red-600 text-black shadow-[0_0_10px_rgba(255,0,0,0.5)]' : 'bg-[#1a1a1a] border border-[#333] text-[#666]'}`}\n                    >\n                        M\n                    </button>\n                    <button\n                        onClick={() => toggleSoloStore(trackId)}\n                        className={`w-7 py-1 rounded-sm text-[8px] font-bold transition-all ${fader.isSoloed ? 'bg-[#ffaa00] border-[#ffaa00] text-black shadow-[0_0_10px_rgba(255,170,0,0.5)]' : 'bg-[#1a1a1a] border border-[#333] text-[#666]'}`}\n                    >\n                        S\n                    </button>\n                </div>\n            </div>\n\n            {/* Hide knobs if track gets too short */}\n            {trackHeight >= 40 && (\n                <div className=\"flex gap-3 items-center\">\n                    {renderKnob(fader.pan, -100, 100, 'PAN', (v) => setPanStore(trackId, v), true)}\n                    {renderKnob(fader.value, 0, 100, 'VOL', (v) => setFaderValue(trackId, v), false)}\n                </div>\n            )}\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2920, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/PianoRoll.tsx"],"sourcesContent":["import React from 'react';\nimport {\n    Settings2, Play, MousePointer2, Scissors, PenTool,\n    Eraser, Volume2, Maximize2, Crosshair, ArrowRightLeft,\n    Link2, Navigation, Focus\n} from 'lucide-react';\n\n/**\n * PianoRoll Component\n * Styled after Logic Pro X's Piano Roll editor.\n * Features a lighter gray grid, comprehensive toolbar, and velocity-colored notes.\n */\nexport function PianoRoll() {\n    // Generate 4 octaves of keys\n    const keys = Array.from({ length: 48 }, (_, i) => {\n        const noteIndex = i % 12;\n        const isBlack = [1, 3, 6, 8, 10].includes(noteIndex);\n        const noteName = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'][noteIndex];\n        const octave = Math.floor(i / 12) + 2; // Start from C2\n        return { id: i, isBlack, noteName, octave, isC: noteIndex === 0 };\n    });\n\n    return (\n        <div className=\"w-full h-full bg-[#1E1E22] flex flex-col border-t border-black/40 shadow-[0_-20px_60px_rgba(0,0,0,0.6)] font-sans relative\">\n\n            {/* Top Toolbar (Logic Pro X Inspired) */}\n            <div className=\"flex items-center justify-between px-4 py-2 border-b border-[#111] bg-[#2D2D32] shrink-0 shadow-lg z-30\">\n\n                {/* Left controls: Menus & Tools */}\n                <div className=\"flex items-center gap-4\">\n                    <div className=\"flex items-center gap-1\">\n                        <button className=\"px-2.5 py-1 text-[11px] font-bold text-[#AAA] hover:text-white bg-transparent hover:bg-white/5 rounded transition-all\">Edit</button>\n                        <button className=\"px-2.5 py-1 text-[11px] font-bold text-[#AAA] hover:text-white bg-transparent hover:bg-white/5 rounded transition-all\">Functions</button>\n                        <button className=\"px-2.5 py-1 text-[11px] font-bold text-[#AAA] hover:text-white bg-transparent hover:bg-white/5 rounded transition-all\">View</button>\n                    </div>\n\n                    <div className=\"w-px h-6 bg-black/30 mx-1\" />\n\n                    {/* Primary & Secondary Tools */}\n                    <div className=\"flex items-center gap-1.5 p-1 bg-black/20 rounded-md border border-white/5\">\n                        <button className=\"p-1.5 px-3 text-[#4A90E2] bg-[#1A1A1C] rounded shadow-[0_2px_5px_rgba(0,0,0,0.3)] border border-white/10\"><MousePointer2 size={13} /></button>\n                        <button className=\"p-1.5 px-3 text-[#888] hover:text-white transition-colors\"><PenTool size={13} /></button>\n                        <button className=\"p-1.5 px-3 text-[#888] hover:text-white transition-colors\"><Eraser size={13} /></button>\n                        <button className=\"p-1.5 px-3 text-[#888] hover:text-white transition-colors\"><Scissors size={13} /></button>\n                    </div>\n\n                    <div className=\"w-px h-6 bg-black/30 mx-1\" />\n\n                    {/* Logic Toggles */}\n                    <div className=\"flex items-center gap-2\">\n                        <button className=\"p-2 text-[#666] hover:text-white bg-black/20 rounded border border-white/5\"><Navigation size={12} className=\"rotate-45\" /></button>\n                        <button className=\"p-2 text-orange-400 bg-orange-400/10 rounded border border-orange-400/20 shadow-[0_0_10px_rgba(251,146,60,0.1)]\"><Link2 size={12} /></button>\n                    </div>\n                </div>\n\n                {/* Center Tabs: Seamless Switch */}\n                <div className=\"flex bg-black/40 rounded-lg border border-white/5 p-1 shadow-inner ring-1 ring-black/50\">\n                    <button className=\"px-8 py-1 text-[10px] font-black tracking-widest text-white bg-gradient-to-b from-[#4A6B9C] to-[#3A5B8C] rounded shadow-[0_1px_3px_rgba(0,0,0,0.4)] ring-1 ring-white/10\">PIANO ROLL</button>\n                    <button className=\"px-8 py-1 text-[10px] font-black tracking-widest text-[#666] hover:text-white transition-all uppercase\">Score</button>\n                    <button className=\"px-8 py-1 text-[10px] font-black tracking-widest text-[#666] hover:text-white transition-all uppercase\">Step Editor</button>\n                </div>\n\n                {/* Right controls: Info & Snap */}\n                <div className=\"flex items-center gap-6\">\n                    <div className=\"flex flex-col items-end\">\n                        <span className=\"text-[9px] font-black text-[#555] tracking-widest uppercase\">Position</span>\n                        <div className=\"text-[11px] font-mono text-[#4A90E2] tracking-tighter shadow-sm bg-black/20 px-2 rounded\">5 1 1 1</div>\n                    </div>\n\n                    <div className=\"flex items-center gap-3 bg-black/20 px-3 py-1 rounded border border-white/5\">\n                        <span className=\"text-[9px] font-black text-[#555] uppercase tracking-widest\">Snap</span>\n                        <select className=\"bg-transparent border-none text-[11px] font-bold text-[#AAA] outline-none cursor-pointer hover:text-white transition-colors\">\n                            <option>Smart</option>\n                            <option>1/16</option>\n                        </select>\n                    </div>\n                </div>\n            </div>\n\n            {/* Main Area */}\n            <div className=\"flex flex-1 overflow-hidden relative bg-[#1E1E22]\">\n\n                {/* Left Inspector Panel (Dark Metal Style) */}\n                <div className=\"w-[200px] bg-[#26262A] border-r border-black flex flex-col shrink-0 shadow-[10px_0_30px_rgba(0,0,0,0.3)] z-20\">\n                    <div className=\"p-4 border-b border-black/40 bg-[#1A1A1D]\">\n                        <div className=\"text-[11px] font-black tracking-widest text-[#E0E0E0] uppercase flex items-center gap-2\">\n                            <Focus size={12} className=\"text-[#4A90E2]\" /> INSPECTOR\n                        </div>\n                        <div className=\"text-[9px] text-[#555] tracking-widest mt-1\">Región: \"Orquesta Bolero\"</div>\n                    </div>\n\n                    <div className=\"p-4 space-y-6\">\n                        <div className=\"space-y-2\">\n                            <div className=\"text-[10px] font-black tracking-widest text-[#666] uppercase\">Time Quantize</div>\n                            <div className=\"flex rounded-md border border-black overflow-hidden shadow-lg\">\n                                <select className=\"flex-1 bg-[#111] text-[11px] text-[#AAA] py-2 px-3 outline-none hover:text-white transition-colors\">\n                                    <option>1/16 Note</option>\n                                    <option>1/8 Note</option>\n                                </select>\n                                <button className=\"bg-[#4A90E2] text-white px-3 text-[11px] font-black border-l border-black shadow-[inset_0_1px_1px_rgba(255,255,255,0.3)]\">Q</button>\n                            </div>\n                        </div>\n\n                        <div className=\"space-y-4 pt-4 border-t border-white/5\">\n                            <div className=\"flex justify-between items-center\">\n                                <div className=\"text-[10px] font-black tracking-widest text-[#666] uppercase\">Velocity</div>\n                                <div className=\"text-[10px] font-mono text-[#4A90E2] bg-black/40 px-2 rounded\">100</div>\n                            </div>\n                            <div className=\"relative group py-2\">\n                                <div className=\"h-1 bg-black rounded-full overflow-hidden\">\n                                    <div className=\"h-full bg-gradient-to-r from-blue-600 to-cyan-400 w-[70%]\" />\n                                </div>\n                                <div className=\"absolute top-1/2 left-[70%] -translate-y-1/2 w-3 h-3 bg-white rounded-full shadow-[0_0_10px_rgba(255,255,255,0.5)] border border-black cursor-pointer group-hover:scale-125 transition-transform\" />\n                            </div>\n                        </div>\n\n                        {/* Interactive Scale Quantize */}\n                        <div className=\"space-y-2 pt-4 border-t border-white/5\">\n                            <div className=\"text-[10px] font-black tracking-widest text-[#666] uppercase\">Scale Quantize</div>\n                            <div className=\"flex flex-col gap-1\">\n                                <select className=\"bg-[#111] border border-black rounded-md text-[11px] text-[#AAA] py-1.5 px-2 outline-none\">\n                                    <option>C Major</option>\n                                </select>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                {/* Piano Keys & Grid Container */}\n                <div className=\"flex flex-1 overflow-y-auto overflow-x-hidden relative custom-scrollbar\">\n\n                    {/* Vertical Piano Keys (Ivory & Ebony Style) */}\n                    <div className=\"w-[60px] flex flex-col-reverse bg-[#EAEAEA] border-r border-black sticky left-0 z-30 shadow-[5px_0_15px_rgba(0,0,0,0.4)] shrink-0\">\n                        {keys.map((key) => (\n                            <div\n                                key={key.id}\n                                className={`w-full relative flex flex-col justify-end items-center pr-1 border-b border-black/10 ${key.isBlack\n                                    ? 'h-[14px] bg-gradient-to-r from-[#111] to-[#333] border-black z-20 shadow-[0_2px_4px_rgba(0,0,0,0.5)] -my-[7px] rounded-r-sm'\n                                    : 'h-[24px] bg-gradient-to-r from-[#F0F0F0] to-[#E0E0E0] border-[#BBB]'\n                                    }`}\n                                style={key.isBlack ? { width: '65%', borderRight: '2px solid black' } : {}}\n                            >\n                                {key.isC && !key.isBlack && (\n                                    <span className=\"text-[10px] font-black text-[#888] absolute right-2 bottom-1 tracking-tighter opacity-60\">\n                                        {key.noteName}{key.octave}\n                                    </span>\n                                )}\n                            </div>\n                        ))}\n                    </div>\n\n                    {/* MIDI Grid (Pro Dark Theme) */}\n                    <div className=\"flex-1 relative bg-[#26262A] min-w-[2000px]\">\n\n                        {/* High-Contrast Professional Grid Pattern */}\n                        <div\n                            className=\"absolute inset-0 pointer-events-none\"\n                            style={{\n                                backgroundImage: `\n                                    linear-gradient(0deg, rgba(255,255,255,0.03) 1px, transparent 1px),\n                                    linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px),\n                                    linear-gradient(90deg, rgba(0,0,0,0.5) 1px, transparent 1px),\n                                    linear-gradient(90deg, rgba(255,255,255,0.08) 1px, transparent 1px)\n                                `,\n                                backgroundSize: '100% 12px, 30px 100%, 120px 100%, 480px 100%'\n                            }}\n                        />\n\n                        {/* Top Measure Ruler (Metallic Style) */}\n                        <div className=\"h-8 sticky top-0 bg-[#2D2D32] border-b border-black z-40 flex text-[10px] font-black text-[#666] font-mono shadow-md\">\n                            {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16].map(m => (\n                                <div key={m} className=\"w-[120px] px-2 flex items-end pb-1.5 border-l border-white/5 relative group\">\n                                    <span className=\"group-hover:text-[#AAA] transition-colors\">{m}</span>\n                                    <div className=\"absolute bottom-0 left-[30px] h-1.5 w-px bg-white/10\" />\n                                    <div className=\"absolute bottom-0 left-[60px] h-3 w-px bg-white/10\" />\n                                    <div className=\"absolute bottom-0 left-[90px] h-1.5 w-px bg-white/10\" />\n                                </div>\n                            ))}\n                        </div>\n\n                        {/* Green Region Header (Glossy Glass) */}\n                        <div className=\"h-5 absolute top-8 left-0 right-0 bg-[#7ED321]/30 backdrop-blur-sm border-b border-[#7ED321]/50 flex items-center px-4 z-20 shadow-[0_2px_10px_rgba(126,211,33,0.1)]\">\n                            <span className=\"text-[9px] font-black text-[#A4ECA1] flex items-center gap-2 tracking-[0.2em] uppercase\">\n                                <Play size={10} fill=\"currentColor\" /> REGION: HARP_BOLERO_01\n                            </span>\n                        </div>\n\n                        {/* Playhead line (Liquid Neon) */}\n                        <div className=\"absolute top-0 bottom-0 left-[480px] w-[2px] bg-white z-[45] shadow-[0_0_15px_rgba(255,255,255,0.8)]\">\n                            <div className=\"w-0 h-0 border-l-[6px] border-r-[6px] border-t-[8px] border-l-transparent border-r-transparent border-t-white absolute -top-1 -left-[5px]\" />\n                        </div>\n\n                        {/* Advanced MIDI Notes (3D Glass Style) */}\n                        {[\n                            { t: 120, l: 30, w: 200, color: 'bg-[#F29F94]', border: 'border-[#D04033]' },\n                            { t: 288, l: 10, w: 40, color: 'bg-[#ED6255]', border: 'border-[#C52013]' },\n                            { t: 276, l: 60, w: 120, color: 'bg-[#F29F94]', border: 'border-[#D04033]' },\n                            { t: 264, l: 200, w: 80, color: 'bg-[#E2A04A]', border: 'border-[#A05D17]' },\n                            { t: 240, l: 320, w: 150, color: 'bg-[#4A90E2]', border: 'border-[#2A60A2]' },\n                            { t: 300, l: 500, w: 60, color: 'bg-[#D6D657]', border: 'border-[#A8A811]' },\n                            { t: 216, l: 600, w: 90, color: 'bg-[#FF6B00]', border: 'border-[#CC5500]' },\n                            { t: 312, l: 720, w: 110, color: 'bg-[#ED6255]', border: 'border-[#C52013]' },\n                        ].map((note, idx) => (\n                            <div\n                                key={idx}\n                                className={`absolute rounded-[2px] shadow-lg flex items-center overflow-hidden hover:scale-y-110 active:scale-95 transition-all cursor-pointer group select-none ${note.color} ${note.border} border`}\n                                style={{ top: `${note.t}px`, left: `${note.l}px`, width: `${note.w}px`, height: '10px' }}\n                            >\n                                <div className=\"absolute inset-0 bg-gradient-to-b from-white/30 to-transparent pointer-events-none\" />\n                                <div className=\"ml-1 w-1 h-1 rounded-full bg-white/50 opacity-0 group-hover:opacity-100\" />\n                            </div>\n                        ))}\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3737, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/lib/modal-client.ts"],"sourcesContent":["/**\n * Modal.com Client wrapper for Next.js (Client-side / Server-side)\n * As the Modal SDK is Python, we trigger Modal Functions via their HTTP Webhook URLs,\n * or mock the latency if no URL is provided yet.\n */\n\nexport const modalClient = {\n    /**\n     * Calls the remote `process_vocal_cloning` function in Modal.\n     */\n    async process_vocal_cloning(options?: { artistId?: string }) {\n        console.log('[Modal Client] Executing remote Modal function: process_vocal_cloning');\n\n        // Simulate network latency of the remote GPU inference/processing\n        await new Promise((resolve) => setTimeout(resolve, 3000));\n\n        // Return mock success payload that signals the frontend to adjust mix\n        return {\n            success: true,\n            message: 'Vocal cloned and processed successfully.',\n            mixParameters: {\n                vocalLevel: 85,\n                beatLevel: 75\n            }\n        };\n    }\n};\n"],"names":[],"mappings":"AAAA;;;;CAIC;;;;AAEM,MAAM,cAAc;IACvB;;KAEC,GACD,MAAM,uBAAsB,OAA+B;QACvD,QAAQ,GAAG,CAAC;QAEZ,kEAAkE;QAClE,MAAM,IAAI,QAAQ,CAAC,UAAY,WAAW,SAAS;QAEnD,sEAAsE;QACtE,OAAO;YACH,SAAS;YACT,SAAS;YACT,eAAe;gBACX,YAAY;gBACZ,WAAW;YACf;QACJ;IACJ;AACJ"}},
    {"offset": {"line": 3770, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/TransportBar.tsx"],"sourcesContent":["\nimport React, { useState, useEffect } from 'react';\nimport {\n    Play, Pause, Square, SkipBack, SkipForward, Mic, Volume2,\n    Settings2, Upload, Download, Layers, Music, Drum, Keyboard, ActivitySquare,\n    Activity, Circle, Repeat\n} from 'lucide-react';\nimport { useDAWStore } from '@/store/useDAWStore';\nimport { MidiInputSelector } from './MidiKeyboardComponent';\nimport { modalClient } from '@/lib/modal-client';\nimport { audioEngine } from '@/lib/audio-engine-bridge';\n\nexport function TransportBar() {\n    // --- State ---\n    const [isPlaying, setIsPlaying] = useState(false);\n    const [isRecording, setIsRecording] = useState(false);\n    const [playhead, setPlayhead] = useState(0);\n\n    // --- Global DAW Store ---\n    const isTraining = useDAWStore((state) => state.isTraining);\n    const activeBottomPanel = useDAWStore((state) => state.activeBottomPanel);\n    const isMetronomeOn = useDAWStore((state) => state.isMetronomeOn);\n    const setTrainingStatus = useDAWStore((state) => state.setTrainingStatus);\n    const setFaderValue = useDAWStore((state) => state.setFaderValue);\n    const setActiveBottomPanel = useDAWStore((state) => state.setActiveBottomPanel);\n    const toggleMetronome = useDAWStore((state) => state.toggleMetronome);\n    const setIsPlayingStore = useDAWStore((state) => state.setIsPlaying);\n    const setMasterLevel = useDAWStore((state) => state.setMasterLevel);\n    const isFullMixer = useDAWStore((state) => state.isFullMixer);\n    const setFullMixer = useDAWStore((state) => state.setFullMixer);\n\n    // --- Audio Engine Sync ---\n    useEffect(() => {\n        let interval: NodeJS.Timeout;\n        if (isPlaying) {\n            interval = setInterval(() => {\n                setPlayhead(audioEngine.getPlayheadPosition());\n                // Poll master level for speaker animations\n                setMasterLevel(audioEngine.getVUMeterLevel('master'));\n            }, 50);\n        } else {\n            setMasterLevel(0);\n        }\n        return () => clearInterval(interval);\n    }, [isPlaying, setMasterLevel]);\n\n    const handleTogglePlay = () => {\n        if (isPlaying) {\n            audioEngine.pause();\n            setIsPlayingStore(false);\n        } else {\n            audioEngine.play();\n            setIsPlayingStore(true);\n        }\n        setIsPlaying(!isPlaying);\n    };\n\n    const handleAutoMix = async () => {\n        setTrainingStatus(true);\n        try {\n            const response = await modalClient.process_vocal_cloning();\n            if (response.success) {\n                setFaderValue('vocal', response.mixParameters.vocalLevel);\n                setFaderValue('beat', response.mixParameters.beatLevel);\n                setFaderValue('bass', 65);\n                setFaderValue('fx', 50);\n            }\n        } catch (error) {\n            console.error(\"Auto Mix Modal training failed:\", error);\n        } finally {\n            setTrainingStatus(false);\n        }\n    };\n\n    return (\n        <div className=\"h-16 flex items-center justify-between px-4 border-b border-[#222] bg-[#1C1C1E] shadow-md z-30 shrink-0 font-sans\">\n\n            {/* LEFT: Branding & Auto-Mix */}\n            <div className=\"flex items-center gap-4 w-1/3\">\n                <div className=\"border border-[#FF6B00]/30 px-3 py-1 rounded bg-black/50 shadow-[0_0_10px_rgba(255,107,0,0.1)]\">\n                    <h1 className=\"text-sm font-sans tracking-widest text-white\">\n                        DA GRABA <span className=\"font-light text-[#FF6B00]\">DAW</span>\n                    </h1>\n                </div>\n\n                <button\n                    onClick={handleAutoMix}\n                    disabled={isTraining}\n                    className=\"flex items-center gap-2 bg-[#111] hover:bg-[#1A1A1C] border border-[#FF6B00]/50 text-[#FF6B00] px-3 py-1.5 rounded shadow-[0_0_5px_rgba(255,107,0,0.2)] transition-colors disabled:opacity-50 text-[10px] font-bold tracking-widest\"\n                >\n                    <Activity size={12} />\n                    AUTO-MIX IA\n                </button>\n            </div>\n\n            {/* CENTER: True Transport Controls (Logic/Pro Tools Style) */}\n            <div className=\"flex flex-1 items-center justify-center gap-6\">\n\n                {/* Transport Buttons */}\n                <div className=\"flex items-center gap-1 bg-[#111] p-1 rounded-md border border-[#333] shadow-inner\">\n                    <button\n                        onClick={() => {\n                            setPlayhead(0);\n                            audioEngine.pause();\n                            setIsPlayingStore(false);\n                            setIsPlaying(false);\n                        }}\n                        className=\"p-1.5 text-[#AAA] hover:text-white transition-colors rounded hover:bg-[#222]\"\n                    >\n                        <SkipBack size={16} />\n                    </button>\n                    <button\n                        onClick={() => {\n                            setPlayhead(240); // End of standard timeline\n                        }}\n                        className=\"p-1.5 text-[#AAA] hover:text-white transition-colors rounded hover:bg-[#222]\"\n                    >\n                        <SkipForward size={16} />\n                    </button>\n                    <button className={`p-1.5 transition-colors rounded hover:bg-[#222] ${isPlaying ? 'text-white' : 'text-[#AAA] hover:text-white'}`} onClick={handleTogglePlay}>\n                        <Square size={16} fill={isPlaying ? \"currentColor\" : \"none\"} />\n                    </button>\n                    <button className={`p-1.5 transition-colors rounded hover:bg-[#222] ${isPlaying ? 'text-[#A4ECA1]' : 'text-[#AAA] hover:text-white'}`} onClick={handleTogglePlay}>\n                        <Play size={16} fill={isPlaying ? \"currentColor\" : \"none\"} />\n                    </button>\n                    <button className={`p-1.5 transition-colors rounded hover:bg-[#222] ${isRecording ? 'text-red-500' : 'text-[#AAA] hover:text-red-400'}`} onClick={() => setIsRecording(!isRecording)}>\n                        <Circle size={16} fill={isRecording ? \"currentColor\" : \"none\"} />\n                    </button>\n                </div>\n\n                {/* LCD Display */}\n                <div className=\"flex bg-[#0A0A0C] border border-[#333] rounded-md shadow-[inset_0_2px_10px_rgba(0,0,0,0.8)] px-4 py-1.5 items-center gap-6 min-w-[300px] justify-center text-[#E0E0E0]\">\n                    {/* Time / Measure */}\n                    <div className=\"flex flex-col items-center\">\n                        <div className=\"flex items-baseline gap-1 font-mono text-lg font-light tracking-wider text-[#A4ECA1]\">\n                            <span>{Math.floor(playhead / 2) + 1}</span>\n                            <span className=\"text-[#666] text-sm\">:</span>\n                            <span>{Math.floor((playhead % 2) * 2) + 1}</span>\n                            <span className=\"text-[#666] text-sm\">:</span>\n                            <span>1</span>\n                            <span className=\"text-[#666] text-sm\">:</span>\n                            <span className=\"text-xs\">{((playhead * 1000) % 1000).toFixed(0).padStart(3, '0')}</span>\n                        </div>\n                        <span className=\"text-[8px] text-[#666] uppercase tracking-widest\">Measure / Time</span>\n                    </div>\n\n                    <div className=\"w-px h-6 bg-[#222]\" />\n\n                    {/* Tempo / Signature */}\n                    <div className=\"flex gap-4\">\n                        <div className=\"flex flex-col items-center\">\n                            <span className=\"font-mono text-sm text-[#4A90E2]\">120.00</span>\n                            <span className=\"text-[8px] text-[#666] uppercase tracking-widest\">Tempo</span>\n                        </div>\n                        <div className=\"flex flex-col items-center\">\n                            <span className=\"font-mono text-sm text-[#E2A04A]\">4/4</span>\n                            <span className=\"text-[8px] text-[#666] uppercase tracking-widest\">Sig</span>\n                        </div>\n                    </div>\n                </div>\n\n                {/* Function Toggles */}\n                <div className=\"flex items-center gap-1 bg-[#111] p-1 rounded-md border border-[#333] shadow-inner\">\n                    <button className=\"p-1.5 text-[#E2A04A] bg-[#222] rounded transition-colors border border-[#333]\">\n                        <Repeat size={16} />\n                    </button>\n                    <button\n                        onClick={() => toggleMetronome()}\n                        className={`p-1.5 rounded transition-colors border border-[#333] ${isMetronomeOn ? 'text-[#4A90E2] bg-blue-500/20 glow-blue' : 'text-[#666] bg-[#222] hover:text-[#4A90E2]'}`}\n                    >\n                        <ActivitySquare size={16} />\n                    </button>\n                </div>\n            </div>\n\n            {/* RIGHT: Panel Toggles & Settings */}\n            <div className=\"flex items-center gap-4 w-1/3 justify-end\">\n                {/* Console Navigation Toggles */}\n                <div className=\"flex bg-[#111] p-1 border border-white/5 rounded-lg shadow-xl ring-1 ring-black/50 gap-1\">\n                    <button\n                        onClick={() => {\n                            setFullMixer(true);\n                            setActiveBottomPanel('mixer');\n                        }}\n                        className={`px-4 py-1.5 rounded-md text-[10px] font-black tracking-widest transition-all duration-300 ${isFullMixer ? 'bg-gradient-to-b from-orange-500 to-orange-700 text-white shadow-[0_0_15px_rgba(249,115,22,0.4)] border border-orange-400/50' : 'text-white/30 hover:text-white/60 hover:bg-white/5'}`}\n                    >\n                        MIX\n                    </button>\n                    <button\n                        onClick={() => {\n                            setFullMixer(false);\n                            setActiveBottomPanel('closed');\n                        }}\n                        className={`px-4 py-1.5 rounded-md text-[10px] font-black tracking-widest transition-all duration-300 ${!isFullMixer ? 'bg-gradient-to-b from-neutral-600 to-neutral-800 text-white shadow-[0_0_15px_rgba(255,255,255,0.05)] border border-white/10' : 'text-white/30 hover:text-white/60 hover:bg-white/5'}`}\n                    >\n                        EDIT\n                    </button>\n                </div>\n\n                <div className=\"w-[1px] h-6 bg-white/5 mx-2\" />\n\n                <div className=\"flex bg-[#111] p-1 border border-[#333] rounded shadow-sm gap-1\">\n                    <button\n                        onClick={() => {\n                            setFullMixer(false);\n                            setActiveBottomPanel(activeBottomPanel === 'mixer' ? 'closed' : 'mixer');\n                        }}\n                        className={`px-3 py-1 rounded-sm text-[10px] font-bold tracking-widest transition-colors ${activeBottomPanel === 'mixer' && !isFullMixer ? 'bg-[#5A5A60] text-white shadow-[inset_0_1px_5px_rgba(0,0,0,0.5)]' : 'text-[#888] hover:text-white hover:bg-[#222]'\n                            }`}\n                    >\n                        FX\n                    </button>\n                    <button\n                        onClick={() => {\n                            setFullMixer(false);\n                            setActiveBottomPanel(activeBottomPanel === 'piano_roll' ? 'closed' : 'piano_roll');\n                        }}\n                        className={`px-3 py-1 rounded-sm text-[10px] font-bold tracking-widest transition-colors flex items-center gap-1 ${activeBottomPanel === 'piano_roll' ? 'bg-[#FF6B00] text-black shadow-[0_0_10px_rgba(255,107,0,0.6)]' : 'text-[#888] hover:text-white hover:bg-[#222]'\n                            }`}\n                    >\n                        <Music size={12} />\n                        PIANO\n                    </button>\n                </div>\n\n                <div className=\"flex items-center gap-2 ml-2\">\n                    <button\n                        onClick={() => {\n                            const input = document.createElement('input');\n                            input.type = 'file';\n                            input.accept = 'audio/*';\n                            input.onchange = (e) => {\n                                const file = (e.target as HTMLInputElement).files?.[0];\n                                if (file) alert(`Audio importado al Studio: ${file.name} `);\n                            };\n                            input.click();\n                        }}\n                        className=\"p-1.5 text-[#AAA] hover:text-white transition-colors rounded hover:bg-[#222]\" title=\"Importar Audio\"\n                    >\n                        <Upload size={16} />\n                    </button>\n                    <button\n                        onClick={() => alert('Mezcla final exportada correctamente.')}\n                        className=\"p-1.5 text-[#AAA] hover:text-[#A4ECA1] transition-colors rounded hover:bg-[#222]\" title=\"Exportar Mezcla\"\n                    >\n                        <Download size={16} />\n                    </button>\n                    <button className=\"p-1.5 text-[#666] hover:text-[#AAA] transition-colors rounded hover:bg-[#222]\">\n                        <Settings2 size={16} />\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4426, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/StudioChat.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useRef, useEffect, useCallback } from 'react';\nimport { Send, Sparkles, Wand2, Mic2, Scissors, PlayCircle, ChevronRight, MessageSquare, Mic, MicOff, Volume2 } from 'lucide-react';\nimport { useDAWStore } from '@/store/useDAWStore';\n\n// Type definition for Web Speech API\ninterface SpeechRecognition extends EventTarget {\n    continuous: boolean;\n    interimResults: boolean;\n    lang: string;\n    start(): void;\n    stop(): void;\n    onresult: (event: any) => void;\n    onerror: (event: any) => void;\n    onend: () => void;\n}\n\ndeclare global {\n    interface Window {\n        webkitSpeechRecognition: any;\n        SpeechRecognition: any;\n    }\n}\n\nexport function StudioChat({\n    embedded = false,\n    songName,\n    onExecuteMastering\n}: {\n    embedded?: boolean,\n    songName?: string,\n    onExecuteMastering?: () => void\n}) {\n    const addTrack = useDAWStore((state) => state.addTrack);\n    const setTracks = useDAWStore((state) => state.setTracks);\n    const clearTracks = useDAWStore((state) => state.clearTracks);\n    const tracks = useDAWStore((state) => state.tracks);\n\n    const [isOpen, setIsOpen] = useState(false);\n    const [input, setInput] = useState('');\n    const [messages, setMessages] = useState<{ role: 'user' | 'assistant', content: string }[]>([]);\n\n    useEffect(() => {\n        const greeting = songName\n            ? `¿Necesitas ayuda con tu master de \"${songName}\"? Aquí estoy listo para ayudarte.`\n            : '¡Estamos en el studio! El plan está listo. ¿Quieres que genere la primera mitad de los instrumentos o prefieres grabar algo tú primero?';\n\n        setMessages([{ role: 'assistant', content: greeting }]);\n    }, [songName]);\n    const [isTyping, setIsTyping] = useState(false);\n    const [isListening, setIsListening] = useState(false);\n    const [isSpeaking, setIsSpeaking] = useState(false);\n\n    const scrollRef = useRef<HTMLDivElement>(null);\n    const recognitionRef = useRef<SpeechRecognition | null>(null);\n    const audioRef = useRef<HTMLAudioElement | null>(null);\n\n    useEffect(() => {\n        if (scrollRef.current) {\n            scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n        }\n    }, [messages]);\n\n    // Initialize Speech Recognition\n    useEffect(() => {\n        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n        if (SpeechRecognition) {\n            const recognition = new SpeechRecognition();\n            recognition.continuous = true;\n            recognition.interimResults = false;\n            recognition.lang = 'es-ES';\n\n            recognition.onresult = (event: any) => {\n                const transcript = event.results[event.results.length - 1][0].transcript;\n                if (transcript.trim()) {\n                    handleVoiceInput(transcript);\n                }\n            };\n\n            recognition.onerror = (event: any) => {\n                console.error('Speech recognition error', event.error);\n                setIsListening(false);\n            };\n\n            recognition.onend = () => {\n                if (isListening) recognition.start(); // Auto-restart if it should be listening\n            };\n\n            recognitionRef.current = recognition;\n        }\n    }, [isListening]);\n\n    const playJohnVoice = async (text: string) => {\n        try {\n            setIsSpeaking(true);\n            const response = await fetch('/api/ai/tts', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ text })\n            });\n\n            if (!response.ok) throw new Error('Failed to fetch voice');\n\n            const blob = await response.blob();\n            const url = URL.createObjectURL(blob);\n\n            if (audioRef.current) {\n                audioRef.current.src = url;\n                audioRef.current.play();\n            } else {\n                const audio = new Audio(url);\n                audioRef.current = audio;\n                audio.play();\n            }\n\n            audioRef.current!.onended = () => {\n                setIsSpeaking(false);\n                URL.revokeObjectURL(url);\n            };\n        } catch (error) {\n            console.error('TTS Error:', error);\n            setIsSpeaking(false);\n        }\n    };\n\n    const triggerGeneration = () => {\n        setIsTyping(true);\n        setTimeout(() => {\n            const demoTracks: any[] = [\n                { id: 't-beat', name: 'Dark Trap Beat (AI)', color: '#FF6B00', trackType: 'stereo' },\n                { id: 't-808', name: 'Heavy 808 Sub', color: '#B026FF', trackType: 'stereo' },\n                { id: 't-melody', name: 'Dark Piano Melody', color: '#00F0FF', trackType: 'stereo' },\n                { id: 't-perch', name: 'Percussion Loop', color: '#A4ECA1', trackType: 'stereo' }\n            ];\n            setTracks(demoTracks);\n            const msg = \"¡Listo! He abierto los tracks en el espacio de trabajo como por arte de magia. He configurado la batería, el bajo y la melodía principal. ¿Escuchamos esta primera parte?\";\n            setMessages(prev => [...prev, { role: 'assistant', content: msg }]);\n            setIsTyping(false);\n            playJohnVoice(msg);\n        }, 1500);\n    };\n\n    const handleSend = async (forcedInput?: string) => {\n        const textToSend = forcedInput || input;\n        if (!textToSend.trim() || isTyping) return;\n\n        setInput('');\n        setMessages(prev => [...prev, { role: 'user', content: textToSend }]);\n\n        const lowInput = textToSend.toLowerCase();\n        if (lowInput.includes('genera') || lowInput.includes('mitad') || lowInput.includes('abre')) {\n            triggerGeneration();\n            return;\n        }\n\n        if ((lowInput.includes('masteriza') || lowInput.includes('arregla') || lowInput.includes('aplica el adn')) && onExecuteMastering) {\n            setIsTyping(true);\n            setTimeout(() => {\n                onExecuteMastering();\n                const msg = \"¡Claro que sí! Estoy analizando el ADN de tu mezcla ahora mismo. Voy a aplicar mi configuración Gold Standard para que suene con todo el peso de Da Graba Studio. ¡Mira cómo se mueven los equipos!\";\n                setMessages(prev => [...prev, { role: 'assistant', content: msg }]);\n                setIsTyping(false);\n                playJohnVoice(msg);\n            }, 1000);\n            return;\n        }\n\n        setIsTyping(true);\n        try {\n            const history = messages.map(m => ({ role: m.role, content: m.content }));\n            const response = await fetch('/api/ai/engineer', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ message: textToSend, history })\n            });\n\n            if (!response.ok) throw new Error('Failed to fetch AI response');\n\n            const data = await response.json();\n            const aiMessage = data.message;\n\n            setMessages(prev => [...prev, { role: 'assistant', content: aiMessage }]);\n            setIsTyping(false);\n            playJohnVoice(aiMessage);\n        } catch (error) {\n            console.error('AI Error:', error);\n            const errorMsg = \"Lo siento, John tiene problemas de conexión ahora mismo. Pero sigo aquí.\";\n            setMessages(prev => [...prev, { role: 'assistant', content: errorMsg }]);\n            setIsTyping(false);\n        }\n    };\n\n    const handleVoiceInput = (transcript: string) => {\n        handleSend(transcript);\n    };\n\n    const toggleListening = () => {\n        if (isListening) {\n            recognitionRef.current?.stop();\n            setIsListening(false);\n        } else {\n            recognitionRef.current?.start();\n            setIsListening(true);\n        }\n    };\n\n    return (\n        <div className={embedded ? \"w-full h-full\" : `fixed right-8 bottom-32 z-50 transition-all duration-500 flex flex-col items-end ${isOpen ? 'w-80 h-[450px]' : 'w-12 h-12'}`}>\n\n            {/* TOGGLE BUTTON - Only show if not embedded */}\n            {!embedded && (\n                <div className=\"flex flex-col gap-3\">\n                    <button\n                        onClick={toggleListening}\n                        className={`w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300 shadow-2xl ${isListening ? 'bg-red-500 animate-pulse glow-red' : 'bg-white/5 border border-white/10 hover:bg-white/10'}`}\n                    >\n                        {isListening ? <Mic className=\"text-white\" size={20} /> : <MicOff className=\"text-silver-dark\" size={20} />}\n                    </button>\n\n                    <button\n                        onClick={() => setIsOpen(!isOpen)}\n                        className={`w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300 shadow-2xl ${isOpen ? 'bg-orange-600 scale-90' : 'bg-gradient-to-br from-cyan-glow to-blue-600 glow-cyan hover:scale-110'}`}\n                    >\n                        {isOpen ? <ChevronRight className=\"text-white\" /> : <MessageSquare className=\"text-white\" />}\n                    </button>\n                </div>\n            )}\n\n            {/* CHAT WINDOW */}\n            <div className={`${embedded ? 'w-full h-full' : 'mt-4 w-full h-full'} bg-[#0B1015]/95 backdrop-blur-xl border border-white/10 rounded-2xl flex flex-col overflow-hidden shadow-[0_20px_50px_rgba(0,0,0,0.5)] transition-opacity duration-300 ${embedded || isOpen ? 'opacity-100' : 'opacity-0 pointer-events-none'}`}>\n\n                {/* Header */}\n                <div className=\"px-4 py-3 border-b border-white/5 bg-white/5 flex items-center justify-between\">\n                    <div className=\"flex items-center gap-2\">\n                        <Sparkles size={16} className=\"text-cyan-glow\" />\n                        <span className=\"text-xs font-bold tracking-widest text-[#E0E0E0]\">ENGINEER FEEDBACK</span>\n                    </div>\n                    {isSpeaking && <Volume2 size={14} className=\"text-cyan-glow animate-pulse\" />}\n                </div>\n\n                {/* Messages Panel */}\n                <div ref={scrollRef} className=\"flex-1 overflow-y-auto p-4 flex flex-col gap-4 custom-scrollbar\">\n                    {messages.map((m, i) => (\n                        <div key={i} className={`flex flex-col ${m.role === 'user' ? 'items-end' : 'items-start'}`}>\n                            <div className={`max-w-[85%] px-3 py-2 rounded-xl text-xs leading-relaxed ${m.role === 'user'\n                                ? 'bg-orange-600/20 border border-orange-500/30 text-white'\n                                : 'bg-white/5 border border-white/10 text-silver-light'\n                                }`}>\n                                {m.content}\n                            </div>\n                        </div>\n                    ))}\n                    {isTyping && (\n                        <div className=\"flex gap-1 ml-2\">\n                            <div className=\"w-1.5 h-1.5 bg-cyan-glow rounded-full animate-bounce\" />\n                            <div className=\"w-1.5 h-1.5 bg-cyan-glow rounded-full animate-bounce [animation-delay:0.2s]\" />\n                            <div className=\"w-1.5 h-1.5 bg-cyan-glow rounded-full animate-bounce [animation-delay:0.4s]\" />\n                        </div>\n                    )}\n                </div>\n\n                {/* Quick Actions */}\n                <div className=\"px-3 py-2 flex gap-2 overflow-x-auto border-t border-white/5 bg-black/20 no-scrollbar\">\n                    <button\n                        onClick={triggerGeneration}\n                        className=\"whitespace-nowrap flex items-center gap-1.5 px-2 py-1 rounded bg-white/5 border border-white/10 text-[10px] text-silver-dark hover:text-cyan-glow transition-colors\"\n                    >\n                        <Wand2 size={10} /> Generar Mitad\n                    </button>\n                    <button className=\"whitespace-nowrap flex items-center gap-1.5 px-2 py-1 rounded bg-white/5 border border-white/10 text-[10px] text-silver-dark hover:text-white transition-colors\">\n                        <PlayCircle size={10} /> Continuar\n                    </button>\n                    <button\n                        onClick={clearTracks}\n                        className=\"whitespace-nowrap flex items-center gap-1.5 px-2 py-1 rounded bg-white/5 border border-white/10 text-[10px] text-red-400 hover:text-red-300 transition-colors\"\n                    >\n                        <Scissors size={10} /> Limpiar Todo\n                    </button>\n                    <button className=\"whitespace-nowrap flex items-center gap-1.5 px-2 py-1 rounded bg-white/5 border border-white/10 text-[10px] text-silver-dark hover:text-white transition-colors\">\n                        <Mic2 size={10} /> Grabar Hum\n                    </button>\n                </div>\n\n                {/* Input Area */}\n                <div className=\"p-3 bg-black/40 flex items-center gap-2\">\n                    <input\n                        type=\"text\"\n                        value={input}\n                        onChange={(e) => setInput(e.target.value)}\n                        onKeyDown={(e) => e.key === 'Enter' && handleSend()}\n                        placeholder={isListening ? \"Te escucho...\" : \"Dime qué sigue...\"}\n                        className=\"flex-1 bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-xs text-white placeholder:text-gray-600 focus:outline-none focus:border-cyan-glow/50 transition-colors\"\n                    />\n                    <button\n                        onClick={() => handleSend()}\n                        className=\"p-2 bg-orange-600 rounded-lg hover:bg-orange-500 transition-colors shadow-lg\"\n                    >\n                        <Send size={14} className=\"text-white\" />\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4992, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/MasteringKnob.tsx"],"sourcesContent":["import React from 'react';\n\ninterface MasteringKnobProps {\n    label: string;\n    value: number; // 0 to 100\n    onChange?: (value: number) => void;\n    size?: 'sm' | 'md' | 'lg';\n}\n\nexport function MasteringKnob({ label, value, onChange, size = 'md' }: MasteringKnobProps) {\n    // Calculate rotation (-135deg to +135deg for a standard 270 degree sweep)\n    const rotation = -135 + (value / 100) * 270;\n\n    const sizeClasses = {\n        sm: 'w-10 h-10',\n        md: 'w-16 h-16',\n        lg: 'w-24 h-24'\n    };\n\n    return (\n        <div \n            className=\"flex flex-col items-center gap-3\"\n            onMouseDown={(e) => {\n                const startY = e.clientY;\n                const startValue = value;\n                \n                const handleMouseMove = (moveEvent: MouseEvent) => {\n                    const deltaY = startY - moveEvent.clientY;\n                    const newValue = Math.min(100, Math.max(0, startValue + deltaY));\n                    if (onChange) onChange(newValue);\n                };\n\n                const handleMouseUp = () => {\n                    window.removeEventListener('mousemove', handleMouseMove);\n                    window.removeEventListener('mouseup', handleMouseUp);\n                    document.body.style.cursor = 'default';\n                };\n\n                window.addEventListener('mousemove', handleMouseMove);\n                window.addEventListener('mouseup', handleMouseUp);\n                document.body.style.cursor = 'ns-resize';\n            }}\n        >\n            {/* Knob Container (The groove/shadow it sits in) */}\n            <div className={`${sizeClasses[size]} rounded-full bg-[#1A1A1A] p-1 shadow-[inset_0_4px_10px_rgba(0,0,0,0.8),0_2px_4px_rgba(255,255,255,0.05)] relative flex items-center justify-center`}>\n\n                {/* The Knob Body */}\n                <div\n                    className=\"w-full h-full rounded-full bg-gradient-to-b from-[#333] to-[#111] shadow-[0_4px_8px_rgba(0,0,0,0.6),inset_0_2px_1px_rgba(255,255,255,0.2)] relative cursor-ns-resize group transition-transform duration-500 ease-out\"\n                    style={{ transform: `rotate(${rotation}deg)` }}\n                >\n                    {/* The Indicator Line */}\n                    <div className=\"absolute top-1 left-1/2 -translate-x-1/2 w-0.5 h-1/4 bg-white/80 rounded-full shadow-[0_0_2px_rgba(255,255,255,0.5)] group-hover:bg-cyan-glow group-hover:shadow-[0_0_5px_rgba(0,240,255,0.8)] transition-colors\" />\n                </div>\n            </div>\n\n            {/* Label */}\n            <span className=\"text-[10px] font-bold tracking-widest text-[#888] uppercase select-none\">{label}</span>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;;AASO,SAAS,cAAc,EAAE,KAAK,EAAE,KAAK,EAAE,QAAQ,EAAE,OAAO,IAAI,EAAsB;IACrF,0EAA0E;IAC1E,MAAM,WAAW,CAAC,MAAM,AAAC,QAAQ,MAAO;IAExC,MAAM,cAAc;QAChB,IAAI;QACJ,IAAI;QACJ,IAAI;IACR;IAEA,qBACI,gOAAC;QACG,WAAU;QACV,aAAa,CAAC;YACV,MAAM,SAAS,EAAE,OAAO;YACxB,MAAM,aAAa;YAEnB,MAAM,kBAAkB,CAAC;gBACrB,MAAM,SAAS,SAAS,UAAU,OAAO;gBACzC,MAAM,WAAW,KAAK,GAAG,CAAC,KAAK,KAAK,GAAG,CAAC,GAAG,aAAa;gBACxD,IAAI,UAAU,SAAS;YAC3B;YAEA,MAAM,gBAAgB;gBAClB,OAAO,mBAAmB,CAAC,aAAa;gBACxC,OAAO,mBAAmB,CAAC,WAAW;gBACtC,SAAS,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG;YACjC;YAEA,OAAO,gBAAgB,CAAC,aAAa;YACrC,OAAO,gBAAgB,CAAC,WAAW;YACnC,SAAS,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG;QACjC;;0BAGA,gOAAC;gBAAI,WAAW,GAAG,WAAW,CAAC,KAAK,CAAC,mJAAmJ,CAAC;0BAGrL,cAAA,gOAAC;oBACG,WAAU;oBACV,OAAO;wBAAE,WAAW,CAAC,OAAO,EAAE,SAAS,IAAI,CAAC;oBAAC;8BAG7C,cAAA,gOAAC;wBAAI,WAAU;;;;;;;;;;;;;;;;0BAKvB,gOAAC;gBAAK,WAAU;0BAA2E;;;;;;;;;;;;AAGvG;KAnDgB"}},
    {"offset": {"line": 5075, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/plugins/GateModule.tsx"],"sourcesContent":["'use client';\n\nimport React from 'react';\nimport { MasteringKnob } from '../MasteringKnob';\n\ninterface GateModuleProps {\n    settings: {\n        gateThreshold: number;\n        gateAttack: number;\n        gateRelease: number;\n    };\n    onChange: (settings: any) => void;\n}\n\nexport function GateModule({ settings, onChange }: GateModuleProps) {\n    return (\n        <div className=\"flex gap-8 p-4 justify-around items-center bg-[#303030] rounded-lg border border-[#3A3A3A] shadow-inner min-h-[180px] w-full\">\n            <MasteringKnob \n                label=\"THRES\" \n                value={settings.gateThreshold} \n                onChange={(v) => onChange({ gateThreshold: v })} \n                size=\"lg\" \n            />\n            <MasteringKnob \n                label=\"ATTACK\" \n                value={settings.gateAttack} \n                onChange={(v) => onChange({ gateAttack: v })} \n                size=\"lg\" \n            />\n            <MasteringKnob \n                label=\"RELEASE\" \n                value={settings.gateRelease} \n                onChange={(v) => onChange({ gateRelease: v })} \n                size=\"lg\" \n            />\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAGA;AAHA;;;AAcO,SAAS,WAAW,EAAE,QAAQ,EAAE,QAAQ,EAAmB;IAC9D,qBACI,gOAAC;QAAI,WAAU;;0BACX,gOAAC,0LAAa;gBACV,OAAM;gBACN,OAAO,SAAS,aAAa;gBAC7B,UAAU,CAAC,IAAM,SAAS;wBAAE,eAAe;oBAAE;gBAC7C,MAAK;;;;;;0BAET,gOAAC,0LAAa;gBACV,OAAM;gBACN,OAAO,SAAS,UAAU;gBAC1B,UAAU,CAAC,IAAM,SAAS;wBAAE,YAAY;oBAAE;gBAC1C,MAAK;;;;;;0BAET,gOAAC,0LAAa;gBACV,OAAM;gBACN,OAAO,SAAS,WAAW;gBAC3B,UAAU,CAAC,IAAM,SAAS;wBAAE,aAAa;oBAAE;gBAC3C,MAAK;;;;;;;;;;;;AAIrB;KAvBgB"}},
    {"offset": {"line": 5141, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/plugins/EQModule.tsx"],"sourcesContent":["'use client';\n\nimport React from 'react';\nimport { MasteringKnob } from '../MasteringKnob';\n\ninterface EQModuleProps {\n    settings: {\n        eqHighpass: number;\n        eqTilt: number;\n        eqSideGain: number;\n        eqSideFreq: number;\n    };\n    onChange: (settings: any) => void;\n}\n\nexport function EQModule({ settings, onChange }: EQModuleProps) {\n    return (\n        <div className=\"flex gap-8 p-4 justify-around items-center bg-[#303030] rounded-lg border border-[#3A3A3A] shadow-inner min-h-[180px] w-full\">\n            <MasteringKnob \n                label=\"HI-PASS\" \n                value={settings.eqHighpass} \n                onChange={(v) => onChange({ eqHighpass: v })} \n                size=\"lg\" \n            />\n            <MasteringKnob \n                label=\"TILT\" \n                value={settings.eqTilt} \n                onChange={(v) => onChange({ eqTilt: v })} \n                size=\"lg\" \n            />\n            <MasteringKnob \n                label=\"SIDE GAIN\" \n                value={settings.eqSideGain} \n                onChange={(v) => onChange({ eqSideGain: v })} \n                size=\"lg\" \n            />\n            <MasteringKnob \n                label=\"SIDE FREQ\" \n                value={settings.eqSideFreq} \n                onChange={(v) => onChange({ eqSideFreq: v })} \n                size=\"lg\" \n            />\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAGA;AAHA;;;AAeO,SAAS,SAAS,EAAE,QAAQ,EAAE,QAAQ,EAAiB;IAC1D,qBACI,gOAAC;QAAI,WAAU;;0BACX,gOAAC,0LAAa;gBACV,OAAM;gBACN,OAAO,SAAS,UAAU;gBAC1B,UAAU,CAAC,IAAM,SAAS;wBAAE,YAAY;oBAAE;gBAC1C,MAAK;;;;;;0BAET,gOAAC,0LAAa;gBACV,OAAM;gBACN,OAAO,SAAS,MAAM;gBACtB,UAAU,CAAC,IAAM,SAAS;wBAAE,QAAQ;oBAAE;gBACtC,MAAK;;;;;;0BAET,gOAAC,0LAAa;gBACV,OAAM;gBACN,OAAO,SAAS,UAAU;gBAC1B,UAAU,CAAC,IAAM,SAAS;wBAAE,YAAY;oBAAE;gBAC1C,MAAK;;;;;;0BAET,gOAAC,0LAAa;gBACV,OAAM;gBACN,OAAO,SAAS,UAAU;gBAC1B,UAAU,CAAC,IAAM,SAAS;wBAAE,YAAY;oBAAE;gBAC1C,MAAK;;;;;;;;;;;;AAIrB;KA7BgB"}},
    {"offset": {"line": 5219, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/plugins/CompressorModule.tsx"],"sourcesContent":["'use client';\n\nimport React from 'react';\nimport { MasteringKnob } from '../MasteringKnob';\n\ninterface CompressorModuleProps {\n    settings: {\n        compStrength: number;\n        compAttack: number;\n        compRelease: number;\n        compMakeup: number;\n    };\n    onChange: (settings: any) => void;\n}\n\nexport function CompressorModule({ settings, onChange }: CompressorModuleProps) {\n    return (\n        <div className=\"flex gap-8 p-4 justify-around items-center bg-[#303030] rounded-lg border border-[#3A3A3A] shadow-inner min-h-[180px] w-full\">\n            <MasteringKnob \n                label=\"STRENGTH\" \n                value={settings.compStrength} \n                onChange={(v) => onChange({ compStrength: v })} \n                size=\"lg\" \n            />\n            <MasteringKnob \n                label=\"ATTACK\" \n                value={settings.compAttack} \n                onChange={(v) => onChange({ compAttack: v })} \n                size=\"lg\" \n            />\n            <MasteringKnob \n                label=\"RELEASE\" \n                value={settings.compRelease} \n                onChange={(v) => onChange({ compRelease: v })} \n                size=\"lg\" \n            />\n            <MasteringKnob \n                label=\"MAKEUP\" \n                value={settings.compMakeup} \n                onChange={(v) => onChange({ compMakeup: v })} \n                size=\"lg\" \n            />\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAGA;AAHA;;;AAeO,SAAS,iBAAiB,EAAE,QAAQ,EAAE,QAAQ,EAAyB;IAC1E,qBACI,gOAAC;QAAI,WAAU;;0BACX,gOAAC,0LAAa;gBACV,OAAM;gBACN,OAAO,SAAS,YAAY;gBAC5B,UAAU,CAAC,IAAM,SAAS;wBAAE,cAAc;oBAAE;gBAC5C,MAAK;;;;;;0BAET,gOAAC,0LAAa;gBACV,OAAM;gBACN,OAAO,SAAS,UAAU;gBAC1B,UAAU,CAAC,IAAM,SAAS;wBAAE,YAAY;oBAAE;gBAC1C,MAAK;;;;;;0BAET,gOAAC,0LAAa;gBACV,OAAM;gBACN,OAAO,SAAS,WAAW;gBAC3B,UAAU,CAAC,IAAM,SAAS;wBAAE,aAAa;oBAAE;gBAC3C,MAAK;;;;;;0BAET,gOAAC,0LAAa;gBACV,OAAM;gBACN,OAAO,SAAS,UAAU;gBAC1B,UAAU,CAAC,IAAM,SAAS;wBAAE,YAAY;oBAAE;gBAC1C,MAAK;;;;;;;;;;;;AAIrB;KA7BgB"}},
    {"offset": {"line": 5297, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/plugins/MultibandModule.tsx"],"sourcesContent":["'use client';\n\nimport React from 'react';\nimport { MasteringKnob } from '../MasteringKnob';\n\ninterface MultibandModuleProps {\n    settings: {\n        mbStrengthLow: number;\n        mbStrengthHigh: number;\n        mbCrossoverLow: number;\n        mbCrossoverHigh: number;\n    };\n    onChange: (settings: any) => void;\n}\n\nexport function MultibandModule({ settings, onChange }: MultibandModuleProps) {\n    return (\n        <div className=\"flex gap-8 p-4 justify-around items-center bg-[#303030] rounded-lg border border-[#3A3A3A] shadow-inner min-h-[180px] w-full\">\n            <div className=\"flex flex-col items-center gap-4 border-r border-white/5 pr-8\">\n                <span className=\"text-[8px] text-white/30 uppercase font-black tracking-widest\">Low Bands</span>\n                <div className=\"flex gap-4\">\n                    <MasteringKnob label=\"STR\" value={settings.mbStrengthLow} onChange={(v) => onChange({ mbStrengthLow: v })} size=\"md\" />\n                    <MasteringKnob label=\"CROSS\" value={settings.mbCrossoverLow} onChange={(v) => onChange({ mbCrossoverLow: v })} size=\"md\" />\n                </div>\n            </div>\n            <div className=\"flex flex-col items-center gap-4\">\n                <span className=\"text-[8px] text-white/30 uppercase font-black tracking-widest\">High Bands</span>\n                <div className=\"flex gap-4\">\n                    <MasteringKnob label=\"STR\" value={settings.mbStrengthHigh} onChange={(v) => onChange({ mbStrengthHigh: v })} size=\"md\" />\n                    <MasteringKnob label=\"CROSS\" value={settings.mbCrossoverHigh} onChange={(v) => onChange({ mbCrossoverHigh: v })} size=\"md\" />\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAGA;AAHA;;;AAeO,SAAS,gBAAgB,EAAE,QAAQ,EAAE,QAAQ,EAAwB;IACxE,qBACI,gOAAC;QAAI,WAAU;;0BACX,gOAAC;gBAAI,WAAU;;kCACX,gOAAC;wBAAK,WAAU;kCAAgE;;;;;;kCAChF,gOAAC;wBAAI,WAAU;;0CACX,gOAAC,0LAAa;gCAAC,OAAM;gCAAM,OAAO,SAAS,aAAa;gCAAE,UAAU,CAAC,IAAM,SAAS;wCAAE,eAAe;oCAAE;gCAAI,MAAK;;;;;;0CAChH,gOAAC,0LAAa;gCAAC,OAAM;gCAAQ,OAAO,SAAS,cAAc;gCAAE,UAAU,CAAC,IAAM,SAAS;wCAAE,gBAAgB;oCAAE;gCAAI,MAAK;;;;;;;;;;;;;;;;;;0BAG5H,gOAAC;gBAAI,WAAU;;kCACX,gOAAC;wBAAK,WAAU;kCAAgE;;;;;;kCAChF,gOAAC;wBAAI,WAAU;;0CACX,gOAAC,0LAAa;gCAAC,OAAM;gCAAM,OAAO,SAAS,cAAc;gCAAE,UAAU,CAAC,IAAM,SAAS;wCAAE,gBAAgB;oCAAE;gCAAI,MAAK;;;;;;0CAClH,gOAAC,0LAAa;gCAAC,OAAM;gCAAQ,OAAO,SAAS,eAAe;gCAAE,UAAU,CAAC,IAAM,SAAS;wCAAE,iBAAiB;oCAAE;gCAAI,MAAK;;;;;;;;;;;;;;;;;;;;;;;;AAK1I;KAnBgB"}},
    {"offset": {"line": 5427, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/plugins/LimiterModule.tsx"],"sourcesContent":["'use client';\n\nimport React from 'react';\nimport { MasteringKnob } from '../MasteringKnob';\n\ninterface LimiterModuleProps {\n    settings: {\n        limStrength: number;\n        limAttack: number;\n        limRelease: number;\n        limCeiling: number;\n    };\n    onChange: (settings: any) => void;\n}\n\nexport function LimiterModule({ settings, onChange }: LimiterModuleProps) {\n    return (\n        <div className=\"flex gap-8 p-4 justify-around items-center bg-[#303030] rounded-lg border border-[#3A3A3A] shadow-inner min-h-[180px] w-full\">\n            <MasteringKnob \n                label=\"STRENGTH\" \n                value={settings.limStrength} \n                onChange={(v) => onChange({ limStrength: v })} \n                size=\"lg\" \n            />\n            <MasteringKnob \n                label=\"ATTACK\" \n                value={settings.limAttack} \n                onChange={(v) => onChange({ limAttack: v })} \n                size=\"lg\" \n            />\n            <MasteringKnob \n                label=\"RELEASE\" \n                value={settings.limRelease} \n                onChange={(v) => onChange({ limRelease: v })} \n                size=\"lg\" \n            />\n            <MasteringKnob \n                label=\"CEILING\" \n                value={settings.limCeiling} \n                onChange={(v) => onChange({ limCeiling: v })} \n                size=\"lg\" \n            />\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAGA;AAHA;;;AAeO,SAAS,cAAc,EAAE,QAAQ,EAAE,QAAQ,EAAsB;IACpE,qBACI,gOAAC;QAAI,WAAU;;0BACX,gOAAC,0LAAa;gBACV,OAAM;gBACN,OAAO,SAAS,WAAW;gBAC3B,UAAU,CAAC,IAAM,SAAS;wBAAE,aAAa;oBAAE;gBAC3C,MAAK;;;;;;0BAET,gOAAC,0LAAa;gBACV,OAAM;gBACN,OAAO,SAAS,SAAS;gBACzB,UAAU,CAAC,IAAM,SAAS;wBAAE,WAAW;oBAAE;gBACzC,MAAK;;;;;;0BAET,gOAAC,0LAAa;gBACV,OAAM;gBACN,OAAO,SAAS,UAAU;gBAC1B,UAAU,CAAC,IAAM,SAAS;wBAAE,YAAY;oBAAE;gBAC1C,MAAK;;;;;;0BAET,gOAAC,0LAAa;gBACV,OAAM;gBACN,OAAO,SAAS,UAAU;gBAC1B,UAAU,CAAC,IAAM,SAAS;wBAAE,YAAY;oBAAE;gBAC1C,MAAK;;;;;;;;;;;;AAIrB;KA7BgB"}},
    {"offset": {"line": 5505, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/plugins/LevelerModule.tsx"],"sourcesContent":["'use client';\n\nimport React from 'react';\nimport { MasteringKnob } from '../MasteringKnob';\n\ninterface LevelerModuleProps {\n    settings: {\n        levelerTarget: number;\n        levelerBrake: number;\n        levelerMaxPlus: number;\n        levelerMaxMinus: number;\n    };\n    onChange: (settings: any) => void;\n}\n\nexport function LevelerModule({ settings, onChange }: LevelerModuleProps) {\n    return (\n        <div className=\"flex gap-8 p-4 justify-around items-center bg-[#303030] rounded-lg border border-[#3A3A3A] shadow-inner min-h-[180px] w-full\">\n            <MasteringKnob \n                label=\"TARGET LUFS\" \n                value={settings.levelerTarget} \n                onChange={(v) => onChange({ levelerTarget: v })} \n                size=\"lg\" \n            />\n            <MasteringKnob \n                label=\"BRAKE\" \n                value={settings.levelerBrake} \n                onChange={(v) => onChange({ levelerBrake: v })} \n                size=\"lg\" \n            />\n            <MasteringKnob \n                label=\"MAX +\" \n                value={settings.levelerMaxPlus} \n                onChange={(v) => onChange({ levelerMaxPlus: v })} \n                size=\"lg\" \n            />\n            <MasteringKnob \n                label=\"MAX -\" \n                value={settings.levelerMaxMinus} \n                onChange={(v) => onChange({ levelerMaxMinus: v })} \n                size=\"lg\" \n            />\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAGA;AAHA;;;AAeO,SAAS,cAAc,EAAE,QAAQ,EAAE,QAAQ,EAAsB;IACpE,qBACI,gOAAC;QAAI,WAAU;;0BACX,gOAAC,0LAAa;gBACV,OAAM;gBACN,OAAO,SAAS,aAAa;gBAC7B,UAAU,CAAC,IAAM,SAAS;wBAAE,eAAe;oBAAE;gBAC7C,MAAK;;;;;;0BAET,gOAAC,0LAAa;gBACV,OAAM;gBACN,OAAO,SAAS,YAAY;gBAC5B,UAAU,CAAC,IAAM,SAAS;wBAAE,cAAc;oBAAE;gBAC5C,MAAK;;;;;;0BAET,gOAAC,0LAAa;gBACV,OAAM;gBACN,OAAO,SAAS,cAAc;gBAC9B,UAAU,CAAC,IAAM,SAAS;wBAAE,gBAAgB;oBAAE;gBAC9C,MAAK;;;;;;0BAET,gOAAC,0LAAa;gBACV,OAAM;gBACN,OAAO,SAAS,eAAe;gBAC/B,UAAU,CAAC,IAAM,SAAS;wBAAE,iBAAiB;oBAAE;gBAC/C,MAAK;;;;;;;;;;;;AAIrB;KA7BgB"}},
    {"offset": {"line": 5583, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/plugins/ReverbModule.tsx"],"sourcesContent":["'use client';\n\nimport React from 'react';\n\ninterface ReverbModuleProps {\n    settings: Record<string, any>;\n    onChange: (settings: Record<string, any>) => void;\n}\n\nfunction KnobRow({ label, param, value, min, max, unit, onChange }: {\n    label: string; param: string; value: number; min: number; max: number; unit?: string;\n    onChange: (param: string, val: number) => void;\n}) {\n    const pct = ((value - min) / (max - min)) * 100;\n    return (\n        <div className=\"flex flex-col items-center gap-2\">\n            <div className=\"relative w-16 h-16\">\n                <svg viewBox=\"0 0 100 100\" className=\"w-full h-full -rotate-[135deg]\">\n                    <circle cx=\"50\" cy=\"50\" r=\"40\" fill=\"none\" stroke=\"#1a1a1a\" strokeWidth=\"8\" strokeDasharray=\"188 251\" strokeLinecap=\"round\" />\n                    <circle cx=\"50\" cy=\"50\" r=\"40\" fill=\"none\" stroke=\"#06b6d4\" strokeWidth=\"8\"\n                        strokeDasharray={`${pct * 1.88} 251`} strokeLinecap=\"round\"\n                        style={{ filter: 'drop-shadow(0 0 6px rgba(6,182,212,0.6))' }} />\n                </svg>\n                <div className=\"absolute inset-0 flex items-center justify-center\">\n                    <span className=\"text-[10px] font-mono text-cyan-400 font-bold\">\n                        {Math.round(value)}{unit}\n                    </span>\n                </div>\n            </div>\n            <input type=\"range\" min={min} max={max} step={1} value={value}\n                onChange={(e) => onChange(param, Number(e.target.value))}\n                className=\"w-14 h-1 accent-cyan-400 opacity-0 absolute cursor-pointer\"\n                style={{ width: '64px', height: '64px', top: 0, position: 'absolute', borderRadius: '50%' }}\n            />\n            <input type=\"range\" min={min} max={max} step={1} value={value}\n                onChange={(e) => onChange(param, Number(e.target.value))}\n                className=\"w-full h-1 accent-cyan-400 mt-1 cursor-pointer\"\n            />\n            <span className=\"text-[9px] font-black text-white/40 uppercase tracking-widest\">{label}</span>\n        </div>\n    );\n}\n\nexport function ReverbModule({ settings, onChange }: ReverbModuleProps) {\n    const roomSize = settings.roomSize ?? 50;\n    const damping = settings.damping ?? 50;\n    const wet = settings.wet ?? 40;\n\n    const handle = (param: string, val: number) => onChange({ ...settings, [param]: val });\n\n    return (\n        <div className=\"flex flex-col gap-6\">\n            <div className=\"flex items-center justify-between mb-2\">\n                <span className=\"text-[9px] font-black text-cyan-400/60 uppercase tracking-[0.3em]\">Room Acoustics</span>\n                <div className=\"h-1 flex-1 ml-4 bg-gradient-to-r from-cyan-500/20 to-transparent rounded-full\" />\n            </div>\n            <div className=\"grid grid-cols-3 gap-6\">\n                <KnobRow label=\"Room\" param=\"roomSize\" value={roomSize} min={0} max={100} unit=\"%\" onChange={handle} />\n                <KnobRow label=\"Damping\" param=\"damping\" value={damping} min={0} max={100} unit=\"%\" onChange={handle} />\n                <KnobRow label=\"Wet/Dry\" param=\"wet\" value={wet} min={0} max={100} unit=\"%\" onChange={handle} />\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAAA;;AASA,SAAS,QAAQ,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,QAAQ,EAG/D;IACG,MAAM,MAAM,AAAC,CAAC,QAAQ,GAAG,IAAI,CAAC,MAAM,GAAG,IAAK;IAC5C,qBACI,gOAAC;QAAI,WAAU;;0BACX,gOAAC;gBAAI,WAAU;;kCACX,gOAAC;wBAAI,SAAQ;wBAAc,WAAU;;0CACjC,gOAAC;gCAAO,IAAG;gCAAK,IAAG;gCAAK,GAAE;gCAAK,MAAK;gCAAO,QAAO;gCAAU,aAAY;gCAAI,iBAAgB;gCAAU,eAAc;;;;;;0CACpH,gOAAC;gCAAO,IAAG;gCAAK,IAAG;gCAAK,GAAE;gCAAK,MAAK;gCAAO,QAAO;gCAAU,aAAY;gCACpE,iBAAiB,GAAG,MAAM,KAAK,IAAI,CAAC;gCAAE,eAAc;gCACpD,OAAO;oCAAE,QAAQ;gCAA2C;;;;;;;;;;;;kCAEpE,gOAAC;wBAAI,WAAU;kCACX,cAAA,gOAAC;4BAAK,WAAU;;gCACX,KAAK,KAAK,CAAC;gCAAQ;;;;;;;;;;;;;;;;;;0BAIhC,gOAAC;gBAAM,MAAK;gBAAQ,KAAK;gBAAK,KAAK;gBAAK,MAAM;gBAAG,OAAO;gBACpD,UAAU,CAAC,IAAM,SAAS,OAAO,OAAO,EAAE,MAAM,CAAC,KAAK;gBACtD,WAAU;gBACV,OAAO;oBAAE,OAAO;oBAAQ,QAAQ;oBAAQ,KAAK;oBAAG,UAAU;oBAAY,cAAc;gBAAM;;;;;;0BAE9F,gOAAC;gBAAM,MAAK;gBAAQ,KAAK;gBAAK,KAAK;gBAAK,MAAM;gBAAG,OAAO;gBACpD,UAAU,CAAC,IAAM,SAAS,OAAO,OAAO,EAAE,MAAM,CAAC,KAAK;gBACtD,WAAU;;;;;;0BAEd,gOAAC;gBAAK,WAAU;0BAAiE;;;;;;;;;;;;AAG7F;KAhCS;AAkCF,SAAS,aAAa,EAAE,QAAQ,EAAE,QAAQ,EAAqB;IAClE,MAAM,WAAW,SAAS,QAAQ,IAAI;IACtC,MAAM,UAAU,SAAS,OAAO,IAAI;IACpC,MAAM,MAAM,SAAS,GAAG,IAAI;IAE5B,MAAM,SAAS,CAAC,OAAe,MAAgB,SAAS;YAAE,GAAG,QAAQ;YAAE,CAAC,MAAM,EAAE;QAAI;IAEpF,qBACI,gOAAC;QAAI,WAAU;;0BACX,gOAAC;gBAAI,WAAU;;kCACX,gOAAC;wBAAK,WAAU;kCAAoE;;;;;;kCACpF,gOAAC;wBAAI,WAAU;;;;;;;;;;;;0BAEnB,gOAAC;gBAAI,WAAU;;kCACX,gOAAC;wBAAQ,OAAM;wBAAO,OAAM;wBAAW,OAAO;wBAAU,KAAK;wBAAG,KAAK;wBAAK,MAAK;wBAAI,UAAU;;;;;;kCAC7F,gOAAC;wBAAQ,OAAM;wBAAU,OAAM;wBAAU,OAAO;wBAAS,KAAK;wBAAG,KAAK;wBAAK,MAAK;wBAAI,UAAU;;;;;;kCAC9F,gOAAC;wBAAQ,OAAM;wBAAU,OAAM;wBAAM,OAAO;wBAAK,KAAK;wBAAG,KAAK;wBAAK,MAAK;wBAAI,UAAU;;;;;;;;;;;;;;;;;;AAItG;MApBgB"}},
    {"offset": {"line": 5813, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/plugins/DelayModule.tsx"],"sourcesContent":["'use client';\n\nimport React from 'react';\n\ninterface DelayModuleProps {\n    settings: Record<string, any>;\n    onChange: (settings: Record<string, any>) => void;\n}\n\nexport function DelayModule({ settings, onChange }: DelayModuleProps) {\n    const time = settings.delayTime ?? 250;\n    const feedback = settings.feedback ?? 40;\n    const mix = settings.mix ?? 30;\n\n    const handle = (param: string, val: number) => onChange({ ...settings, [param]: val });\n\n    const pct = (val: number, min: number, max: number) => ((val - min) / (max - min)) * 100;\n\n    const Knob = ({ label, param, value, min, max, unit }: { label: string; param: string; value: number; min: number; max: number; unit?: string }) => (\n        <div className=\"flex flex-col items-center gap-2 relative\">\n            <div className=\"relative w-16 h-16\">\n                <svg viewBox=\"0 0 100 100\" className=\"w-full h-full -rotate-[135deg]\">\n                    <circle cx=\"50\" cy=\"50\" r=\"40\" fill=\"none\" stroke=\"#1a1a1a\" strokeWidth=\"8\" strokeDasharray=\"188 251\" strokeLinecap=\"round\" />\n                    <circle cx=\"50\" cy=\"50\" r=\"40\" fill=\"none\" stroke=\"#f97316\" strokeWidth=\"8\"\n                        strokeDasharray={`${pct(value, min, max) * 1.88} 251`} strokeLinecap=\"round\"\n                        style={{ filter: 'drop-shadow(0 0 6px rgba(249,115,22,0.6))' }} />\n                </svg>\n                <div className=\"absolute inset-0 flex items-center justify-center\">\n                    <span className=\"text-[10px] font-mono text-orange-400 font-bold\">{Math.round(value)}{unit}</span>\n                </div>\n            </div>\n            <input type=\"range\" min={min} max={max} value={value}\n                onChange={(e) => handle(param, Number(e.target.value))}\n                className=\"w-full h-1 accent-orange-400 cursor-pointer\" />\n            <span className=\"text-[9px] font-black text-white/40 uppercase tracking-widest\">{label}</span>\n        </div>\n    );\n\n    return (\n        <div className=\"flex flex-col gap-6\">\n            <div className=\"flex items-center justify-between mb-2\">\n                <span className=\"text-[9px] font-black text-orange-400/60 uppercase tracking-[0.3em]\">Echo Engine</span>\n                <div className=\"h-1 flex-1 ml-4 bg-gradient-to-r from-orange-500/20 to-transparent rounded-full\" />\n            </div>\n            <div className=\"grid grid-cols-3 gap-6\">\n                <Knob label=\"Time\" param=\"delayTime\" value={time} min={0} max={1000} unit=\"ms\" />\n                <Knob label=\"Feedback\" param=\"feedback\" value={feedback} min={0} max={95} unit=\"%\" />\n                <Knob label=\"Mix\" param=\"mix\" value={mix} min={0} max={100} unit=\"%\" />\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAAA;;AASO,SAAS,YAAY,EAAE,QAAQ,EAAE,QAAQ,EAAoB;IAChE,MAAM,OAAO,SAAS,SAAS,IAAI;IACnC,MAAM,WAAW,SAAS,QAAQ,IAAI;IACtC,MAAM,MAAM,SAAS,GAAG,IAAI;IAE5B,MAAM,SAAS,CAAC,OAAe,MAAgB,SAAS;YAAE,GAAG,QAAQ;YAAE,CAAC,MAAM,EAAE;QAAI;IAEpF,MAAM,MAAM,CAAC,KAAa,KAAa,MAAgB,AAAC,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,GAAG,IAAK;IAErF,MAAM,OAAO,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,EAAE,GAAG,EAAE,IAAI,EAA4F,iBAC3I,gOAAC;YAAI,WAAU;;8BACX,gOAAC;oBAAI,WAAU;;sCACX,gOAAC;4BAAI,SAAQ;4BAAc,WAAU;;8CACjC,gOAAC;oCAAO,IAAG;oCAAK,IAAG;oCAAK,GAAE;oCAAK,MAAK;oCAAO,QAAO;oCAAU,aAAY;oCAAI,iBAAgB;oCAAU,eAAc;;;;;;8CACpH,gOAAC;oCAAO,IAAG;oCAAK,IAAG;oCAAK,GAAE;oCAAK,MAAK;oCAAO,QAAO;oCAAU,aAAY;oCACpE,iBAAiB,GAAG,IAAI,OAAO,KAAK,OAAO,KAAK,IAAI,CAAC;oCAAE,eAAc;oCACrE,OAAO;wCAAE,QAAQ;oCAA4C;;;;;;;;;;;;sCAErE,gOAAC;4BAAI,WAAU;sCACX,cAAA,gOAAC;gCAAK,WAAU;;oCAAmD,KAAK,KAAK,CAAC;oCAAQ;;;;;;;;;;;;;;;;;;8BAG9F,gOAAC;oBAAM,MAAK;oBAAQ,KAAK;oBAAK,KAAK;oBAAK,OAAO;oBAC3C,UAAU,CAAC,IAAM,OAAO,OAAO,OAAO,EAAE,MAAM,CAAC,KAAK;oBACpD,WAAU;;;;;;8BACd,gOAAC;oBAAK,WAAU;8BAAiE;;;;;;;;;;;;IAIzF,qBACI,gOAAC;QAAI,WAAU;;0BACX,gOAAC;gBAAI,WAAU;;kCACX,gOAAC;wBAAK,WAAU;kCAAsE;;;;;;kCACtF,gOAAC;wBAAI,WAAU;;;;;;;;;;;;0BAEnB,gOAAC;gBAAI,WAAU;;kCACX,gOAAC;wBAAK,OAAM;wBAAO,OAAM;wBAAY,OAAO;wBAAM,KAAK;wBAAG,KAAK;wBAAM,MAAK;;;;;;kCAC1E,gOAAC;wBAAK,OAAM;wBAAW,OAAM;wBAAW,OAAO;wBAAU,KAAK;wBAAG,KAAK;wBAAI,MAAK;;;;;;kCAC/E,gOAAC;wBAAK,OAAM;wBAAM,OAAM;wBAAM,OAAO;wBAAK,KAAK;wBAAG,KAAK;wBAAK,MAAK;;;;;;;;;;;;;;;;;;AAIjF;KA1CgB"}},
    {"offset": {"line": 6015, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/plugins/ChorusModule.tsx"],"sourcesContent":["'use client';\n\nimport React from 'react';\n\ninterface ChorusModuleProps {\n    settings: Record<string, any>;\n    onChange: (settings: Record<string, any>) => void;\n}\n\nexport function ChorusModule({ settings, onChange }: ChorusModuleProps) {\n    const rate = settings.rate ?? 1;\n    const depth = settings.depth ?? 50;\n    const mix = settings.mix ?? 50;\n\n    const handle = (param: string, val: number) => onChange({ ...settings, [param]: val });\n\n    const pct = (val: number, min: number, max: number) => ((val - min) / (max - min)) * 100;\n\n    const Knob = ({ label, param, value, min, max, unit, step = 1 }: { label: string; param: string; value: number; min: number; max: number; unit?: string; step?: number }) => (\n        <div className=\"flex flex-col items-center gap-2 relative\">\n            <div className=\"relative w-16 h-16\">\n                <svg viewBox=\"0 0 100 100\" className=\"w-full h-full -rotate-[135deg]\">\n                    <circle cx=\"50\" cy=\"50\" r=\"40\" fill=\"none\" stroke=\"#1a1a1a\" strokeWidth=\"8\" strokeDasharray=\"188 251\" strokeLinecap=\"round\" />\n                    <circle cx=\"50\" cy=\"50\" r=\"40\" fill=\"none\" stroke=\"#a78bfa\" strokeWidth=\"8\"\n                        strokeDasharray={`${pct(value, min, max) * 1.88} 251`} strokeLinecap=\"round\"\n                        style={{ filter: 'drop-shadow(0 0 6px rgba(167,139,250,0.6))' }} />\n                </svg>\n                <div className=\"absolute inset-0 flex items-center justify-center\">\n                    <span className=\"text-[10px] font-mono text-purple-400 font-bold\">{step < 1 ? value.toFixed(1) : Math.round(value)}{unit}</span>\n                </div>\n            </div>\n            <input type=\"range\" min={min} max={max} step={step} value={value}\n                onChange={(e) => handle(param, Number(e.target.value))}\n                className=\"w-full h-1 accent-purple-400 cursor-pointer\" />\n            <span className=\"text-[9px] font-black text-white/40 uppercase tracking-widest\">{label}</span>\n        </div>\n    );\n\n    return (\n        <div className=\"flex flex-col gap-6\">\n            <div className=\"flex items-center justify-between mb-2\">\n                <span className=\"text-[9px] font-black text-purple-400/60 uppercase tracking-[0.3em]\">Modulation</span>\n                <div className=\"h-1 flex-1 ml-4 bg-gradient-to-r from-purple-500/20 to-transparent rounded-full\" />\n            </div>\n            <div className=\"grid grid-cols-3 gap-6\">\n                <Knob label=\"Rate\" param=\"rate\" value={rate} min={0.1} max={10} unit=\"Hz\" step={0.1} />\n                <Knob label=\"Depth\" param=\"depth\" value={depth} min={0} max={100} unit=\"%\" />\n                <Knob label=\"Mix\" param=\"mix\" value={mix} min={0} max={100} unit=\"%\" />\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAAA;;AASO,SAAS,aAAa,EAAE,QAAQ,EAAE,QAAQ,EAAqB;IAClE,MAAM,OAAO,SAAS,IAAI,IAAI;IAC9B,MAAM,QAAQ,SAAS,KAAK,IAAI;IAChC,MAAM,MAAM,SAAS,GAAG,IAAI;IAE5B,MAAM,SAAS,CAAC,OAAe,MAAgB,SAAS;YAAE,GAAG,QAAQ;YAAE,CAAC,MAAM,EAAE;QAAI;IAEpF,MAAM,MAAM,CAAC,KAAa,KAAa,MAAgB,AAAC,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,GAAG,IAAK;IAErF,MAAM,OAAO,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,OAAO,CAAC,EAA2G,iBACpK,gOAAC;YAAI,WAAU;;8BACX,gOAAC;oBAAI,WAAU;;sCACX,gOAAC;4BAAI,SAAQ;4BAAc,WAAU;;8CACjC,gOAAC;oCAAO,IAAG;oCAAK,IAAG;oCAAK,GAAE;oCAAK,MAAK;oCAAO,QAAO;oCAAU,aAAY;oCAAI,iBAAgB;oCAAU,eAAc;;;;;;8CACpH,gOAAC;oCAAO,IAAG;oCAAK,IAAG;oCAAK,GAAE;oCAAK,MAAK;oCAAO,QAAO;oCAAU,aAAY;oCACpE,iBAAiB,GAAG,IAAI,OAAO,KAAK,OAAO,KAAK,IAAI,CAAC;oCAAE,eAAc;oCACrE,OAAO;wCAAE,QAAQ;oCAA6C;;;;;;;;;;;;sCAEtE,gOAAC;4BAAI,WAAU;sCACX,cAAA,gOAAC;gCAAK,WAAU;;oCAAmD,OAAO,IAAI,MAAM,OAAO,CAAC,KAAK,KAAK,KAAK,CAAC;oCAAQ;;;;;;;;;;;;;;;;;;8BAG5H,gOAAC;oBAAM,MAAK;oBAAQ,KAAK;oBAAK,KAAK;oBAAK,MAAM;oBAAM,OAAO;oBACvD,UAAU,CAAC,IAAM,OAAO,OAAO,OAAO,EAAE,MAAM,CAAC,KAAK;oBACpD,WAAU;;;;;;8BACd,gOAAC;oBAAK,WAAU;8BAAiE;;;;;;;;;;;;IAIzF,qBACI,gOAAC;QAAI,WAAU;;0BACX,gOAAC;gBAAI,WAAU;;kCACX,gOAAC;wBAAK,WAAU;kCAAsE;;;;;;kCACtF,gOAAC;wBAAI,WAAU;;;;;;;;;;;;0BAEnB,gOAAC;gBAAI,WAAU;;kCACX,gOAAC;wBAAK,OAAM;wBAAO,OAAM;wBAAO,OAAO;wBAAM,KAAK;wBAAK,KAAK;wBAAI,MAAK;wBAAK,MAAM;;;;;;kCAChF,gOAAC;wBAAK,OAAM;wBAAQ,OAAM;wBAAQ,OAAO;wBAAO,KAAK;wBAAG,KAAK;wBAAK,MAAK;;;;;;kCACvE,gOAAC;wBAAK,OAAM;wBAAM,OAAM;wBAAM,OAAO;wBAAK,KAAK;wBAAG,KAAK;wBAAK,MAAK;;;;;;;;;;;;;;;;;;AAIjF;KA1CgB"}},
    {"offset": {"line": 6219, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/plugins/DistortionModule.tsx"],"sourcesContent":["'use client';\n\nimport React from 'react';\n\ninterface DistortionModuleProps {\n    settings: Record<string, any>;\n    onChange: (settings: Record<string, any>) => void;\n}\n\nexport function DistortionModule({ settings, onChange }: DistortionModuleProps) {\n    const drive = settings.drive ?? 50;\n    const tone = settings.tone ?? 50;\n    const mix = settings.mix ?? 50;\n\n    const handle = (param: string, val: number) => onChange({ ...settings, [param]: val });\n\n    const pct = (val: number, min: number, max: number) => ((val - min) / (max - min)) * 100;\n\n    const Knob = ({ label, param, value, min, max, unit }: { label: string; param: string; value: number; min: number; max: number; unit?: string }) => (\n        <div className=\"flex flex-col items-center gap-2 relative\">\n            <div className=\"relative w-16 h-16\">\n                <svg viewBox=\"0 0 100 100\" className=\"w-full h-full -rotate-[135deg]\">\n                    <circle cx=\"50\" cy=\"50\" r=\"40\" fill=\"none\" stroke=\"#1a1a1a\" strokeWidth=\"8\" strokeDasharray=\"188 251\" strokeLinecap=\"round\" />\n                    <circle cx=\"50\" cy=\"50\" r=\"40\" fill=\"none\" stroke=\"#ef4444\" strokeWidth=\"8\"\n                        strokeDasharray={`${pct(value, min, max) * 1.88} 251`} strokeLinecap=\"round\"\n                        style={{ filter: 'drop-shadow(0 0 6px rgba(239,68,68,0.6))' }} />\n                </svg>\n                <div className=\"absolute inset-0 flex items-center justify-center\">\n                    <span className=\"text-[10px] font-mono text-red-400 font-bold\">{Math.round(value)}{unit}</span>\n                </div>\n            </div>\n            <input type=\"range\" min={min} max={max} value={value}\n                onChange={(e) => handle(param, Number(e.target.value))}\n                className=\"w-full h-1 accent-red-500 cursor-pointer\" />\n            <span className=\"text-[9px] font-black text-white/40 uppercase tracking-widest\">{label}</span>\n        </div>\n    );\n\n    return (\n        <div className=\"flex flex-col gap-6\">\n            <div className=\"flex items-center justify-between mb-2\">\n                <span className=\"text-[9px] font-black text-red-400/60 uppercase tracking-[0.3em]\">Saturation Drive</span>\n                <div className=\"h-1 flex-1 ml-4 bg-gradient-to-r from-red-500/20 to-transparent rounded-full\" />\n            </div>\n            <div className=\"grid grid-cols-3 gap-6\">\n                <Knob label=\"Drive\" param=\"drive\" value={drive} min={0} max={100} unit=\"%\" />\n                <Knob label=\"Tone\" param=\"tone\" value={tone} min={0} max={100} unit=\"%\" />\n                <Knob label=\"Mix\" param=\"mix\" value={mix} min={0} max={100} unit=\"%\" />\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAAA;;AASO,SAAS,iBAAiB,EAAE,QAAQ,EAAE,QAAQ,EAAyB;IAC1E,MAAM,QAAQ,SAAS,KAAK,IAAI;IAChC,MAAM,OAAO,SAAS,IAAI,IAAI;IAC9B,MAAM,MAAM,SAAS,GAAG,IAAI;IAE5B,MAAM,SAAS,CAAC,OAAe,MAAgB,SAAS;YAAE,GAAG,QAAQ;YAAE,CAAC,MAAM,EAAE;QAAI;IAEpF,MAAM,MAAM,CAAC,KAAa,KAAa,MAAgB,AAAC,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,GAAG,IAAK;IAErF,MAAM,OAAO,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,EAAE,GAAG,EAAE,IAAI,EAA4F,iBAC3I,gOAAC;YAAI,WAAU;;8BACX,gOAAC;oBAAI,WAAU;;sCACX,gOAAC;4BAAI,SAAQ;4BAAc,WAAU;;8CACjC,gOAAC;oCAAO,IAAG;oCAAK,IAAG;oCAAK,GAAE;oCAAK,MAAK;oCAAO,QAAO;oCAAU,aAAY;oCAAI,iBAAgB;oCAAU,eAAc;;;;;;8CACpH,gOAAC;oCAAO,IAAG;oCAAK,IAAG;oCAAK,GAAE;oCAAK,MAAK;oCAAO,QAAO;oCAAU,aAAY;oCACpE,iBAAiB,GAAG,IAAI,OAAO,KAAK,OAAO,KAAK,IAAI,CAAC;oCAAE,eAAc;oCACrE,OAAO;wCAAE,QAAQ;oCAA2C;;;;;;;;;;;;sCAEpE,gOAAC;4BAAI,WAAU;sCACX,cAAA,gOAAC;gCAAK,WAAU;;oCAAgD,KAAK,KAAK,CAAC;oCAAQ;;;;;;;;;;;;;;;;;;8BAG3F,gOAAC;oBAAM,MAAK;oBAAQ,KAAK;oBAAK,KAAK;oBAAK,OAAO;oBAC3C,UAAU,CAAC,IAAM,OAAO,OAAO,OAAO,EAAE,MAAM,CAAC,KAAK;oBACpD,WAAU;;;;;;8BACd,gOAAC;oBAAK,WAAU;8BAAiE;;;;;;;;;;;;IAIzF,qBACI,gOAAC;QAAI,WAAU;;0BACX,gOAAC;gBAAI,WAAU;;kCACX,gOAAC;wBAAK,WAAU;kCAAmE;;;;;;kCACnF,gOAAC;wBAAI,WAAU;;;;;;;;;;;;0BAEnB,gOAAC;gBAAI,WAAU;;kCACX,gOAAC;wBAAK,OAAM;wBAAQ,OAAM;wBAAQ,OAAO;wBAAO,KAAK;wBAAG,KAAK;wBAAK,MAAK;;;;;;kCACvE,gOAAC;wBAAK,OAAM;wBAAO,OAAM;wBAAO,OAAO;wBAAM,KAAK;wBAAG,KAAK;wBAAK,MAAK;;;;;;kCACpE,gOAAC;wBAAK,OAAM;wBAAM,OAAM;wBAAM,OAAO;wBAAK,KAAK;wBAAG,KAAK;wBAAK,MAAK;;;;;;;;;;;;;;;;;;AAIjF;KA1CgB"}},
    {"offset": {"line": 6421, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/Knob.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useRef, useEffect } from 'react';\nimport { cn } from '@/lib/utils';\n\ninterface KnobProps {\n    value: number;\n    min: number;\n    max: number;\n    onChange: (val: number) => void;\n    className?: string;\n    size?: number;\n}\n\nexport function Knob({ value, min, max, onChange, className, size = 32 }: KnobProps) {\n    const [isDragging, setIsDragging] = useState(false);\n    const startY = useRef(0);\n    const startVal = useRef(value);\n\n    const range = max - min;\n    const percentage = (value - min) / range;\n    // Map 0-100% to -135 to +135 degrees (270 total sweep)\n    const rotation = percentage * 270 - 135;\n\n    useEffect(() => {\n        const handleMouseMove = (e: MouseEvent) => {\n            if (!isDragging) return;\n            const deltaY = startY.current - e.clientY;\n            // 1 pixel = 1 step for now. Add shift key for precision later.\n            const step = range / 100;\n            let newVal = startVal.current + deltaY * step;\n            newVal = Math.max(min, Math.min(max, newVal));\n            onChange(Math.round(newVal));\n        };\n\n        const handleMouseUp = () => {\n            setIsDragging(false);\n        };\n\n        if (isDragging) {\n            window.addEventListener('mousemove', handleMouseMove);\n            window.addEventListener('mouseup', handleMouseUp);\n        }\n\n        return () => {\n            window.removeEventListener('mousemove', handleMouseMove);\n            window.removeEventListener('mouseup', handleMouseUp);\n        };\n    }, [isDragging, min, max, onChange, range]);\n\n    return (\n        <div\n            className={cn(\"relative rounded-full bg-carbon shadow-xl border border-silver-dark/40 flex items-center justify-center cursor-ns-resize\", className)}\n            style={{ width: size, height: size }}\n            onMouseDown={(e) => {\n                setIsDragging(true);\n                startY.current = e.clientY;\n                startVal.current = value;\n            }}\n        >\n            <div\n                className=\"absolute top-0 w-1 bg-primary rounded-t-full origin-bottom transition-transform duration-75\"\n                style={{ height: '50%', transform: `rotate(${rotation}deg)` }}\n            />\n            <div className=\"absolute inset-2 rounded-full bg-gradient-to-br from-neutral-700 to-black shadow-inner\" />\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;AAHA;;;AAcO,SAAS,KAAK,EAAE,KAAK,EAAE,GAAG,EAAE,GAAG,EAAE,QAAQ,EAAE,SAAS,EAAE,OAAO,EAAE,EAAa;;IAC/E,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,4MAAQ,EAAC;IAC7C,MAAM,SAAS,IAAA,0MAAM,EAAC;IACtB,MAAM,WAAW,IAAA,0MAAM,EAAC;IAExB,MAAM,QAAQ,MAAM;IACpB,MAAM,aAAa,CAAC,QAAQ,GAAG,IAAI;IACnC,uDAAuD;IACvD,MAAM,WAAW,aAAa,MAAM;IAEpC,IAAA,6MAAS;0BAAC;YACN,MAAM;kDAAkB,CAAC;oBACrB,IAAI,CAAC,YAAY;oBACjB,MAAM,SAAS,OAAO,OAAO,GAAG,EAAE,OAAO;oBACzC,+DAA+D;oBAC/D,MAAM,OAAO,QAAQ;oBACrB,IAAI,SAAS,SAAS,OAAO,GAAG,SAAS;oBACzC,SAAS,KAAK,GAAG,CAAC,KAAK,KAAK,GAAG,CAAC,KAAK;oBACrC,SAAS,KAAK,KAAK,CAAC;gBACxB;;YAEA,MAAM;gDAAgB;oBAClB,cAAc;gBAClB;;YAEA,IAAI,YAAY;gBACZ,OAAO,gBAAgB,CAAC,aAAa;gBACrC,OAAO,gBAAgB,CAAC,WAAW;YACvC;YAEA;kCAAO;oBACH,OAAO,mBAAmB,CAAC,aAAa;oBACxC,OAAO,mBAAmB,CAAC,WAAW;gBAC1C;;QACJ;yBAAG;QAAC;QAAY;QAAK;QAAK;QAAU;KAAM;IAE1C,qBACI,gOAAC;QACG,WAAW,IAAA,wJAAE,EAAC,4HAA4H;QAC1I,OAAO;YAAE,OAAO;YAAM,QAAQ;QAAK;QACnC,aAAa,CAAC;YACV,cAAc;YACd,OAAO,OAAO,GAAG,EAAE,OAAO;YAC1B,SAAS,OAAO,GAAG;QACvB;;0BAEA,gOAAC;gBACG,WAAU;gBACV,OAAO;oBAAE,QAAQ;oBAAO,WAAW,CAAC,OAAO,EAAE,SAAS,IAAI,CAAC;gBAAC;;;;;;0BAEhE,gOAAC;gBAAI,WAAU;;;;;;;;;;;;AAG3B;GArDgB;KAAA"}},
    {"offset": {"line": 6526, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/plugins/SaturatorModule.tsx"],"sourcesContent":["'use client';\n\nimport React from 'react';\nimport { Knob } from '../Knob';\n\ninterface SaturatorModuleProps {\n    settings: Record<string, any>;\n    onChange: (settings: Record<string, any>) => void;\n}\n\n/**\n * Da Graba Tube Saturator — Plugin UI\n * Routes through the C++ WASM DG_Saturator for analog-style warmth.\n */\nexport function SaturatorModule({ settings, onChange }: SaturatorModuleProps) {\n    const drive = settings.satDrive ?? 30;\n    const mix = settings.satMix ?? 50;\n    const output = settings.satOutput ?? 50;\n    const bias = settings.satBias ?? 10;\n\n    return (\n        <div className=\"flex flex-col gap-4\">\n            {/* Header */}\n            <div className=\"flex items-center gap-2\">\n                <div className=\"w-2 h-2 rounded-full bg-orange-500 animate-pulse\" />\n                <span className=\"text-[9px] font-black text-orange-400/80 tracking-widest uppercase\">\n                    Tube Saturator · WASM\n                </span>\n            </div>\n\n            {/* Knobs row */}\n            <div className=\"flex items-center justify-center gap-6\">\n                {/* DRIVE */}\n                <div className=\"flex flex-col items-center gap-2\">\n                    <Knob\n                        value={drive}\n                        min={0} max={100}\n                        onChange={(v) => onChange({ ...settings, satDrive: v })}\n                        size={40}\n                    />\n                    <span className=\"text-[8px] font-black tracking-widest text-orange-400/60 uppercase\">Drive</span>\n                    <span className=\"text-[9px] font-mono text-white/30\">{drive}%</span>\n                </div>\n                {/* MIX */}\n                <div className=\"flex flex-col items-center gap-2\">\n                    <Knob\n                        value={mix}\n                        min={0} max={100}\n                        onChange={(v) => onChange({ ...settings, satMix: v })}\n                        size={40}\n                    />\n                    <span className=\"text-[8px] font-black tracking-widest text-orange-300/60 uppercase\">Mix</span>\n                    <span className=\"text-[9px] font-mono text-white/30\">{mix}%</span>\n                </div>\n                {/* OUTPUT */}\n                <div className=\"flex flex-col items-center gap-2\">\n                    <Knob\n                        value={output}\n                        min={0} max={100}\n                        onChange={(v) => onChange({ ...settings, satOutput: v })}\n                        size={40}\n                    />\n                    <span className=\"text-[8px] font-black tracking-widest text-amber-400/60 uppercase\">Output</span>\n                    <span className=\"text-[9px] font-mono text-white/30\">{output}%</span>\n                </div>\n                {/* BIAS */}\n                <div className=\"flex flex-col items-center gap-2\">\n                    <Knob\n                        value={bias}\n                        min={0} max={50}\n                        onChange={(v) => onChange({ ...settings, satBias: v })}\n                        size={40}\n                    />\n                    <span className=\"text-[8px] font-black tracking-widest text-red-400/60 uppercase\">Bias</span>\n                    <span className=\"text-[9px] font-mono text-white/30\">{bias}%</span>\n                </div>\n            </div>\n\n            {/* VU-style indicator */}\n            <div className=\"mx-auto w-[260px] h-3 bg-[#111] rounded-full border border-white/5 overflow-hidden\">\n                <div\n                    className=\"h-full rounded-full transition-all duration-150\"\n                    style={{\n                        width: `${Math.min(100, drive * 1.5)}%`,\n                        background: `linear-gradient(90deg, #FF6B00 0%, #FF0000 ${Math.min(100, drive * 2)}%)`,\n                    }}\n                />\n            </div>\n\n            <p className=\"text-[8px] text-white/20 text-center font-mono\">\n                Asymmetric Tube Model · 2nd Harmonic Injection · C++ WASM\n            </p>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAGA;AAHA;;;AAcO,SAAS,gBAAgB,EAAE,QAAQ,EAAE,QAAQ,EAAwB;IACxE,MAAM,QAAQ,SAAS,QAAQ,IAAI;IACnC,MAAM,MAAM,SAAS,MAAM,IAAI;IAC/B,MAAM,SAAS,SAAS,SAAS,IAAI;IACrC,MAAM,OAAO,SAAS,OAAO,IAAI;IAEjC,qBACI,gOAAC;QAAI,WAAU;;0BAEX,gOAAC;gBAAI,WAAU;;kCACX,gOAAC;wBAAI,WAAU;;;;;;kCACf,gOAAC;wBAAK,WAAU;kCAAqE;;;;;;;;;;;;0BAMzF,gOAAC;gBAAI,WAAU;;kCAEX,gOAAC;wBAAI,WAAU;;0CACX,gOAAC,wKAAI;gCACD,OAAO;gCACP,KAAK;gCAAG,KAAK;gCACb,UAAU,CAAC,IAAM,SAAS;wCAAE,GAAG,QAAQ;wCAAE,UAAU;oCAAE;gCACrD,MAAM;;;;;;0CAEV,gOAAC;gCAAK,WAAU;0CAAqE;;;;;;0CACrF,gOAAC;gCAAK,WAAU;;oCAAsC;oCAAM;;;;;;;;;;;;;kCAGhE,gOAAC;wBAAI,WAAU;;0CACX,gOAAC,wKAAI;gCACD,OAAO;gCACP,KAAK;gCAAG,KAAK;gCACb,UAAU,CAAC,IAAM,SAAS;wCAAE,GAAG,QAAQ;wCAAE,QAAQ;oCAAE;gCACnD,MAAM;;;;;;0CAEV,gOAAC;gCAAK,WAAU;0CAAqE;;;;;;0CACrF,gOAAC;gCAAK,WAAU;;oCAAsC;oCAAI;;;;;;;;;;;;;kCAG9D,gOAAC;wBAAI,WAAU;;0CACX,gOAAC,wKAAI;gCACD,OAAO;gCACP,KAAK;gCAAG,KAAK;gCACb,UAAU,CAAC,IAAM,SAAS;wCAAE,GAAG,QAAQ;wCAAE,WAAW;oCAAE;gCACtD,MAAM;;;;;;0CAEV,gOAAC;gCAAK,WAAU;0CAAoE;;;;;;0CACpF,gOAAC;gCAAK,WAAU;;oCAAsC;oCAAO;;;;;;;;;;;;;kCAGjE,gOAAC;wBAAI,WAAU;;0CACX,gOAAC,wKAAI;gCACD,OAAO;gCACP,KAAK;gCAAG,KAAK;gCACb,UAAU,CAAC,IAAM,SAAS;wCAAE,GAAG,QAAQ;wCAAE,SAAS;oCAAE;gCACpD,MAAM;;;;;;0CAEV,gOAAC;gCAAK,WAAU;0CAAkE;;;;;;0CAClF,gOAAC;gCAAK,WAAU;;oCAAsC;oCAAK;;;;;;;;;;;;;;;;;;;0BAKnE,gOAAC;gBAAI,WAAU;0BACX,cAAA,gOAAC;oBACG,WAAU;oBACV,OAAO;wBACH,OAAO,GAAG,KAAK,GAAG,CAAC,KAAK,QAAQ,KAAK,CAAC,CAAC;wBACvC,YAAY,CAAC,2CAA2C,EAAE,KAAK,GAAG,CAAC,KAAK,QAAQ,GAAG,EAAE,CAAC;oBAC1F;;;;;;;;;;;0BAIR,gOAAC;gBAAE,WAAU;0BAAiD;;;;;;;;;;;;AAK1E;KAhFgB"}},
    {"offset": {"line": 6787, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/lib/soundBanks.ts"],"sourcesContent":["/**\n * Sound Banks for DA GRABA Virtual Instrument Plugin\n * Each bank defines synthesis parameters for Web Audio API playback\n * and can optionally load sample buffers.\n */\n\nexport type OscType = 'sine' | 'square' | 'sawtooth' | 'triangle';\n\nexport interface ADSR {\n    attack: number;    // seconds\n    decay: number;     // seconds\n    sustain: number;   // 0-1\n    release: number;   // seconds\n}\n\nexport interface SoundBank {\n    id: string;\n    name: string;\n    category: 'keys' | 'strings' | 'bass' | 'synth' | 'percussion' | 'brass' | 'pad' | 'fx';\n    oscillator: OscType;\n    adsr: ADSR;\n    detune: number;         // cents\n    filterFreq: number;     // Hz (0 = no filter)\n    filterQ: number;\n    gain: number;           // 0-1\n    color: string;          // UI accent color\n    icon: string;           // emoji\n    aiTrainable: boolean;   // Can be trained with Modal\n    hasCustomSamples?: boolean;\n    sampleUrls?: Record<string, string>; // note -> audioURL\n}\n\nexport const SOUND_BANKS: SoundBank[] = [\n    {\n        id: 'grand_piano',\n        name: 'Grand Piano',\n        category: 'keys',\n        oscillator: 'triangle',\n        adsr: { attack: 0.005, decay: 1.2, sustain: 0.3, release: 1.0 },\n        detune: 0,\n        filterFreq: 5000,\n        filterQ: 0.5,\n        gain: 0.7,\n        color: '#00F0FF',\n        icon: '🎹',\n        aiTrainable: true,\n    },\n    {\n        id: 'electric_piano',\n        name: 'Electric Piano',\n        category: 'keys',\n        oscillator: 'sine',\n        adsr: { attack: 0.01, decay: 0.8, sustain: 0.5, release: 0.5 },\n        detune: 5,\n        filterFreq: 3000,\n        filterQ: 1,\n        gain: 0.65,\n        color: '#F5A623',\n        icon: '🎹',\n        aiTrainable: true,\n    },\n    {\n        id: 'strings',\n        name: 'Strings Ensemble',\n        category: 'strings',\n        oscillator: 'sawtooth',\n        adsr: { attack: 0.4, decay: 0.2, sustain: 0.8, release: 0.8 },\n        detune: 8,\n        filterFreq: 2000,\n        filterQ: 0.7,\n        gain: 0.5,\n        color: '#E8D16E',\n        icon: '🎻',\n        aiTrainable: true,\n    },\n    {\n        id: 'violin_solo',\n        name: 'Violin Solo',\n        category: 'strings',\n        oscillator: 'sawtooth',\n        adsr: { attack: 0.3, decay: 0.1, sustain: 0.9, release: 0.6 },\n        detune: 3,\n        filterFreq: 3500,\n        filterQ: 1.2,\n        gain: 0.55,\n        color: '#E8A54B',\n        icon: '🎻',\n        aiTrainable: true,\n    },\n    {\n        id: 'bass_guitar',\n        name: 'Bass Guitar',\n        category: 'bass',\n        oscillator: 'triangle',\n        adsr: { attack: 0.005, decay: 0.3, sustain: 0.6, release: 0.3 },\n        detune: -1200,\n        filterFreq: 800,\n        filterQ: 2,\n        gain: 0.8,\n        color: '#FF6B00',\n        icon: '🎸',\n        aiTrainable: true,\n    },\n    {\n        id: 'synth_bass',\n        name: 'Synth Bass',\n        category: 'bass',\n        oscillator: 'square',\n        adsr: { attack: 0.01, decay: 0.2, sustain: 0.5, release: 0.2 },\n        detune: -1200,\n        filterFreq: 600,\n        filterQ: 3,\n        gain: 0.75,\n        color: '#FF4040',\n        icon: '🔊',\n        aiTrainable: true,\n    },\n    {\n        id: 'synth_lead',\n        name: 'Synth Lead',\n        category: 'synth',\n        oscillator: 'sawtooth',\n        adsr: { attack: 0.05, decay: 0.1, sustain: 0.8, release: 0.3 },\n        detune: 0,\n        filterFreq: 4000,\n        filterQ: 5,\n        gain: 0.6,\n        color: '#A855F7',\n        icon: '🌊',\n        aiTrainable: true,\n    },\n    {\n        id: 'synth_pad',\n        name: 'Synth Pad',\n        category: 'pad',\n        oscillator: 'sine',\n        adsr: { attack: 0.5, decay: 0.5, sustain: 0.7, release: 1.5 },\n        detune: 12,\n        filterFreq: 1500,\n        filterQ: 2,\n        gain: 0.45,\n        color: '#06B6D4',\n        icon: '☁️',\n        aiTrainable: true,\n    },\n    {\n        id: 'brass',\n        name: 'Brass Section',\n        category: 'brass',\n        oscillator: 'square',\n        adsr: { attack: 0.1, decay: 0.2, sustain: 0.8, release: 0.4 },\n        detune: 0,\n        filterFreq: 2500,\n        filterQ: 1.5,\n        gain: 0.6,\n        color: '#F59E0B',\n        icon: '🎺',\n        aiTrainable: true,\n    },\n    {\n        id: 'organ',\n        name: 'Church Organ',\n        category: 'keys',\n        oscillator: 'sine',\n        adsr: { attack: 0.01, decay: 0, sustain: 1, release: 0.1 },\n        detune: 0,\n        filterFreq: 0,\n        filterQ: 0,\n        gain: 0.65,\n        color: '#8B5CF6',\n        icon: '⛪',\n        aiTrainable: false,\n    },\n    {\n        id: 'drums_808',\n        name: '808 Drums',\n        category: 'percussion',\n        oscillator: 'sine',\n        adsr: { attack: 0.001, decay: 0.5, sustain: 0, release: 0.5 },\n        detune: -1200,\n        filterFreq: 200,\n        filterQ: 5,\n        gain: 0.9,\n        color: '#EF4444',\n        icon: '🥁',\n        aiTrainable: true,\n    },\n    {\n        id: 'marimba',\n        name: 'Marimba',\n        category: 'percussion',\n        oscillator: 'triangle',\n        adsr: { attack: 0.001, decay: 0.8, sustain: 0.1, release: 0.4 },\n        detune: 0,\n        filterFreq: 0,\n        filterQ: 0,\n        gain: 0.65,\n        color: '#10B981',\n        icon: '🪘',\n        aiTrainable: false,\n    },\n];\n\nexport const getBankById = (id: string): SoundBank | undefined =>\n    SOUND_BANKS.find(b => b.id === id);\n\nexport const getBanksByCategory = (category: SoundBank['category']): SoundBank[] =>\n    SOUND_BANKS.filter(b => b.category === category);\n\n/** Convert MIDI note number to frequency in Hz */\nexport const midiToFreq = (midi: number): number =>\n    440 * Math.pow(2, (midi - 69) / 12);\n\n/** Get note name from MIDI number */\nexport const midiToName = (midi: number): string => {\n    const names = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];\n    return names[midi % 12] + Math.floor(midi / 12 - 1);\n};\n"],"names":[],"mappings":"AAAA;;;;CAIC;;;;;;;;;;;;AA4BM,MAAM,cAA2B;IACpC;QACI,IAAI;QACJ,MAAM;QACN,UAAU;QACV,YAAY;QACZ,MAAM;YAAE,QAAQ;YAAO,OAAO;YAAK,SAAS;YAAK,SAAS;QAAI;QAC9D,QAAQ;QACR,YAAY;QACZ,SAAS;QACT,MAAM;QACN,OAAO;QACP,MAAM;QACN,aAAa;IACjB;IACA;QACI,IAAI;QACJ,MAAM;QACN,UAAU;QACV,YAAY;QACZ,MAAM;YAAE,QAAQ;YAAM,OAAO;YAAK,SAAS;YAAK,SAAS;QAAI;QAC7D,QAAQ;QACR,YAAY;QACZ,SAAS;QACT,MAAM;QACN,OAAO;QACP,MAAM;QACN,aAAa;IACjB;IACA;QACI,IAAI;QACJ,MAAM;QACN,UAAU;QACV,YAAY;QACZ,MAAM;YAAE,QAAQ;YAAK,OAAO;YAAK,SAAS;YAAK,SAAS;QAAI;QAC5D,QAAQ;QACR,YAAY;QACZ,SAAS;QACT,MAAM;QACN,OAAO;QACP,MAAM;QACN,aAAa;IACjB;IACA;QACI,IAAI;QACJ,MAAM;QACN,UAAU;QACV,YAAY;QACZ,MAAM;YAAE,QAAQ;YAAK,OAAO;YAAK,SAAS;YAAK,SAAS;QAAI;QAC5D,QAAQ;QACR,YAAY;QACZ,SAAS;QACT,MAAM;QACN,OAAO;QACP,MAAM;QACN,aAAa;IACjB;IACA;QACI,IAAI;QACJ,MAAM;QACN,UAAU;QACV,YAAY;QACZ,MAAM;YAAE,QAAQ;YAAO,OAAO;YAAK,SAAS;YAAK,SAAS;QAAI;QAC9D,QAAQ,CAAC;QACT,YAAY;QACZ,SAAS;QACT,MAAM;QACN,OAAO;QACP,MAAM;QACN,aAAa;IACjB;IACA;QACI,IAAI;QACJ,MAAM;QACN,UAAU;QACV,YAAY;QACZ,MAAM;YAAE,QAAQ;YAAM,OAAO;YAAK,SAAS;YAAK,SAAS;QAAI;QAC7D,QAAQ,CAAC;QACT,YAAY;QACZ,SAAS;QACT,MAAM;QACN,OAAO;QACP,MAAM;QACN,aAAa;IACjB;IACA;QACI,IAAI;QACJ,MAAM;QACN,UAAU;QACV,YAAY;QACZ,MAAM;YAAE,QAAQ;YAAM,OAAO;YAAK,SAAS;YAAK,SAAS;QAAI;QAC7D,QAAQ;QACR,YAAY;QACZ,SAAS;QACT,MAAM;QACN,OAAO;QACP,MAAM;QACN,aAAa;IACjB;IACA;QACI,IAAI;QACJ,MAAM;QACN,UAAU;QACV,YAAY;QACZ,MAAM;YAAE,QAAQ;YAAK,OAAO;YAAK,SAAS;YAAK,SAAS;QAAI;QAC5D,QAAQ;QACR,YAAY;QACZ,SAAS;QACT,MAAM;QACN,OAAO;QACP,MAAM;QACN,aAAa;IACjB;IACA;QACI,IAAI;QACJ,MAAM;QACN,UAAU;QACV,YAAY;QACZ,MAAM;YAAE,QAAQ;YAAK,OAAO;YAAK,SAAS;YAAK,SAAS;QAAI;QAC5D,QAAQ;QACR,YAAY;QACZ,SAAS;QACT,MAAM;QACN,OAAO;QACP,MAAM;QACN,aAAa;IACjB;IACA;QACI,IAAI;QACJ,MAAM;QACN,UAAU;QACV,YAAY;QACZ,MAAM;YAAE,QAAQ;YAAM,OAAO;YAAG,SAAS;YAAG,SAAS;QAAI;QACzD,QAAQ;QACR,YAAY;QACZ,SAAS;QACT,MAAM;QACN,OAAO;QACP,MAAM;QACN,aAAa;IACjB;IACA;QACI,IAAI;QACJ,MAAM;QACN,UAAU;QACV,YAAY;QACZ,MAAM;YAAE,QAAQ;YAAO,OAAO;YAAK,SAAS;YAAG,SAAS;QAAI;QAC5D,QAAQ,CAAC;QACT,YAAY;QACZ,SAAS;QACT,MAAM;QACN,OAAO;QACP,MAAM;QACN,aAAa;IACjB;IACA;QACI,IAAI;QACJ,MAAM;QACN,UAAU;QACV,YAAY;QACZ,MAAM;YAAE,QAAQ;YAAO,OAAO;YAAK,SAAS;YAAK,SAAS;QAAI;QAC9D,QAAQ;QACR,YAAY;QACZ,SAAS;QACT,MAAM;QACN,OAAO;QACP,MAAM;QACN,aAAa;IACjB;CACH;AAEM,MAAM,cAAc,CAAC,KACxB,YAAY,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;AAE5B,MAAM,qBAAqB,CAAC,WAC/B,YAAY,MAAM,CAAC,CAAA,IAAK,EAAE,QAAQ,KAAK;AAGpC,MAAM,aAAa,CAAC,OACvB,MAAM,KAAK,GAAG,CAAC,GAAG,CAAC,OAAO,EAAE,IAAI;AAG7B,MAAM,aAAa,CAAC;IACvB,MAAM,QAAQ;QAAC;QAAK;QAAM;QAAK;QAAM;QAAK;QAAK;QAAM;QAAK;QAAM;QAAK;QAAM;KAAI;IAC/E,OAAO,KAAK,CAAC,OAAO,GAAG,GAAG,KAAK,KAAK,CAAC,OAAO,KAAK;AACrD"}},
    {"offset": {"line": 7060, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/plugins/VirtualInstrumentPlugin.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useCallback, useEffect, useRef } from 'react';\nimport { Upload, RefreshCw, Brain, Piano as PianoIcon, ChevronDown } from 'lucide-react';\nimport { SOUND_BANKS, SoundBank, midiToFreq, type ADSR } from '@/lib/soundBanks';\n\ninterface VirtualInstrumentPluginProps {\n    insert: { id: string; settings: any };\n    onSettingsChange: (settings: any) => void;\n}\n\n// Piano keys: 2.5 octaves starting at C3 (MIDI 48) to E5 (MIDI 64+12)\nconst START_MIDI = 48; // C3\nconst NUM_WHITE_KEYS = 18;\nconst WHITE_KEY_SEQUENCE = [0, 2, 4, 5, 7, 9, 11]; // C D E F G A B semitones\nconst BLACK_KEY_POSITIONS: Record<number, number> = { 1: 0, 3: 1, 6: 3, 8: 4, 10: 5 }; // semitone -> visual gap\n\nfunction buildPianoKeys() {\n    const keys: { midi: number; isBlack: boolean; position: number; label?: string }[] = [];\n    let whitePos = 0;\n    for (let octaveOffset = 0; octaveOffset < 3; octaveOffset++) {\n        for (let semi = 0; semi < 12; semi++) {\n            const midi = START_MIDI + octaveOffset * 12 + semi;\n            const isBlack = [1, 3, 6, 8, 10].includes(semi);\n            if (!isBlack) {\n                keys.push({ midi, isBlack: false, position: whitePos, label: semi === 0 ? `C${Math.floor(midi / 12) - 1}` : undefined });\n                whitePos++;\n            } else {\n                keys.push({ midi, isBlack: true, position: whitePos - 1 });\n            }\n        }\n    }\n    // Trim to NUM_WHITE_KEYS\n    return keys.filter(k => !k.isBlack && k.position < NUM_WHITE_KEYS || k.isBlack && k.position < NUM_WHITE_KEYS - 1).slice(0, 40);\n}\n\nconst PIANO_KEYS = buildPianoKeys();\n\nlet audioCtx: AudioContext | null = null;\nconst getAudioCtx = () => {\n    if (!audioCtx) audioCtx = new (window.AudioContext || (window as any).webkitAudioContext)();\n    return audioCtx;\n};\n\nfunction playNote(midi: number, bank: SoundBank) {\n    try {\n        const ctx = getAudioCtx();\n        if (ctx.state === 'suspended') ctx.resume();\n\n        const freq = midiToFreq(midi) * Math.pow(2, bank.detune / 1200);\n        const osc = ctx.createOscillator();\n        const gainNode = ctx.createGain();\n\n        osc.type = bank.oscillator;\n        osc.frequency.value = freq;\n\n        // ADSR\n        const now = ctx.currentTime;\n        const { attack, decay, sustain, release } = bank.adsr;\n        gainNode.gain.setValueAtTime(0, now);\n        gainNode.gain.linearRampToValueAtTime(bank.gain, now + attack);\n        gainNode.gain.linearRampToValueAtTime(bank.gain * sustain, now + attack + decay);\n        gainNode.gain.setValueAtTime(bank.gain * sustain, now + attack + decay + 0.2);\n        gainNode.gain.linearRampToValueAtTime(0, now + attack + decay + 0.2 + release);\n\n        // Filter\n        if (bank.filterFreq > 0) {\n            const filter = ctx.createBiquadFilter();\n            filter.type = 'lowpass';\n            filter.frequency.value = bank.filterFreq;\n            filter.Q.value = bank.filterQ;\n            osc.connect(filter);\n            filter.connect(gainNode);\n        } else {\n            osc.connect(gainNode);\n        }\n        gainNode.connect(ctx.destination);\n\n        osc.start(now);\n        osc.stop(now + attack + decay + 0.2 + release + 0.1);\n    } catch (e) {\n        console.error('Audio playback error', e);\n    }\n}\n\nconst CATEGORY_LABELS: Record<string, string> = {\n    keys: 'Teclados', strings: 'Cuerdas', bass: 'Bajo', synth: 'Sintetizadores',\n    pad: 'Pads', brass: 'Metales', percussion: 'Percusión', fx: 'FX',\n};\n\nexport function VirtualInstrumentPlugin({ insert, onSettingsChange }: VirtualInstrumentPluginProps) {\n    const [selectedBankId, setSelectedBankId] = useState<string>(insert.settings?.bankId || 'grand_piano');\n    const [activeKeys, setActiveKeys] = useState<Set<number>>(new Set());\n    const [showBankPicker, setShowBankPicker] = useState(false);\n    const [showTrainModal, setShowTrainModal] = useState(false);\n    const [octaveShift, setOctaveShift] = useState(0);\n    const [showImport, setShowImport] = useState(false);\n    const [importedName, setImportedName] = useState<string | null>(null);\n\n    const bank = SOUND_BANKS.find(b => b.id === selectedBankId) || SOUND_BANKS[0];\n\n    const handleBankSelect = (id: string) => {\n        setSelectedBankId(id);\n        setShowBankPicker(false);\n        onSettingsChange({ ...insert.settings, bankId: id });\n    };\n\n    const triggerKey = useCallback((midi: number) => {\n        const shifted = midi + octaveShift * 12;\n        setActiveKeys(prev => new Set([...prev, shifted]));\n        playNote(shifted, bank);\n        setTimeout(() => setActiveKeys(prev => { const n = new Set(prev); n.delete(shifted); return n; }), 300);\n    }, [bank, octaveShift]);\n\n    // Keyboard shortcuts: a-s-d-f-g-h-j-k-l = white keys C3..A3\n    useEffect(() => {\n        const keyMap: Record<string, number> = { a: 48, s: 50, d: 52, f: 53, g: 55, h: 57, j: 59, k: 60, l: 62, w: 49, e: 51, t: 54, y: 56, u: 58 };\n        const onKey = (e: KeyboardEvent) => {\n            if (e.repeat || e.metaKey || e.ctrlKey) return;\n            const midi = keyMap[e.key.toLowerCase()];\n            if (midi) triggerKey(midi);\n        };\n        window.addEventListener('keydown', onKey);\n        return () => window.removeEventListener('keydown', onKey);\n    }, [triggerKey]);\n\n    const whiteKeys = PIANO_KEYS.filter(k => !k.isBlack);\n    const blackKeys = PIANO_KEYS.filter(k => k.isBlack);\n\n    return (\n        <div className=\"flex flex-col gap-4 p-4 bg-[#0A0A0C] border border-[#1A1A1A] rounded-xl min-w-[600px] relative\">\n\n            {/* Header */}\n            <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-3\">\n                    <div className=\"w-8 h-8 rounded-lg bg-green-500/10 border border-green-500/30 flex items-center justify-center text-green-400\">\n                        <PianoIcon size={16} />\n                    </div>\n                    <div>\n                        <p className=\"text-[10px] font-black text-white/40 uppercase tracking-widest\">DA GRABA</p>\n                        <p className=\"text-sm font-black text-white\">Virtual Instrument</p>\n                    </div>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                    <button onClick={() => setShowImport(!showImport)} className=\"flex items-center gap-1.5 px-3 py-1.5 bg-[#111] border border-[#222] rounded-lg text-[10px] font-bold text-[#666] hover:text-white transition-all\">\n                        <Upload size={11} /> Importar\n                    </button>\n                    <button onClick={() => setShowTrainModal(true)} className=\"flex items-center gap-1.5 px-3 py-1.5 bg-purple-500/10 border border-purple-500/30 rounded-lg text-[10px] font-bold text-purple-400 hover:bg-purple-500/20 transition-all\">\n                        <Brain size={11} /> Entrenar IA\n                    </button>\n                </div>\n            </div>\n\n            {/* Bank Selector */}\n            <div className=\"relative\">\n                <button\n                    onClick={() => setShowBankPicker(!showBankPicker)}\n                    className=\"w-full flex items-center justify-between px-4 py-3 bg-[#111] border border-[#2A2A2A] rounded-xl hover:border-[#3A3A3A] transition-all\"\n                >\n                    <div className=\"flex items-center gap-3\">\n                        <span className=\"text-xl\">{bank.icon}</span>\n                        <div className=\"text-left\">\n                            <div className=\"text-sm font-black text-white\">{bank.name}</div>\n                            <div className=\"text-[9px] text-[#555] uppercase tracking-wider\">{CATEGORY_LABELS[bank.category]}</div>\n                        </div>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                        {bank.aiTrainable && <span className=\"px-1.5 py-0.5 bg-purple-500/20 text-purple-400 text-[8px] font-black rounded\">IA</span>}\n                        {importedName && <span className=\"px-1.5 py-0.5 bg-orange-500/20 text-orange-400 text-[8px] font-black rounded\">CUSTOM</span>}\n                        <ChevronDown size={14} className={`text-[#555] transition-transform ${showBankPicker ? 'rotate-180' : ''}`} />\n                    </div>\n                </button>\n\n                {showBankPicker && (\n                    <div className=\"absolute top-full left-0 right-0 mt-1 bg-[#111] border border-[#2A2A2A] rounded-xl z-50 overflow-y-auto max-h-64 custom-scrollbar shadow-2xl\">\n                        {Object.entries(CATEGORY_LABELS).map(([cat, label]) => {\n                            const catBanks = SOUND_BANKS.filter(b => b.category === cat);\n                            if (!catBanks.length) return null;\n                            return (\n                                <div key={cat}>\n                                    <div className=\"px-4 py-2 text-[8px] font-black text-[#444] uppercase tracking-widest border-b border-[#1A1A1A]\">{label}</div>\n                                    {catBanks.map(b => (\n                                        <button key={b.id} onClick={() => handleBankSelect(b.id)}\n                                            className={`w-full flex items-center gap-3 px-4 py-2.5 hover:bg-white/5 transition-colors text-left ${b.id === selectedBankId ? 'bg-white/5' : ''}`}>\n                                            <span>{b.icon}</span>\n                                            <span className=\"text-sm font-bold text-white flex-1\">{b.name}</span>\n                                            {b.id === selectedBankId && <div className=\"w-2 h-2 rounded-full bg-green-400\" />}\n                                        </button>\n                                    ))}\n                                </div>\n                            );\n                        }).filter(Boolean)}\n                    </div>\n                )}\n            </div>\n\n            {/* Import Panel */}\n            {showImport && (\n                <div className=\"p-4 bg-[#111] border-2 border-dashed border-[#2A2A2A] rounded-xl animate-in fade-in duration-200\">\n                    <p className=\"text-[10px] font-black text-[#555] uppercase tracking-widest mb-3 text-center\">Importar Instrumento (WAV · MP3)</p>\n                    <label className=\"flex flex-col items-center gap-2 cursor-pointer\">\n                        <Upload size={24} className=\"text-[#444]\" />\n                        <span className=\"text-xs text-[#555]\">Arrastra o haz click para importar</span>\n                        <input type=\"file\" accept=\".wav,.mp3,.ogg\" className=\"hidden\" onChange={e => {\n                            const file = e.target.files?.[0];\n                            if (file) { setImportedName(file.name); setShowImport(false); }\n                        }} />\n                    </label>\n                    {importedName && <p className=\"text-xs text-green-400 text-center mt-2\">✓ {importedName}</p>}\n                    <p className=\"text-[9px] text-[#333] text-center mt-3\">La IA puede analizar e imitar el instrumento importado para producción automatizada.</p>\n                </div>\n            )}\n\n            {/* Piano Keyboard */}\n            <div className=\"relative overflow-x-auto custom-scrollbar pb-2\">\n                <div className=\"relative select-none\" style={{ width: `${whiteKeys.length * 32}px`, height: '120px' }}>\n                    {/* White Keys */}\n                    {whiteKeys.map(k => (\n                        <button\n                            key={k.midi}\n                            onPointerDown={() => triggerKey(k.midi)}\n                            className={`absolute bottom-0 border border-[#333] rounded-b-md transition-all duration-75 ${activeKeys.has(k.midi + octaveShift * 12) ? 'bg-yellow-400 border-yellow-300' : 'bg-white hover:bg-gray-100'}`}\n                            style={{ left: `${k.position * 32}px`, width: '30px', height: '110px' }}\n                        >\n                            {k.label && <span className=\"absolute bottom-2 left-1/2 -translate-x-1/2 text-[9px] font-black text-gray-400\">{k.label}</span>}\n                        </button>\n                    ))}\n                    {/* Black Keys */}\n                    {blackKeys.map(k => (\n                        <button\n                            key={k.midi}\n                            onPointerDown={() => triggerKey(k.midi)}\n                            className={`absolute top-0 z-10 rounded-b-sm transition-all duration-75 ${activeKeys.has(k.midi + octaveShift * 12) ? 'bg-yellow-500' : 'bg-[#111] hover:bg-[#222]'}`}\n                            style={{ left: `${k.position * 32 + 21}px`, width: '20px', height: '70px' }}\n                        />\n                    ))}\n                </div>\n            </div>\n\n            {/* Controls */}\n            <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                    <span className=\"text-[10px] text-[#555] font-bold uppercase tracking-widest\">Octava</span>\n                    <button onClick={() => setOctaveShift(p => Math.max(-2, p - 1))} className=\"w-7 h-7 bg-[#111] border border-[#222] rounded-lg text-white hover:bg-[#1A1A1A] text-xs font-bold transition-all\">−</button>\n                    <span className=\"text-sm font-black text-white w-6 text-center\">{octaveShift >= 0 ? `+${octaveShift}` : octaveShift}</span>\n                    <button onClick={() => setOctaveShift(p => Math.min(2, p + 1))} className=\"w-7 h-7 bg-[#111] border border-[#222] rounded-lg text-white hover:bg-[#1A1A1A] text-xs font-bold transition-all\">+</button>\n                </div>\n                <p className=\"text-[9px] text-[#333] italic\">Usa el teclado A-S-D-F... para tocar</p>\n                <div className=\"flex items-center gap-1.5\">\n                    <div className=\"w-2 h-2 rounded-full bg-green-500 animate-pulse\" />\n                    <span className=\"text-[9px] text-[#555] font-bold uppercase tracking-widest\">Web Audio API</span>\n                </div>\n            </div>\n\n            {/* Train Modal */}\n            {showTrainModal && (\n                <div className=\"absolute inset-0 bg-black/95 backdrop-blur-sm rounded-xl flex flex-col items-center justify-center gap-5 z-50 p-6\">\n                    <div className=\"w-16 h-16 rounded-full bg-purple-500/10 border border-purple-500/30 flex items-center justify-center text-purple-400\">\n                        <Brain size={28} />\n                    </div>\n                    <div className=\"text-center\">\n                        <h3 className=\"text-lg font-black text-white mb-1\">Entrenar Banco de Sonidos</h3>\n                        <p className=\"text-sm text-[#666] max-w-xs\">Sube tus archivos VST3 o samples WAV para entrenar un banco personalizado usando Modal.com + IA.</p>\n                    </div>\n                    <div className=\"w-full max-w-xs space-y-3\">\n                        <div className=\"p-3 bg-[#111] border border-[#222] rounded-xl\">\n                            <p className=\"text-[10px] text-[#444] uppercase tracking-widest font-black mb-1\">1. Subir VST3 / Samples</p>\n                            <label className=\"flex items-center gap-2 cursor-pointer text-sm text-[#666] hover:text-white transition-colors\">\n                                <Upload size={14} /> Seleccionar archivos...\n                                <input type=\"file\" accept=\".vst3,.wav,.mp3,.zip\" className=\"hidden\" />\n                            </label>\n                        </div>\n                        <div className=\"p-3 bg-[#111] border border-[#222] rounded-xl opacity-60\">\n                            <p className=\"text-[10px] text-[#444] uppercase tracking-widest font-black mb-1\">2. Entrenar con Modal.com</p>\n                            <p className=\"text-[10px] text-[#555]\">El modelo aprenderá las características del instrumento para síntesis y generación.</p>\n                        </div>\n                        <div className=\"p-3 bg-[#111] border border-[#222] rounded-xl opacity-40\">\n                            <p className=\"text-[10px] text-[#444] uppercase tracking-widest font-black mb-1\">3. Disponible en bancos IA</p>\n                            <p className=\"text-[10px] text-[#555]\">El banco entrenado aparecerá en la lista y estará disponible para la IA compositora.</p>\n                        </div>\n                    </div>\n                    <p className=\"text-[9px] text-[#333]\">⚠️ Requiere cuenta Modal.com configurada en el panel Admin.</p>\n                    <button onClick={() => setShowTrainModal(false)} className=\"px-6 py-2 bg-[#1A1A1A] border border-[#2A2A2A] rounded-lg text-xs font-bold text-[#888] hover:text-white transition-all\">Cerrar</button>\n                </div>\n            )}\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7915, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/PluginWindow.tsx"],"sourcesContent":["'use client';\n\nimport React, { useEffect } from 'react';\nimport { X, Power } from 'lucide-react';\nimport { useDAWStore, FXInsert } from '@/store/useDAWStore';\nimport { GateModule } from './plugins/GateModule';\nimport { EQModule } from './plugins/EQModule';\nimport { CompressorModule } from './plugins/CompressorModule';\nimport { MultibandModule } from './plugins/MultibandModule';\nimport { LimiterModule } from './plugins/LimiterModule';\nimport { LevelerModule } from './plugins/LevelerModule';\nimport { ReverbModule } from './plugins/ReverbModule';\nimport { DelayModule } from './plugins/DelayModule';\nimport { ChorusModule } from './plugins/ChorusModule';\nimport { DistortionModule } from './plugins/DistortionModule';\nimport { SaturatorModule } from './plugins/SaturatorModule';\nimport { VirtualInstrumentPlugin } from './plugins/VirtualInstrumentPlugin';\nimport { audioEngine } from '@/lib/audio-engine-bridge';\n\ninterface PluginWindowProps {\n    trackId: string;\n    insert: FXInsert;\n    onClose: () => void;\n}\n\nexport function PluginWindow({ trackId, insert, onClose }: PluginWindowProps) {\n    const updateInsertSettings = useDAWStore((state) => state.updateInsertSettings);\n    const toggleInsertBypass = useDAWStore((state) => state.toggleInsertBypass);\n\n    // Sync with Audio Engine\n    useEffect(() => {\n        if (insert.bypass && insert.pluginId !== 'limiter') return;\n\n        if (insert.pluginId === 'eq') {\n            audioEngine.updateEQ(\n                trackId,\n                insert.settings.eqHighpass ?? 50,\n                insert.settings.eqTilt ?? 50,\n                insert.settings.eqSideGain ?? 50,\n                insert.settings.eqSideFreq ?? 50,\n                insert.bypass\n            );\n        } else if (insert.pluginId === 'compressor') {\n            audioEngine.updateCompressor(\n                trackId,\n                insert.settings.compStrength,\n                insert.settings.compAttack,\n                insert.settings.compRelease,\n                insert.bypass\n            );\n        } else if (insert.pluginId === 'limiter') {\n            // Load WASM worklet on first open, then route through it\n            audioEngine.loadWasmLimiter().then((loaded) => {\n                audioEngine.updateLimiter(\n                    trackId,\n                    insert.settings.limStrength ?? 50,\n                    insert.settings.limCeiling ?? -0.3,\n                    insert.bypass,\n                    loaded  // use WASM if it loaded successfully\n                );\n            });\n        } else if (insert.pluginId === 'saturator') {\n            // Route through C++ WASM Saturator\n            audioEngine.insertWasmPlugin(trackId, 'saturator').then(node => {\n                if (node) {\n                    node.port.postMessage({ type: 'param', key: 'drive', value: (insert.settings.satDrive ?? 30) / 100 * 5 });\n                    node.port.postMessage({ type: 'param', key: 'mix', value: (insert.settings.satMix ?? 50) / 100 });\n                    node.port.postMessage({ type: 'param', key: 'outputGain', value: (insert.settings.satOutput ?? 50) / 50 });\n                    node.port.postMessage({ type: 'param', key: 'bias', value: (insert.settings.satBias ?? 10) / 100 });\n                }\n            });\n        }\n    }, [trackId, insert.settings, insert.bypass, insert.pluginId]);\n\n\n    const renderModule = () => {\n        const props = {\n            settings: insert.settings,\n            onChange: (newSettings: any) => updateInsertSettings(trackId, insert.id, newSettings)\n        };\n\n        switch (insert.pluginId) {\n            case 'gate': return <GateModule {...props} />;\n            case 'eq': return <EQModule {...props} />;\n            case 'compressor': return <CompressorModule {...props} />;\n            case 'multiband': return <MultibandModule {...props} />;\n            case 'limiter': return <LimiterModule {...props} />;\n            case 'leveler': return <LevelerModule {...props} />;\n            case 'reverb': return <ReverbModule {...props} />;\n            case 'delay': return <DelayModule {...props} />;\n            case 'chorus': return <ChorusModule {...props} />;\n            case 'distortion': return <DistortionModule {...props} />;\n            case 'saturator': return <SaturatorModule {...props} />;\n            case 'virtual_instrument': return <VirtualInstrumentPlugin insert={insert} onSettingsChange={(s) => updateInsertSettings(trackId, insert.id, s)} />;\n            default: return null;\n        }\n    };\n\n    return (\n        <div className=\"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-[100] bg-[#2B2B2B] rounded-xl shadow-[0_40px_100px_rgba(0,0,0,0.8)] border border-[#1A1A1A] p-1 w-[600px] animate-in zoom-in-95 duration-200\">\n            {/* Header / Title Bar */}\n            <div className=\"flex items-center justify-between px-4 py-2 bg-[#1A1A1A] rounded-t-lg border-b border-white/5\">\n                <div className=\"flex items-center gap-3\">\n                    <button\n                        onClick={() => toggleInsertBypass(trackId, insert.id)}\n                        className={`w-6 h-6 rounded-full flex items-center justify-center transition-all ${insert.bypass ? 'bg-zinc-800 text-zinc-600' : 'bg-cyan-500 text-black shadow-[0_0_10px_rgba(6,182,212,0.5)]'}`}\n                    >\n                        <Power size={12} />\n                    </button>\n                    <span className=\"text-[10px] font-black text-white/80 uppercase tracking-widest italic\">\n                        DA GRABA <span className=\"text-cyan-400\">{insert.pluginId === 'multiband' ? 'M-BAND' : insert.pluginId}</span>\n                    </span>\n                </div>\n\n                <button\n                    onClick={onClose}\n                    className=\"p-1 hover:bg-white/5 rounded-md text-white/20 hover:text-white transition-colors\"\n                >\n                    <X size={14} />\n                </button>\n            </div>\n\n            {/* Plugin Interface */}\n            <div className={`p-4 transition-opacity duration-300 ${insert.bypass ? 'opacity-40 grayscale pointer-events-none' : 'opacity-100'}`}>\n                {renderModule()}\n            </div>\n\n            {/* Footer / Status */}\n            <div className=\"px-4 py-1.5 bg-[#141414] rounded-b-lg flex justify-between items-center\">\n                <span className=\"text-[8px] text-white/20 font-mono uppercase tracking-tighter\">High Fidelity Processing</span>\n                <span className=\"text-[8px] text-cyan-400/40 font-mono uppercase\">Track: {trackId}</span>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 8252, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/TrackTypeModal.tsx"],"sourcesContent":["'use client';\n\nimport React from 'react';\nimport { X, Mic2, Radio, ArrowLeftRight, Crown, Piano, Cpu } from 'lucide-react';\nimport type { TrackType } from '@/store/useDAWStore';\n\ninterface TrackTypeOption {\n    type: TrackType;\n    label: string;\n    description: string;\n    icon: React.ReactNode;\n    color: string;\n    border: string;\n    bg: string;\n}\n\nconst TRACK_OPTIONS: TrackTypeOption[] = [\n    {\n        type: 'mono',\n        label: 'Mono',\n        description: 'Canal de audio de un solo canal. Ideal para voz, guitarra, bajo.',\n        icon: <Mic2 size={26} />,\n        color: 'text-cyan-400',\n        border: 'border-cyan-500/30 hover:border-cyan-400/60',\n        bg: 'from-cyan-500/10',\n    },\n    {\n        type: 'stereo',\n        label: 'Stereo',\n        description: 'Canal de audio estéreo izquierda/derecha. Para loops, samples y pads.',\n        icon: <Radio size={26} />,\n        color: 'text-blue-400',\n        border: 'border-blue-500/30 hover:border-blue-400/60',\n        bg: 'from-blue-500/10',\n    },\n    {\n        type: 'aux',\n        label: 'Auxiliar',\n        description: 'Bus de envío/retorno (Send/Return). Para reverb, delay y efectos compartidos.',\n        icon: <ArrowLeftRight size={26} />,\n        color: 'text-orange-400',\n        border: 'border-orange-500/30 hover:border-orange-400/60',\n        bg: 'from-orange-500/10',\n    },\n    {\n        type: 'master',\n        label: 'Master',\n        description: 'Salida maestra de la sesión. Procesamiento final antes del render.',\n        icon: <Crown size={26} />,\n        color: 'text-yellow-400',\n        border: 'border-yellow-500/30 hover:border-yellow-400/60',\n        bg: 'from-yellow-500/10',\n    },\n    {\n        type: 'midi',\n        label: 'MIDI',\n        description: 'Secuenciador MIDI para controlar instrumentos externos o plugins.',\n        icon: <Piano size={26} />,\n        color: 'text-purple-400',\n        border: 'border-purple-500/30 hover:border-purple-400/60',\n        bg: 'from-purple-500/10',\n    },\n    {\n        type: 'virtual_instrument',\n        label: 'Instrumento Virtual',\n        description: 'Plugin de síntesis y bancos de sonido. Piano, cuerdas, drums y más.',\n        icon: <Cpu size={26} />,\n        color: 'text-green-400',\n        border: 'border-green-500/30 hover:border-green-400/60',\n        bg: 'from-green-500/10',\n    },\n];\n\ninterface TrackTypeModalProps {\n    onSelect: (type: TrackType, name: string) => void;\n    onClose: () => void;\n}\n\nexport function TrackTypeModal({ onSelect, onClose }: TrackTypeModalProps) {\n    const [selected, setSelected] = React.useState<TrackType | null>(null);\n    const [trackName, setTrackName] = React.useState('');\n\n    const handleConfirm = () => {\n        if (!selected) return;\n        const defaultNames: Record<TrackType, string> = {\n            mono: 'Mono Track',\n            stereo: 'Stereo Track',\n            aux: 'Aux Bus',\n            master: 'Master',\n            midi: 'MIDI Track',\n            virtual_instrument: 'VInst',\n        };\n        onSelect(selected, trackName.trim() || defaultNames[selected]);\n    };\n\n    return (\n        <div\n            className=\"fixed inset-0 bg-black/80 backdrop-blur-sm z-[300] flex items-center justify-center p-4\"\n            onClick={onClose}\n        >\n            <div\n                className=\"bg-[#111] border border-[#2A2A2A] rounded-2xl w-full max-w-2xl p-6 animate-in zoom-in-95 fade-in duration-200 shadow-2xl\"\n                onClick={e => e.stopPropagation()}\n            >\n                {/* Header */}\n                <div className=\"flex items-center justify-between mb-6\">\n                    <div>\n                        <h2 className=\"text-lg font-black text-white tracking-tight\">Nuevo Track</h2>\n                        <p className=\"text-[11px] text-[#555] uppercase tracking-widest mt-0.5\">Selecciona el tipo de canal</p>\n                    </div>\n                    <button onClick={onClose} className=\"p-2 hover:bg-white/5 rounded-lg text-[#555] hover:text-white transition-colors\">\n                        <X size={16} />\n                    </button>\n                </div>\n\n                {/* Track Type Grid */}\n                <div className=\"grid grid-cols-3 gap-3 mb-6\">\n                    {TRACK_OPTIONS.map(opt => (\n                        <button\n                            key={opt.type}\n                            onClick={() => setSelected(opt.type)}\n                            className={`relative flex flex-col items-start p-4 rounded-xl border-2 transition-all duration-200 text-left bg-gradient-to-br ${opt.bg} to-transparent\n                                ${selected === opt.type\n                                    ? `${opt.border} ring-1 ring-white/10 scale-[1.02]`\n                                    : `border-white/5 ${opt.border}`\n                                }`}\n                        >\n                            {selected === opt.type && (\n                                <div className=\"absolute top-2 right-2 w-4 h-4 bg-white rounded-full flex items-center justify-center\">\n                                    <div className=\"w-2 h-2 bg-black rounded-full\" />\n                                </div>\n                            )}\n                            <div className={`${opt.color} mb-3`}>{opt.icon}</div>\n                            <div className=\"text-sm font-black text-white mb-1\">{opt.label}</div>\n                            <div className=\"text-[10px] text-[#666] leading-relaxed\">{opt.description}</div>\n                        </button>\n                    ))}\n                </div>\n\n                {/* Track Name Input */}\n                {selected && (\n                    <div className=\"mb-5 animate-in fade-in slide-in-from-bottom-2 duration-200\">\n                        <label className=\"text-[10px] font-black text-[#555] uppercase tracking-widest mb-2 block\">Nombre del Track (opcional)</label>\n                        <input\n                            type=\"text\"\n                            value={trackName}\n                            onChange={e => setTrackName(e.target.value)}\n                            onKeyDown={e => e.key === 'Enter' && handleConfirm()}\n                            placeholder={`Ej. ${selected === 'mono' ? 'Lead Vocal' : selected === 'stereo' ? 'Loop Beat' : selected === 'midi' ? 'Piano MIDI' : selected === 'virtual_instrument' ? 'Strings VI' : selected === 'aux' ? 'Reverb Bus' : 'Master Out'}`}\n                            autoFocus\n                            className=\"w-full bg-[#0A0A0C] border border-[#2A2A2A] rounded-xl px-4 py-3 text-sm text-white focus:border-[#555] outline-none transition-colors placeholder:text-[#333]\"\n                        />\n                    </div>\n                )}\n\n                {/* Actions */}\n                <div className=\"flex gap-3 justify-end\">\n                    <button onClick={onClose} className=\"px-5 py-2.5 bg-[#1A1A1A] border border-[#2A2A2A] rounded-xl text-xs font-bold text-[#888] hover:text-white transition-all\">\n                        Cancelar\n                    </button>\n                    <button\n                        onClick={handleConfirm}\n                        disabled={!selected}\n                        className={`px-8 py-2.5 rounded-xl text-xs font-black tracking-widest transition-all ${selected ? 'bg-white text-black hover:bg-gray-100 shadow-lg' : 'bg-[#1A1A1A] text-[#444] cursor-not-allowed border border-[#2A2A2A]'}`}\n                    >\n                        CREAR TRACK\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 8570, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/store/useCreatorStore.ts"],"sourcesContent":["import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\n\nexport interface CreatorTrack {\n    id: string;\n    title: string;\n    style: string;\n    duration: string;\n    image: string;\n    tags: string[];\n    lyrics: string;\n    views: string;\n    likes: number;\n    url: string;\n    streamAudioUrl?: string;\n}\n\n\nconst MOCK_TRACKS: CreatorTrack[] = [\n    {\n        id: 'track-1',\n        title: 'Sombras en la Calle',\n        style: 'Dark Trap, 808s, Moody',\n        duration: '2:45',\n        image: 'https://picsum.photos/seed/darktrap/200/200',\n        tags: ['Trap', 'Dark'],\n        lyrics: \"[Verse 1]\\nCaminando en la penumbra de la ciudad\\nBuscando una salida, una realidad\\nLos bajos retumban en mi pecho hoy\\nNo sé a dónde voy, pero aquí estoy.\\n\\n[Chorus]\\nSombras en la calle, luces que se van\\nEl eco de un sueño que no volverá.\",\n        views: '1.2k',\n        likes: 124,\n        url: 'https://cdn.pixabay.com/audio/2022/03/10/audio_c8c8a73a56.mp3'\n    },\n    {\n        id: 'track-2',\n        title: 'Luces de Neón',\n        style: 'Melodic Trap, Heavy Bass, Futuristic',\n        duration: '3:10',\n        image: 'https://picsum.photos/seed/neon/200/200',\n        tags: ['Trap', 'Melodic'],\n        lyrics: \"[Verse 1]\\nReflejos de neón en el asfalto frío\\nUn mundo de cristal, un vacío mío\\nLas máquinas cantan una melodía\\nQue me atrapa el alma, pura fantasía.\\n\\n[Chorus]\\nBrilla el neón, brilla el metal\\nUn viaje eterno, algo sideral.\",\n        views: '850',\n        likes: 92,\n        url: 'https://cdn.pixabay.com/audio/2021/11/24/audio_12345678.mp3'\n    }\n];\n\ninterface CreatorState {\n    tracks: CreatorTrack[];\n    activeTrack: CreatorTrack | null;\n    setTracks: (tracks: CreatorTrack[]) => void;\n    setActiveTrack: (track: CreatorTrack) => void;\n    addTrack: (track: CreatorTrack) => void;\n    updateTrack: (id: string, updates: Partial<CreatorTrack>) => void;\n    removeTrack: (id: string) => void;\n}\n\nexport const useCreatorStore = create<CreatorState>()(\n    persist(\n        (set) => ({\n            tracks: MOCK_TRACKS,\n            activeTrack: MOCK_TRACKS[0],\n            setTracks: (tracks) => set({ tracks }),\n            setActiveTrack: (track) => set({ activeTrack: track }),\n            addTrack: (track) => set((state) => ({\n                tracks: [track, ...state.tracks],\n                activeTrack: track\n            })),\n            updateTrack: (id, updates) => set((state) => ({\n                tracks: state.tracks.map((t) => t.id === id ? { ...t, ...updates } : t),\n                activeTrack: state.activeTrack?.id === id ? { ...state.activeTrack, ...updates } : state.activeTrack\n            })),\n            removeTrack: (id) => set((state) => ({\n                tracks: state.tracks.filter((t) => t.id !== id),\n                activeTrack: state.activeTrack?.id === id ? null : state.activeTrack\n            }))\n        }),\n        {\n            name: 'creator-tracks-storage',\n        }\n    )\n);\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAiBA,MAAM,cAA8B;IAChC;QACI,IAAI;QACJ,OAAO;QACP,OAAO;QACP,UAAU;QACV,OAAO;QACP,MAAM;YAAC;YAAQ;SAAO;QACtB,QAAQ;QACR,OAAO;QACP,OAAO;QACP,KAAK;IACT;IACA;QACI,IAAI;QACJ,OAAO;QACP,OAAO;QACP,UAAU;QACV,OAAO;QACP,MAAM;YAAC;YAAQ;SAAU;QACzB,QAAQ;QACR,OAAO;QACP,OAAO;QACP,KAAK;IACT;CACH;AAYM,MAAM,kBAAkB,IAAA,wLAAM,IACjC,IAAA,8LAAO,EACH,CAAC,MAAQ,CAAC;QACN,QAAQ;QACR,aAAa,WAAW,CAAC,EAAE;QAC3B,WAAW,CAAC,SAAW,IAAI;gBAAE;YAAO;QACpC,gBAAgB,CAAC,QAAU,IAAI;gBAAE,aAAa;YAAM;QACpD,UAAU,CAAC,QAAU,IAAI,CAAC,QAAU,CAAC;oBACjC,QAAQ;wBAAC;2BAAU,MAAM,MAAM;qBAAC;oBAChC,aAAa;gBACjB,CAAC;QACD,aAAa,CAAC,IAAI,UAAY,IAAI,CAAC,QAAU,CAAC;oBAC1C,QAAQ,MAAM,MAAM,CAAC,GAAG,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,KAAK;4BAAE,GAAG,CAAC;4BAAE,GAAG,OAAO;wBAAC,IAAI;oBACrE,aAAa,MAAM,WAAW,EAAE,OAAO,KAAK;wBAAE,GAAG,MAAM,WAAW;wBAAE,GAAG,OAAO;oBAAC,IAAI,MAAM,WAAW;gBACxG,CAAC;QACD,aAAa,CAAC,KAAO,IAAI,CAAC,QAAU,CAAC;oBACjC,QAAQ,MAAM,MAAM,CAAC,MAAM,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;oBAC5C,aAAa,MAAM,WAAW,EAAE,OAAO,KAAK,OAAO,MAAM,WAAW;gBACxE,CAAC;IACL,CAAC,GACD;IACI,MAAM;AACV"}},
    {"offset": {"line": 8650, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/store/useMasteringStore.ts"],"sourcesContent":["import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\n\nexport interface MasteringSettings {\n    // Gate\n    gateThreshold: number;\n    gateAttack: number;\n    gateRelease: number;\n    \n    // EQ\n    eqHighpass: number;\n    eqTilt: number;\n    eqSideGain: number;\n    eqSideFreq: number;\n    \n    // Leveler\n    levelerTarget: number;\n    levelerBrake: number;\n    levelerMaxPlus: number;\n    levelerMaxMinus: number;\n    \n    // Knee Compressor\n    compStrength: number;\n    compAttack: number;\n    compRelease: number;\n    compKnee: number;\n    compMakeup: number;\n    \n    // Multiband (interpolated low/high)\n    mbStrengthLow: number;\n    mbStrengthHigh: number;\n    mbAttackLow: number;\n    mbAttackHigh: number;\n    mbCrossoverLow: number;\n    mbCrossoverHigh: number;\n    \n    // Limiter & Brickwall\n    limStrength: number;\n    limAttack: number;\n    limRelease: number;\n    limCeiling: number;\n\n    // Legacy/Quick controls (for compatibility if needed)\n    inputDrive: number;\n    stereoWidth: number;\n\n    // Bypasses\n    gateBypass: boolean;\n    eqBypass: boolean;\n    levelerBypass: boolean;\n    compBypass: boolean;\n    mbBypass: boolean;\n    limBypass: boolean;\n}\n\nexport interface MasteringProject {\n    id: string;\n    name: string;\n    date: string;\n    audioUrl: string | null;\n    audioId?: string;\n    dna: string;\n    settings: MasteringSettings;\n    frequencyData?: number[]; // Snapshot of final spectral balance\n}\n\ninterface MasteringState {\n    history: MasteringProject[];\n    currentModule: 'gate' | 'eq' | 'leveler' | 'compressor' | 'multiband' | 'limiter';\n    setCurrentModule: (module: 'gate' | 'eq' | 'leveler' | 'compressor' | 'multiband' | 'limiter') => void;\n    addToHistory: (project: Omit<MasteringProject, 'date'>) => void;\n    deleteFromHistory: (id: string) => void;\n    getProjectById: (id: string) => MasteringProject | undefined;\n    cleanupOldHistory: () => void;\n}\n\nexport const useMasteringStore = create<MasteringState>()(\n    persist(\n        (set, get) => ({\n            history: [],\n            currentModule: 'leveler',\n            setCurrentModule: (module) => set({ currentModule: module }),\n            addToHistory: (project) => {\n                const newProject = {\n                    ...project,\n                    date: new Date().toISOString(),\n                };\n                set((state) => {\n                    // Remove any existing entry with the same ID to prevent duplication\n                    const filteredHistory = state.history.filter(p => p.id !== project.id);\n                    return {\n                        history: [newProject, ...filteredHistory],\n                    };\n                });\n            },\n            deleteFromHistory: (id) => {\n                set((state) => ({\n                    history: state.history.filter((p) => p.id !== id),\n                }));\n            },\n            getProjectById: (id) => {\n                return get().history.find((p) => p.id === id);\n            },\n            cleanupOldHistory: () => {\n                const NINETY_DAYS_MS = 90 * 24 * 60 * 60 * 1000;\n                const now = Date.now();\n                set((state) => ({\n                    history: state.history.filter((p) => {\n                        const projectDate = new Date(p.date).getTime();\n                        return (now - projectDate) < NINETY_DAYS_MS;\n                    }),\n                }));\n            },\n        }),\n        {\n            name: 'mastering-history-storage',\n        }\n    )\n);\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AA2EO,MAAM,oBAAoB,IAAA,wLAAM,IACnC,IAAA,8LAAO,EACH,CAAC,KAAK,MAAQ,CAAC;QACX,SAAS,EAAE;QACX,eAAe;QACf,kBAAkB,CAAC,SAAW,IAAI;gBAAE,eAAe;YAAO;QAC1D,cAAc,CAAC;YACX,MAAM,aAAa;gBACf,GAAG,OAAO;gBACV,MAAM,IAAI,OAAO,WAAW;YAChC;YACA,IAAI,CAAC;gBACD,oEAAoE;gBACpE,MAAM,kBAAkB,MAAM,OAAO,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,QAAQ,EAAE;gBACrE,OAAO;oBACH,SAAS;wBAAC;2BAAe;qBAAgB;gBAC7C;YACJ;QACJ;QACA,mBAAmB,CAAC;YAChB,IAAI,CAAC,QAAU,CAAC;oBACZ,SAAS,MAAM,OAAO,CAAC,MAAM,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;gBAClD,CAAC;QACL;QACA,gBAAgB,CAAC;YACb,OAAO,MAAM,OAAO,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;QAC9C;QACA,mBAAmB;YACf,MAAM,iBAAiB,KAAK,KAAK,KAAK,KAAK;YAC3C,MAAM,MAAM,KAAK,GAAG;YACpB,IAAI,CAAC,QAAU,CAAC;oBACZ,SAAS,MAAM,OAAO,CAAC,MAAM,CAAC,CAAC;wBAC3B,MAAM,cAAc,IAAI,KAAK,EAAE,IAAI,EAAE,OAAO;wBAC5C,OAAO,AAAC,MAAM,cAAe;oBACjC;gBACJ,CAAC;QACL;IACJ,CAAC,GACD;IACI,MAAM;AACV"}},
    {"offset": {"line": 8708, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/StemExtractModal.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState } from 'react';\nimport { X, Layers, Music, Mic2, Drum, GitBranch, Piano, ArrowRight } from 'lucide-react';\nimport { useCreatorStore } from '@/store/useCreatorStore';\nimport { useMasteringStore } from '@/store/useMasteringStore';\nimport { useDAWStore } from '@/store/useDAWStore';\n\ninterface StemExtractModalProps {\n    onClose: () => void;\n}\n\n// Stem definitions — these are the track names + colors created for each song\nconst STEM_DEFINITIONS = [\n    { name: 'Vocal', color: '#00F0FF', trackType: 'mono' as const },\n    { name: 'Beat', color: '#FF6B00', trackType: 'stereo' as const },\n    { name: 'Bajo', color: '#A4ECA1', trackType: 'mono' as const },\n    { name: 'Melodía', color: '#E2A04A', trackType: 'stereo' as const },\n    { name: 'FX', color: '#D94AE2', trackType: 'stereo' as const },\n];\n\nexport function StemExtractModal({ onClose }: StemExtractModalProps) {\n    const creatorTracks = useCreatorStore((s) => s.tracks);\n    const masteringHistory = useMasteringStore((s) => s.history);\n    const addTrack = useDAWStore((s) => s.addTrack);\n\n    const [selectedId, setSelectedId] = useState<string | null>(null);\n    const [extracting, setExtracting] = useState(false);\n    const [done, setDone] = useState(false);\n\n    // Combine creator + mastering sources into one selectable list\n    const songList = [\n        ...creatorTracks.map((t) => ({\n            id: t.id,\n            title: t.title,\n            subtitle: t.style || 'AI Creator',\n            audioUrl: t.streamAudioUrl || t.url,\n            source: 'creator' as const,\n        })),\n        ...masteringHistory.slice(0, 8).map((p) => ({\n            id: p.id,\n            title: p.name,\n            subtitle: `Masterización · ${p.dna}`,\n            audioUrl: typeof p.audioUrl === 'string' && !p.audioUrl.startsWith('blob:') ? p.audioUrl : null,\n            source: 'mastering' as const,\n        })),\n    ];\n\n    const handleExtract = async () => {\n        if (!selectedId) return;\n        const song = songList.find((s) => s.id === selectedId);\n        if (!song) return;\n\n        setExtracting(true);\n\n        // Simulate stem separation delay (250ms per stem)\n        for (let i = 0; i < STEM_DEFINITIONS.length; i++) {\n            await new Promise((r) => setTimeout(r, 250));\n            const stem = STEM_DEFINITIONS[i];\n            addTrack(\n                `${song.title} · ${stem.name}`,\n                stem.color,\n                stem.trackType,\n                song.audioUrl ? `${song.audioUrl}?stem=${stem.name.toLowerCase()}` : undefined,\n            );\n        }\n\n        setExtracting(false);\n        setDone(true);\n\n        // Auto-close after showing success\n        setTimeout(() => onClose(), 1200);\n    };\n\n    return (\n        <div className=\"fixed inset-0 bg-black/80 backdrop-blur-sm z-[200] flex items-center justify-center p-4\">\n            <div className=\"bg-[#0B1015] border border-white/10 rounded-2xl w-full max-w-lg shadow-[0_0_60px_rgba(0,0,0,0.9)] animate-in zoom-in-95 duration-200\">\n\n                {/* Header */}\n                <div className=\"flex items-center justify-between px-6 py-4 border-b border-white/5\">\n                    <div className=\"flex items-center gap-3\">\n                        <div className=\"p-2 bg-gradient-to-br from-cyan-500/20 to-blue-500/10 rounded-lg border border-cyan-500/20\">\n                            <Layers size={18} className=\"text-cyan-400\" />\n                        </div>\n                        <div>\n                            <h3 className=\"text-sm font-black text-white tracking-widest uppercase\">Extraer Stems al Editor</h3>\n                            <p className=\"text-[10px] text-white/40 mt-0.5\">Selecciona una canción para separar sus pistas</p>\n                        </div>\n                    </div>\n                    <button onClick={onClose} className=\"p-2 text-white/20 hover:text-white hover:bg-white/5 rounded-full transition-all\">\n                        <X size={18} />\n                    </button>\n                </div>\n\n                {/* Song List */}\n                <div className=\"p-4 flex flex-col gap-2 max-h-[340px] overflow-y-auto custom-scrollbar\">\n                    {songList.length === 0 && (\n                        <div className=\"text-center py-10 text-white/20\">\n                            <Music size={36} className=\"mx-auto mb-3 opacity-30\" />\n                            <p className=\"text-xs font-bold tracking-widest uppercase\">No hay canciones disponibles</p>\n                            <p className=\"text-[10px] mt-1\">Genera una canción en Crear primero</p>\n                        </div>\n                    )}\n                    {songList.map((song) => (\n                        <button\n                            key={song.id}\n                            onClick={() => setSelectedId(song.id)}\n                            className={`flex items-center gap-4 p-4 rounded-xl border text-left transition-all ${selectedId === song.id\n                                ? 'bg-cyan-500/10 border-cyan-500/40 shadow-[0_0_20px_rgba(6,182,212,0.15)]'\n                                : 'bg-white/3 border-white/5 hover:bg-white/5 hover:border-white/10'\n                                }`}\n                        >\n                            <div className={`w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 ${song.source === 'creator'\n                                ? 'bg-orange-500/20 border border-orange-500/30'\n                                : 'bg-purple-500/20 border border-purple-500/30'\n                                }`}>\n                                {song.source === 'creator' ? (\n                                    <Music size={16} className=\"text-orange-400\" />\n                                ) : (\n                                    <Layers size={16} className=\"text-purple-400\" />\n                                )}\n                            </div>\n                            <div className=\"flex-1 min-w-0\">\n                                <p className=\"text-sm font-bold text-white truncate\">{song.title}</p>\n                                <p className=\"text-[10px] text-white/40 mt-0.5 truncate\">{song.subtitle}</p>\n                            </div>\n                            {selectedId === song.id && (\n                                <div className=\"w-2 h-2 rounded-full bg-cyan-400 animate-pulse flex-shrink-0\" />\n                            )}\n                        </button>\n                    ))}\n                </div>\n\n                {/* Stem Preview (when song selected) */}\n                {selectedId && !done && (\n                    <div className=\"px-4 pb-2\">\n                        <p className=\"text-[9px] font-bold text-white/30 uppercase tracking-widest mb-2\">Se crearán estas pistas en el editor:</p>\n                        <div className=\"flex gap-2 flex-wrap\">\n                            {STEM_DEFINITIONS.map((stem, i) => (\n                                <div\n                                    key={stem.name}\n                                    className=\"flex items-center gap-1.5 px-3 py-1.5 rounded-full text-[10px] font-bold border\"\n                                    style={{\n                                        background: `${stem.color}15`,\n                                        borderColor: `${stem.color}40`,\n                                        color: stem.color,\n                                        animationDelay: `${i * 50}ms`,\n                                    }}\n                                >\n                                    <div className=\"w-1.5 h-1.5 rounded-full\" style={{ background: stem.color }} />\n                                    {stem.name}\n                                </div>\n                            ))}\n                        </div>\n                    </div>\n                )}\n\n                {/* Footer */}\n                <div className=\"px-6 py-4 border-t border-white/5 flex items-center justify-between gap-4\">\n                    {done ? (\n                        <div className=\"flex items-center gap-2 text-green-400 text-sm font-bold mx-auto\">\n                            <div className=\"w-5 h-5 rounded-full bg-green-500/20 flex items-center justify-center\">✓</div>\n                            ¡Stems añadidos al editor!\n                        </div>\n                    ) : (\n                        <>\n                            <button onClick={onClose} className=\"px-5 py-2 text-white/40 hover:text-white text-xs font-bold tracking-widest transition-colors\">\n                                Cancelar\n                            </button>\n                            <button\n                                onClick={handleExtract}\n                                disabled={!selectedId || extracting}\n                                className=\"flex items-center gap-2 px-6 py-2.5 rounded-xl bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 disabled:opacity-40 disabled:cursor-not-allowed text-white text-[11px] font-black tracking-widest uppercase transition-all shadow-[0_0_20px_rgba(6,182,212,0.3)]\"\n                            >\n                                {extracting ? (\n                                    <>\n                                        <div className=\"w-3 h-3 rounded-full border border-white border-t-transparent animate-spin\" />\n                                        Separando stems...\n                                    </>\n                                ) : (\n                                    <>\n                                        <Layers size={14} />\n                                        Abrir en Editor\n                                    </>\n                                )}\n                            </button>\n                        </>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9134, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/lib/midi/MidiEngine.ts"],"sourcesContent":["/**\n * Da Graba Studio — MIDI Engine\n * ==============================\n * TypeScript MIDI system inspired by JUCE's MidiMessage & MidiBuffer.\n * Web-native implementation for the DAW's Piano Roll & Drum Pads.\n */\n\n// ─────────────────────────────────────────────────────────────────────────────\n// MidiMessage\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport type MidiMessageType =\n    | 'noteOn' | 'noteOff'\n    | 'controlChange' | 'programChange'\n    | 'pitchBend' | 'aftertouch' | 'channelPressure'\n    | 'allNotesOff' | 'allSoundOff'\n    | 'sysex' | 'meta' | 'unknown';\n\nexport class MidiMessage {\n    private _status: number;\n    private _data1: number;\n    private _data2: number;\n    private _channel: number;\n    private _timestamp: number;\n    private _type: MidiMessageType;\n\n    private constructor(status: number, data1: number, data2: number, channel: number, type: MidiMessageType) {\n        this._status = status;\n        this._data1 = data1;\n        this._data2 = data2;\n        this._channel = channel;\n        this._timestamp = 0;\n        this._type = type;\n    }\n\n    // ── Factory Methods ─────────────────────────────────────────────\n\n    static noteOn(channel: number, noteNumber: number, velocity: number): MidiMessage {\n        const vel = Math.max(1, Math.min(127, Math.round(velocity)));\n        return new MidiMessage(0x90, noteNumber & 0x7F, vel, channel & 0xF, 'noteOn');\n    }\n\n    static noteOff(channel: number, noteNumber: number, velocity: number = 0): MidiMessage {\n        return new MidiMessage(0x80, noteNumber & 0x7F, velocity & 0x7F, channel & 0xF, 'noteOff');\n    }\n\n    static controllerEvent(channel: number, controllerNumber: number, value: number): MidiMessage {\n        return new MidiMessage(0xB0, controllerNumber & 0x7F, value & 0x7F, channel & 0xF, 'controlChange');\n    }\n\n    static programChange(channel: number, programNumber: number): MidiMessage {\n        return new MidiMessage(0xC0, programNumber & 0x7F, 0, channel & 0xF, 'programChange');\n    }\n\n    static pitchWheel(channel: number, position: number): MidiMessage {\n        // position: 0-16383, center = 8192\n        const clamped = Math.max(0, Math.min(16383, position));\n        return new MidiMessage(0xE0, clamped & 0x7F, (clamped >> 7) & 0x7F, channel & 0xF, 'pitchBend');\n    }\n\n    static allNotesOff(channel: number): MidiMessage {\n        return new MidiMessage(0xB0, 123, 0, channel & 0xF, 'allNotesOff');\n    }\n\n    static allSoundOff(channel: number): MidiMessage {\n        return new MidiMessage(0xB0, 120, 0, channel & 0xF, 'allSoundOff');\n    }\n\n    // ── Query Methods ───────────────────────────────────────────────\n\n    get type(): MidiMessageType { return this._type; }\n    get channel(): number { return this._channel; }\n    get timestamp(): number { return this._timestamp; }\n\n    set timestamp(t: number) { this._timestamp = t; }\n    setTimeStamp(t: number): MidiMessage { this._timestamp = t; return this; }\n\n    isNoteOn(): boolean { return this._type === 'noteOn'; }\n    isNoteOff(): boolean { return this._type === 'noteOff'; }\n    isNoteOnOrOff(): boolean { return this._type === 'noteOn' || this._type === 'noteOff'; }\n    isController(): boolean { return this._type === 'controlChange'; }\n    isProgramChange(): boolean { return this._type === 'programChange'; }\n    isPitchWheel(): boolean { return this._type === 'pitchBend'; }\n    isAllNotesOff(): boolean { return this._type === 'allNotesOff'; }\n    isAllSoundOff(): boolean { return this._type === 'allSoundOff'; }\n\n    getNoteNumber(): number { return this._data1; }\n    getVelocity(): number { return this._data2; }\n    getFloatVelocity(): number { return this._data2 / 127.0; }\n    getControllerNumber(): number { return this._data1; }\n    getControllerValue(): number { return this._data2; }\n    getProgramChangeNumber(): number { return this._data1; }\n    getPitchWheelValue(): number { return this._data1 | (this._data2 << 7); }\n\n    // ── Formatting ──────────────────────────────────────────────────\n\n    static getMidiNoteName(noteNumber: number): string {\n        const names = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];\n        const octave = Math.floor(noteNumber / 12) - 1;\n        return `${names[noteNumber % 12]}${octave}`;\n    }\n\n    static getControllerName(cc: number): string {\n        const names: Record<number, string> = {\n            1: 'Mod Wheel', 7: 'Volume', 10: 'Pan', 11: 'Expression',\n            64: 'Sustain', 91: 'Reverb', 93: 'Chorus', 123: 'All Notes Off',\n        };\n        return names[cc] || `CC${cc}`;\n    }\n\n    getDescription(): string {\n        if (this.isNoteOn()) return `Note On ${MidiMessage.getMidiNoteName(this._data1)} vel:${this._data2}`;\n        if (this.isNoteOff()) return `Note Off ${MidiMessage.getMidiNoteName(this._data1)}`;\n        if (this.isController()) return `CC ${MidiMessage.getControllerName(this._data1)}: ${this._data2}`;\n        if (this.isProgramChange()) return `Program Change ${this._data1}`;\n        if (this.isPitchWheel()) return `Pitch Wheel ${this.getPitchWheelValue()}`;\n        if (this.isAllNotesOff()) return 'All Notes Off';\n        if (this.isAllSoundOff()) return 'All Sound Off';\n        return `MIDI [${this._status.toString(16)} ${this._data1} ${this._data2}]`;\n    }\n\n    getTimecodeString(): string {\n        const t = this._timestamp;\n        const mins = Math.floor(t / 60) % 60;\n        const secs = Math.floor(t) % 60;\n        const ms = Math.floor((t * 1000) % 1000);\n        return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}.${String(ms).padStart(3, '0')}`;\n    }\n\n    /** Raw MIDI bytes */\n    getRawData(): Uint8Array {\n        return new Uint8Array([this._status | this._channel, this._data1, this._data2]);\n    }\n\n    /** Clone this message */\n    clone(): MidiMessage {\n        const m = new MidiMessage(this._status, this._data1, this._data2, this._channel, this._type);\n        m._timestamp = this._timestamp;\n        return m;\n    }\n}\n\n\n// ─────────────────────────────────────────────────────────────────────────────\n// MidiBuffer\n// ─────────────────────────────────────────────────────────────────────────────\n\ninterface BufferEvent {\n    samplePosition: number;\n    message: MidiMessage;\n}\n\nexport class MidiBuffer {\n    private events: BufferEvent[] = [];\n    private _sampleRate: number;\n\n    constructor(sampleRate: number = 44100) {\n        this._sampleRate = sampleRate;\n    }\n\n    get sampleRate(): number { return this._sampleRate; }\n    get numEvents(): number { return this.events.length; }\n    get isEmpty(): boolean { return this.events.length === 0; }\n\n    /** Add a MIDI event at the given sample position */\n    addEvent(message: MidiMessage, sampleNumber: number): void {\n        const event: BufferEvent = { samplePosition: sampleNumber, message: message.clone() };\n\n        // Insert in sorted order\n        let i = this.events.length;\n        while (i > 0 && this.events[i - 1].samplePosition > sampleNumber) i--;\n        this.events.splice(i, 0, event);\n    }\n\n    /** Add event using the message's timestamp (seconds → samples) */\n    addEventFromTimestamp(message: MidiMessage): void {\n        const sampleNumber = Math.floor(message.timestamp * this._sampleRate);\n        this.addEvent(message, sampleNumber);\n    }\n\n    /** Iterate over events in the buffer */\n    *[Symbol.iterator](): Generator<BufferEvent> {\n        for (const e of this.events) {\n            yield e;\n        }\n    }\n\n    /** Get events in a specific sample range [start, end) */\n    getEventsInRange(startSample: number, endSample: number): BufferEvent[] {\n        return this.events.filter(\n            e => e.samplePosition >= startSample && e.samplePosition < endSample\n        );\n    }\n\n    /** Clear events in range [start, start+numSamples) */\n    clear(startSample: number = 0, numSamples?: number): void {\n        if (numSamples === undefined) {\n            this.events = [];\n        } else {\n            const end = startSample + numSamples;\n            this.events = this.events.filter(\n                e => e.samplePosition < startSample || e.samplePosition >= end\n            );\n        }\n    }\n\n    /** Clear all events */\n    clearAll(): void {\n        this.events = [];\n    }\n}\n\n\n// ─────────────────────────────────────────────────────────────────────────────\n// MidiEngine — Realtime scheduler\n// ─────────────────────────────────────────────────────────────────────────────\n\ntype MidiListener = (message: MidiMessage) => void;\n\nexport class MidiEngine {\n    private buffer: MidiBuffer;\n    private listeners: MidiListener[] = [];\n    private startTime: number = 0;\n    private previousSampleNumber: number = 0;\n    private timerId: ReturnType<typeof setInterval> | null = null;\n    private _log: MidiMessage[] = [];\n    private _maxLog = 200;\n\n    constructor(sampleRate: number = 44100) {\n        this.buffer = new MidiBuffer(sampleRate);\n        this.startTime = performance.now() / 1000;\n    }\n\n    get log(): MidiMessage[] { return this._log; }\n    get sampleRate(): number { return this.buffer.sampleRate; }\n\n    /** Register a listener for dispatched MIDI events */\n    addListener(fn: MidiListener): void {\n        this.listeners.push(fn);\n    }\n\n    removeListener(fn: MidiListener): void {\n        this.listeners = this.listeners.filter(l => l !== fn);\n    }\n\n    /** Schedule a MIDI event into the buffer */\n    scheduleEvent(msg: MidiMessage): void {\n        this.buffer.addEventFromTimestamp(msg);\n    }\n\n    /** Fire a MIDI event immediately (bypasses buffer) */\n    sendImmediate(msg: MidiMessage): void {\n        msg.setTimeStamp(this.getCurrentTime());\n        this._log.push(msg);\n        if (this._log.length > this._maxLog) this._log.shift();\n        this.listeners.forEach(l => l(msg));\n    }\n\n    /** Get current time relative to engine start (seconds) */\n    getCurrentTime(): number {\n        return performance.now() / 1000 - this.startTime;\n    }\n\n    /** Start the scheduling timer */\n    start(): void {\n        this.startTime = performance.now() / 1000;\n        this.previousSampleNumber = 0;\n        this.timerId = setInterval(() => this.tick(), 1);\n    }\n\n    /** Stop the scheduler */\n    stop(): void {\n        if (this.timerId) clearInterval(this.timerId);\n        this.timerId = null;\n    }\n\n    /** Internal: dispatch due events */\n    private tick(): void {\n        const currentTime = this.getCurrentTime();\n        const currentSample = Math.floor(currentTime * this.buffer.sampleRate);\n\n        const dueEvents = this.buffer.getEventsInRange(this.previousSampleNumber, currentSample);\n        for (const { message, samplePosition } of dueEvents) {\n            message.setTimeStamp(samplePosition / this.buffer.sampleRate);\n            this._log.push(message);\n            if (this._log.length > this._maxLog) this._log.shift();\n            this.listeners.forEach(l => l(message));\n        }\n\n        this.buffer.clear(this.previousSampleNumber, currentSample - this.previousSampleNumber);\n        this.previousSampleNumber = currentSample;\n    }\n\n    /** Reset engine */\n    reset(): void {\n        this.stop();\n        this.buffer.clearAll();\n        this._log = [];\n        this.previousSampleNumber = 0;\n    }\n}\n\n// ── Singleton instance ──────────────────────────────────────────────────────\nexport const midiEngine = new MidiEngine();\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9438, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/DrumPadMidi.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useCallback, useRef, useEffect } from 'react';\nimport { MidiMessage, midiEngine } from '@/lib/midi/MidiEngine';\nimport { Drum, Volume2, Activity } from 'lucide-react';\n\n/**\n * Drum Pad MIDI Controller\n * Based on the JUCE MidiMessage tutorial — creates NoteOn/NoteOff messages\n * on MIDI channel 10 for General MIDI drum sounds.\n */\n\ninterface PadDef {\n    label: string;\n    note: number;\n    color: string;\n    shortcut: string;\n}\n\nconst DRUM_PADS: PadDef[] = [\n    { label: 'KICK', note: 36, color: '#FF3333', shortcut: 'Q' },\n    { label: 'SNARE', note: 38, color: '#33AAFF', shortcut: 'W' },\n    { label: 'HI-HAT', note: 42, color: '#FFD700', shortcut: 'E' },\n    { label: 'OPEN HH', note: 46, color: '#FF8C00', shortcut: 'R' },\n    { label: 'CRASH', note: 49, color: '#FF00FF', shortcut: 'A' },\n    { label: 'RIDE', note: 51, color: '#00FFAA', shortcut: 'S' },\n    { label: 'TOM HI', note: 48, color: '#8855FF', shortcut: 'D' },\n    { label: 'TOM LO', note: 45, color: '#FF5588', shortcut: 'F' },\n    { label: 'CLAP', note: 39, color: '#00CCFF', shortcut: 'Z' },\n    { label: 'COWBELL', note: 56, color: '#FFAA00', shortcut: 'X' },\n    { label: 'RIMSHOT', note: 37, color: '#99FF33', shortcut: 'C' },\n    { label: 'SHAKER', note: 70, color: '#FF6699', shortcut: 'V' },\n];\n\nconst MIDI_CHANNEL = 10;\n\nexport function DrumPadMidi() {\n    const [activePads, setActivePads] = useState<Set<number>>(new Set());\n    const [midiLog, setMidiLog] = useState<string[]>([]);\n    const [volume, setVolume] = useState(100);\n    const logRef = useRef<HTMLDivElement>(null);\n\n    // Handle pad trigger\n    const triggerPad = useCallback((noteNumber: number) => {\n        // Create NoteOn\n        const noteOn = MidiMessage.noteOn(MIDI_CHANNEL, noteNumber, volume);\n        midiEngine.sendImmediate(noteOn);\n\n        // Schedule NoteOff 100ms later\n        const noteOff = MidiMessage.noteOff(MIDI_CHANNEL, noteNumber);\n        noteOff.setTimeStamp(midiEngine.getCurrentTime() + 0.1);\n        midiEngine.scheduleEvent(noteOff);\n\n        // Visual feedback\n        setActivePads(prev => new Set(prev).add(noteNumber));\n        setTimeout(() => {\n            setActivePads(prev => {\n                const next = new Set(prev);\n                next.delete(noteNumber);\n                return next;\n            });\n        }, 120);\n\n        // Update log\n        setMidiLog(prev => {\n            const entry = `${noteOn.getTimecodeString()} - ${noteOn.getDescription()}`;\n            const next = [entry, ...prev];\n            return next.slice(0, 30);\n        });\n    }, [volume]);\n\n    // Volume CC handler\n    const handleVolumeChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n        const val = parseInt(e.target.value);\n        setVolume(val);\n        const cc = MidiMessage.controllerEvent(MIDI_CHANNEL, 7, val);\n        midiEngine.sendImmediate(cc);\n        setMidiLog(prev => [`${cc.getTimecodeString()} - ${cc.getDescription()}`, ...prev].slice(0, 30));\n    }, []);\n\n    // Keyboard shortcuts\n    useEffect(() => {\n        const handleKey = (e: KeyboardEvent) => {\n            const pad = DRUM_PADS.find(p => p.shortcut === e.key.toUpperCase());\n            if (pad && !e.repeat) triggerPad(pad.note);\n        };\n        window.addEventListener('keydown', handleKey);\n        return () => window.removeEventListener('keydown', handleKey);\n    }, [triggerPad]);\n\n    // Start MIDI scheduler\n    useEffect(() => {\n        midiEngine.start();\n        return () => midiEngine.stop();\n    }, []);\n\n    return (\n        <div className=\"flex gap-4 w-full h-full\">\n            {/* Pad Grid */}\n            <div className=\"flex-1 flex flex-col gap-3\">\n                <div className=\"flex items-center gap-2 mb-1\">\n                    <Drum size={14} className=\"text-cyan-400\" />\n                    <span className=\"text-[10px] font-black tracking-widest text-white/60 uppercase\">\n                        MIDI Drum Pads · CH{MIDI_CHANNEL}\n                    </span>\n                </div>\n\n                <div className=\"grid grid-cols-4 gap-2\">\n                    {DRUM_PADS.map(pad => {\n                        const isActive = activePads.has(pad.note);\n                        return (\n                            <button\n                                key={pad.note}\n                                onMouseDown={() => triggerPad(pad.note)}\n                                className=\"relative aspect-square rounded-lg border transition-all duration-75 flex flex-col items-center justify-center gap-1 select-none active:scale-95\"\n                                style={{\n                                    background: isActive\n                                        ? `${pad.color}40`\n                                        : 'rgba(255,255,255,0.03)',\n                                    borderColor: isActive\n                                        ? `${pad.color}80`\n                                        : 'rgba(255,255,255,0.08)',\n                                    boxShadow: isActive\n                                        ? `0 0 20px ${pad.color}30, inset 0 0 20px ${pad.color}15`\n                                        : 'none',\n                                }}\n                            >\n                                <span\n                                    className=\"text-[10px] font-black tracking-wider\"\n                                    style={{ color: pad.color }}\n                                >\n                                    {pad.label}\n                                </span>\n                                <span className=\"text-[8px] text-white/20 font-mono\">\n                                    {pad.shortcut} · {pad.note}\n                                </span>\n                            </button>\n                        );\n                    })}\n                </div>\n\n                {/* Volume CC7 Slider */}\n                <div className=\"flex items-center gap-3 mt-2 px-1\">\n                    <Volume2 size={12} className=\"text-white/30\" />\n                    <input\n                        type=\"range\"\n                        min={0}\n                        max={127}\n                        value={volume}\n                        onChange={handleVolumeChange}\n                        className=\"flex-1 h-1 accent-cyan-500 bg-white/10 rounded-full appearance-none cursor-pointer\"\n                    />\n                    <span className=\"text-[9px] font-mono text-white/30 w-8 text-right\">{volume}</span>\n                </div>\n            </div>\n\n            {/* MIDI Log */}\n            <div className=\"w-[220px] bg-black/40 border border-white/5 rounded-lg overflow-hidden flex flex-col\">\n                <div className=\"flex items-center gap-2 px-3 py-2 border-b border-white/5 bg-white/3\">\n                    <Activity size={10} className=\"text-green-400\" />\n                    <span className=\"text-[8px] font-black tracking-widest text-white/40 uppercase\">\n                        MIDI Monitor\n                    </span>\n                </div>\n                <div\n                    ref={logRef}\n                    className=\"flex-1 overflow-y-auto p-2 flex flex-col gap-0.5 custom-scrollbar max-h-[200px]\"\n                >\n                    {midiLog.length === 0 ? (\n                        <span className=\"text-[9px] text-white/15 text-center py-8\">\n                            Press a pad or use keyboard shortcuts...\n                        </span>\n                    ) : (\n                        midiLog.map((entry, i) => (\n                            <div\n                                key={i}\n                                className=\"text-[8px] font-mono text-white/50 py-0.5 px-1 rounded hover:bg-white/5 transition-colors\"\n                            >\n                                {entry}\n                            </div>\n                        ))\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9818, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/lib/midi/MidiDeviceManager.ts"],"sourcesContent":["/**\n * Da Graba Studio — MIDI Device Manager\n * =====================================\n * Handles Web MIDI API connections (external hardware).\n * Routes external incoming MIDI directly into the central MidiEngine.\n */\n/// <reference path=\"../../types/webmidi.d.ts\" />\n\nimport { MidiMessage, midiEngine, MidiMessageType } from './MidiEngine';\n\nexport interface MidiInputDef {\n    id: string;\n    name: string;\n    manufacturer: string;\n}\n\ntype DeviceListener = (inputs: MidiInputDef[], activeId: string | null) => void;\n\nclass MidiDeviceManager {\n    private midiAccess: WebMidi.MIDIAccess | null = null;\n    private inputs: Map<string, WebMidi.MIDIInput> = new Map();\n    private activeInputId: string | null = null;\n    private listeners: DeviceListener[] = [];\n    private isInitialized = false;\n\n    constructor() {\n        // We will initialize explicitly, to handle permissions flow safely\n    }\n\n    /** \n     * Request MIDI access from the browser. \n     * If user denies, it throws or rejects.\n     */\n    async initialize(): Promise<void> {\n        if (this.isInitialized) return;\n\n        if (typeof navigator !== 'undefined' && navigator.requestMIDIAccess) {\n            try {\n                this.midiAccess = await navigator.requestMIDIAccess({ sysex: false });\n                this.midiAccess.onstatechange = this.handleStateChange;\n                this.updateInputs();\n                this.isInitialized = true;\n            } catch (err) {\n                console.error(\"MIDI Device Manager: Failed to get MIDI access\", err);\n            }\n        } else {\n            console.warn(\"MIDI Device Manager: Web MIDI API not supported in this browser.\");\n        }\n    }\n\n    /** Listeners for UI state updates */\n    addListener(fn: DeviceListener) {\n        this.listeners.push(fn);\n        fn(this.getAvailableInputs(), this.activeInputId);\n    }\n\n    removeListener(fn: DeviceListener) {\n        this.listeners = this.listeners.filter(l => l !== fn);\n    }\n\n    private notifyListeners() {\n        const inputs = this.getAvailableInputs();\n        this.listeners.forEach(fn => fn(inputs, this.activeInputId));\n    }\n\n    /** Get formatted list of inputs for UI */\n    getAvailableInputs(): MidiInputDef[] {\n        return Array.from(this.inputs.values()).map(input => ({\n            id: input.id,\n            name: input.name || `Unknown Input (${input.id})`,\n            manufacturer: input.manufacturer || 'Unknown',\n        }));\n    }\n\n    /** Set which hardware input we are listening to */\n    setActiveInput(id: string | null) {\n        // Disconnect old\n        if (this.activeInputId && this.inputs.has(this.activeInputId)) {\n            const oldInput = this.inputs.get(this.activeInputId)!;\n            oldInput.onmidimessage = null;\n        }\n\n        this.activeInputId = id;\n\n        // Connect new\n        if (id && this.inputs.has(id)) {\n            const newInput = this.inputs.get(id)!;\n            newInput.onmidimessage = this.handleIncomingMidi;\n        }\n\n        this.notifyListeners();\n    }\n\n    /** Auto-connect to first available if none selected */\n    autoConnect() {\n        if (!this.activeInputId && this.inputs.size > 0) {\n            this.setActiveInput(this.inputs.keys().next().value!);\n        }\n    }\n\n    private updateInputs() {\n        if (!this.midiAccess) return;\n\n        this.inputs.clear();\n        for (const input of this.midiAccess.inputs.values()) {\n            this.inputs.set(input.id, input);\n        }\n\n        // If the active input was disconnected, clear it\n        if (this.activeInputId && !this.inputs.has(this.activeInputId)) {\n            this.activeInputId = null;\n        }\n\n        this.notifyListeners();\n    }\n\n    // Bound handlers\n    private handleStateChange = (event: WebMidi.MIDIConnectionEvent) => {\n        console.log(`MIDI Device State Change: ${event.port.name} ${event.port.state}`);\n        this.updateInputs();\n    };\n\n    /** The core bridge: Hardware MIDI -> MidiMessage -> MidiEngine */\n    private handleIncomingMidi = (event: WebMidi.MIDIMessageEvent) => {\n        const [statusByte, data1 = 0, data2 = 0] = event.data;\n\n        let msg: MidiMessage | null = null;\n\n        const command = statusByte & 0xF0;\n        const channel = statusByte & 0x0F;\n\n        if (command === 0x90) {     // Note On\n            if (data2 === 0) {\n                msg = MidiMessage.noteOff(channel, data1, 0); // Implicit note off\n            } else {\n                msg = MidiMessage.noteOn(channel, data1, data2);\n            }\n        } else if (command === 0x80) { // Note Off\n            msg = MidiMessage.noteOff(channel, data1, data2);\n        } else if (command === 0xB0) { // Control Change\n            msg = MidiMessage.controllerEvent(channel, data1, data2);\n        } else if (command === 0xC0) { // Program Change\n            msg = MidiMessage.programChange(channel, data1);\n        } else if (command === 0xE0) { // Pitch Bend\n            const val = data1 | (data2 << 7);\n            msg = MidiMessage.pitchWheel(channel, val);\n        }\n\n        if (msg) {\n            // Send directly to the engine\n            midiEngine.sendImmediate(msg);\n        }\n    };\n}\n\n// Global Singleton\nexport const midiDeviceManager = new MidiDeviceManager();\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9948, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/MidiKeyboardComponent.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { MidiMessage, midiEngine } from '@/lib/midi/MidiEngine';\nimport { Settings2 } from 'lucide-react';\nimport { midiDeviceManager, MidiInputDef } from '@/lib/midi/MidiDeviceManager';\n\n/**\n * Da Graba Studio — MIDI Keyboard Component\n * =========================================\n * Inspired by JUCE MidiKeyboardComponent.\n * Acts as an on-screen source of MIDI messages and visually responds\n * to internal/external MIDI notes routed through the MidiEngine.\n */\n\n// Simple 2-octave layout starting at C3 (MIDI 48)\nconst START_NOTE = 48;\nconst NUM_KEYS = 25;\n\nconst isBlackKey = (note: number) => {\n    const semitone = note % 12;\n    return [1, 3, 6, 8, 10].includes(semitone);\n};\n\nexport function MidiKeyboardComponent() {\n    const [activeNotes, setActiveNotes] = useState<Set<number>>(new Set());\n    const [volume, setVolume] = useState(100);\n\n    // Visual feedback from external/internal MIDI engine\n    useEffect(() => {\n        const handleMidi = (msg: MidiMessage) => {\n            if (msg.isNoteOn()) {\n                setActiveNotes(prev => new Set(prev).add(msg.getNoteNumber()));\n            } else if (msg.isNoteOff()) {\n                setActiveNotes(prev => {\n                    const next = new Set(prev);\n                    next.delete(msg.getNoteNumber());\n                    return next;\n                });\n            } else if (msg.isAllNotesOff() || msg.isAllSoundOff()) {\n                setActiveNotes(new Set());\n            }\n        };\n\n        midiEngine.addListener(handleMidi);\n        return () => midiEngine.removeListener(handleMidi);\n    }, []);\n\n    // Mouse interactions\n    const handleMouseNoteOn = useCallback((note: number) => {\n        midiEngine.sendImmediate(MidiMessage.noteOn(1, note, volume));\n        // We don't need to manually update activeNotes here, \n        // because the engine listener above handles it! Awesome architecture.\n    }, [volume]);\n\n    const handleMouseNoteOff = useCallback((note: number) => {\n        midiEngine.sendImmediate(MidiMessage.noteOff(1, note, 0));\n    }, []);\n\n    // Render keys\n    const keys = [];\n    let whiteIndex = 0;\n\n    for (let i = 0; i < NUM_KEYS; i++) {\n        const note = START_NOTE + i;\n        const _isBlack = isBlackKey(note);\n        const isActive = activeNotes.has(note);\n\n        if (_isBlack) {\n            keys.push(\n                <div\n                    key={note}\n                    onMouseDown={() => handleMouseNoteOn(note)}\n                    onMouseUp={() => handleMouseNoteOff(note)}\n                    onMouseLeave={() => { if (isActive) handleMouseNoteOff(note); }}\n                    className={`absolute z-10 w-6 h-24 border border-black/80 rounded-b shadow-[0_4px_10px_rgba(0,0,0,0.5)] cursor-pointer select-none transition-all duration-75`}\n                    style={{\n                        left: `${whiteIndex * 36 - 12}px`,\n                        background: isActive ? '#FF6B00' : 'linear-gradient(180deg, #333 0%, #111 100%)',\n                    }}\n                />\n            );\n        } else {\n            keys.push(\n                <div\n                    key={note}\n                    onMouseDown={() => handleMouseNoteOn(note)}\n                    onMouseUp={() => handleMouseNoteOff(note)}\n                    onMouseLeave={() => { if (isActive) handleMouseNoteOff(note); }}\n                    className={`absolute z-0 w-9 h-36 border border-[#222] rounded-b shadow-[0_4px_10px_rgba(0,0,0,0.3)] cursor-pointer select-none transition-all duration-75 flex items-end justify-center pb-2`}\n                    style={{\n                        left: `${whiteIndex * 36}px`,\n                        background: isActive ? '#FF8C00' : 'linear-gradient(180deg, #FFF 0%, #DDD 100%)',\n                    }}\n                >\n                    <span className={`text-[8px] font-bold ${isActive ? 'text-black/60' : 'text-black/30'}`}>\n                        {MidiMessage.getMidiNoteName(note)}\n                    </span>\n                </div>\n            );\n            whiteIndex++;\n        }\n    }\n\n    return (\n        <div className=\"flex flex-col gap-2 p-2 bg-[#1A1A1A] border border-white/10 rounded-lg w-fit\">\n            <div className=\"flex items-center justify-between px-2\">\n                <span className=\"text-[9px] font-black tracking-widest text-[#888] uppercase flex items-center gap-1\">\n                    <Settings2 size={10} />\n                    Virtual Keyboard\n                </span>\n\n                <div className=\"flex items-center gap-2\">\n                    <span className=\"text-[8px] font-mono text-[#666]\">VEL:</span>\n                    <input\n                        type=\"range\" min=\"1\" max=\"127\"\n                        value={volume} onChange={e => setVolume(Number(e.target.value))}\n                        className=\"w-20 h-1 accent-[#FF6B00] bg-white/10 rounded-full appearance-none\"\n                    />\n                </div>\n            </div>\n\n            <div className=\"relative h-36 mt-1\" style={{ width: `${whiteIndex * 36}px` }}>\n                {keys}\n            </div>\n        </div>\n    );\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Da Graba Studio — MIDI Input Selector\n * Dropdown to select the active hardware MIDI input device.\n */\nexport function MidiInputSelector() {\n    const [inputs, setInputs] = useState<MidiInputDef[]>([]);\n    const [activeId, setActiveId] = useState<string | null>(null);\n\n    useEffect(() => {\n        const handleDeviceChange = (inps: MidiInputDef[], currentId: string | null) => {\n            setInputs(inps);\n            setActiveId(currentId);\n        };\n\n        // Initialize Web MIDI on mount, then register listener\n        midiDeviceManager.initialize().then(() => {\n            midiDeviceManager.addListener(handleDeviceChange);\n            // Auto-connect if none is selected\n            if (!activeId) midiDeviceManager.autoConnect();\n        });\n\n        return () => midiDeviceManager.removeListener(handleDeviceChange);\n    }, [activeId]);\n\n    return (\n        <div className=\"flex items-center gap-2\">\n            <span className=\"text-[9px] font-black tracking-widest text-white/40 uppercase\">MIDI IN</span>\n            <select\n                className=\"bg-black/40 border border-white/10 text-white/70 text-[10px] uppercase font-bold tracking-wider px-2 py-1 rounded outline-none\"\n                value={activeId || ''}\n                onChange={(e) => midiDeviceManager.setActiveInput(e.target.value)}\n            >\n                <option value=\"\" disabled>No Device Selected</option>\n                {inputs.map(input => (\n                    <option key={input.id} value={input.id}>{input.name}</option>\n                ))}\n            </select>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 10247, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/ui/PlanLock.tsx"],"sourcesContent":["'use client';\n\nimport React from 'react';\nimport { Lock, Crown, Star, ArrowRight } from 'lucide-react';\nimport { useRouter } from 'next/navigation';\nimport { useLocale } from 'next-intl';\n\ninterface PlanLockProps {\n    requiredPlan: 'pro' | 'premium';\n    featureName: string;\n}\n\nexport const PlanLock = ({ requiredPlan, featureName }: PlanLockProps) => {\n    const router = useRouter();\n    const locale = useLocale();\n\n    const isPremium = requiredPlan === 'premium';\n\n    return (\n        <div className=\"fixed inset-0 z-[100] flex items-center justify-center p-6 bg-black/60 backdrop-blur-xl animate-in fade-in duration-700\">\n            <div className=\"max-w-md w-full bg-[#0A0A0C] border border-white/5 rounded-[32px] p-10 flex flex-col items-center text-center shadow-2xl relative overflow-hidden group\">\n                {/* Decorative Glow */}\n                <div className={`absolute -top-24 -left-24 w-48 h-48 blur-[100px] opacity-20 rounded-full transition-colors duration-1000 ${isPremium ? 'bg-orange-500' : 'bg-cyan-glow'}`} />\n                <div className={`absolute -bottom-24 -right-24 w-48 h-48 blur-[100px] opacity-20 rounded-full transition-colors duration-1000 ${isPremium ? 'bg-orange-500' : 'bg-cyan-glow'}`} />\n\n                {/* Icon Container */}\n                <div className={`w-20 h-20 rounded-3xl mb-8 flex items-center justify-center relative ${isPremium ? 'bg-orange-500/10 text-orange-500' : 'bg-cyan-glow/10 text-cyan-glow'}`}>\n                    <div className=\"absolute inset-0 rounded-3xl blur-2xl opacity-50 bg-inherit\" />\n                    {isPremium ? <Crown size={32} className=\"relative z-10\" /> : <Star size={32} className=\"relative z-10\" />}\n                    <div className=\"absolute -top-2 -right-2 w-8 h-8 bg-black border border-white/10 rounded-full flex items-center justify-center translate-x-1 -translate-y-1 shadow-lg\">\n                        <Lock size={12} className=\"text-white/40\" />\n                    </div>\n                </div>\n\n                {/* Text Content */}\n                <h2 className=\"text-2xl font-black text-white tracking-tighter mb-4 uppercase\">\n                    {featureName} <span className={isPremium ? 'text-orange-500' : 'text-cyan-glow'}>Locked</span>\n                </h2>\n                <p className=\"text-silver-dark text-sm leading-relaxed mb-10 px-4\">\n                    The {featureName} is a professional tool reserved for our <span className=\"text-white font-bold\">{requiredPlan.toUpperCase()}</span> members. Upgrade now to unlock your full sonic potential.\n                </p>\n\n                {/* Action Buttons */}\n                <div className=\"w-full flex flex-col gap-3\">\n                    <button\n                        onClick={() => router.push(`/${locale}/pricing`)}\n                        className={`w-full py-4 rounded-2xl font-black uppercase tracking-widest text-[10px] flex items-center justify-center gap-2 transition-all group/btn ${isPremium\n                                ? 'bg-orange-600 text-white hover:bg-orange-500 shadow-[0_10px_30px_rgba(255,107,0,0.2)]'\n                                : 'bg-cyan-glow text-black hover:bg-white shadow-[0_10px_30px_rgba(0,240,255,0.2)]'\n                            }`}\n                    >\n                        Explore {requiredPlan.toUpperCase()} Plans\n                        <ArrowRight size={14} className=\"group-hover/btn:translate-x-1 transition-transform\" />\n                    </button>\n                    <button\n                        onClick={() => router.back()}\n                        className=\"w-full py-4 rounded-2xl font-bold uppercase tracking-widest text-[10px] text-white/40 hover:text-white transition-colors\"\n                    >\n                        Back to Safety\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n};\n"],"names":[],"mappings":";;;;;AAGA;AAAA;AAAA;AAAA;AACA;AACA;;;AALA;;;;AAYO,MAAM,WAAW,CAAC,EAAE,YAAY,EAAE,WAAW,EAAiB;;IACjE,MAAM,SAAS,IAAA,qLAAS;IACxB,MAAM,SAAS,IAAA,qNAAS;IAExB,MAAM,YAAY,iBAAiB;IAEnC,qBACI,gOAAC;QAAI,WAAU;kBACX,cAAA,gOAAC;YAAI,WAAU;;8BAEX,gOAAC;oBAAI,WAAW,CAAC,yGAAyG,EAAE,YAAY,kBAAkB,gBAAgB;;;;;;8BAC1K,gOAAC;oBAAI,WAAW,CAAC,6GAA6G,EAAE,YAAY,kBAAkB,gBAAgB;;;;;;8BAG9K,gOAAC;oBAAI,WAAW,CAAC,qEAAqE,EAAE,YAAY,qCAAqC,kCAAkC;;sCACvK,gOAAC;4BAAI,WAAU;;;;;;wBACd,0BAAY,gOAAC,mPAAK;4BAAC,MAAM;4BAAI,WAAU;;;;;qFAAqB,gOAAC,gPAAI;4BAAC,MAAM;4BAAI,WAAU;;;;;;sCACvF,gOAAC;4BAAI,WAAU;sCACX,cAAA,gOAAC,gPAAI;gCAAC,MAAM;gCAAI,WAAU;;;;;;;;;;;;;;;;;8BAKlC,gOAAC;oBAAG,WAAU;;wBACT;wBAAY;sCAAC,gOAAC;4BAAK,WAAW,YAAY,oBAAoB;sCAAkB;;;;;;;;;;;;8BAErF,gOAAC;oBAAE,WAAU;;wBAAsD;wBAC1D;wBAAY;sCAAyC,gOAAC;4BAAK,WAAU;sCAAwB,aAAa,WAAW;;;;;;wBAAU;;;;;;;8BAIxI,gOAAC;oBAAI,WAAU;;sCACX,gOAAC;4BACG,SAAS,IAAM,OAAO,IAAI,CAAC,CAAC,CAAC,EAAE,OAAO,QAAQ,CAAC;4BAC/C,WAAW,CAAC,yIAAyI,EAAE,YAC7I,0FACA,mFACJ;;gCACT;gCACY,aAAa,WAAW;gCAAG;8CACpC,gOAAC,sQAAU;oCAAC,MAAM;oCAAI,WAAU;;;;;;;;;;;;sCAEpC,gOAAC;4BACG,SAAS,IAAM,OAAO,IAAI;4BAC1B,WAAU;sCACb;;;;;;;;;;;;;;;;;;;;;;;AAOrB;GApDa;;QACM,qLAAS;QACT,qNAAS;;;KAFf"}},
    {"offset": {"line": 10441, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/app/%5Blocale%5D/studio/page.tsx"],"sourcesContent":["'use client';\n\nimport { useDAWStore } from '@/store/useDAWStore';\nimport { Fader } from '@/components/daw/Fader';\nimport { AudioTimeline } from '@/components/daw/AudioTimeline';\nimport { DawTrackControl } from '@/components/daw/DawTrackControl';\nimport { PianoRoll } from '@/components/daw/PianoRoll';\nimport { TransportBar } from '@/components/daw/TransportBar';\nimport { SpectrumAnalyzer } from '@/components/daw/SpectrumAnalyzer';\nimport { StudioChat } from '@/components/daw/StudioChat';\nimport { Activity, Layers } from 'lucide-react';\nimport { PluginWindow } from '@/components/daw/PluginWindow';\nimport { TrackTypeModal } from '@/components/daw/TrackTypeModal';\nimport { StemExtractModal } from '@/components/daw/StemExtractModal';\nimport { DrumPadMidi } from '@/components/daw/DrumPadMidi';\nimport { MidiKeyboardComponent } from '@/components/daw/MidiKeyboardComponent';\nimport { useUserStore } from '@/store/useUserStore';\nimport { PlanLock } from '@/components/ui/PlanLock';\nimport { useState, useEffect } from 'react';\n\nexport default function Studio() {\n    const plan = useUserStore((state) => state.plan);\n    const faders = useDAWStore((state) => state.faders);\n    const tracks = useDAWStore((state) => state.tracks);\n    const addTrack = useDAWStore((state) => state.addTrack);\n    const isTraining = useDAWStore((state) => state.isTraining);\n    const activeBottomPanel = useDAWStore((state) => state.activeBottomPanel);\n    const mixerBank = useDAWStore((state) => state.mixerBank);\n    const setMixerBank = useDAWStore((state) => state.setMixerBank);\n    const isFullMixer = useDAWStore((state) => state.isFullMixer);\n    const [showTrackModal, setShowTrackModal] = useState(false);\n    const [showStemModal, setShowStemModal] = useState(false);\n    const [hasHydrated, setHasHydrated] = useState(false);\n\n    useEffect(() => {\n        setHasHydrated(true);\n    }, []);\n\n    const openPluginIds = useDAWStore((state) => state.openPluginIds);\n    const closePlugin = useDAWStore((state) => state.closePlugin);\n\n    if (!hasHydrated) return null;\n\n    // PLAN GUARD: Studio requires at least 'pro'\n    if (plan === 'free') {\n        return <PlanLock requiredPlan=\"pro\" featureName=\"AI Production Studio\" />;\n    }\n\n    // Every track has a corresponding fader with same ID\n    const activeFaders = faders;\n\n    return (\n        <div className=\"flex flex-col h-full w-full pointer-events-auto bg-[#0A0A0C]\">\n\n            {/* TOP HEADER: Pro Tools / Logic Transport Bar */}\n            <TransportBar />\n\n            {/* CENTER: Audio Timeline & Track Control Column */}\n            <div className={`flex w-full px-8 py-2 gap-4 z-20 max-w-[2000px] mx-auto overflow-hidden transition-all duration-300 ${isFullMixer ? 'absolute -top-[9999px] opacity-0 h-0 pointer-events-none' : (activeBottomPanel !== 'closed' ? 'min-h-[250px] flex-1' : 'flex-1 h-full pb-8')\n                }`}>\n                {/* Left Column: Track Controls */}\n                <div className=\"w-[200px] bg-[#111113]/80 backdrop-blur-md border border-[#333] flex flex-col overflow-y-auto shadow-2xl rounded-md shrink-0 py-4 custom-scrollbar\">\n                    {tracks.map((track) => (\n                        <DawTrackControl key={track.id} trackId={track.id} trackName={track.name} color={track.color} />\n                    ))}\n\n                    {/* Extract Stems button */}\n                    <button\n                        onClick={() => setShowStemModal(true)}\n                        className=\"mt-4 mx-4 py-2 rounded bg-gradient-to-r from-cyan-600/20 to-blue-600/20 border border-cyan-500/30 text-cyan-400 hover:from-cyan-600/30 hover:to-blue-600/30 hover:border-cyan-400/50 transition-all text-[10px] font-black tracking-widest flex items-center justify-center gap-2\"\n                    >\n                        <Layers size={12} /> EXTRAER STEMS\n                    </button>\n\n                    <button\n                        onClick={() => setShowTrackModal(true)}\n                        className=\"mt-2 mx-4 py-2 border border-dashed border-[#444] rounded text-[#888] hover:text-white hover:border-[#888] transition-colors text-xs font-bold tracking-widest flex items-center justify-center gap-2\"\n                    >\n                        + NEW TRACK\n                    </button>\n                </div>\n\n                {/* Main Timeline Canvas */}\n                <div className=\"flex-1 bg-[#1A1A1C]/90 backdrop-blur-md relative border border-[#333] shadow-2xl rounded-md overflow-hidden\">\n                    <AudioTimeline />\n                </div>\n            </div>\n\n            {/* BOTTOM: Conditional Workspace Panel */}\n            {activeBottomPanel !== 'closed' && (\n                <div className={`w-full mt-auto flex flex-col items-center justify-end z-10 pb-0 overflow-hidden transition-all duration-300 ${isFullMixer ? 'h-full' : (activeBottomPanel === 'piano_roll' ? 'h-[60vh]' : 'h-[400px]')\n                    }`}>\n\n                    {/* MIXER VIEW - RESTORED AND SYNCED */}\n                    {activeBottomPanel === 'mixer' && (\n                        <div className=\"flex flex-col items-center w-full z-20\">\n                            {/* Fast Feedback: Spectrum Analyzer */}\n                            <div className=\"w-full max-w-5xl h-[100px] mb-2 px-8 relative z-30\">\n                                <div className=\"absolute inset-0 bg-black/40 backdrop-blur-xl border border-white/5 rounded-xl overflow-hidden\">\n                                    <SpectrumAnalyzer />\n                                </div>\n                            </div>\n\n                            {/* Mixer Strip */}\n                            <div className=\"w-full bg-[#111] border-t border-[#333] relative overflow-x-auto custom-scrollbar shadow-[0_-10px_40px_rgba(0,0,0,0.6)]\">\n                                {faders.length === 0 ? (\n                                    <div className=\"flex flex-col items-center justify-center py-10 opacity-30 gap-2\">\n                                        <Layers size={20} />\n                                        <p className=\"text-[10px] font-bold tracking-widest uppercase\">Console Empty</p>\n                                    </div>\n                                ) : (\n                                    <div className=\"min-w-fit mx-auto flex justify-center py-6 px-10 relative z-10 bg-gradient-to-b from-[#151517] to-[#0A0A0C]\">\n                                        <div className=\"flex gap-2 w-full justify-center\">\n                                            {activeFaders.map((fader) => (\n                                                <Fader key={fader.id} id={fader.id} />\n                                            ))}\n                                        </div>\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n                    )}\n\n                    {/* PIANO ROLL VIEW */}\n                    {activeBottomPanel === 'piano_roll' && (\n                        <div className=\"w-full h-full relative z-20 transform-none\">\n                            <PianoRoll />\n                        </div>\n                    )}\n\n                    {/* DRUM PAD MIDI VIEW */}\n                    {activeBottomPanel === 'drums' && (\n                        <div className=\"w-full h-full relative z-20 p-4\">\n                            <DrumPadMidi />\n                        </div>\n                    )}\n\n                    {/* VIRTUAL KEYBOARD (KEYS) VIEW */}\n                    {activeBottomPanel === 'keys' && (\n                        <div className=\"w-full h-full relative z-20 p-4 flex justify-center\">\n                            <MidiKeyboardComponent />\n                        </div>\n                    )}\n                </div>\n            )}\n\n            {/* FULLSCREEN TRAINING / PROCESSING OVERLAY */}\n            {isTraining && (\n                <div className=\"fixed inset-0 z-50 flex flex-col items-center justify-center bg-black/80 backdrop-blur-md pointer-events-auto\">\n                    {/* The spectacular glowing DG Logo */}\n                    <div className=\"w-64 h-64 rounded-full relative flex items-center justify-center shadow-[0_0_100px_rgba(255,107,0,0.8)] animate-pulse overflow-hidden border border-orange-500/30\">\n                        {/* Outer spinner ring */}\n                        <div className=\"absolute inset-0 border-8 border-t-white border-r-transparent border-b-white/10 border-l-transparent rounded-full animate-spin z-10\" />\n                        <img src=\"/logo_circular.png\" alt=\"DA GRABA Loading Logo\" className=\"w-full h-full object-cover scale-110\" />\n                    </div>\n\n                    <div className=\"mt-8 flex flex-col items-center gap-2\">\n                        <div className=\"flex items-center gap-3\">\n                            <Activity size={16} className=\"text-primary animate-bounce\" />\n                            <h2 className=\"text-xl font-bold tracking-widest text-[#E0E0E0]\">PROCESANDO EN MODAL</h2>\n                        </div>\n                        <p className=\"text-silver-dark text-sm font-mono tracking-wide max-w-sm text-center\">\n                            Aplicando clonación vocal y auto-mezclando niveles en la consola...\n                        </p>\n                    </div>\n                </div>\n            )}\n\n            {/* AI PRODUCTION CHAT */}\n            <StudioChat />\n\n            {/* FLOATING PLUGIN WINDOWS */}\n            {openPluginIds.map((insertId) => {\n                // Find which fader/track this insert belongs to\n                const fader = faders.find(f => f.inserts.some(i => i.id === insertId));\n                const insert = fader?.inserts.find(i => i.id === insertId);\n\n                if (!fader || !insert) return null;\n\n                return (\n                    <PluginWindow\n                        key={insertId}\n                        trackId={fader.id}\n                        insert={insert}\n                        onClose={() => closePlugin(insertId)}\n                    />\n                );\n            })}\n\n            {/* TRACK TYPE MODAL */}\n            {showTrackModal && (\n                <TrackTypeModal\n                    onSelect={(type, name) => {\n                        addTrack(name, undefined, type);\n                        setShowTrackModal(false);\n                    }}\n                    onClose={() => setShowTrackModal(false)}\n                />\n            )}\n\n            {/* STEM EXTRACT MODAL */}\n            {showStemModal && (\n                <StemExtractModal onClose={() => setShowStemModal(false)} />\n            )}\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}}]
}