{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/StudioChat.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useRef, useEffect, useCallback } from 'react';\nimport { Send, Sparkles, Wand2, Mic2, Scissors, PlayCircle, ChevronRight, MessageSquare, Mic, MicOff, Volume2 } from 'lucide-react';\nimport { useDAWStore } from '@/store/useDAWStore';\n\n// Type definition for Web Speech API\ninterface SpeechRecognition extends EventTarget {\n    continuous: boolean;\n    interimResults: boolean;\n    lang: string;\n    start(): void;\n    stop(): void;\n    onresult: (event: any) => void;\n    onerror: (event: any) => void;\n    onend: () => void;\n}\n\ndeclare global {\n    interface Window {\n        webkitSpeechRecognition: any;\n        SpeechRecognition: any;\n    }\n}\n\nexport function StudioChat({ embedded = false }: { embedded?: boolean }) {\n    const addTrack = useDAWStore((state) => state.addTrack);\n    const setTracks = useDAWStore((state) => state.setTracks);\n    const clearTracks = useDAWStore((state) => state.clearTracks);\n    const tracks = useDAWStore((state) => state.tracks);\n\n    const [isOpen, setIsOpen] = useState(false);\n    const [input, setInput] = useState('');\n    const [messages, setMessages] = useState<{ role: 'user' | 'assistant', content: string }[]>([\n        { role: 'assistant', content: '¡Estamos en el studio! El plan está listo. ¿Quieres que genere la primera mitad de los instrumentos o prefieres grabar algo tú primero?' }\n    ]);\n    const [isTyping, setIsTyping] = useState(false);\n    const [isListening, setIsListening] = useState(false);\n    const [isSpeaking, setIsSpeaking] = useState(false);\n\n    const scrollRef = useRef<HTMLDivElement>(null);\n    const recognitionRef = useRef<SpeechRecognition | null>(null);\n    const audioRef = useRef<HTMLAudioElement | null>(null);\n\n    useEffect(() => {\n        if (scrollRef.current) {\n            scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n        }\n    }, [messages]);\n\n    // Initialize Speech Recognition\n    useEffect(() => {\n        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n        if (SpeechRecognition) {\n            const recognition = new SpeechRecognition();\n            recognition.continuous = true;\n            recognition.interimResults = false;\n            recognition.lang = 'es-ES';\n\n            recognition.onresult = (event: any) => {\n                const transcript = event.results[event.results.length - 1][0].transcript;\n                if (transcript.trim()) {\n                    handleVoiceInput(transcript);\n                }\n            };\n\n            recognition.onerror = (event: any) => {\n                console.error('Speech recognition error', event.error);\n                setIsListening(false);\n            };\n\n            recognition.onend = () => {\n                if (isListening) recognition.start(); // Auto-restart if it should be listening\n            };\n\n            recognitionRef.current = recognition;\n        }\n    }, [isListening]);\n\n    const playJohnVoice = async (text: string) => {\n        try {\n            setIsSpeaking(true);\n            const response = await fetch('/api/ai/tts', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ text })\n            });\n\n            if (!response.ok) throw new Error('Failed to fetch voice');\n\n            const blob = await response.blob();\n            const url = URL.createObjectURL(blob);\n\n            if (audioRef.current) {\n                audioRef.current.src = url;\n                audioRef.current.play();\n            } else {\n                const audio = new Audio(url);\n                audioRef.current = audio;\n                audio.play();\n            }\n\n            audioRef.current!.onended = () => {\n                setIsSpeaking(false);\n                URL.revokeObjectURL(url);\n            };\n        } catch (error) {\n            console.error('TTS Error:', error);\n            setIsSpeaking(false);\n        }\n    };\n\n    const triggerGeneration = () => {\n        setIsTyping(true);\n        setTimeout(() => {\n            const demoTracks = [\n                { id: 't-beat', name: 'Dark Trap Beat (AI)', color: '#FF6B00' },\n                { id: 't-808', name: 'Heavy 808 Sub', color: '#B026FF' },\n                { id: 't-melody', name: 'Dark Piano Melody', color: '#00F0FF' },\n                { id: 't-perch', name: 'Percussion Loop', color: '#A4ECA1' }\n            ];\n            setTracks(demoTracks);\n            const msg = \"¡Listo! He abierto los tracks en el espacio de trabajo como por arte de magia. He configurado la batería, el bajo y la melodía principal. ¿Escuchamos esta primera parte?\";\n            setMessages(prev => [...prev, { role: 'assistant', content: msg }]);\n            setIsTyping(false);\n            playJohnVoice(msg);\n        }, 1500);\n    };\n\n    const handleSend = async (forcedInput?: string) => {\n        const textToSend = forcedInput || input;\n        if (!textToSend.trim() || isTyping) return;\n\n        setInput('');\n        setMessages(prev => [...prev, { role: 'user', content: textToSend }]);\n\n        const lowInput = textToSend.toLowerCase();\n        if (lowInput.includes('genera') || lowInput.includes('mitad') || lowInput.includes('abre')) {\n            triggerGeneration();\n            return;\n        }\n\n        setIsTyping(true);\n        try {\n            const history = messages.map(m => ({ role: m.role, content: m.content }));\n            const response = await fetch('/api/ai/engineer', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ message: textToSend, history })\n            });\n\n            if (!response.ok) throw new Error('Failed to fetch AI response');\n\n            const data = await response.json();\n            const aiMessage = data.message;\n\n            setMessages(prev => [...prev, { role: 'assistant', content: aiMessage }]);\n            setIsTyping(false);\n            playJohnVoice(aiMessage);\n        } catch (error) {\n            console.error('AI Error:', error);\n            const errorMsg = \"Lo siento, John tiene problemas de conexión ahora mismo. Pero sigo aquí.\";\n            setMessages(prev => [...prev, { role: 'assistant', content: errorMsg }]);\n            setIsTyping(false);\n        }\n    };\n\n    const handleVoiceInput = (transcript: string) => {\n        handleSend(transcript);\n    };\n\n    const toggleListening = () => {\n        if (isListening) {\n            recognitionRef.current?.stop();\n            setIsListening(false);\n        } else {\n            recognitionRef.current?.start();\n            setIsListening(true);\n        }\n    };\n\n    return (\n        <div className={embedded ? \"w-full h-full\" : `fixed right-8 bottom-32 z-50 transition-all duration-500 flex flex-col items-end ${isOpen ? 'w-80 h-[450px]' : 'w-12 h-12'}`}>\n\n            {/* TOGGLE BUTTON - Only show if not embedded */}\n            {!embedded && (\n                <div className=\"flex flex-col gap-3\">\n                    <button\n                        onClick={toggleListening}\n                        className={`w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300 shadow-2xl ${isListening ? 'bg-red-500 animate-pulse glow-red' : 'bg-white/5 border border-white/10 hover:bg-white/10'}`}\n                    >\n                        {isListening ? <Mic className=\"text-white\" size={20} /> : <MicOff className=\"text-silver-dark\" size={20} />}\n                    </button>\n\n                    <button\n                        onClick={() => setIsOpen(!isOpen)}\n                        className={`w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300 shadow-2xl ${isOpen ? 'bg-orange-600 scale-90' : 'bg-gradient-to-br from-cyan-glow to-blue-600 glow-cyan hover:scale-110'}`}\n                    >\n                        {isOpen ? <ChevronRight className=\"text-white\" /> : <MessageSquare className=\"text-white\" />}\n                    </button>\n                </div>\n            )}\n\n            {/* CHAT WINDOW */}\n            <div className={`${embedded ? 'w-full h-full' : 'mt-4 w-full h-full'} bg-[#0B1015]/95 backdrop-blur-xl border border-white/10 rounded-2xl flex flex-col overflow-hidden shadow-[0_20px_50px_rgba(0,0,0,0.5)] transition-opacity duration-300 ${embedded || isOpen ? 'opacity-100' : 'opacity-0 pointer-events-none'}`}>\n\n                {/* Header */}\n                <div className=\"px-4 py-3 border-b border-white/5 bg-white/5 flex items-center justify-between\">\n                    <div className=\"flex items-center gap-2\">\n                        <Sparkles size={16} className=\"text-cyan-glow\" />\n                        <span className=\"text-xs font-bold tracking-widest text-[#E0E0E0]\">ENGINEER FEEDBACK</span>\n                    </div>\n                    {isSpeaking && <Volume2 size={14} className=\"text-cyan-glow animate-pulse\" />}\n                </div>\n\n                {/* Messages Panel */}\n                <div ref={scrollRef} className=\"flex-1 overflow-y-auto p-4 flex flex-col gap-4 custom-scrollbar\">\n                    {messages.map((m, i) => (\n                        <div key={i} className={`flex flex-col ${m.role === 'user' ? 'items-end' : 'items-start'}`}>\n                            <div className={`max-w-[85%] px-3 py-2 rounded-xl text-xs leading-relaxed ${m.role === 'user'\n                                ? 'bg-orange-600/20 border border-orange-500/30 text-white'\n                                : 'bg-white/5 border border-white/10 text-silver-light'\n                                }`}>\n                                {m.content}\n                            </div>\n                        </div>\n                    ))}\n                    {isTyping && (\n                        <div className=\"flex gap-1 ml-2\">\n                            <div className=\"w-1.5 h-1.5 bg-cyan-glow rounded-full animate-bounce\" />\n                            <div className=\"w-1.5 h-1.5 bg-cyan-glow rounded-full animate-bounce [animation-delay:0.2s]\" />\n                            <div className=\"w-1.5 h-1.5 bg-cyan-glow rounded-full animate-bounce [animation-delay:0.4s]\" />\n                        </div>\n                    )}\n                </div>\n\n                {/* Quick Actions */}\n                <div className=\"px-3 py-2 flex gap-2 overflow-x-auto border-t border-white/5 bg-black/20 no-scrollbar\">\n                    <button\n                        onClick={triggerGeneration}\n                        className=\"whitespace-nowrap flex items-center gap-1.5 px-2 py-1 rounded bg-white/5 border border-white/10 text-[10px] text-silver-dark hover:text-cyan-glow transition-colors\"\n                    >\n                        <Wand2 size={10} /> Generar Mitad\n                    </button>\n                    <button className=\"whitespace-nowrap flex items-center gap-1.5 px-2 py-1 rounded bg-white/5 border border-white/10 text-[10px] text-silver-dark hover:text-white transition-colors\">\n                        <PlayCircle size={10} /> Continuar\n                    </button>\n                    <button\n                        onClick={clearTracks}\n                        className=\"whitespace-nowrap flex items-center gap-1.5 px-2 py-1 rounded bg-white/5 border border-white/10 text-[10px] text-red-400 hover:text-red-300 transition-colors\"\n                    >\n                        <Scissors size={10} /> Limpiar Todo\n                    </button>\n                    <button className=\"whitespace-nowrap flex items-center gap-1.5 px-2 py-1 rounded bg-white/5 border border-white/10 text-[10px] text-silver-dark hover:text-white transition-colors\">\n                        <Mic2 size={10} /> Grabar Hum\n                    </button>\n                </div>\n\n                {/* Input Area */}\n                <div className=\"p-3 bg-black/40 flex items-center gap-2\">\n                    <input\n                        type=\"text\"\n                        value={input}\n                        onChange={(e) => setInput(e.target.value)}\n                        onKeyDown={(e) => e.key === 'Enter' && handleSend()}\n                        placeholder={isListening ? \"Te escucho...\" : \"Dime qué sigue...\"}\n                        className=\"flex-1 bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-xs text-white placeholder:text-gray-600 focus:outline-none focus:border-cyan-glow/50 transition-colors\"\n                    />\n                    <button\n                        onClick={() => handleSend()}\n                        className=\"p-2 bg-orange-600 rounded-lg hover:bg-orange-500 transition-colors shadow-lg\"\n                    >\n                        <Send size={14} className=\"text-white\" />\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 507, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/lib/utils.ts"],"sourcesContent":["import { type ClassValue, clsx } from 'clsx';\nimport { twMerge } from 'tailwind-merge';\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,yMAAO,EAAC,IAAA,gLAAI,EAAC;AACtB"}},
    {"offset": {"line": 522, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/SpectrumAnalyzer.tsx"],"sourcesContent":["'use client';\n\nimport React, { useEffect, useRef } from 'react';\nimport { cn } from '@/lib/utils';\nimport { useDAWStore } from '@/store/useDAWStore';\n\ninterface SpectrumAnalyzerProps {\n    analyzer?: AnalyserNode; // Optional: If provided, uses real audio data\n    naked?: boolean; // If true, removes background and border\n}\n\nexport function SpectrumAnalyzer({ analyzer, naked }: SpectrumAnalyzerProps) {\n    const isPlaying = useDAWStore((state) => state.isPlaying);\n    const canvasRef = useRef<HTMLCanvasElement>(null);\n    const requestRef = useRef<number>(0);\n\n    // Smooth falloff state holding the max peaks\n    const peaksRef = useRef<number[]>([]);\n\n    useEffect(() => {\n        const canvas = canvasRef.current;\n        if (!canvas) return;\n\n        const ctx = canvas.getContext('2d');\n        if (!ctx) return;\n\n        // Ensure canvas renders sharply on high-DPI displays\n        const scale = window.devicePixelRatio || 1;\n        canvas.width = canvas.clientWidth * scale;\n        canvas.height = canvas.clientHeight * scale;\n        ctx.scale(scale, scale);\n\n        const width = canvas.clientWidth;\n        const height = canvas.clientHeight;\n\n        let dataArray: Uint8Array;\n        let bufferLength = 128; // Default if no analyzer\n\n        if (analyzer) {\n            bufferLength = analyzer.frequencyBinCount;\n            dataArray = new Uint8Array(bufferLength);\n        } else {\n            dataArray = new Uint8Array(bufferLength);\n        }\n\n        // Initialize peaks array\n        if (peaksRef.current.length !== bufferLength) {\n            peaksRef.current = new Array(bufferLength).fill(0);\n        }\n\n        const renderFrame = () => {\n            requestRef.current = requestAnimationFrame(renderFrame);\n\n            if (!isPlaying) {\n                // Dim the display when not playing\n                ctx.clearRect(0, 0, canvas.width, canvas.height);\n                // Slowly decay any existing peaks\n                peaksRef.current = peaksRef.current.map(p => p * 0.9);\n\n                // Draw static low baseline\n                const barWidth = Math.ceil(canvas.width / bufferLength);\n                for (let i = 0; i < bufferLength; i++) {\n                    const x = i * barWidth;\n                    ctx.fillStyle = `rgba(255, 107, 0, 0.05)`;\n                    ctx.fillRect(x, canvas.height - 2, barWidth - 1, 2);\n                }\n                return;\n            }\n\n            // Get audio data\n            if (analyzer) {\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                analyzer.getByteFrequencyData(dataArray as any);\n            } else {\n                // Simulate data for visual placeholder\n                const time = Date.now() / 1000;\n                for (let i = 0; i < bufferLength; i++) {\n                    // Create some dynamic peaks that look like music\n                    const noise = Math.random() * 20;\n                    const wave1 = Math.sin(time * 2 + i * 0.1) * 50 + 50;\n                    const wave2 = Math.cos(time * 5 - i * 0.3) * 60 + 60;\n\n                    // Emphasize bass (lower indices)\n                    const bassBoost = i < 20 ? (20 - i) * 3 : 0;\n\n                    // Attenuate highs\n                    const highCut = i > 80 ? (i - 80) * 2 : 0;\n\n                    let val = (wave1 + wave2) / 2 + noise + bassBoost - highCut;\n\n                    // Occasional random spikes (like kick/snare)\n                    if (Math.random() > 0.95 && i < 40) val += 80;\n\n                    dataArray[i] = Math.max(0, Math.min(255, val));\n                }\n            }\n\n            // Clear canvas\n            ctx.clearRect(0, 0, width, height);\n\n            // Calculate bar width (leaving some gap)\n            // We use a subset of the buffer for better aesthetics (skipping the very highest dead frequencies)\n            const displayBins = Math.floor(bufferLength * 0.7);\n            const barWidth = (width / displayBins) - 1; // 1px gap\n            let x = 0;\n\n            const peaks = peaksRef.current;\n            const gravity = 1.5; // Speed at which peaks fall\n\n            for (let i = 0; i < displayBins; i++) {\n                const value = dataArray[i];\n\n                // Update peak for smooth falloff\n                if (value > peaks[i]) {\n                    peaks[i] = value;\n                } else {\n                    peaks[i] = Math.max(0, peaks[i] - gravity);\n                }\n\n                // Normalize values to canvas height\n                const barHeight = (value / 255) * height;\n                const peakHeight = (peaks[i] / 255) * height;\n\n                // --- Draw Main Bar ---\n                // Gradient from Metallic Gray to DA GRABA Naranja (#FF6B00)\n                const barGradient = ctx.createLinearGradient(0, height, 0, height - barHeight);\n                barGradient.addColorStop(0, '#5A5A60');      // Metallic gray base\n                barGradient.addColorStop(0.5, '#8C8C91');    // Lighter gray middle\n                barGradient.addColorStop(1, '#FF6B00');      // Orange peak\n\n                ctx.fillStyle = barGradient;\n                ctx.fillRect(x, height - barHeight, barWidth, barHeight);\n\n                // --- Draw Floating Peak (Cap) ---\n                // To enhance the 2D/3D feel, draw a bright cap at the peak level\n                ctx.fillStyle = '#FF9A4A'; // Slightly brighter orange for the cap\n                ctx.fillRect(x, height - peakHeight - 2, barWidth, 2);\n\n                x += barWidth + 1;\n            }\n        };\n\n        renderFrame();\n\n        return () => {\n            if (requestRef.current) {\n                cancelAnimationFrame(requestRef.current);\n            }\n        };\n    }, [analyzer]);\n\n    return (\n        <div className={cn(\n            \"w-full h-full relative p-2 overflow-hidden\",\n            !naked && \"bg-[#111113]/60 backdrop-blur-md rounded-lg border border-[#333] shadow-[inset_0_0_20px_rgba(0,0,0,0.8)]\"\n        )}>\n            {/* Glassmorphism reflection highlight */}\n            <div className=\"absolute top-0 left-0 right-0 h-1/3 bg-gradient-to-b from-white/5 to-transparent pointer-events-none rounded-t-lg\" />\n\n            <canvas\n                ref={canvasRef}\n                className=\"w-full h-full block\"\n            />\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}}]
}