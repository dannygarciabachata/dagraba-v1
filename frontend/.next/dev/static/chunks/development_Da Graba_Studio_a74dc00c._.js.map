{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/lib/audio/WebAudioEngine.ts"],"sourcesContent":["export interface TrackChain {\n    input: GainNode;\n    inserts: AudioNode[];\n    gate?: DynamicsCompressorNode;\n    eqBands?: BiquadFilterNode[]; // [lowShelf, midPeak, highShelf, presencePeak]\n    compressor?: DynamicsCompressorNode;\n    makeup?: GainNode;\n    limiter?: DynamicsCompressorNode;\n    wasmLimiter?: AudioWorkletNode;\n    muteGain: GainNode; // Dedicated node for Mute/Solo\n    output: GainNode;\n    panner: StereoPannerNode;\n    analyser: AnalyserNode;\n    stemDSP?: {\n        splitter: ChannelSplitterNode;\n        merger: ChannelMergerNode;\n        midGain: GainNode;\n        sideGain: GainNode;\n        filters: BiquadFilterNode[];\n    };\n    source?: MediaElementAudioSourceNode | AudioBufferSourceNode;\n    isMuted: boolean;\n    isSoloed: boolean;\n}\n\nclass WebAudioEngine {\n    private ctx: AudioContext | null = null;\n    private masterGain: GainNode | null = null;\n    private trackChains: Map<string, TrackChain> = new Map();\n    private sourceNodeMap: WeakMap<HTMLMediaElement, MediaElementAudioSourceNode> = new WeakMap();\n    private isPlaying = false;\n    private playhead = 0;\n    private startTime = 0;\n    private soloedTracks: Set<string> = new Set();\n    private dspWorkletReady = false;\n\n    constructor() {\n        // We delay context creation until a user interaction (play)\n    }\n\n    public initContext() {\n        if (!this.ctx) {\n            this.ctx = new (window.AudioContext || (window as any).webkitAudioContext)();\n            this.masterGain = this.ctx.createGain();\n            this.masterGain.connect(this.ctx.destination);\n        }\n        if (this.ctx.state === 'suspended') {\n            this.ctx.resume();\n        }\n    }\n\n    private getOrCreateTrack(trackId: string): TrackChain {\n        this.initContext();\n        if (!this.trackChains.has(trackId)) {\n            const ctx = this.ctx!;\n            const input = ctx.createGain();\n            const muteGain = ctx.createGain();\n            const output = ctx.createGain();\n            const panner = ctx.createStereoPanner();\n            const analyser = ctx.createAnalyser();\n\n            analyser.fftSize = 256;\n\n            // Initial chain: Input -> Pan -> MuteGain -> Output -> Analyser -> Master\n            input.connect(panner);\n            panner.connect(muteGain);\n            muteGain.connect(output);\n            output.connect(analyser);\n            analyser.connect(this.masterGain!);\n\n            this.trackChains.set(trackId, {\n                input,\n                muteGain,\n                output,\n                panner,\n                analyser,\n                inserts: [],\n                isMuted: false,\n                isSoloed: false\n            });\n        }\n        return this.trackChains.get(trackId)!;\n    }\n\n    init(sampleRate: number, bufferSize: number) {\n        console.log(`[WebAudioEngine] Ready for initialization. context will start on play.`);\n        return true;\n    }\n\n    /**\n     * Loads the AudioWorklet for the WebAssembly C++ engine.\n     * To be called when the user wants to switch to the professional offline engine.\n     */\n    async loadWasmLimiter() {\n        this.initContext();\n        try {\n            await this.ctx!.audioWorklet.addModule('/wasm/phaselimiter-worklet.js');\n            console.log(\"[WebAudioEngine] WASM AudioWorklet module loaded successfully.\");\n            return true;\n        } catch (error) {\n            console.error(\"[WebAudioEngine] Failed to load WASM AudioWorklet module:\", error);\n            return false;\n        }\n    }\n\n    /**\n     * Loads the Da Graba professional DSP suite (Compressor, Saturator, EQ).\n     * Call once on user interaction. The worklet runs C++ WASM on the audio thread.\n     */\n    async loadDaGrabaDSP(): Promise<boolean> {\n        if (this.dspWorkletReady) return true;\n        this.initContext();\n        try {\n            await this.ctx!.audioWorklet.addModule('/wasm/dagraba-dsp-worklet.js');\n            this.dspWorkletReady = true;\n            console.log('[WebAudioEngine] Da Graba DSP WASM worklet loaded.');\n            return true;\n        } catch (error) {\n            console.error('[WebAudioEngine] Failed to load Da Graba DSP worklet:', error);\n            return false;\n        }\n    }\n\n    /**\n     * Insert a WASM DSP plugin on a track.\n     * plugin: 'compressor' | 'saturator' | 'eq'\n     * Returns the AudioWorkletNode for parameter control.\n     */\n    async insertWasmPlugin(trackId: string, plugin: 'compressor' | 'saturator' | 'eq'): Promise<AudioWorkletNode | null> {\n        await this.loadDaGrabaDSP();\n        if (!this.dspWorkletReady || !this.ctx) return null;\n\n        const chain = this.getOrCreateTrack(trackId);\n\n        const node = new AudioWorkletNode(this.ctx, 'dagraba-dsp-processor', {\n            processorOptions: { plugin },\n            numberOfInputs: 1,\n            numberOfOutputs: 1,\n            outputChannelCount: [2]\n        });\n\n        // Insert into chain: after input, before panner\n        // For simplicity, chain the worklet between input and panner\n        const prevLast = chain.inserts.length > 0 ? chain.inserts[chain.inserts.length - 1] : chain.input;\n        try { prevLast.disconnect(chain.panner); } catch (e) { }\n        prevLast.connect(node);\n        node.connect(chain.panner);\n        chain.inserts.push(node);\n\n        console.log(`[WebAudioEngine] Inserted WASM ${plugin} on track ${trackId}`);\n        return node;\n    }\n\n    play() {\n        if (this.isPlaying) return;\n        this.initContext();\n        this.isPlaying = true;\n        this.startTime = this.ctx!.currentTime - this.playhead;\n        console.log(`[WebAudioEngine] Playback started.`);\n    }\n\n    pause() {\n        this.isPlaying = false;\n        if (this.ctx) {\n            this.playhead = this.ctx.currentTime - this.startTime;\n        }\n        console.log(`[WebAudioEngine] Playback paused.`);\n    }\n\n    stop() {\n        this.isPlaying = false;\n        this.playhead = 0;\n        console.log(`[WebAudioEngine] Playback stopped.`);\n    }\n\n    setPlayheadPosition(seconds: number) {\n        this.playhead = seconds;\n        if (this.isPlaying && this.ctx) {\n            this.startTime = this.ctx.currentTime - seconds;\n        }\n    }\n\n    getPlayheadPosition() {\n        if (this.isPlaying && this.ctx) {\n            return this.ctx.currentTime - this.startTime;\n        }\n        return this.playhead;\n    }\n\n    setTrackVolume(trackId: string, value: number) {\n        // value 0-100 to gain 0-1\n        const chain = this.getOrCreateTrack(trackId);\n        const gainValue = value / 100;\n        chain.output.gain.setTargetAtTime(gainValue, this.ctx!.currentTime, 0.05);\n    }\n\n    setTrackPan(trackId: string, value: number) {\n        // value -50 to 50 to pan -1 to 1\n        const chain = this.getOrCreateTrack(trackId);\n        const panValue = value / 50;\n        chain.panner.pan.setTargetAtTime(panValue, this.ctx!.currentTime, 0.05);\n    }\n\n    setTrackMute(trackId: string, isMuted: boolean) {\n        const chain = this.getOrCreateTrack(trackId);\n        chain.isMuted = isMuted;\n        this.updateRoutingLevels();\n    }\n\n    setTrackSolo(trackId: string, isSolo: boolean) {\n        const chain = this.getOrCreateTrack(trackId);\n        chain.isSoloed = isSolo;\n\n        if (isSolo) {\n            this.soloedTracks.add(trackId);\n        } else {\n            this.soloedTracks.delete(trackId);\n        }\n\n        this.updateRoutingLevels();\n    }\n\n    private updateRoutingLevels() {\n        // A track is audible IF (no tracks are soloed OR it is soloed) AND (it is not muted)\n        const hasSolo = this.soloedTracks.size > 0;\n\n        this.trackChains.forEach((chain, id) => {\n            const shouldBeHeard = (hasSolo ? chain.isSoloed : true) && !chain.isMuted;\n            const targetGain = shouldBeHeard ? 1 : 0;\n            chain.muteGain.gain.setTargetAtTime(targetGain, this.ctx!.currentTime, 0.05);\n        });\n    }\n\n    moveAudioClip(clipId: string, newTime: number) {\n        // Dummy implementation\n    }\n\n    getWaveformData(clipId: string, arg2?: any): number[] {\n        // Dummy implementation\n        return [];\n    }\n\n    // New method to connect a real audio element (like in the mastering page)\n    connectAudioElement(trackId: string, element: HTMLMediaElement) {\n        this.initContext();\n        const chain = this.getOrCreateTrack(trackId);\n\n        // Disconnect previous source associated with this track chain to prevent accumulation\n        if (chain.source) {\n            try { chain.source.disconnect(); } catch (e) { }\n        }\n\n        let source = this.sourceNodeMap.get(element);\n        if (!source) {\n            try {\n                source = this.ctx!.createMediaElementSource(element);\n                this.sourceNodeMap.set(element, source);\n            } catch (e) {\n                console.warn('Failed to create media element source', e);\n                return;\n            }\n        }\n\n        try { source.disconnect(); } catch (e) { }\n        source.connect(chain.input);\n        chain.source = source;\n\n        // Apply automatic stem separation if URL contains stem parameter\n        const url = new URL(element.src, window.location.href);\n        let stemType = url.searchParams.get('stem');\n\n        // Handle proxy URL case where stem parameter is encoded inside the 'url' parameter\n        if (!stemType) {\n            const innerUrlStr = url.searchParams.get('url');\n            if (innerUrlStr) {\n                try {\n                    // Try to parse as URL\n                    const innerUrl = new URL(innerUrlStr, window.location.href);\n                    stemType = innerUrl.searchParams.get('stem');\n                } catch (e) {\n                    // Fallback to simple query string parsing if it's just a path\n                    const match = innerUrlStr.match(/[?&]stem=([^&]+)/);\n                    if (match) stemType = match[1];\n                }\n            }\n        }\n\n        if (stemType) {\n            this.applyStemSeparation(trackId, stemType);\n        }\n    }\n\n    private applyStemSeparation(trackId: string, type: string) {\n        const chain = this.getOrCreateTrack(trackId);\n        const ctx = this.ctx!;\n\n        // Clean up previous stem DSP if any\n        if (chain.stemDSP) {\n            try {\n                chain.input.disconnect(chain.stemDSP.splitter);\n                chain.stemDSP.merger.disconnect();\n                chain.stemDSP.filters.forEach(f => f.disconnect());\n            } catch (e) { }\n        }\n\n        const splitter = ctx.createChannelSplitter(2);\n        const merger = ctx.createChannelMerger(2);\n        const midGain = ctx.createGain();\n        const sideGain = ctx.createGain();\n        const filters: BiquadFilterNode[] = [];\n\n        // Mid-Side Logic for Separation\n        // Mid = (L + R) / 2\n        // Side = (L - R) / 2\n        const midInverter = ctx.createGain();\n        midInverter.gain.value = -1;\n\n        splitter.connect(midGain, 0); // L\n        splitter.connect(midGain, 1); // R\n        midGain.gain.value = 0.5;\n\n        splitter.connect(sideGain, 0); // L\n        splitter.connect(midInverter, 1); // -R\n        midInverter.connect(sideGain);\n        sideGain.gain.value = 0.5;\n\n        // Routing based on Stem Type\n        const dspOutput = ctx.createGain();\n\n        if (type === 'vocal') {\n            // Vocals are usually centered (Mid channel)\n            const hp = ctx.createBiquadFilter();\n            hp.type = 'highpass';\n            hp.frequency.value = 250;\n\n            const lp = ctx.createBiquadFilter();\n            lp.type = 'lowpass';\n            lp.frequency.value = 4000;\n\n            const peak = ctx.createBiquadFilter();\n            peak.type = 'peaking';\n            peak.frequency.value = 3000;\n            peak.gain.value = 3;\n\n            midGain.connect(hp);\n            hp.connect(lp);\n            lp.connect(peak);\n            peak.connect(dspOutput);\n            filters.push(hp, lp, peak);\n\n            // Kill sides for isolation\n            sideGain.gain.value = 0;\n        } else if (type === 'beat' || type === 'bajo') {\n            // Beat/Bass are Mid heavy but need different EQ\n            const lp = ctx.createBiquadFilter();\n            lp.type = 'lowpass';\n            lp.frequency.value = type === 'bajo' ? 200 : 800;\n\n            midGain.connect(lp);\n            lp.connect(dspOutput);\n            filters.push(lp);\n            sideGain.gain.value = 0.1; // Minimal sides\n        } else {\n            // Melody/FX are often panned or wide (Sides)\n            const hp = ctx.createBiquadFilter();\n            hp.type = 'highpass';\n            hp.frequency.value = 400;\n\n            sideGain.connect(hp);\n            hp.connect(dspOutput);\n            filters.push(hp);\n            midGain.gain.value = 0.3; // Low mid to avoid echo\n        }\n\n        // Connect chain: Input -> Splitter -> (Mid/Side processing) -> dspOutput -> Panner\n        chain.input.disconnect();\n        chain.input.connect(splitter);\n        dspOutput.connect(chain.panner);\n\n        chain.stemDSP = { splitter, merger, midGain, sideGain, filters };\n        console.log(`[WebAudioEngine] Applied SSE separation for stem: ${type} on track: ${trackId}`);\n    }\n\n    /**\n     * Performs an offline analysis of an audio file to determine its \"DNA\" (RMS, Peak, Crest Factor).\n     * Used by the AI to set accurate dynamic and loudness targets.\n     */\n    async analyzeAudioBuffer(audioUrl: string): Promise<{ rms: number, peak: number, crestFactor: number } | null> {\n        try {\n            console.log('[WebAudioEngine] Fetching audio for analysis...');\n            const response = await fetch(audioUrl);\n            const arrayBuffer = await response.arrayBuffer();\n\n            // Use an OfflineAudioContext just to decode (or use main ctx)\n            this.initContext();\n            console.log('[WebAudioEngine] Decoding audio data...');\n            const audioBuffer = await this.ctx!.decodeAudioData(arrayBuffer);\n\n            const channelData = audioBuffer.getChannelData(0); // Analyze left/mono channel for speed\n            let sumSquares = 0;\n            let peak = 0;\n\n            // Calculate RMS and Peak\n            console.log('[WebAudioEngine] Calculating RMS and Peak...');\n            const length = channelData.length;\n            const step = Math.max(1, Math.floor(length / 441000)); // Sample every ~100ms to speed up analysis if huge, or just process all if fast\n\n            // For true accuracy, process all samples, it's usually less than 100ms in a Wasm/V8 loop\n            for (let i = 0; i < length; i += 1) {\n                const sample = channelData[i];\n                const abs = Math.abs(sample);\n                sumSquares += sample * sample;\n                if (abs > peak) {\n                    peak = abs;\n                }\n            }\n\n            const rms = Math.sqrt(sumSquares / length);\n\n            // Convert to dB\n            const rmsDb = 20 * Math.log10(rms || 0.0001);\n            const peakDb = 20 * Math.log10(peak || 0.0001);\n            const crestFactor = peakDb - rmsDb; // Difference between peak and average\n\n            console.log(`[WebAudioEngine] Analysis complete. RMS: ${rmsDb.toFixed(2)}dB, Peak: ${peakDb.toFixed(2)}dB, CF: ${crestFactor.toFixed(2)}dB`);\n\n            return {\n                rms: rmsDb,\n                peak: peakDb,\n                crestFactor: crestFactor\n            };\n\n        } catch (error) {\n            console.error('[WebAudioEngine] Audio analysis failed:', error);\n            return null;\n        }\n    }\n\n    getVUMeterLevel(trackId: string): number {\n        const chain = this.trackChains.get(trackId);\n        if (!chain) return 0;\n\n        const dataArray = new Uint8Array(chain.analyser.frequencyBinCount);\n        chain.analyser.getByteFrequencyData(dataArray);\n\n        let sum = 0;\n        for (let i = 0; i < dataArray.length; i++) {\n            sum += dataArray[i];\n        }\n        return Math.floor((sum / dataArray.length) * 1.5);\n    }\n\n    getFrequencyLevel(trackId: string, minFreq: number, maxFreq: number): number {\n        const chain = this.trackChains.get(trackId);\n        if (!chain || !this.ctx) return 0;\n\n        const bufferLength = chain.analyser.frequencyBinCount;\n        const dataArray = new Uint8Array(bufferLength);\n        chain.analyser.getByteFrequencyData(dataArray);\n\n        const nyquist = this.ctx.sampleRate / 2;\n        const indexMin = Math.round((minFreq / nyquist) * bufferLength);\n        const indexMax = Math.round((maxFreq / nyquist) * bufferLength);\n\n        let sum = 0;\n        let count = 0;\n        for (let i = indexMin; i <= indexMax; i++) {\n            sum += dataArray[i];\n            count++;\n        }\n\n        return count > 0 ? sum / count / 255 : 0;\n    }\n\n    getTrackAnalyser(trackId: string): AnalyserNode | undefined {\n        return this.trackChains.get(trackId)?.analyser;\n    }\n\n    // --- Plugin System ---\n\n    updateGate(trackId: string, threshold: number, bypass: boolean) {\n        const chain = this.getOrCreateTrack(trackId);\n        if (!chain.gate) {\n            // Real noise gates are complex in WebAudio without script processors.\n            // A compressor acts backwards (reduces loud, not quiet).\n            // We'll leave the node for routing but keep it fully transparent.\n            const gate = this.ctx!.createDynamicsCompressor();\n            gate.ratio.value = 1; // 1:1 ratio (no compression)\n            gate.threshold.value = 0; // 0 dB \n            chain.gate = gate;\n\n            // Route: input -> gate -> [eqBands] -> [compressor] -> [makeup] -> [limiter] -> panner\n            chain.input.disconnect();\n            chain.input.connect(gate);\n            const nextNode = (chain.eqBands ? chain.eqBands[0] : null) || chain.compressor || chain.makeup || chain.limiter || chain.panner;\n            gate.connect(nextNode);\n        }\n\n        // Always bypass to prevent volume destruction\n        chain.gate.ratio.setTargetAtTime(1, this.ctx!.currentTime, 0.1);\n        chain.gate.threshold.setTargetAtTime(0, this.ctx!.currentTime, 0.1);\n    }\n\n    updateEQ(trackId: string, highpass: number, tilt: number, sideGain: number, sideFreq: number, bypass: boolean) {\n        const chain = this.getOrCreateTrack(trackId);\n        if (!chain.eqBands) {\n            const low = this.ctx!.createBiquadFilter();\n            low.type = 'lowshelf';\n            low.frequency.value = 80;\n\n            const mid = this.ctx!.createBiquadFilter();\n            mid.type = 'peaking';\n            mid.frequency.value = 1000;\n            mid.Q.value = 0.5;\n\n            const high = this.ctx!.createBiquadFilter();\n            high.type = 'highshelf';\n            high.frequency.value = 6000;\n\n            const presence = this.ctx!.createBiquadFilter();\n            presence.type = 'peaking';\n            presence.frequency.value = 3500;\n            presence.Q.value = 1.0;\n\n            low.connect(mid);\n            mid.connect(high);\n            high.connect(presence);\n\n            chain.eqBands = [low, mid, high, presence];\n\n            // Re-route\n            const prevNode = chain.gate || chain.input;\n            prevNode.disconnect();\n            prevNode.connect(low);\n            const nextNode = chain.compressor || chain.makeup || chain.limiter || chain.panner;\n            presence.connect(nextNode);\n        }\n\n        const [low, mid, high, presence] = chain.eqBands;\n\n        if (bypass) {\n            low.gain.setTargetAtTime(0, this.ctx!.currentTime, 0.1);\n            mid.gain.setTargetAtTime(0, this.ctx!.currentTime, 0.1);\n            high.gain.setTargetAtTime(0, this.ctx!.currentTime, 0.1);\n            presence.gain.setTargetAtTime(0, this.ctx!.currentTime, 0.1);\n        } else {\n            // Knob (0-100) Maps to (-12dB to +12dB). Neutral is 50.\n            low.gain.setTargetAtTime((highpass - 50) * 0.24, this.ctx!.currentTime, 0.1);\n            mid.gain.setTargetAtTime((tilt - 50) * 0.24, this.ctx!.currentTime, 0.1);\n            high.gain.setTargetAtTime((sideGain - 50) * 0.24, this.ctx!.currentTime, 0.1);\n            // Presence (0-100) maps to (0dB to +6dB). Neutral is 0.\n            presence.gain.setTargetAtTime((sideFreq / 100) * 6, this.ctx!.currentTime, 0.1);\n        }\n    }\n\n    updateCompressor(trackId: string, strength: number, attack: number, release: number, bypass: boolean) {\n        const chain = this.getOrCreateTrack(trackId);\n        if (!chain.compressor) {\n            chain.compressor = this.ctx!.createDynamicsCompressor();\n            // Re-route\n            const prevNode = (chain.eqBands ? chain.eqBands[chain.eqBands.length - 1] : null) || chain.gate || chain.input;\n            prevNode.disconnect();\n            prevNode.connect(chain.compressor);\n            const nextNode = chain.makeup || chain.limiter || chain.panner;\n            chain.compressor.connect(nextNode);\n        }\n\n        if (bypass) {\n            chain.compressor.ratio.setTargetAtTime(1, this.ctx!.currentTime, 0.1);\n        } else {\n            // Strength (0-100) -> Threshold (-10 to -25dB), Ratio (1.2 to 4.0)\n            const threshold = -10 - ((strength / 100) * 15);\n            const ratio = 1.2 + ((strength / 100) * 2.8);\n\n            chain.compressor.threshold.setTargetAtTime(threshold, this.ctx!.currentTime, 0.1);\n            chain.compressor.ratio.setTargetAtTime(ratio, this.ctx!.currentTime, 0.1);\n            chain.compressor.attack.setTargetAtTime(attack / 1000, this.ctx!.currentTime, 0.1);\n            chain.compressor.release.setTargetAtTime(release / 1000, this.ctx!.currentTime, 0.1);\n        }\n    }\n\n    updateLeveler(trackId: string, target: number, bypass: boolean) {\n        // We use Leveler as the Makeup Gain before the Limiter!\n        const chain = this.getOrCreateTrack(trackId);\n\n        if (!chain.makeup) {\n            chain.makeup = this.ctx!.createGain();\n            const prevNode = chain.compressor || (chain.eqBands ? chain.eqBands[chain.eqBands.length - 1] : null) || chain.gate || chain.input;\n            prevNode.disconnect();\n            prevNode.connect(chain.makeup);\n            const nextNode = chain.limiter || chain.panner;\n            chain.makeup.connect(nextNode);\n        }\n\n        if (bypass) {\n            chain.makeup.gain.setTargetAtTime(1, this.ctx!.currentTime, 0.1);\n        } else {\n            // Target (0-100) maps to 0dB to +15dB of gain!\n            // This gain pushes the signal into the limiter (Loudness Maximizer)\n            const dbGain = (target / 100) * 15; // 0 to +15 dB\n            const gainValue = Math.pow(10, dbGain / 20);\n            chain.makeup.gain.setTargetAtTime(gainValue, this.ctx!.currentTime, 0.1);\n        }\n    }\n\n    updateLimiter(trackId: string, strength: number, ceiling: number, bypass: boolean, useWasm: boolean = false) {\n        const chain = this.getOrCreateTrack(trackId);\n\n        if (useWasm) {\n            if (!chain.wasmLimiter) {\n                try {\n                    chain.wasmLimiter = new AudioWorkletNode(this.ctx!, 'phaselimiter-worklet');\n                    const prevNode = chain.makeup || chain.compressor || (chain.eqBands ? chain.eqBands[chain.eqBands.length - 1] : null) || chain.gate || chain.input;\n                    prevNode.disconnect();\n                    prevNode.connect(chain.wasmLimiter);\n                    chain.wasmLimiter.connect(chain.panner);\n                    console.log(\"[WebAudioEngine] Routed through WASM Limiter.\");\n                } catch (e) {\n                    console.warn(\"[WebAudioEngine] WASM Worklet not ready. Falling back to native limiter.\", e);\n                    useWasm = false;\n                }\n            }\n\n            // Send parameter updates to the worklet\n            if (chain.wasmLimiter) {\n                const ceilingDb = -0.3 - ((strength / 100) * 2.7); // -0.3 to -3 dBFS\n                chain.wasmLimiter.port.postMessage({\n                    type: 'params',\n                    ceiling: bypass ? 0 : ceilingDb,\n                    strength: strength / 100,\n                    bypass,\n                });\n                return;\n            }\n        }\n\n        // Disconnect WASM if it was connected and we're falling back\n        if (chain.wasmLimiter) {\n            chain.wasmLimiter.disconnect();\n        }\n\n        if (!chain.limiter) {\n            chain.limiter = this.ctx!.createDynamicsCompressor();\n            chain.limiter.ratio.value = 50;\n            chain.limiter.attack.value = 0.001;\n            chain.limiter.release.value = 0.05;\n            const prevNode = chain.makeup || chain.compressor || (chain.eqBands ? chain.eqBands[chain.eqBands.length - 1] : null) || chain.gate || chain.input;\n            prevNode.disconnect();\n            prevNode.connect(chain.limiter);\n            chain.limiter.connect(chain.panner);\n        }\n\n        if (bypass) {\n            chain.limiter.ratio.setTargetAtTime(1, this.ctx!.currentTime, 0.1);\n        } else {\n            const threshold = ceiling - ((strength / 100) * 3);\n            chain.limiter.threshold.setTargetAtTime(threshold, this.ctx!.currentTime, 0.1);\n        }\n    }\n\n\n    updateMultiband(trackId: string, lowStr: number, highStr: number, bypass: boolean) {\n        // Placeholder for multiband - logic would require a splitter and multiple compressors\n        // For now, let's just use it as a global tone shaper or additional compression\n    }\n}\n\nexport const audioEngine = new WebAudioEngine();\n"],"names":[],"mappings":";;;;AAyBA,MAAM;IACM,MAA2B,KAAK;IAChC,aAA8B,KAAK;IACnC,cAAuC,IAAI,MAAM;IACjD,gBAAwE,IAAI,UAAU;IACtF,YAAY,MAAM;IAClB,WAAW,EAAE;IACb,YAAY,EAAE;IACd,eAA4B,IAAI,MAAM;IACtC,kBAAkB,MAAM;IAEhC,aAAc;IACV,4DAA4D;IAChE;IAEO,cAAc;QACjB,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE;YACX,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,OAAO,YAAY,IAAI,AAAC,OAAe,kBAAkB;YACzE,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,GAAG,CAAC,UAAU;YACrC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,WAAW;QAChD;QACA,IAAI,IAAI,CAAC,GAAG,CAAC,KAAK,KAAK,aAAa;YAChC,IAAI,CAAC,GAAG,CAAC,MAAM;QACnB;IACJ;IAEQ,iBAAiB,OAAe,EAAc;QAClD,IAAI,CAAC,WAAW;QAChB,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,UAAU;YAChC,MAAM,MAAM,IAAI,CAAC,GAAG;YACpB,MAAM,QAAQ,IAAI,UAAU;YAC5B,MAAM,WAAW,IAAI,UAAU;YAC/B,MAAM,SAAS,IAAI,UAAU;YAC7B,MAAM,SAAS,IAAI,kBAAkB;YACrC,MAAM,WAAW,IAAI,cAAc;YAEnC,SAAS,OAAO,GAAG;YAEnB,0EAA0E;YAC1E,MAAM,OAAO,CAAC;YACd,OAAO,OAAO,CAAC;YACf,SAAS,OAAO,CAAC;YACjB,OAAO,OAAO,CAAC;YACf,SAAS,OAAO,CAAC,IAAI,CAAC,UAAU;YAEhC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,SAAS;gBAC1B;gBACA;gBACA;gBACA;gBACA;gBACA,SAAS,EAAE;gBACX,SAAS;gBACT,UAAU;YACd;QACJ;QACA,OAAO,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC;IAChC;IAEA,KAAK,UAAkB,EAAE,UAAkB,EAAE;QACzC,QAAQ,GAAG,CAAC,CAAC,sEAAsE,CAAC;QACpF,OAAO;IACX;IAEA;;;KAGC,GACD,MAAM,kBAAkB;QACpB,IAAI,CAAC,WAAW;QAChB,IAAI;YACA,MAAM,IAAI,CAAC,GAAG,CAAE,YAAY,CAAC,SAAS,CAAC;YACvC,QAAQ,GAAG,CAAC;YACZ,OAAO;QACX,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,6DAA6D;YAC3E,OAAO;QACX;IACJ;IAEA;;;KAGC,GACD,MAAM,iBAAmC;QACrC,IAAI,IAAI,CAAC,eAAe,EAAE,OAAO;QACjC,IAAI,CAAC,WAAW;QAChB,IAAI;YACA,MAAM,IAAI,CAAC,GAAG,CAAE,YAAY,CAAC,SAAS,CAAC;YACvC,IAAI,CAAC,eAAe,GAAG;YACvB,QAAQ,GAAG,CAAC;YACZ,OAAO;QACX,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,yDAAyD;YACvE,OAAO;QACX;IACJ;IAEA;;;;KAIC,GACD,MAAM,iBAAiB,OAAe,EAAE,MAAyC,EAAoC;QACjH,MAAM,IAAI,CAAC,cAAc;QACzB,IAAI,CAAC,IAAI,CAAC,eAAe,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,OAAO;QAE/C,MAAM,QAAQ,IAAI,CAAC,gBAAgB,CAAC;QAEpC,MAAM,OAAO,IAAI,iBAAiB,IAAI,CAAC,GAAG,EAAE,yBAAyB;YACjE,kBAAkB;gBAAE;YAAO;YAC3B,gBAAgB;YAChB,iBAAiB;YACjB,oBAAoB;gBAAC;aAAE;QAC3B;QAEA,gDAAgD;QAChD,6DAA6D;QAC7D,MAAM,WAAW,MAAM,OAAO,CAAC,MAAM,GAAG,IAAI,MAAM,OAAO,CAAC,MAAM,OAAO,CAAC,MAAM,GAAG,EAAE,GAAG,MAAM,KAAK;QACjG,IAAI;YAAE,SAAS,UAAU,CAAC,MAAM,MAAM;QAAG,EAAE,OAAO,GAAG,CAAE;QACvD,SAAS,OAAO,CAAC;QACjB,KAAK,OAAO,CAAC,MAAM,MAAM;QACzB,MAAM,OAAO,CAAC,IAAI,CAAC;QAEnB,QAAQ,GAAG,CAAC,CAAC,+BAA+B,EAAE,OAAO,UAAU,EAAE,SAAS;QAC1E,OAAO;IACX;IAEA,OAAO;QACH,IAAI,IAAI,CAAC,SAAS,EAAE;QACpB,IAAI,CAAC,WAAW;QAChB,IAAI,CAAC,SAAS,GAAG;QACjB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,GAAG,CAAE,WAAW,GAAG,IAAI,CAAC,QAAQ;QACtD,QAAQ,GAAG,CAAC,CAAC,kCAAkC,CAAC;IACpD;IAEA,QAAQ;QACJ,IAAI,CAAC,SAAS,GAAG;QACjB,IAAI,IAAI,CAAC,GAAG,EAAE;YACV,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,WAAW,GAAG,IAAI,CAAC,SAAS;QACzD;QACA,QAAQ,GAAG,CAAC,CAAC,iCAAiC,CAAC;IACnD;IAEA,OAAO;QACH,IAAI,CAAC,SAAS,GAAG;QACjB,IAAI,CAAC,QAAQ,GAAG;QAChB,QAAQ,GAAG,CAAC,CAAC,kCAAkC,CAAC;IACpD;IAEA,oBAAoB,OAAe,EAAE;QACjC,IAAI,CAAC,QAAQ,GAAG;QAChB,IAAI,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,GAAG,EAAE;YAC5B,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,GAAG,CAAC,WAAW,GAAG;QAC5C;IACJ;IAEA,sBAAsB;QAClB,IAAI,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,GAAG,EAAE;YAC5B,OAAO,IAAI,CAAC,GAAG,CAAC,WAAW,GAAG,IAAI,CAAC,SAAS;QAChD;QACA,OAAO,IAAI,CAAC,QAAQ;IACxB;IAEA,eAAe,OAAe,EAAE,KAAa,EAAE;QAC3C,0BAA0B;QAC1B,MAAM,QAAQ,IAAI,CAAC,gBAAgB,CAAC;QACpC,MAAM,YAAY,QAAQ;QAC1B,MAAM,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,WAAW,IAAI,CAAC,GAAG,CAAE,WAAW,EAAE;IACxE;IAEA,YAAY,OAAe,EAAE,KAAa,EAAE;QACxC,iCAAiC;QACjC,MAAM,QAAQ,IAAI,CAAC,gBAAgB,CAAC;QACpC,MAAM,WAAW,QAAQ;QACzB,MAAM,MAAM,CAAC,GAAG,CAAC,eAAe,CAAC,UAAU,IAAI,CAAC,GAAG,CAAE,WAAW,EAAE;IACtE;IAEA,aAAa,OAAe,EAAE,OAAgB,EAAE;QAC5C,MAAM,QAAQ,IAAI,CAAC,gBAAgB,CAAC;QACpC,MAAM,OAAO,GAAG;QAChB,IAAI,CAAC,mBAAmB;IAC5B;IAEA,aAAa,OAAe,EAAE,MAAe,EAAE;QAC3C,MAAM,QAAQ,IAAI,CAAC,gBAAgB,CAAC;QACpC,MAAM,QAAQ,GAAG;QAEjB,IAAI,QAAQ;YACR,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC;QAC1B,OAAO;YACH,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC;QAC7B;QAEA,IAAI,CAAC,mBAAmB;IAC5B;IAEQ,sBAAsB;QAC1B,qFAAqF;QACrF,MAAM,UAAU,IAAI,CAAC,YAAY,CAAC,IAAI,GAAG;QAEzC,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,OAAO;YAC7B,MAAM,gBAAgB,CAAC,UAAU,MAAM,QAAQ,GAAG,IAAI,KAAK,CAAC,MAAM,OAAO;YACzE,MAAM,aAAa,gBAAgB,IAAI;YACvC,MAAM,QAAQ,CAAC,IAAI,CAAC,eAAe,CAAC,YAAY,IAAI,CAAC,GAAG,CAAE,WAAW,EAAE;QAC3E;IACJ;IAEA,cAAc,MAAc,EAAE,OAAe,EAAE;IAC3C,uBAAuB;IAC3B;IAEA,gBAAgB,MAAc,EAAE,IAAU,EAAY;QAClD,uBAAuB;QACvB,OAAO,EAAE;IACb;IAEA,0EAA0E;IAC1E,oBAAoB,OAAe,EAAE,OAAyB,EAAE;QAC5D,IAAI,CAAC,WAAW;QAChB,MAAM,QAAQ,IAAI,CAAC,gBAAgB,CAAC;QAEpC,sFAAsF;QACtF,IAAI,MAAM,MAAM,EAAE;YACd,IAAI;gBAAE,MAAM,MAAM,CAAC,UAAU;YAAI,EAAE,OAAO,GAAG,CAAE;QACnD;QAEA,IAAI,SAAS,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC;QACpC,IAAI,CAAC,QAAQ;YACT,IAAI;gBACA,SAAS,IAAI,CAAC,GAAG,CAAE,wBAAwB,CAAC;gBAC5C,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,SAAS;YACpC,EAAE,OAAO,GAAG;gBACR,QAAQ,IAAI,CAAC,yCAAyC;gBACtD;YACJ;QACJ;QAEA,IAAI;YAAE,OAAO,UAAU;QAAI,EAAE,OAAO,GAAG,CAAE;QACzC,OAAO,OAAO,CAAC,MAAM,KAAK;QAC1B,MAAM,MAAM,GAAG;QAEf,iEAAiE;QACjE,MAAM,MAAM,IAAI,IAAI,QAAQ,GAAG,EAAE,OAAO,QAAQ,CAAC,IAAI;QACrD,IAAI,WAAW,IAAI,YAAY,CAAC,GAAG,CAAC;QAEpC,mFAAmF;QACnF,IAAI,CAAC,UAAU;YACX,MAAM,cAAc,IAAI,YAAY,CAAC,GAAG,CAAC;YACzC,IAAI,aAAa;gBACb,IAAI;oBACA,sBAAsB;oBACtB,MAAM,WAAW,IAAI,IAAI,aAAa,OAAO,QAAQ,CAAC,IAAI;oBAC1D,WAAW,SAAS,YAAY,CAAC,GAAG,CAAC;gBACzC,EAAE,OAAO,GAAG;oBACR,8DAA8D;oBAC9D,MAAM,QAAQ,YAAY,KAAK,CAAC;oBAChC,IAAI,OAAO,WAAW,KAAK,CAAC,EAAE;gBAClC;YACJ;QACJ;QAEA,IAAI,UAAU;YACV,IAAI,CAAC,mBAAmB,CAAC,SAAS;QACtC;IACJ;IAEQ,oBAAoB,OAAe,EAAE,IAAY,EAAE;QACvD,MAAM,QAAQ,IAAI,CAAC,gBAAgB,CAAC;QACpC,MAAM,MAAM,IAAI,CAAC,GAAG;QAEpB,oCAAoC;QACpC,IAAI,MAAM,OAAO,EAAE;YACf,IAAI;gBACA,MAAM,KAAK,CAAC,UAAU,CAAC,MAAM,OAAO,CAAC,QAAQ;gBAC7C,MAAM,OAAO,CAAC,MAAM,CAAC,UAAU;gBAC/B,MAAM,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,CAAA,IAAK,EAAE,UAAU;YACnD,EAAE,OAAO,GAAG,CAAE;QAClB;QAEA,MAAM,WAAW,IAAI,qBAAqB,CAAC;QAC3C,MAAM,SAAS,IAAI,mBAAmB,CAAC;QACvC,MAAM,UAAU,IAAI,UAAU;QAC9B,MAAM,WAAW,IAAI,UAAU;QAC/B,MAAM,UAA8B,EAAE;QAEtC,gCAAgC;QAChC,oBAAoB;QACpB,qBAAqB;QACrB,MAAM,cAAc,IAAI,UAAU;QAClC,YAAY,IAAI,CAAC,KAAK,GAAG,CAAC;QAE1B,SAAS,OAAO,CAAC,SAAS,IAAI,IAAI;QAClC,SAAS,OAAO,CAAC,SAAS,IAAI,IAAI;QAClC,QAAQ,IAAI,CAAC,KAAK,GAAG;QAErB,SAAS,OAAO,CAAC,UAAU,IAAI,IAAI;QACnC,SAAS,OAAO,CAAC,aAAa,IAAI,KAAK;QACvC,YAAY,OAAO,CAAC;QACpB,SAAS,IAAI,CAAC,KAAK,GAAG;QAEtB,6BAA6B;QAC7B,MAAM,YAAY,IAAI,UAAU;QAEhC,IAAI,SAAS,SAAS;YAClB,4CAA4C;YAC5C,MAAM,KAAK,IAAI,kBAAkB;YACjC,GAAG,IAAI,GAAG;YACV,GAAG,SAAS,CAAC,KAAK,GAAG;YAErB,MAAM,KAAK,IAAI,kBAAkB;YACjC,GAAG,IAAI,GAAG;YACV,GAAG,SAAS,CAAC,KAAK,GAAG;YAErB,MAAM,OAAO,IAAI,kBAAkB;YACnC,KAAK,IAAI,GAAG;YACZ,KAAK,SAAS,CAAC,KAAK,GAAG;YACvB,KAAK,IAAI,CAAC,KAAK,GAAG;YAElB,QAAQ,OAAO,CAAC;YAChB,GAAG,OAAO,CAAC;YACX,GAAG,OAAO,CAAC;YACX,KAAK,OAAO,CAAC;YACb,QAAQ,IAAI,CAAC,IAAI,IAAI;YAErB,2BAA2B;YAC3B,SAAS,IAAI,CAAC,KAAK,GAAG;QAC1B,OAAO,IAAI,SAAS,UAAU,SAAS,QAAQ;YAC3C,gDAAgD;YAChD,MAAM,KAAK,IAAI,kBAAkB;YACjC,GAAG,IAAI,GAAG;YACV,GAAG,SAAS,CAAC,KAAK,GAAG,SAAS,SAAS,MAAM;YAE7C,QAAQ,OAAO,CAAC;YAChB,GAAG,OAAO,CAAC;YACX,QAAQ,IAAI,CAAC;YACb,SAAS,IAAI,CAAC,KAAK,GAAG,KAAK,gBAAgB;QAC/C,OAAO;YACH,6CAA6C;YAC7C,MAAM,KAAK,IAAI,kBAAkB;YACjC,GAAG,IAAI,GAAG;YACV,GAAG,SAAS,CAAC,KAAK,GAAG;YAErB,SAAS,OAAO,CAAC;YACjB,GAAG,OAAO,CAAC;YACX,QAAQ,IAAI,CAAC;YACb,QAAQ,IAAI,CAAC,KAAK,GAAG,KAAK,wBAAwB;QACtD;QAEA,mFAAmF;QACnF,MAAM,KAAK,CAAC,UAAU;QACtB,MAAM,KAAK,CAAC,OAAO,CAAC;QACpB,UAAU,OAAO,CAAC,MAAM,MAAM;QAE9B,MAAM,OAAO,GAAG;YAAE;YAAU;YAAQ;YAAS;YAAU;QAAQ;QAC/D,QAAQ,GAAG,CAAC,CAAC,kDAAkD,EAAE,KAAK,WAAW,EAAE,SAAS;IAChG;IAEA;;;KAGC,GACD,MAAM,mBAAmB,QAAgB,EAAsE;QAC3G,IAAI;YACA,QAAQ,GAAG,CAAC;YACZ,MAAM,WAAW,MAAM,MAAM;YAC7B,MAAM,cAAc,MAAM,SAAS,WAAW;YAE9C,8DAA8D;YAC9D,IAAI,CAAC,WAAW;YAChB,QAAQ,GAAG,CAAC;YACZ,MAAM,cAAc,MAAM,IAAI,CAAC,GAAG,CAAE,eAAe,CAAC;YAEpD,MAAM,cAAc,YAAY,cAAc,CAAC,IAAI,sCAAsC;YACzF,IAAI,aAAa;YACjB,IAAI,OAAO;YAEX,yBAAyB;YACzB,QAAQ,GAAG,CAAC;YACZ,MAAM,SAAS,YAAY,MAAM;YACjC,MAAM,OAAO,KAAK,GAAG,CAAC,GAAG,KAAK,KAAK,CAAC,SAAS,UAAU,gFAAgF;YAEvI,yFAAyF;YACzF,IAAK,IAAI,IAAI,GAAG,IAAI,QAAQ,KAAK,EAAG;gBAChC,MAAM,SAAS,WAAW,CAAC,EAAE;gBAC7B,MAAM,MAAM,KAAK,GAAG,CAAC;gBACrB,cAAc,SAAS;gBACvB,IAAI,MAAM,MAAM;oBACZ,OAAO;gBACX;YACJ;YAEA,MAAM,MAAM,KAAK,IAAI,CAAC,aAAa;YAEnC,gBAAgB;YAChB,MAAM,QAAQ,KAAK,KAAK,KAAK,CAAC,OAAO;YACrC,MAAM,SAAS,KAAK,KAAK,KAAK,CAAC,QAAQ;YACvC,MAAM,cAAc,SAAS,OAAO,sCAAsC;YAE1E,QAAQ,GAAG,CAAC,CAAC,yCAAyC,EAAE,MAAM,OAAO,CAAC,GAAG,UAAU,EAAE,OAAO,OAAO,CAAC,GAAG,QAAQ,EAAE,YAAY,OAAO,CAAC,GAAG,EAAE,CAAC;YAE3I,OAAO;gBACH,KAAK;gBACL,MAAM;gBACN,aAAa;YACjB;QAEJ,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,2CAA2C;YACzD,OAAO;QACX;IACJ;IAEA,gBAAgB,OAAe,EAAU;QACrC,MAAM,QAAQ,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC;QACnC,IAAI,CAAC,OAAO,OAAO;QAEnB,MAAM,YAAY,IAAI,WAAW,MAAM,QAAQ,CAAC,iBAAiB;QACjE,MAAM,QAAQ,CAAC,oBAAoB,CAAC;QAEpC,IAAI,MAAM;QACV,IAAK,IAAI,IAAI,GAAG,IAAI,UAAU,MAAM,EAAE,IAAK;YACvC,OAAO,SAAS,CAAC,EAAE;QACvB;QACA,OAAO,KAAK,KAAK,CAAC,AAAC,MAAM,UAAU,MAAM,GAAI;IACjD;IAEA,kBAAkB,OAAe,EAAE,OAAe,EAAE,OAAe,EAAU;QACzE,MAAM,QAAQ,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC;QACnC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,EAAE,OAAO;QAEhC,MAAM,eAAe,MAAM,QAAQ,CAAC,iBAAiB;QACrD,MAAM,YAAY,IAAI,WAAW;QACjC,MAAM,QAAQ,CAAC,oBAAoB,CAAC;QAEpC,MAAM,UAAU,IAAI,CAAC,GAAG,CAAC,UAAU,GAAG;QACtC,MAAM,WAAW,KAAK,KAAK,CAAC,AAAC,UAAU,UAAW;QAClD,MAAM,WAAW,KAAK,KAAK,CAAC,AAAC,UAAU,UAAW;QAElD,IAAI,MAAM;QACV,IAAI,QAAQ;QACZ,IAAK,IAAI,IAAI,UAAU,KAAK,UAAU,IAAK;YACvC,OAAO,SAAS,CAAC,EAAE;YACnB;QACJ;QAEA,OAAO,QAAQ,IAAI,MAAM,QAAQ,MAAM;IAC3C;IAEA,iBAAiB,OAAe,EAA4B;QACxD,OAAO,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,UAAU;IAC1C;IAEA,wBAAwB;IAExB,WAAW,OAAe,EAAE,SAAiB,EAAE,MAAe,EAAE;QAC5D,MAAM,QAAQ,IAAI,CAAC,gBAAgB,CAAC;QACpC,IAAI,CAAC,MAAM,IAAI,EAAE;YACb,sEAAsE;YACtE,yDAAyD;YACzD,kEAAkE;YAClE,MAAM,OAAO,IAAI,CAAC,GAAG,CAAE,wBAAwB;YAC/C,KAAK,KAAK,CAAC,KAAK,GAAG,GAAG,6BAA6B;YACnD,KAAK,SAAS,CAAC,KAAK,GAAG,GAAG,QAAQ;YAClC,MAAM,IAAI,GAAG;YAEb,uFAAuF;YACvF,MAAM,KAAK,CAAC,UAAU;YACtB,MAAM,KAAK,CAAC,OAAO,CAAC;YACpB,MAAM,WAAW,CAAC,MAAM,OAAO,GAAG,MAAM,OAAO,CAAC,EAAE,GAAG,IAAI,KAAK,MAAM,UAAU,IAAI,MAAM,MAAM,IAAI,MAAM,OAAO,IAAI,MAAM,MAAM;YAC/H,KAAK,OAAO,CAAC;QACjB;QAEA,8CAA8C;QAC9C,MAAM,IAAI,CAAC,KAAK,CAAC,eAAe,CAAC,GAAG,IAAI,CAAC,GAAG,CAAE,WAAW,EAAE;QAC3D,MAAM,IAAI,CAAC,SAAS,CAAC,eAAe,CAAC,GAAG,IAAI,CAAC,GAAG,CAAE,WAAW,EAAE;IACnE;IAEA,SAAS,OAAe,EAAE,QAAgB,EAAE,IAAY,EAAE,QAAgB,EAAE,QAAgB,EAAE,MAAe,EAAE;QAC3G,MAAM,QAAQ,IAAI,CAAC,gBAAgB,CAAC;QACpC,IAAI,CAAC,MAAM,OAAO,EAAE;YAChB,MAAM,MAAM,IAAI,CAAC,GAAG,CAAE,kBAAkB;YACxC,IAAI,IAAI,GAAG;YACX,IAAI,SAAS,CAAC,KAAK,GAAG;YAEtB,MAAM,MAAM,IAAI,CAAC,GAAG,CAAE,kBAAkB;YACxC,IAAI,IAAI,GAAG;YACX,IAAI,SAAS,CAAC,KAAK,GAAG;YACtB,IAAI,CAAC,CAAC,KAAK,GAAG;YAEd,MAAM,OAAO,IAAI,CAAC,GAAG,CAAE,kBAAkB;YACzC,KAAK,IAAI,GAAG;YACZ,KAAK,SAAS,CAAC,KAAK,GAAG;YAEvB,MAAM,WAAW,IAAI,CAAC,GAAG,CAAE,kBAAkB;YAC7C,SAAS,IAAI,GAAG;YAChB,SAAS,SAAS,CAAC,KAAK,GAAG;YAC3B,SAAS,CAAC,CAAC,KAAK,GAAG;YAEnB,IAAI,OAAO,CAAC;YACZ,IAAI,OAAO,CAAC;YACZ,KAAK,OAAO,CAAC;YAEb,MAAM,OAAO,GAAG;gBAAC;gBAAK;gBAAK;gBAAM;aAAS;YAE1C,WAAW;YACX,MAAM,WAAW,MAAM,IAAI,IAAI,MAAM,KAAK;YAC1C,SAAS,UAAU;YACnB,SAAS,OAAO,CAAC;YACjB,MAAM,WAAW,MAAM,UAAU,IAAI,MAAM,MAAM,IAAI,MAAM,OAAO,IAAI,MAAM,MAAM;YAClF,SAAS,OAAO,CAAC;QACrB;QAEA,MAAM,CAAC,KAAK,KAAK,MAAM,SAAS,GAAG,MAAM,OAAO;QAEhD,IAAI,QAAQ;YACR,IAAI,IAAI,CAAC,eAAe,CAAC,GAAG,IAAI,CAAC,GAAG,CAAE,WAAW,EAAE;YACnD,IAAI,IAAI,CAAC,eAAe,CAAC,GAAG,IAAI,CAAC,GAAG,CAAE,WAAW,EAAE;YACnD,KAAK,IAAI,CAAC,eAAe,CAAC,GAAG,IAAI,CAAC,GAAG,CAAE,WAAW,EAAE;YACpD,SAAS,IAAI,CAAC,eAAe,CAAC,GAAG,IAAI,CAAC,GAAG,CAAE,WAAW,EAAE;QAC5D,OAAO;YACH,wDAAwD;YACxD,IAAI,IAAI,CAAC,eAAe,CAAC,CAAC,WAAW,EAAE,IAAI,MAAM,IAAI,CAAC,GAAG,CAAE,WAAW,EAAE;YACxE,IAAI,IAAI,CAAC,eAAe,CAAC,CAAC,OAAO,EAAE,IAAI,MAAM,IAAI,CAAC,GAAG,CAAE,WAAW,EAAE;YACpE,KAAK,IAAI,CAAC,eAAe,CAAC,CAAC,WAAW,EAAE,IAAI,MAAM,IAAI,CAAC,GAAG,CAAE,WAAW,EAAE;YACzE,wDAAwD;YACxD,SAAS,IAAI,CAAC,eAAe,CAAC,AAAC,WAAW,MAAO,GAAG,IAAI,CAAC,GAAG,CAAE,WAAW,EAAE;QAC/E;IACJ;IAEA,iBAAiB,OAAe,EAAE,QAAgB,EAAE,MAAc,EAAE,OAAe,EAAE,MAAe,EAAE;QAClG,MAAM,QAAQ,IAAI,CAAC,gBAAgB,CAAC;QACpC,IAAI,CAAC,MAAM,UAAU,EAAE;YACnB,MAAM,UAAU,GAAG,IAAI,CAAC,GAAG,CAAE,wBAAwB;YACrD,WAAW;YACX,MAAM,WAAW,CAAC,MAAM,OAAO,GAAG,MAAM,OAAO,CAAC,MAAM,OAAO,CAAC,MAAM,GAAG,EAAE,GAAG,IAAI,KAAK,MAAM,IAAI,IAAI,MAAM,KAAK;YAC9G,SAAS,UAAU;YACnB,SAAS,OAAO,CAAC,MAAM,UAAU;YACjC,MAAM,WAAW,MAAM,MAAM,IAAI,MAAM,OAAO,IAAI,MAAM,MAAM;YAC9D,MAAM,UAAU,CAAC,OAAO,CAAC;QAC7B;QAEA,IAAI,QAAQ;YACR,MAAM,UAAU,CAAC,KAAK,CAAC,eAAe,CAAC,GAAG,IAAI,CAAC,GAAG,CAAE,WAAW,EAAE;QACrE,OAAO;YACH,mEAAmE;YACnE,MAAM,YAAY,CAAC,KAAM,AAAC,WAAW,MAAO;YAC5C,MAAM,QAAQ,MAAO,AAAC,WAAW,MAAO;YAExC,MAAM,UAAU,CAAC,SAAS,CAAC,eAAe,CAAC,WAAW,IAAI,CAAC,GAAG,CAAE,WAAW,EAAE;YAC7E,MAAM,UAAU,CAAC,KAAK,CAAC,eAAe,CAAC,OAAO,IAAI,CAAC,GAAG,CAAE,WAAW,EAAE;YACrE,MAAM,UAAU,CAAC,MAAM,CAAC,eAAe,CAAC,SAAS,MAAM,IAAI,CAAC,GAAG,CAAE,WAAW,EAAE;YAC9E,MAAM,UAAU,CAAC,OAAO,CAAC,eAAe,CAAC,UAAU,MAAM,IAAI,CAAC,GAAG,CAAE,WAAW,EAAE;QACpF;IACJ;IAEA,cAAc,OAAe,EAAE,MAAc,EAAE,MAAe,EAAE;QAC5D,wDAAwD;QACxD,MAAM,QAAQ,IAAI,CAAC,gBAAgB,CAAC;QAEpC,IAAI,CAAC,MAAM,MAAM,EAAE;YACf,MAAM,MAAM,GAAG,IAAI,CAAC,GAAG,CAAE,UAAU;YACnC,MAAM,WAAW,MAAM,UAAU,IAAI,CAAC,MAAM,OAAO,GAAG,MAAM,OAAO,CAAC,MAAM,OAAO,CAAC,MAAM,GAAG,EAAE,GAAG,IAAI,KAAK,MAAM,IAAI,IAAI,MAAM,KAAK;YAClI,SAAS,UAAU;YACnB,SAAS,OAAO,CAAC,MAAM,MAAM;YAC7B,MAAM,WAAW,MAAM,OAAO,IAAI,MAAM,MAAM;YAC9C,MAAM,MAAM,CAAC,OAAO,CAAC;QACzB;QAEA,IAAI,QAAQ;YACR,MAAM,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,GAAG,IAAI,CAAC,GAAG,CAAE,WAAW,EAAE;QAChE,OAAO;YACH,+CAA+C;YAC/C,oEAAoE;YACpE,MAAM,SAAS,AAAC,SAAS,MAAO,IAAI,cAAc;YAClD,MAAM,YAAY,KAAK,GAAG,CAAC,IAAI,SAAS;YACxC,MAAM,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC,WAAW,IAAI,CAAC,GAAG,CAAE,WAAW,EAAE;QACxE;IACJ;IAEA,cAAc,OAAe,EAAE,QAAgB,EAAE,OAAe,EAAE,MAAe,EAAE,UAAmB,KAAK,EAAE;QACzG,MAAM,QAAQ,IAAI,CAAC,gBAAgB,CAAC;QAEpC,IAAI,SAAS;YACT,IAAI,CAAC,MAAM,WAAW,EAAE;gBACpB,IAAI;oBACA,MAAM,WAAW,GAAG,IAAI,iBAAiB,IAAI,CAAC,GAAG,EAAG;oBACpD,MAAM,WAAW,MAAM,MAAM,IAAI,MAAM,UAAU,IAAI,CAAC,MAAM,OAAO,GAAG,MAAM,OAAO,CAAC,MAAM,OAAO,CAAC,MAAM,GAAG,EAAE,GAAG,IAAI,KAAK,MAAM,IAAI,IAAI,MAAM,KAAK;oBAClJ,SAAS,UAAU;oBACnB,SAAS,OAAO,CAAC,MAAM,WAAW;oBAClC,MAAM,WAAW,CAAC,OAAO,CAAC,MAAM,MAAM;oBACtC,QAAQ,GAAG,CAAC;gBAChB,EAAE,OAAO,GAAG;oBACR,QAAQ,IAAI,CAAC,4EAA4E;oBACzF,UAAU;gBACd;YACJ;YAEA,wCAAwC;YACxC,IAAI,MAAM,WAAW,EAAE;gBACnB,MAAM,YAAY,CAAC,MAAO,AAAC,WAAW,MAAO,KAAM,kBAAkB;gBACrE,MAAM,WAAW,CAAC,IAAI,CAAC,WAAW,CAAC;oBAC/B,MAAM;oBACN,SAAS,SAAS,IAAI;oBACtB,UAAU,WAAW;oBACrB;gBACJ;gBACA;YACJ;QACJ;QAEA,6DAA6D;QAC7D,IAAI,MAAM,WAAW,EAAE;YACnB,MAAM,WAAW,CAAC,UAAU;QAChC;QAEA,IAAI,CAAC,MAAM,OAAO,EAAE;YAChB,MAAM,OAAO,GAAG,IAAI,CAAC,GAAG,CAAE,wBAAwB;YAClD,MAAM,OAAO,CAAC,KAAK,CAAC,KAAK,GAAG;YAC5B,MAAM,OAAO,CAAC,MAAM,CAAC,KAAK,GAAG;YAC7B,MAAM,OAAO,CAAC,OAAO,CAAC,KAAK,GAAG;YAC9B,MAAM,WAAW,MAAM,MAAM,IAAI,MAAM,UAAU,IAAI,CAAC,MAAM,OAAO,GAAG,MAAM,OAAO,CAAC,MAAM,OAAO,CAAC,MAAM,GAAG,EAAE,GAAG,IAAI,KAAK,MAAM,IAAI,IAAI,MAAM,KAAK;YAClJ,SAAS,UAAU;YACnB,SAAS,OAAO,CAAC,MAAM,OAAO;YAC9B,MAAM,OAAO,CAAC,OAAO,CAAC,MAAM,MAAM;QACtC;QAEA,IAAI,QAAQ;YACR,MAAM,OAAO,CAAC,KAAK,CAAC,eAAe,CAAC,GAAG,IAAI,CAAC,GAAG,CAAE,WAAW,EAAE;QAClE,OAAO;YACH,MAAM,YAAY,UAAW,AAAC,WAAW,MAAO;YAChD,MAAM,OAAO,CAAC,SAAS,CAAC,eAAe,CAAC,WAAW,IAAI,CAAC,GAAG,CAAE,WAAW,EAAE;QAC9E;IACJ;IAGA,gBAAgB,OAAe,EAAE,MAAc,EAAE,OAAe,EAAE,MAAe,EAAE;IAC/E,sFAAsF;IACtF,+EAA+E;IACnF;AACJ;AAEO,MAAM,cAAc,IAAI"}},
    {"offset": {"line": 576, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/lib/audio-engine-bridge.ts"],"sourcesContent":["import { audioEngine } from './audio/WebAudioEngine';\n\nexport { audioEngine };\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 587, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/StudioMonitor.tsx"],"sourcesContent":["import React, { useMemo, useState, useEffect } from 'react';\nimport { motion } from 'framer-motion';\nimport { useDAWStore } from '@/store/useDAWStore';\nimport { audioEngine } from '@/lib/audio-engine-bridge';\n\nexport function StudioMonitor({ className = '' }: { className?: string }) {\n    const isPlaying = useDAWStore((state) => state.isPlaying);\n    const [bassLevel, setBassLevel] = useState(0); // 0 to 1\n    const [midLevel, setMidLevel] = useState(0); // 0 to 1\n\n    useEffect(() => {\n        if (!isPlaying) {\n            setBassLevel(0);\n            setMidLevel(0);\n            return;\n        }\n\n        let animationFrameId: number;\n        const updateLevels = () => {\n            // Get bass frequency intensity (20Hz - 150Hz) for woofer\n            const bass = audioEngine.getFrequencyLevel('master-track', 20, 150);\n            // Get mid frequency intensity (150Hz - 2kHz) for cabinetry/tweeter\n            const mid = audioEngine.getFrequencyLevel('master-track', 150, 2000);\n            \n            setBassLevel(bass);\n            setMidLevel(mid);\n            \n            animationFrameId = requestAnimationFrame(updateLevels);\n        };\n\n        updateLevels();\n        return () => cancelAnimationFrame(animationFrameId);\n    }, [isPlaying]);\n\n    // Calculate pulse intensity: 1.0 (base) to 1.05 (max mid/high expansion)\n    const pulseScale = useMemo(() => {\n        return 1 + (midLevel * 0.03); \n    }, [midLevel]);\n\n    // Woofer specific pulse (stronger vibration)\n    const wooferScale = useMemo(() => {\n        return 1 + (bassLevel * 0.15); \n    }, [bassLevel]);\n\n    return (\n        <div className={`flex flex-col items-center justify-center w-64 h-96 ${className}`}>\n            {/* Speaker Cabinet (The wooden box) */}\n            <motion.div\n                animate={{ scale: pulseScale }}\n                transition={{ type: 'spring', stiffness: 300, damping: 20 }}\n                className=\"w-full h-full bg-[#1A1A1C] border border-[#222] rounded-md shadow-[-20px_0_50px_rgba(0,0,0,0.8),20px_0_50px_rgba(0,0,0,0.8),inset_0_4px_10px_rgba(255,255,255,0.02)] flex flex-col items-center py-8 relative justify-between\"\n            >\n\n                {/* Wood Grain Texture Overlay */}\n                <div className=\"absolute inset-0 bg-transparent mix-blend-overlay opacity-10 pointer-events-none rounded-md\" />\n\n                {/* Top Tweeter */}\n                <div className=\"w-24 h-24 rounded-full bg-[#2A2A2D] border-2 border-[#111] shadow-[inset_0_5px_15px_rgba(0,0,0,0.8)] flex items-center justify-center relative z-10\">\n                    <div className=\"w-12 h-12 rounded-full bg-black/80 blur-[2px] absolute\" />\n                    {/* Tweeter Cone Details */}\n                    <div className=\"w-16 h-16 rounded-full border border-white/5 flex items-center justify-center\">\n                        <div className=\"w-6 h-6 rounded-full bg-[#3A3A3D] shadow-[0_0_10px_rgba(0,0,0,0.9)]\" />\n                        <div className=\"absolute w-[2px] h-3 bg-[#444] top-8\" />\n                        <div className=\"absolute w-[2px] h-3 bg-[#444] top-[48px] -rotate-[120deg] left-10\" />\n                        <div className=\"absolute w-[2px] h-3 bg-[#444] top-[48px] rotate-[120deg] right-10\" />\n                    </div>\n                </div>\n\n                {/* Bottom Woofer */}\n                <div className=\"w-48 h-48 rounded-full bg-[#202022] border-[4px] border-[#0a0a0a] shadow-[inset_0_10px_30px_rgba(0,0,0,0.9),0_5px_15px_rgba(0,0,0,0.5)] flex items-center justify-center relative mt-auto z-10\">\n                    {/* White Woofer Cone - Animated scale for vibration */}\n                    <motion.div\n                        animate={{ scale: wooferScale }}\n                        transition={{ type: 'spring', stiffness: 400, damping: 15 }}\n                        className=\"w-36 h-36 rounded-full bg-gradient-to-br from-[#f0f0f0] to-[#aaaaaa] shadow-[inset_0_-5px_15px_rgba(0,0,0,0.5)] flex items-center justify-center\"\n                    >\n                        {/* Center Dust Cap */}\n                        <div className=\"w-16 h-16 rounded-full bg-[#d0d0d0] border border-white/40 shadow-[0_2px_5px_rgba(0,0,0,0.2)]\" />\n                    </motion.div>\n                </div>\n\n            </motion.div>\n\n            {/* Monitor Base Shadow - Also pulse slightly */}\n            <motion.div\n                animate={{ scaleX: pulseScale, opacity: 0.7 + (bassLevel * 0.3) }}\n                className=\"w-48 h-4 bg-black/90 blur-xl mt-2 rounded-full\"\n            />\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;AAAA;;;;;;;AAEO,SAAS,cAAc,EAAE,YAAY,EAAE,EAA0B;;IACpE,MAAM,YAAY,IAAA,yKAAW;gDAAC,CAAC,QAAU,MAAM,SAAS;;IACxD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,4MAAQ,EAAC,IAAI,SAAS;IACxD,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,4MAAQ,EAAC,IAAI,SAAS;IAEtD,IAAA,6MAAS;mCAAC;YACN,IAAI,CAAC,WAAW;gBACZ,aAAa;gBACb,YAAY;gBACZ;YACJ;YAEA,IAAI;YACJ,MAAM;wDAAe;oBACjB,yDAAyD;oBACzD,MAAM,OAAO,mLAAW,CAAC,iBAAiB,CAAC,gBAAgB,IAAI;oBAC/D,mEAAmE;oBACnE,MAAM,MAAM,mLAAW,CAAC,iBAAiB,CAAC,gBAAgB,KAAK;oBAE/D,aAAa;oBACb,YAAY;oBAEZ,mBAAmB,sBAAsB;gBAC7C;;YAEA;YACA;2CAAO,IAAM,qBAAqB;;QACtC;kCAAG;QAAC;KAAU;IAEd,yEAAyE;IACzE,MAAM,aAAa,IAAA,2MAAO;6CAAC;YACvB,OAAO,IAAK,WAAW;QAC3B;4CAAG;QAAC;KAAS;IAEb,6CAA6C;IAC7C,MAAM,cAAc,IAAA,2MAAO;8CAAC;YACxB,OAAO,IAAK,YAAY;QAC5B;6CAAG;QAAC;KAAU;IAEd,qBACI,gOAAC;QAAI,WAAW,CAAC,oDAAoD,EAAE,WAAW;;0BAE9E,gOAAC,0OAAM,CAAC,GAAG;gBACP,SAAS;oBAAE,OAAO;gBAAW;gBAC7B,YAAY;oBAAE,MAAM;oBAAU,WAAW;oBAAK,SAAS;gBAAG;gBAC1D,WAAU;;kCAIV,gOAAC;wBAAI,WAAU;;;;;;kCAGf,gOAAC;wBAAI,WAAU;;0CACX,gOAAC;gCAAI,WAAU;;;;;;0CAEf,gOAAC;gCAAI,WAAU;;kDACX,gOAAC;wCAAI,WAAU;;;;;;kDACf,gOAAC;wCAAI,WAAU;;;;;;kDACf,gOAAC;wCAAI,WAAU;;;;;;kDACf,gOAAC;wCAAI,WAAU;;;;;;;;;;;;;;;;;;kCAKvB,gOAAC;wBAAI,WAAU;kCAEX,cAAA,gOAAC,0OAAM,CAAC,GAAG;4BACP,SAAS;gCAAE,OAAO;4BAAY;4BAC9B,YAAY;gCAAE,MAAM;gCAAU,WAAW;gCAAK,SAAS;4BAAG;4BAC1D,WAAU;sCAGV,cAAA,gOAAC;gCAAI,WAAU;;;;;;;;;;;;;;;;;;;;;;0BAO3B,gOAAC,0OAAM,CAAC,GAAG;gBACP,SAAS;oBAAE,QAAQ;oBAAY,SAAS,MAAO,YAAY;gBAAK;gBAChE,WAAU;;;;;;;;;;;;AAI1B;GArFgB;;QACM,yKAAW;;;KADjB"}},
    {"offset": {"line": 795, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/MasteringKnob.tsx"],"sourcesContent":["import React from 'react';\n\ninterface MasteringKnobProps {\n    label: string;\n    value: number; // 0 to 100\n    onChange?: (value: number) => void;\n    size?: 'sm' | 'md' | 'lg';\n}\n\nexport function MasteringKnob({ label, value, onChange, size = 'md' }: MasteringKnobProps) {\n    // Calculate rotation (-135deg to +135deg for a standard 270 degree sweep)\n    const rotation = -135 + (value / 100) * 270;\n\n    const sizeClasses = {\n        sm: 'w-10 h-10',\n        md: 'w-16 h-16',\n        lg: 'w-24 h-24'\n    };\n\n    return (\n        <div \n            className=\"flex flex-col items-center gap-3\"\n            onMouseDown={(e) => {\n                const startY = e.clientY;\n                const startValue = value;\n                \n                const handleMouseMove = (moveEvent: MouseEvent) => {\n                    const deltaY = startY - moveEvent.clientY;\n                    const newValue = Math.min(100, Math.max(0, startValue + deltaY));\n                    if (onChange) onChange(newValue);\n                };\n\n                const handleMouseUp = () => {\n                    window.removeEventListener('mousemove', handleMouseMove);\n                    window.removeEventListener('mouseup', handleMouseUp);\n                    document.body.style.cursor = 'default';\n                };\n\n                window.addEventListener('mousemove', handleMouseMove);\n                window.addEventListener('mouseup', handleMouseUp);\n                document.body.style.cursor = 'ns-resize';\n            }}\n        >\n            {/* Knob Container (The groove/shadow it sits in) */}\n            <div className={`${sizeClasses[size]} rounded-full bg-[#1A1A1A] p-1 shadow-[inset_0_4px_10px_rgba(0,0,0,0.8),0_2px_4px_rgba(255,255,255,0.05)] relative flex items-center justify-center`}>\n\n                {/* The Knob Body */}\n                <div\n                    className=\"w-full h-full rounded-full bg-gradient-to-b from-[#333] to-[#111] shadow-[0_4px_8px_rgba(0,0,0,0.6),inset_0_2px_1px_rgba(255,255,255,0.2)] relative cursor-ns-resize group transition-transform duration-500 ease-out\"\n                    style={{ transform: `rotate(${rotation}deg)` }}\n                >\n                    {/* The Indicator Line */}\n                    <div className=\"absolute top-1 left-1/2 -translate-x-1/2 w-0.5 h-1/4 bg-white/80 rounded-full shadow-[0_0_2px_rgba(255,255,255,0.5)] group-hover:bg-cyan-glow group-hover:shadow-[0_0_5px_rgba(0,240,255,0.8)] transition-colors\" />\n                </div>\n            </div>\n\n            {/* Label */}\n            <span className=\"text-[10px] font-bold tracking-widest text-[#888] uppercase select-none\">{label}</span>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;;AASO,SAAS,cAAc,EAAE,KAAK,EAAE,KAAK,EAAE,QAAQ,EAAE,OAAO,IAAI,EAAsB;IACrF,0EAA0E;IAC1E,MAAM,WAAW,CAAC,MAAM,AAAC,QAAQ,MAAO;IAExC,MAAM,cAAc;QAChB,IAAI;QACJ,IAAI;QACJ,IAAI;IACR;IAEA,qBACI,gOAAC;QACG,WAAU;QACV,aAAa,CAAC;YACV,MAAM,SAAS,EAAE,OAAO;YACxB,MAAM,aAAa;YAEnB,MAAM,kBAAkB,CAAC;gBACrB,MAAM,SAAS,SAAS,UAAU,OAAO;gBACzC,MAAM,WAAW,KAAK,GAAG,CAAC,KAAK,KAAK,GAAG,CAAC,GAAG,aAAa;gBACxD,IAAI,UAAU,SAAS;YAC3B;YAEA,MAAM,gBAAgB;gBAClB,OAAO,mBAAmB,CAAC,aAAa;gBACxC,OAAO,mBAAmB,CAAC,WAAW;gBACtC,SAAS,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG;YACjC;YAEA,OAAO,gBAAgB,CAAC,aAAa;YACrC,OAAO,gBAAgB,CAAC,WAAW;YACnC,SAAS,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG;QACjC;;0BAGA,gOAAC;gBAAI,WAAW,GAAG,WAAW,CAAC,KAAK,CAAC,mJAAmJ,CAAC;0BAGrL,cAAA,gOAAC;oBACG,WAAU;oBACV,OAAO;wBAAE,WAAW,CAAC,OAAO,EAAE,SAAS,IAAI,CAAC;oBAAC;8BAG7C,cAAA,gOAAC;wBAAI,WAAU;;;;;;;;;;;;;;;;0BAKvB,gOAAC;gBAAK,WAAU;0BAA2E;;;;;;;;;;;;AAGvG;KAnDgB"}},
    {"offset": {"line": 878, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/store/useMasteringStore.ts"],"sourcesContent":["import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\n\nexport interface MasteringSettings {\n    // Gate\n    gateThreshold: number;\n    gateAttack: number;\n    gateRelease: number;\n    \n    // EQ\n    eqHighpass: number;\n    eqTilt: number;\n    eqSideGain: number;\n    eqSideFreq: number;\n    \n    // Leveler\n    levelerTarget: number;\n    levelerBrake: number;\n    levelerMaxPlus: number;\n    levelerMaxMinus: number;\n    \n    // Knee Compressor\n    compStrength: number;\n    compAttack: number;\n    compRelease: number;\n    compKnee: number;\n    compMakeup: number;\n    \n    // Multiband (interpolated low/high)\n    mbStrengthLow: number;\n    mbStrengthHigh: number;\n    mbAttackLow: number;\n    mbAttackHigh: number;\n    mbCrossoverLow: number;\n    mbCrossoverHigh: number;\n    \n    // Limiter & Brickwall\n    limStrength: number;\n    limAttack: number;\n    limRelease: number;\n    limCeiling: number;\n\n    // Legacy/Quick controls (for compatibility if needed)\n    inputDrive: number;\n    stereoWidth: number;\n\n    // Bypasses\n    gateBypass: boolean;\n    eqBypass: boolean;\n    levelerBypass: boolean;\n    compBypass: boolean;\n    mbBypass: boolean;\n    limBypass: boolean;\n}\n\nexport interface MasteringProject {\n    id: string;\n    name: string;\n    date: string;\n    audioUrl: string | null;\n    audioId?: string;\n    dna: string;\n    settings: MasteringSettings;\n    frequencyData?: number[]; // Snapshot of final spectral balance\n}\n\ninterface MasteringState {\n    history: MasteringProject[];\n    currentModule: 'gate' | 'eq' | 'leveler' | 'compressor' | 'multiband' | 'limiter';\n    setCurrentModule: (module: 'gate' | 'eq' | 'leveler' | 'compressor' | 'multiband' | 'limiter') => void;\n    addToHistory: (project: Omit<MasteringProject, 'date'>) => void;\n    deleteFromHistory: (id: string) => void;\n    getProjectById: (id: string) => MasteringProject | undefined;\n    cleanupOldHistory: () => void;\n}\n\nexport const useMasteringStore = create<MasteringState>()(\n    persist(\n        (set, get) => ({\n            history: [],\n            currentModule: 'leveler',\n            setCurrentModule: (module) => set({ currentModule: module }),\n            addToHistory: (project) => {\n                const newProject = {\n                    ...project,\n                    date: new Date().toISOString(),\n                };\n                set((state) => {\n                    // Remove any existing entry with the same ID to prevent duplication\n                    const filteredHistory = state.history.filter(p => p.id !== project.id);\n                    return {\n                        history: [newProject, ...filteredHistory],\n                    };\n                });\n            },\n            deleteFromHistory: (id) => {\n                set((state) => ({\n                    history: state.history.filter((p) => p.id !== id),\n                }));\n            },\n            getProjectById: (id) => {\n                return get().history.find((p) => p.id === id);\n            },\n            cleanupOldHistory: () => {\n                const NINETY_DAYS_MS = 90 * 24 * 60 * 60 * 1000;\n                const now = Date.now();\n                set((state) => ({\n                    history: state.history.filter((p) => {\n                        const projectDate = new Date(p.date).getTime();\n                        return (now - projectDate) < NINETY_DAYS_MS;\n                    }),\n                }));\n            },\n        }),\n        {\n            name: 'mastering-history-storage',\n        }\n    )\n);\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AA2EO,MAAM,oBAAoB,IAAA,wLAAM,IACnC,IAAA,8LAAO,EACH,CAAC,KAAK,MAAQ,CAAC;QACX,SAAS,EAAE;QACX,eAAe;QACf,kBAAkB,CAAC,SAAW,IAAI;gBAAE,eAAe;YAAO;QAC1D,cAAc,CAAC;YACX,MAAM,aAAa;gBACf,GAAG,OAAO;gBACV,MAAM,IAAI,OAAO,WAAW;YAChC;YACA,IAAI,CAAC;gBACD,oEAAoE;gBACpE,MAAM,kBAAkB,MAAM,OAAO,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,QAAQ,EAAE;gBACrE,OAAO;oBACH,SAAS;wBAAC;2BAAe;qBAAgB;gBAC7C;YACJ;QACJ;QACA,mBAAmB,CAAC;YAChB,IAAI,CAAC,QAAU,CAAC;oBACZ,SAAS,MAAM,OAAO,CAAC,MAAM,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;gBAClD,CAAC;QACL;QACA,gBAAgB,CAAC;YACb,OAAO,MAAM,OAAO,CAAC,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;QAC9C;QACA,mBAAmB;YACf,MAAM,iBAAiB,KAAK,KAAK,KAAK,KAAK;YAC3C,MAAM,MAAM,KAAK,GAAG;YACpB,IAAI,CAAC,QAAU,CAAC;oBACZ,SAAS,MAAM,OAAO,CAAC,MAAM,CAAC,CAAC;wBAC3B,MAAM,cAAc,IAAI,KAAK,EAAE,IAAI,EAAE,OAAO;wBAC5C,OAAO,AAAC,MAAM,cAAe;oBACjC;gBACJ,CAAC;QACL;IACJ,CAAC,GACD;IACI,MAAM;AACV"}},
    {"offset": {"line": 936, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/StudioChat.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useRef, useEffect, useCallback } from 'react';\nimport { Send, Sparkles, Wand2, Mic2, Scissors, PlayCircle, ChevronRight, MessageSquare, Mic, MicOff, Volume2 } from 'lucide-react';\nimport { useDAWStore } from '@/store/useDAWStore';\n\n// Type definition for Web Speech API\ninterface SpeechRecognition extends EventTarget {\n    continuous: boolean;\n    interimResults: boolean;\n    lang: string;\n    start(): void;\n    stop(): void;\n    onresult: (event: any) => void;\n    onerror: (event: any) => void;\n    onend: () => void;\n}\n\ndeclare global {\n    interface Window {\n        webkitSpeechRecognition: any;\n        SpeechRecognition: any;\n    }\n}\n\nexport function StudioChat({\n    embedded = false,\n    songName,\n    onExecuteMastering\n}: {\n    embedded?: boolean,\n    songName?: string,\n    onExecuteMastering?: () => void\n}) {\n    const addTrack = useDAWStore((state) => state.addTrack);\n    const setTracks = useDAWStore((state) => state.setTracks);\n    const clearTracks = useDAWStore((state) => state.clearTracks);\n    const tracks = useDAWStore((state) => state.tracks);\n\n    const [isOpen, setIsOpen] = useState(false);\n    const [input, setInput] = useState('');\n    const [messages, setMessages] = useState<{ role: 'user' | 'assistant', content: string }[]>([]);\n\n    useEffect(() => {\n        const greeting = songName\n            ? `Necesitas ayuda con tu master de \"${songName}\"? Aqu estoy listo para ayudarte.`\n            : 'Estamos en el studio! El plan est listo. Quieres que genere la primera mitad de los instrumentos o prefieres grabar algo t primero?';\n\n        setMessages([{ role: 'assistant', content: greeting }]);\n    }, [songName]);\n    const [isTyping, setIsTyping] = useState(false);\n    const [isListening, setIsListening] = useState(false);\n    const [isSpeaking, setIsSpeaking] = useState(false);\n\n    const scrollRef = useRef<HTMLDivElement>(null);\n    const recognitionRef = useRef<SpeechRecognition | null>(null);\n    const audioRef = useRef<HTMLAudioElement | null>(null);\n\n    useEffect(() => {\n        if (scrollRef.current) {\n            scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n        }\n    }, [messages]);\n\n    // Initialize Speech Recognition\n    useEffect(() => {\n        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n        if (SpeechRecognition) {\n            const recognition = new SpeechRecognition();\n            recognition.continuous = true;\n            recognition.interimResults = false;\n            recognition.lang = 'es-ES';\n\n            recognition.onresult = (event: any) => {\n                const transcript = event.results[event.results.length - 1][0].transcript;\n                if (transcript.trim()) {\n                    handleVoiceInput(transcript);\n                }\n            };\n\n            recognition.onerror = (event: any) => {\n                console.error('Speech recognition error', event.error);\n                setIsListening(false);\n            };\n\n            recognition.onend = () => {\n                if (isListening) recognition.start(); // Auto-restart if it should be listening\n            };\n\n            recognitionRef.current = recognition;\n        }\n    }, [isListening]);\n\n    const playJohnVoice = async (text: string) => {\n        try {\n            setIsSpeaking(true);\n            const response = await fetch('/api/ai/tts', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ text })\n            });\n\n            if (!response.ok) throw new Error('Failed to fetch voice');\n\n            const blob = await response.blob();\n            const url = URL.createObjectURL(blob);\n\n            if (audioRef.current) {\n                audioRef.current.src = url;\n                audioRef.current.play();\n            } else {\n                const audio = new Audio(url);\n                audioRef.current = audio;\n                audio.play();\n            }\n\n            audioRef.current!.onended = () => {\n                setIsSpeaking(false);\n                URL.revokeObjectURL(url);\n            };\n        } catch (error) {\n            console.error('TTS Error:', error);\n            setIsSpeaking(false);\n        }\n    };\n\n    const triggerGeneration = () => {\n        setIsTyping(true);\n        setTimeout(() => {\n            const demoTracks: any[] = [\n                { id: 't-beat', name: 'Dark Trap Beat (AI)', color: '#FF6B00', trackType: 'stereo' },\n                { id: 't-808', name: 'Heavy 808 Sub', color: '#B026FF', trackType: 'stereo' },\n                { id: 't-melody', name: 'Dark Piano Melody', color: '#00F0FF', trackType: 'stereo' },\n                { id: 't-perch', name: 'Percussion Loop', color: '#A4ECA1', trackType: 'stereo' }\n            ];\n            setTracks(demoTracks);\n            const msg = \"Listo! He abierto los tracks en el espacio de trabajo como por arte de magia. He configurado la batera, el bajo y la meloda principal. Escuchamos esta primera parte?\";\n            setMessages(prev => [...prev, { role: 'assistant', content: msg }]);\n            setIsTyping(false);\n            playJohnVoice(msg);\n        }, 1500);\n    };\n\n    const handleSend = async (forcedInput?: string) => {\n        const textToSend = forcedInput || input;\n        if (!textToSend.trim() || isTyping) return;\n\n        setInput('');\n        setMessages(prev => [...prev, { role: 'user', content: textToSend }]);\n\n        const lowInput = textToSend.toLowerCase();\n        if (lowInput.includes('genera') || lowInput.includes('mitad') || lowInput.includes('abre')) {\n            triggerGeneration();\n            return;\n        }\n\n        if ((lowInput.includes('masteriza') || lowInput.includes('arregla') || lowInput.includes('aplica el adn')) && onExecuteMastering) {\n            setIsTyping(true);\n            setTimeout(() => {\n                onExecuteMastering();\n                const msg = \"Claro que s! Estoy analizando el ADN de tu mezcla ahora mismo. Voy a aplicar mi configuracin Gold Standard para que suene con todo el peso de Da Graba Studio. Mira cmo se mueven los equipos!\";\n                setMessages(prev => [...prev, { role: 'assistant', content: msg }]);\n                setIsTyping(false);\n                playJohnVoice(msg);\n            }, 1000);\n            return;\n        }\n\n        setIsTyping(true);\n        try {\n            const history = messages.map(m => ({ role: m.role, content: m.content }));\n            const response = await fetch('/api/ai/engineer', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ message: textToSend, history })\n            });\n\n            if (!response.ok) throw new Error('Failed to fetch AI response');\n\n            const data = await response.json();\n            const aiMessage = data.message;\n\n            setMessages(prev => [...prev, { role: 'assistant', content: aiMessage }]);\n            setIsTyping(false);\n            playJohnVoice(aiMessage);\n        } catch (error) {\n            console.error('AI Error:', error);\n            const errorMsg = \"Lo siento, John tiene problemas de conexin ahora mismo. Pero sigo aqu.\";\n            setMessages(prev => [...prev, { role: 'assistant', content: errorMsg }]);\n            setIsTyping(false);\n        }\n    };\n\n    const handleVoiceInput = (transcript: string) => {\n        handleSend(transcript);\n    };\n\n    const toggleListening = () => {\n        if (isListening) {\n            recognitionRef.current?.stop();\n            setIsListening(false);\n        } else {\n            recognitionRef.current?.start();\n            setIsListening(true);\n        }\n    };\n\n    return (\n        <div className={embedded ? \"w-full h-full\" : `fixed right-8 bottom-32 z-50 transition-all duration-500 flex flex-col items-end ${isOpen ? 'w-80 h-[450px]' : 'w-12 h-12'}`}>\n\n            {/* TOGGLE BUTTON - Only show if not embedded */}\n            {!embedded && (\n                <div className=\"flex flex-col gap-3\">\n                    <button\n                        onClick={toggleListening}\n                        className={`w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300 shadow-2xl ${isListening ? 'bg-red-500 animate-pulse glow-red' : 'bg-white/5 border border-white/10 hover:bg-white/10'}`}\n                    >\n                        {isListening ? <Mic className=\"text-white\" size={20} /> : <MicOff className=\"text-silver-dark\" size={20} />}\n                    </button>\n\n                    <button\n                        onClick={() => setIsOpen(!isOpen)}\n                        className={`w-12 h-12 rounded-full flex items-center justify-center transition-all duration-300 shadow-2xl ${isOpen ? 'bg-orange-600 scale-90' : 'bg-gradient-to-br from-cyan-glow to-blue-600 glow-cyan hover:scale-110'}`}\n                    >\n                        {isOpen ? <ChevronRight className=\"text-white\" /> : <MessageSquare className=\"text-white\" />}\n                    </button>\n                </div>\n            )}\n\n            {/* CHAT WINDOW */}\n            <div className={`${embedded ? 'w-full h-full' : 'mt-4 w-full h-full'} bg-[#0B1015]/95 backdrop-blur-xl border border-white/10 rounded-2xl flex flex-col overflow-hidden shadow-[0_20px_50px_rgba(0,0,0,0.5)] transition-opacity duration-300 ${embedded || isOpen ? 'opacity-100' : 'opacity-0 pointer-events-none'}`}>\n\n                {/* Header */}\n                <div className=\"px-4 py-3 border-b border-white/5 bg-white/5 flex items-center justify-between\">\n                    <div className=\"flex items-center gap-2\">\n                        <Sparkles size={16} className=\"text-cyan-glow\" />\n                        <span className=\"text-xs font-bold tracking-widest text-[#E0E0E0]\">ENGINEER FEEDBACK</span>\n                    </div>\n                    {isSpeaking && <Volume2 size={14} className=\"text-cyan-glow animate-pulse\" />}\n                </div>\n\n                {/* Messages Panel */}\n                <div ref={scrollRef} className=\"flex-1 overflow-y-auto p-4 flex flex-col gap-4 custom-scrollbar\">\n                    {messages.map((m, i) => (\n                        <div key={i} className={`flex flex-col ${m.role === 'user' ? 'items-end' : 'items-start'}`}>\n                            <div className={`max-w-[85%] px-3 py-2 rounded-xl text-xs leading-relaxed ${m.role === 'user'\n                                ? 'bg-orange-600/20 border border-orange-500/30 text-white'\n                                : 'bg-white/5 border border-white/10 text-silver-light'\n                                }`}>\n                                {m.content}\n                            </div>\n                        </div>\n                    ))}\n                    {isTyping && (\n                        <div className=\"flex gap-1 ml-2\">\n                            <div className=\"w-1.5 h-1.5 bg-cyan-glow rounded-full animate-bounce\" />\n                            <div className=\"w-1.5 h-1.5 bg-cyan-glow rounded-full animate-bounce [animation-delay:0.2s]\" />\n                            <div className=\"w-1.5 h-1.5 bg-cyan-glow rounded-full animate-bounce [animation-delay:0.4s]\" />\n                        </div>\n                    )}\n                </div>\n\n                {/* Quick Actions */}\n                <div className=\"px-3 py-2 flex gap-2 overflow-x-auto border-t border-white/5 bg-black/20 no-scrollbar\">\n                    <button\n                        onClick={triggerGeneration}\n                        className=\"whitespace-nowrap flex items-center gap-1.5 px-2 py-1 rounded bg-white/5 border border-white/10 text-[10px] text-silver-dark hover:text-cyan-glow transition-colors\"\n                    >\n                        <Wand2 size={10} /> Generar Mitad\n                    </button>\n                    <button className=\"whitespace-nowrap flex items-center gap-1.5 px-2 py-1 rounded bg-white/5 border border-white/10 text-[10px] text-silver-dark hover:text-white transition-colors\">\n                        <PlayCircle size={10} /> Continuar\n                    </button>\n                    <button\n                        onClick={clearTracks}\n                        className=\"whitespace-nowrap flex items-center gap-1.5 px-2 py-1 rounded bg-white/5 border border-white/10 text-[10px] text-red-400 hover:text-red-300 transition-colors\"\n                    >\n                        <Scissors size={10} /> Limpiar Todo\n                    </button>\n                    <button className=\"whitespace-nowrap flex items-center gap-1.5 px-2 py-1 rounded bg-white/5 border border-white/10 text-[10px] text-silver-dark hover:text-white transition-colors\">\n                        <Mic2 size={10} /> Grabar Hum\n                    </button>\n                </div>\n\n                {/* Input Area */}\n                <div className=\"p-3 bg-black/40 flex items-center gap-2\">\n                    <input\n                        type=\"text\"\n                        value={input}\n                        onChange={(e) => setInput(e.target.value)}\n                        onKeyDown={(e) => e.key === 'Enter' && handleSend()}\n                        placeholder={isListening ? \"Te escucho...\" : \"Dime qu sigue...\"}\n                        className=\"flex-1 bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-xs text-white placeholder:text-gray-600 focus:outline-none focus:border-cyan-glow/50 transition-colors\"\n                    />\n                    <button\n                        onClick={() => handleSend()}\n                        className=\"p-2 bg-orange-600 rounded-lg hover:bg-orange-500 transition-colors shadow-lg\"\n                    >\n                        <Send size={14} className=\"text-white\" />\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1502, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/lib/utils.ts"],"sourcesContent":["import { type ClassValue, clsx } from 'clsx';\nimport { twMerge } from 'tailwind-merge';\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,4MAAO,EAAC,IAAA,mLAAI,EAAC;AACtB"}},
    {"offset": {"line": 1520, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/components/daw/SpectrumAnalyzer.tsx"],"sourcesContent":["'use client';\n\nimport React, { useEffect, useRef } from 'react';\nimport { cn } from '@/lib/utils';\nimport { useDAWStore } from '@/store/useDAWStore';\n\ninterface SpectrumAnalyzerProps {\n    analyzer?: AnalyserNode; // Optional: If provided, uses real audio data\n    naked?: boolean; // If true, removes background and border\n    isPlaying?: boolean; // Optional override\n}\n\nexport function SpectrumAnalyzer({ analyzer, naked, isPlaying }: SpectrumAnalyzerProps) {\n    const dawIsPlaying = useDAWStore((state) => state.isPlaying);\n    const actualIsPlaying = isPlaying !== undefined ? isPlaying : dawIsPlaying;\n    \n    const isPlayingRef = useRef(actualIsPlaying);\n    useEffect(() => {\n        isPlayingRef.current = actualIsPlaying;\n    }, [actualIsPlaying]);\n\n    const canvasRef = useRef<HTMLCanvasElement>(null);\n    const requestRef = useRef<number>(0);\n\n    // Smooth falloff state holding the max peaks\n    const peaksRef = useRef<number[]>([]);\n\n    useEffect(() => {\n        const canvas = canvasRef.current;\n        if (!canvas) return;\n\n        const ctx = canvas.getContext('2d');\n        if (!ctx) return;\n\n        // Ensure canvas renders sharply on high-DPI displays\n        const scale = window.devicePixelRatio || 1;\n        canvas.width = canvas.clientWidth * scale;\n        canvas.height = canvas.clientHeight * scale;\n        ctx.scale(scale, scale);\n\n        const width = canvas.clientWidth;\n        const height = canvas.clientHeight;\n\n        let dataArray: Uint8Array;\n        let bufferLength = 128; // Default if no analyzer\n\n        if (analyzer) {\n            bufferLength = analyzer.frequencyBinCount;\n            dataArray = new Uint8Array(bufferLength);\n        } else {\n            dataArray = new Uint8Array(bufferLength);\n        }\n\n        // Initialize peaks array\n        if (peaksRef.current.length !== bufferLength) {\n            peaksRef.current = new Array(bufferLength).fill(0);\n        }\n\n        const renderFrame = () => {\n            requestRef.current = requestAnimationFrame(renderFrame);\n\n            if (!isPlayingRef.current) {\n                // Dim the display when not playing\n                ctx.clearRect(0, 0, canvas.width, canvas.height);\n                // Slowly decay any existing peaks\n                peaksRef.current = peaksRef.current.map(p => p * 0.9);\n\n                // Draw static low baseline\n                const barWidth = Math.ceil(canvas.width / bufferLength);\n                for (let i = 0; i < bufferLength; i++) {\n                    const x = i * barWidth;\n                    ctx.fillStyle = `rgba(255, 107, 0, 0.05)`;\n                    ctx.fillRect(x, canvas.height - 2, barWidth - 1, 2);\n                }\n                return;\n            }\n\n            // Get audio data\n            if (analyzer) {\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                analyzer.getByteFrequencyData(dataArray as any);\n            } else {\n                // Simulate data for visual placeholder\n                const time = Date.now() / 1000;\n                for (let i = 0; i < bufferLength; i++) {\n                    // Create some dynamic peaks that look like music\n                    const noise = Math.random() * 20;\n                    const wave1 = Math.sin(time * 2 + i * 0.1) * 50 + 50;\n                    const wave2 = Math.cos(time * 5 - i * 0.3) * 60 + 60;\n\n                    // Emphasize bass (lower indices)\n                    const bassBoost = i < 20 ? (20 - i) * 3 : 0;\n\n                    // Attenuate highs\n                    const highCut = i > 80 ? (i - 80) * 2 : 0;\n\n                    let val = (wave1 + wave2) / 2 + noise + bassBoost - highCut;\n\n                    // Occasional random spikes (like kick/snare)\n                    if (Math.random() > 0.95 && i < 40) val += 80;\n\n                    dataArray[i] = Math.max(0, Math.min(255, val));\n                }\n            }\n\n            // Clear canvas\n            ctx.clearRect(0, 0, width, height);\n\n            // Calculate bar width (leaving some gap)\n            // We use a subset of the buffer for better aesthetics (skipping the very highest dead frequencies)\n            const displayBins = Math.floor(bufferLength * 0.7);\n            const barWidth = (width / displayBins) - 1; // 1px gap\n            let x = 0;\n\n            const peaks = peaksRef.current;\n            const gravity = 1.5; // Speed at which peaks fall\n\n            for (let i = 0; i < displayBins; i++) {\n                const value = dataArray[i];\n\n                // Update peak for smooth falloff\n                if (value > peaks[i]) {\n                    peaks[i] = value;\n                } else {\n                    peaks[i] = Math.max(0, peaks[i] - gravity);\n                }\n\n                // Normalize values to canvas height\n                const barHeight = (value / 255) * height;\n                const peakHeight = (peaks[i] / 255) * height;\n\n                // --- Draw Main Bar ---\n                // Gradient from Metallic Gray to DA GRABA Naranja (#FF6B00)\n                const barGradient = ctx.createLinearGradient(0, height, 0, height - barHeight);\n                barGradient.addColorStop(0, '#5A5A60');      // Metallic gray base\n                barGradient.addColorStop(0.5, '#8C8C91');    // Lighter gray middle\n                barGradient.addColorStop(1, '#FF6B00');      // Orange peak\n\n                ctx.fillStyle = barGradient;\n                ctx.fillRect(x, height - barHeight, barWidth, barHeight);\n\n                // --- Draw Floating Peak (Cap) ---\n                // To enhance the 2D/3D feel, draw a bright cap at the peak level\n                ctx.fillStyle = '#FF9A4A'; // Slightly brighter orange for the cap\n                ctx.fillRect(x, height - peakHeight - 2, barWidth, 2);\n\n                x += barWidth + 1;\n            }\n        };\n\n        renderFrame();\n\n        return () => {\n            if (requestRef.current) {\n                cancelAnimationFrame(requestRef.current);\n            }\n        };\n    }, [analyzer]);\n\n    return (\n        <div className={cn(\n            \"w-full h-full relative p-2 overflow-hidden\",\n            !naked && \"bg-[#111113]/60 backdrop-blur-md rounded-lg border border-[#333] shadow-[inset_0_0_20px_rgba(0,0,0,0.8)]\"\n        )}>\n            {/* Glassmorphism reflection highlight */}\n            <div className=\"absolute top-0 left-0 right-0 h-1/3 bg-gradient-to-b from-white/5 to-transparent pointer-events-none rounded-t-lg\" />\n\n            <canvas\n                ref={canvasRef}\n                className=\"w-full h-full block\"\n            />\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1706, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/lib/audio/AudioStorage.ts"],"sourcesContent":["export class AudioStorage {\n    private static DB_NAME = 'DaGrabaAudioCache';\n    private static STORE_NAME = 'audioFiles';\n    private static DB_VERSION = 1;\n\n    private static async getDB(): Promise<IDBDatabase> {\n        return new Promise((resolve, reject) => {\n            const request = indexedDB.open(this.DB_NAME, this.DB_VERSION);\n\n            request.onerror = () => reject(request.error);\n            request.onsuccess = () => resolve(request.result);\n\n            request.onupgradeneeded = (event) => {\n                const db = (event.target as IDBOpenDBRequest).result;\n                if (!db.objectStoreNames.contains(this.STORE_NAME)) {\n                    db.createObjectStore(this.STORE_NAME);\n                }\n            };\n        });\n    }\n\n    static async saveAudio(id: string, blob: Blob): Promise<void> {\n        const db = await this.getDB();\n        return new Promise((resolve, reject) => {\n            const transaction = db.transaction(this.STORE_NAME, 'readwrite');\n            const store = transaction.objectStore(this.STORE_NAME);\n            const request = store.put(blob, id);\n\n            request.onsuccess = () => resolve();\n            request.onerror = () => reject(request.error);\n        });\n    }\n\n    static async getAudio(id: string): Promise<Blob | null> {\n        const db = await this.getDB();\n        return new Promise((resolve, reject) => {\n            const transaction = db.transaction(this.STORE_NAME, 'readonly');\n            const store = transaction.objectStore(this.STORE_NAME);\n            const request = store.get(id);\n\n            request.onsuccess = () => resolve(request.result || null);\n            request.onerror = () => reject(request.error);\n        });\n    }\n\n    static async deleteAudio(id: string): Promise<void> {\n        const db = await this.getDB();\n        return new Promise((resolve, reject) => {\n            const transaction = db.transaction(this.STORE_NAME, 'readwrite');\n            const store = transaction.objectStore(this.STORE_NAME);\n            const request = store.delete(id);\n\n            request.onsuccess = () => resolve();\n            request.onerror = () => reject(request.error);\n        });\n    }\n\n    static async createUrl(id: string): Promise<string | null> {\n        const blob = await this.getAudio(id);\n        if (!blob) return null;\n        return URL.createObjectURL(blob);\n    }\n}\n"],"names":[],"mappings":";;;;AAAO,MAAM;IACT,OAAe,UAAU,oBAAoB;IAC7C,OAAe,aAAa,aAAa;IACzC,OAAe,aAAa,EAAE;IAE9B,aAAqB,QAA8B;QAC/C,OAAO,IAAI,QAAQ,CAAC,SAAS;YACzB,MAAM,UAAU,UAAU,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,UAAU;YAE5D,QAAQ,OAAO,GAAG,IAAM,OAAO,QAAQ,KAAK;YAC5C,QAAQ,SAAS,GAAG,IAAM,QAAQ,QAAQ,MAAM;YAEhD,QAAQ,eAAe,GAAG,CAAC;gBACvB,MAAM,KAAK,AAAC,MAAM,MAAM,CAAsB,MAAM;gBACpD,IAAI,CAAC,GAAG,gBAAgB,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,GAAG;oBAChD,GAAG,iBAAiB,CAAC,IAAI,CAAC,UAAU;gBACxC;YACJ;QACJ;IACJ;IAEA,aAAa,UAAU,EAAU,EAAE,IAAU,EAAiB;QAC1D,MAAM,KAAK,MAAM,IAAI,CAAC,KAAK;QAC3B,OAAO,IAAI,QAAQ,CAAC,SAAS;YACzB,MAAM,cAAc,GAAG,WAAW,CAAC,IAAI,CAAC,UAAU,EAAE;YACpD,MAAM,QAAQ,YAAY,WAAW,CAAC,IAAI,CAAC,UAAU;YACrD,MAAM,UAAU,MAAM,GAAG,CAAC,MAAM;YAEhC,QAAQ,SAAS,GAAG,IAAM;YAC1B,QAAQ,OAAO,GAAG,IAAM,OAAO,QAAQ,KAAK;QAChD;IACJ;IAEA,aAAa,SAAS,EAAU,EAAwB;QACpD,MAAM,KAAK,MAAM,IAAI,CAAC,KAAK;QAC3B,OAAO,IAAI,QAAQ,CAAC,SAAS;YACzB,MAAM,cAAc,GAAG,WAAW,CAAC,IAAI,CAAC,UAAU,EAAE;YACpD,MAAM,QAAQ,YAAY,WAAW,CAAC,IAAI,CAAC,UAAU;YACrD,MAAM,UAAU,MAAM,GAAG,CAAC;YAE1B,QAAQ,SAAS,GAAG,IAAM,QAAQ,QAAQ,MAAM,IAAI;YACpD,QAAQ,OAAO,GAAG,IAAM,OAAO,QAAQ,KAAK;QAChD;IACJ;IAEA,aAAa,YAAY,EAAU,EAAiB;QAChD,MAAM,KAAK,MAAM,IAAI,CAAC,KAAK;QAC3B,OAAO,IAAI,QAAQ,CAAC,SAAS;YACzB,MAAM,cAAc,GAAG,WAAW,CAAC,IAAI,CAAC,UAAU,EAAE;YACpD,MAAM,QAAQ,YAAY,WAAW,CAAC,IAAI,CAAC,UAAU;YACrD,MAAM,UAAU,MAAM,MAAM,CAAC;YAE7B,QAAQ,SAAS,GAAG,IAAM;YAC1B,QAAQ,OAAO,GAAG,IAAM,OAAO,QAAQ,KAAK;QAChD;IACJ;IAEA,aAAa,UAAU,EAAU,EAA0B;QACvD,MAAM,OAAO,MAAM,IAAI,CAAC,QAAQ,CAAC;QACjC,IAAI,CAAC,MAAM,OAAO;QAClB,OAAO,IAAI,eAAe,CAAC;IAC/B;AACJ"}},
    {"offset": {"line": 1770, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/store/useCreatorStore.ts"],"sourcesContent":["import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\n\nexport interface CreatorTrack {\n    id: string;\n    title: string;\n    style: string;\n    duration: string;\n    image: string;\n    tags: string[];\n    lyrics: string;\n    views: string;\n    likes: number;\n    url: string;\n    streamAudioUrl?: string;\n}\n\n\nconst MOCK_TRACKS: CreatorTrack[] = [\n    {\n        id: 'track-1',\n        title: 'Sombras en la Calle',\n        style: 'Dark Trap, 808s, Moody',\n        duration: '2:45',\n        image: 'https://picsum.photos/seed/darktrap/200/200',\n        tags: ['Trap', 'Dark'],\n        lyrics: \"[Verse 1]\\nCaminando en la penumbra de la ciudad\\nBuscando una salida, una realidad\\nLos bajos retumban en mi pecho hoy\\nNo s a dnde voy, pero aqu estoy.\\n\\n[Chorus]\\nSombras en la calle, luces que se van\\nEl eco de un sueo que no volver.\",\n        views: '1.2k',\n        likes: 124,\n        url: 'https://cdn.pixabay.com/audio/2022/03/10/audio_c8c8a73a56.mp3'\n    },\n    {\n        id: 'track-2',\n        title: 'Luces de Nen',\n        style: 'Melodic Trap, Heavy Bass, Futuristic',\n        duration: '3:10',\n        image: 'https://picsum.photos/seed/neon/200/200',\n        tags: ['Trap', 'Melodic'],\n        lyrics: \"[Verse 1]\\nReflejos de nen en el asfalto fro\\nUn mundo de cristal, un vaco mo\\nLas mquinas cantan una meloda\\nQue me atrapa el alma, pura fantasa.\\n\\n[Chorus]\\nBrilla el nen, brilla el metal\\nUn viaje eterno, algo sideral.\",\n        views: '850',\n        likes: 92,\n        url: 'https://cdn.pixabay.com/audio/2021/11/24/audio_12345678.mp3'\n    }\n];\n\ninterface CreatorState {\n    tracks: CreatorTrack[];\n    activeTrack: CreatorTrack | null;\n    setTracks: (tracks: CreatorTrack[]) => void;\n    setActiveTrack: (track: CreatorTrack) => void;\n    addTrack: (track: CreatorTrack) => void;\n    updateTrack: (id: string, updates: Partial<CreatorTrack>) => void;\n    removeTrack: (id: string) => void;\n}\n\nexport const useCreatorStore = create<CreatorState>()(\n    persist(\n        (set) => ({\n            tracks: MOCK_TRACKS,\n            activeTrack: MOCK_TRACKS[0],\n            setTracks: (tracks) => set({ tracks }),\n            setActiveTrack: (track) => set({ activeTrack: track }),\n            addTrack: (track) => set((state) => ({\n                tracks: [track, ...state.tracks],\n                activeTrack: track\n            })),\n            updateTrack: (id, updates) => set((state) => ({\n                tracks: state.tracks.map((t) => t.id === id ? { ...t, ...updates } : t),\n                activeTrack: state.activeTrack?.id === id ? { ...state.activeTrack, ...updates } : state.activeTrack\n            })),\n            removeTrack: (id) => set((state) => ({\n                tracks: state.tracks.filter((t) => t.id !== id),\n                activeTrack: state.activeTrack?.id === id ? null : state.activeTrack\n            }))\n        }),\n        {\n            name: 'creator-tracks-storage',\n        }\n    )\n);\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAiBA,MAAM,cAA8B;IAChC;QACI,IAAI;QACJ,OAAO;QACP,OAAO;QACP,UAAU;QACV,OAAO;QACP,MAAM;YAAC;YAAQ;SAAO;QACtB,QAAQ;QACR,OAAO;QACP,OAAO;QACP,KAAK;IACT;IACA;QACI,IAAI;QACJ,OAAO;QACP,OAAO;QACP,UAAU;QACV,OAAO;QACP,MAAM;YAAC;YAAQ;SAAU;QACzB,QAAQ;QACR,OAAO;QACP,OAAO;QACP,KAAK;IACT;CACH;AAYM,MAAM,kBAAkB,IAAA,wLAAM,IACjC,IAAA,8LAAO,EACH,CAAC,MAAQ,CAAC;QACN,QAAQ;QACR,aAAa,WAAW,CAAC,EAAE;QAC3B,WAAW,CAAC,SAAW,IAAI;gBAAE;YAAO;QACpC,gBAAgB,CAAC,QAAU,IAAI;gBAAE,aAAa;YAAM;QACpD,UAAU,CAAC,QAAU,IAAI,CAAC,QAAU,CAAC;oBACjC,QAAQ;wBAAC;2BAAU,MAAM,MAAM;qBAAC;oBAChC,aAAa;gBACjB,CAAC;QACD,aAAa,CAAC,IAAI,UAAY,IAAI,CAAC,QAAU,CAAC;oBAC1C,QAAQ,MAAM,MAAM,CAAC,GAAG,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,KAAK;4BAAE,GAAG,CAAC;4BAAE,GAAG,OAAO;wBAAC,IAAI;oBACrE,aAAa,MAAM,WAAW,EAAE,OAAO,KAAK;wBAAE,GAAG,MAAM,WAAW;wBAAE,GAAG,OAAO;oBAAC,IAAI,MAAM,WAAW;gBACxG,CAAC;QACD,aAAa,CAAC,KAAO,IAAI,CAAC,QAAU,CAAC;oBACjC,QAAQ,MAAM,MAAM,CAAC,MAAM,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;oBAC5C,aAAa,MAAM,WAAW,EAAE,OAAO,KAAK,OAAO,MAAM,WAAW;gBACxE,CAAC;IACL,CAAC,GACD;IACI,MAAM;AACV"}},
    {"offset": {"line": 1850, "column": 0}, "map": {"version":3,"sources":["file:///Users/odgmusic/development/Da%20Graba_Studio/app/%5Blocale%5D/mastering/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useRef, useEffect } from 'react';\nimport { StudioMonitor } from '@/components/daw/StudioMonitor';\nimport { MasteringKnob } from '@/components/daw/MasteringKnob';\nimport { Activity, Power, SlidersHorizontal, Upload, Download, Play, Pause, Volume2, Repeat, Music, History, Save, ChevronLeft, MessageSquare, Sparkles, MoreHorizontal, Layers, Trash2, X, ArrowRight } from 'lucide-react';\nimport { useMasteringStore, MasteringSettings } from '@/store/useMasteringStore';\nimport { audioEngine } from '@/lib/audio-engine-bridge';\nimport { StudioChat } from '@/components/daw/StudioChat';\nimport { SpectrumAnalyzer } from '@/components/daw/SpectrumAnalyzer';\nimport { AudioStorage } from '@/lib/audio/AudioStorage';\nimport Link from 'next/link';\nimport { useParams, useSearchParams, useRouter } from 'next/navigation';\nimport { useCreatorStore } from '@/store/useCreatorStore';\nimport { useDAWStore } from '@/store/useDAWStore';\n\nexport default function Mastering() {\n    const params = useParams();\n    const searchParams = useSearchParams();\n    const router = useRouter();\n    const locale = params.locale as string;\n    const loadId = searchParams.get('load');\n\n    // UI State\n    const [isOn, setIsOn] = useState(true);\n    const [isComparing, setIsComparing] = useState(false);\n    const [isPlaying, setIsPlaying] = useState(false);\n    const [progress, setProgress] = useState(0);\n    const [duration, setDuration] = useState(0);\n    const [volume, setVolume] = useState(0.8);\n    const [selectedSong, setSelectedSong] = useState('Proyecto 1 - Final');\n    const [metadataDNA, setMetadataDNA] = useState('PROJ-001-A');\n    const [audioUrl, setAudioUrl] = useState<string | null>(null);\n    const [chatOpen, setChatOpen] = useState(false);\n    const [selectedGenre, setSelectedGenre] = useState('DGB_BACHATA');\n    const [isAIMastering, setIsAIMastering] = useState(false);\n    const [aiStatus, setAiStatus] = useState('');\n    const [currentAudioId, setCurrentAudioId] = useState<string | null>(null);\n\n    const defaultSettings: MasteringSettings = {\n        gateThreshold: -12, gateAttack: 10, gateRelease: 100,\n        eqHighpass: 50, eqTilt: 50, eqSideGain: 50, eqSideFreq: 0,\n        levelerTarget: -14, levelerBrake: 50, levelerMaxPlus: 10, levelerMaxMinus: 10,\n        compStrength: 30, compAttack: 30, compRelease: 200, compKnee: 6, compMakeup: 0,\n        mbStrengthLow: 20, mbStrengthHigh: 15, mbAttackLow: 50, mbAttackHigh: 30, mbCrossoverLow: 250, mbCrossoverHigh: 3000,\n        limStrength: 40, limAttack: 1, limRelease: 100, limCeiling: -1.0,\n        inputDrive: 0, stereoWidth: 0,\n        gateBypass: true, eqBypass: true, levelerBypass: true, compBypass: true, mbBypass: true, limBypass: true,\n    };\n\n    const [settings, setSettings] = useState<MasteringSettings>(defaultSettings);\n    const [menuOpen, setMenuOpen] = useState(false);\n    const [stemsModalOpen, setStemsModalOpen] = useState(false);\n    const [stemsTrackId, setStemsTrackId] = useState<string | null>(null);\n    const [stemDownloading, setStemDownloading] = useState(false);\n\n    const downloadStem = async (src: string, name: string) => {\n        if (!src) {\n            alert('Esta pista an no tiene audio disponible.');\n            return;\n        }\n        setStemDownloading(true);\n        try {\n            const res = await fetch(src);\n            const blob = await res.blob();\n            const url = URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = `${name}.mp3`;\n            a.click();\n            URL.revokeObjectURL(url);\n        } catch {\n            alert('Error descargando. Intenta de nuevo.');\n        } finally {\n            setStemDownloading(false);\n        }\n    };\n\n    const resetSettings = () => {\n        setSettings(defaultSettings);\n        setMenuOpen(false);\n    };\n\n    const animateParameter = async (\n        moduleName: 'gate' | 'eq' | 'leveler' | 'compressor' | 'multiband' | 'limiter',\n        message: string,\n        duration: number,\n        updates: Partial<MasteringSettings>\n    ) => {\n        setAiStatus(message);\n        setCurrentModule(moduleName);\n\n        const steps = 30; // 30 frames for smooth animation\n        const stepTime = duration / steps;\n\n        let startValues: Partial<MasteringSettings> = {};\n        setSettings(prev => {\n            startValues = { ...prev };\n            const next = { ...prev };\n            if (updates.gateBypass !== undefined) next.gateBypass = false;\n            if (updates.eqBypass !== undefined) next.eqBypass = false;\n            if (updates.levelerBypass !== undefined) next.levelerBypass = false;\n            if (updates.compBypass !== undefined) next.compBypass = false;\n            if (updates.limBypass !== undefined) next.limBypass = false;\n            return next;\n        });\n\n        for (let i = 1; i <= steps; i++) {\n            await new Promise(r => setTimeout(r, stepTime));\n            const progress = i / steps;\n            // easeInOutCubic for a human-like turn\n            const ease = progress < 0.5 ? 4 * progress * progress * progress : 1 - Math.pow(-2 * progress + 2, 3) / 2;\n\n            setSettings(prev => {\n                const next = { ...prev };\n                for (const key of Object.keys(updates) as Array<keyof MasteringSettings>) {\n                    if (typeof updates[key] === 'number') {\n                        const start = startValues[key] as number;\n                        const end = updates[key] as number;\n                        // Add a tiny random jitter while \"thinking\"\n                        const jitter = progress > 0.1 && progress < 0.9 ? (Math.random() - 0.5) * 3 : 0;\n                        next[key] = (start + (end - start) * ease + jitter) as never;\n                    }\n                }\n                return next;\n            });\n        }\n\n        // Snap to precise final values after animation\n        setSettings(prev => ({ ...prev, ...updates }));\n        await new Promise(r => setTimeout(r, 600)); // Short pause before next step\n    };\n\n    const { history, currentModule, setCurrentModule, addToHistory, getProjectById, cleanupOldHistory } = useMasteringStore();\n    const creatorTracks = useCreatorStore((state) => state.tracks);\n    const addTrackToDAW = useDAWStore((state) => state.addTrack);\n\n    const sendStemToStudio = (src: string | null | undefined, name: string) => {\n        if (!src) { alert('Esta pista an no tiene audio disponible.'); return; }\n        addTrackToDAW(name, undefined, 'stereo', src);\n        setStemsModalOpen(false);\n        router.push(`/${locale}/studio`);\n    };\n\n    useEffect(() => {\n        cleanupOldHistory();\n    }, []);\n    const audioRef = useRef<HTMLAudioElement | null>(null);\n\n    // Load project from history if requested or recover last session\n    useEffect(() => {\n        const loadProject = async () => {\n            // Priority 1: loadId from URL\n            if (loadId) {\n                const project = getProjectById(loadId);\n                if (project) {\n                    setSelectedSong(project.name);\n                    setMetadataDNA(project.dna);\n                    setSettings(project.settings);\n\n                    const audioId = project.audioId || project.id;\n                    const blob = await AudioStorage.getAudio(audioId);\n                    if (blob) {\n                        setAudioUrl(URL.createObjectURL(blob));\n                        setCurrentAudioId(audioId);\n                    } else if (project.audioUrl && !project.audioUrl.startsWith('blob:')) {\n                        setAudioUrl(project.audioUrl);\n                        setCurrentAudioId(audioId);\n                    }\n                    return;\n                }\n            }\n\n            // Priority 2: Last session from history if no audio is loaded\n            if (!audioUrl && history.length > 0) {\n                const project = history[0];\n                setSelectedSong(project.name);\n                setMetadataDNA(project.dna);\n                setSettings(project.settings);\n                const audioId = project.audioId || project.id;\n                const blob = await AudioStorage.getAudio(audioId);\n                if (blob) {\n                    setAudioUrl(URL.createObjectURL(blob));\n                    setCurrentAudioId(audioId);\n                } else if (project.audioUrl && !project.audioUrl.startsWith('blob:')) {\n                    setAudioUrl(project.audioUrl);\n                    setCurrentAudioId(audioId);\n                }\n            }\n        };\n        loadProject();\n    }, [loadId, getProjectById, history, audioUrl]);\n\n    // Mocking user plan for export logic\n    const userPlan = 'Bsico';\n\n    const handleImport = () => {\n        const input = document.createElement('input');\n        input.type = 'file';\n        input.accept = 'audio/*';\n        input.onchange = async (e) => {\n            const file = (e.target as HTMLInputElement).files?.[0];\n            if (file) {\n                const projectId = `import-${Date.now()}`;\n                const url = URL.createObjectURL(file);\n\n                // Save to IndexedDB for persistence\n                await AudioStorage.saveAudio(projectId, file);\n\n                const cleanName = file.name.replace(/\\.[^/.]+$/, \"\");\n                const dna = `DNA-${Math.random().toString(36).substring(2, 6).toUpperCase()}`;\n\n                // Genre detection based on filename\n                if (cleanName.toLowerCase().includes('bachata')) setSelectedGenre('DGB_BACHATA');\n                else if (cleanName.toLowerCase().includes('bolero')) setSelectedGenre('DGB_BOLERO');\n                else if (cleanName.toLowerCase().includes('trap')) setSelectedGenre('DGB_TRAP');\n                else if (cleanName.toLowerCase().includes('merengue')) setSelectedGenre('DGB_MERENGUE');\n\n                setSelectedSong(cleanName);\n                setAudioUrl(url);\n                setCurrentAudioId(projectId);\n                setMetadataDNA(dna);\n\n                // Auto-add to history as requested by user\n                addToHistory({\n                    id: projectId,\n                    name: cleanName,\n                    audioUrl: url,\n                    settings: settings,\n                    dna: dna\n                });\n\n                setIsPlaying(true);\n            }\n        };\n        input.click();\n    };\n\n    // --- Audio Logic ---\n    useEffect(() => {\n        if (audioRef.current && audioUrl) {\n            audioEngine.connectAudioElement('master-track', audioRef.current);\n        }\n    }, [audioUrl]);\n\n    // Sync settings with Audio Engine\n    useEffect(() => {\n        if (!isOn) return;\n\n        // Update individual modules in the audio engine\n        audioEngine.updateGate('master-track', settings.gateThreshold, settings.gateBypass);\n        audioEngine.updateEQ('master-track', settings.eqHighpass, settings.eqTilt, settings.eqSideGain, settings.eqSideFreq, settings.eqBypass);\n        audioEngine.updateLeveler('master-track', settings.levelerTarget, settings.levelerBypass);\n        audioEngine.updateCompressor('master-track', settings.compStrength, settings.compAttack, settings.compRelease, settings.compBypass);\n        audioEngine.updateLimiter('master-track', settings.limStrength, settings.limCeiling, settings.limBypass);\n\n    }, [settings, isOn]);\n\n    const startAIMastering = async () => {\n        if (!audioUrl) {\n            alert(\"Sube una cancin primero para que el Ingeniero pueda trabajar.\");\n            return;\n        }\n\n        setIsPlaying(false);\n        setIsAIMastering(true);\n        setAiStatus('ESCANEANDO ADN DE LA CANCIN...');\n\n        // Warning to user about volume\n        setTimeout(() => {\n            setAiStatus(' ADVERTENCIA: EL VOLUMEN PUEDE CAMBIAR FUERTEMENTE.');\n        }, 1000);\n\n        try {\n            // 1-2. Anlisis inicial e Intensidad\n            setAiStatus('ANLISIS CON IA: EVALUANDO INTENSIDAD Y RMS REAL DE LA PISTA...');\n            const trackAnalysis = await audioEngine.analyzeAudioBuffer(audioUrl);\n            if (trackAnalysis) {\n                // Short simulated delay to let the user read the text\n                await new Promise(r => setTimeout(r, 1500));\n            } else {\n                await new Promise(r => setTimeout(r, 3000));\n            }\n\n            setAiStatus(`BUSCANDO GOLD STANDARD PARA ${selectedGenre}...`);\n            const response = await fetch(`/api/ai/get-dna/${selectedGenre}`);\n            const data = await response.json();\n\n            // Prepare target settings based on DNA\n            const targetSettings = { ...settings };\n\n            // Base target calculations dependent on active track analysis\n            const currentRms = trackAnalysis?.rms || -20;\n            const currentCf = trackAnalysis?.crestFactor || 12;\n\n            if (!data.success) {\n                setAiStatus('ANALIZANDO CON MOTOR HEURSTICO LOCAL HBRIDO...');\n                await new Promise(r => setTimeout(r, 2000));\n\n                // Smart Fallbacks based on genre and internal track analysis\n                let targetLoudnessDb = -8.0;\n\n                if (selectedGenre === 'DGB_BOLERO') {\n                    targetLoudnessDb = -10.0;\n                    targetSettings.eqHighpass = 60; // Retain warmth\n                    targetSettings.eqTilt = 55; // Slight low mid boost\n                    targetSettings.eqSideGain = 45; // Smooth highs\n                    targetSettings.eqSideFreq = 20; // Slight presence\n                    targetSettings.limCeiling = -1.0;\n                } else if (selectedGenre === 'DGB_BACHATA') {\n                    targetLoudnessDb = -8.5;\n                    targetSettings.eqHighpass = 55;\n                    targetSettings.eqTilt = 50;\n                    targetSettings.eqSideGain = 55;\n                    targetSettings.eqSideFreq = 40; // Vocal presence\n                    targetSettings.limCeiling = -0.5;\n                } else {\n                    // Merengue / Urban\n                    targetLoudnessDb = -7.0;\n                    targetSettings.eqHighpass = 50;\n                    targetSettings.eqTilt = 45; // Less low mud\n                    targetSettings.eqSideGain = 65; // Crispy highs\n                    targetSettings.eqSideFreq = 60; // Aggressive presence\n                    targetSettings.limCeiling = -0.1;\n                }\n\n                // Dynamic calculations based on track analysis\n                const gainNeeded = targetLoudnessDb - currentRms;\n                targetSettings.levelerTarget = Math.min(95, Math.max(40, 50 + (gainNeeded * 2.5)));\n                targetSettings.compStrength = Math.min(80, Math.max(30, currentCf * 4));\n                targetSettings.limStrength = Math.min(85, Math.max(35, currentCf * 5));\n\n            } else {\n                setAiStatus('ADN ENCONTRADO. CALCULANDO BALANCE ESPECTRAL PERFECTO...');\n                await new Promise(r => setTimeout(r, 2000));\n                const dna = data.dna;\n\n                // 1. Loudness Hybrid Calculation\n                const dnaTargetLufs = (dna.loudness && dna.loudness.target_lufs) ? dna.loudness.target_lufs : -8.0;\n                const gainNeeded = dnaTargetLufs - currentRms;\n                targetSettings.levelerTarget = Math.min(95, Math.max(40, 50 + (gainNeeded * 2.5)));\n\n                // 2. Dynamics Hybrid Calculation\n                targetSettings.limCeiling = (dna.dynamics && dna.dynamics.peak_ceiling) ? dna.dynamics.peak_ceiling : -0.5;\n                const targetCf = (dna.dynamics && dna.dynamics.crest_factor) ? dna.dynamics.crest_factor : 10;\n                // Blend current track dynamics with target DNA\n                const blendedCf = (currentCf + targetCf) / 2;\n                targetSettings.compStrength = Math.min(75, Math.max(25, blendedCf * 4.5));\n                targetSettings.limStrength = Math.min(85, Math.max(30, blendedCf * 5.5));\n\n                // 3. Spectral (Tilt / Highpass)\n                if (dna.spectral_envelope) {\n                    const mags = dna.spectral_envelope.magnitudes;\n                    if (mags.length > 0) {\n                        const avgSlope = (mags[mags.length - 1] - mags[0]) / mags.length;\n                        targetSettings.eqTilt = 50 + Math.min(20, Math.max(-20, avgSlope * 10));\n                        targetSettings.eqHighpass = 58;\n                        targetSettings.eqSideGain = 50 - Math.min(25, Math.max(-25, avgSlope * 8));\n                        targetSettings.eqSideFreq = 60; // Enhancing presence globally for AI\n                    }\n                }\n            }\n\n            // --- SEQUENTIAL AI NAVIGATION (13-Point Analysis) ---\n\n            // 3-4. Visualizador y Medidores\n            setAiStatus('CONFIGURANDO VISUALIZADOR Y MEDIDORES DE VOLUMEN/SALIDA...');\n            await new Promise(r => setTimeout(r, 1500));\n\n            // 5-6. Ajuste de Entrada e Igualacin\n            setAiStatus('CALIBRANDO AJUSTE DE ENTRADA Y GAIN MATCH...');\n            await animateParameter('compressor', 'CALIBRANDO AJUSTE DE ENTRADA...', 1000, { inputDrive: Math.min(100, targetSettings.compStrength * 0.5) });\n\n            // 7. Bypass / Preparacin\n            setAiStatus('VERIFICANDO BYPASS Y ESTADO DE SEAL...');\n            await new Promise(r => setTimeout(r, 1000));\n\n            // 8. Estilos de Mastering\n            setAiStatus(`APLICANDO ESTILO DE MASTERING (${selectedGenre})...`);\n            await new Promise(r => setTimeout(r, 1500));\n\n            // 9-10. EQ y Presencia\n            await animateParameter('eq', 'ESCULPIENDO EQ Y PRESENCIA...', 2500, { eqHighpass: targetSettings.eqHighpass, eqTilt: targetSettings.eqTilt, eqSideGain: targetSettings.eqSideGain, eqSideFreq: targetSettings.eqSideFreq, eqBypass: false });\n\n            // 11. De-Esser (Multiband High)\n            await animateParameter('multiband', 'AJUSTANDO DE-ESSER PARA CONTROL DE SIBILANCIA...', 2000, { mbStrengthHigh: Math.min(50, targetSettings.eqSideGain * 0.8), mbBypass: false });\n\n            // 12. Stereo Width\n            setAiStatus('EXPANDIENDO STEREO WIDTH...');\n            setSettings(prev => ({ ...prev, stereoWidth: 25 }));\n            await new Promise(r => setTimeout(r, 1500));\n\n            // 13. Dinmicas y Volumen Final\n            await animateParameter('compressor', 'COMPRIMIENDO DINMICAS...', 2000, { compStrength: targetSettings.compStrength, compBypass: false });\n            await animateParameter('limiter', 'MAXIMIZANDO VOLUMEN Y SALIDA...', 1800, { limStrength: targetSettings.limStrength, limCeiling: targetSettings.limCeiling, limBypass: false });\n            await animateParameter('leveler', 'AJUSTANDO MEDIDOR DE VOLUMEN FINAL...', 1500, { levelerTarget: targetSettings.levelerTarget, levelerBypass: false });\n\n            setAiStatus('MASTERIZACIN IA COMPLETADA.');\n\n            // Save to history with frequency \"snapshot\" (DNA summary)\n            addToHistory({\n                id: currentAudioId || `master-${Date.now()}`,\n                name: selectedSong,\n                audioUrl: audioUrl,\n                audioId: currentAudioId || undefined,\n                dna: metadataDNA,\n                settings: settings,\n                frequencyData: [settings.eqHighpass, settings.eqTilt, settings.eqSideGain] // Summary of spectral actions\n            });\n            setTimeout(() => {\n                setIsAIMastering(false);\n                setAiStatus('');\n                // Ensure audio engine is active\n                audioEngine.initContext();\n                // Auto-play after completion\n                setIsPlaying(true);\n            }, 2000);\n\n        } catch (error) {\n            console.error(\"AI Mastering failed\", error);\n            setIsAIMastering(false);\n            setAiStatus('ERROR EN EL PROCESO.');\n        }\n    };\n\n    const togglePlay = () => {\n        if (!isPlaying) {\n            audioEngine.initContext();\n        }\n        setIsPlaying(prev => !prev);\n    };\n\n    useEffect(() => {\n        const audio = audioRef.current;\n        if (!audio) return;\n\n        let isMounted = true;\n\n        const attemptPlay = async () => {\n            if (isPlaying && audioUrl) {\n                try {\n                    // Modern browsers return a promise from play()\n                    const playPromise = audio.play();\n                    if (playPromise !== undefined) {\n                        await playPromise;\n                    }\n                } catch (e) {\n                    // Only log if it's not an AbortError handled by the browser\n                    if (e instanceof Error && e.name !== 'AbortError') {\n                        console.error(\"Playback failed\", e);\n                    }\n                }\n            } else {\n                audio.pause();\n            }\n        };\n\n        attemptPlay();\n\n        return () => {\n            isMounted = false;\n        };\n    }, [isPlaying, isOn, audioUrl]);\n\n    const handleTimeUpdate = () => {\n        if (audioRef.current) {\n            const current = audioRef.current.currentTime;\n            const dur = audioRef.current.duration;\n            setProgress((current / (dur || 1)) * 100);\n            setDuration(dur || 0);\n        }\n    };\n\n    const handleSeek = (percentage: number) => {\n        if (audioRef.current && duration) {\n            const time = (percentage / 100) * duration;\n            audioRef.current.currentTime = time;\n            setProgress(percentage);\n        }\n    };\n\n    const handleSave = () => {\n        const projectId = `proj-${Date.now()}`;\n        addToHistory({\n            id: projectId,\n            name: selectedSong,\n            audioUrl: audioUrl,\n            audioId: currentAudioId || undefined,\n            settings: settings,\n            dna: metadataDNA || projectId\n        });\n        alert(\"Sesin guardada en el historial.\");\n    };\n\n    const handleExport = () => {\n        handleSave(); // Auto-save on export\n\n        const exportInfo = {\n            title: selectedSong,\n            studio: 'DA-GRABA STUDIO MASTER',\n            info: '24-bit / 44.1kHz High Quality'\n        };\n\n        if (userPlan === 'Bsico') {\n            alert(`Exportando \"${exportInfo.title}\"\\n- Sello: ${exportInfo.studio}\\n- Calidad: MP3 128kbps (Plan Bsico)\\n- Informacin: El cliente puede editar su informacin despus de descargar.`);\n        } else {\n            alert(`Exportando Pro \"${exportInfo.title}\"\\n- Sello: ${exportInfo.studio}\\n- Formatos: WAV & MP3 320kbps\\n- Metadatos: Inyectando DA-GRABA MASTER DNA.`);\n        }\n    };\n\n    return (\n        <div className=\"flex flex-col w-full h-full items-center justify-start px-4 md:px-12 lg:px-24 py-4 relative overflow-y-auto overflow-x-hidden pb-32 pointer-events-auto custom-scrollbar\">\n            <audio\n                ref={audioRef}\n                src={\n                    audioUrl\n                        ? (audioUrl.startsWith('blob:') || audioUrl.startsWith('data:'))\n                            ? audioUrl\n                            : `/api/audio-proxy?url=${encodeURIComponent(audioUrl)}`\n                        : undefined\n                }\n                onTimeUpdate={handleTimeUpdate}\n                onEnded={() => setIsPlaying(false)}\n                crossOrigin=\"anonymous\"\n            />\n\n            {/* Background Studio Window Blur effect */}\n            <div className=\"absolute inset-x-0 bottom-0 h-64 bg-gradient-to-t from-black/80 to-transparent pointer-events-none\" />\n\n            {/* TOP BAR: Horizontal Song Selection */}\n            <div className=\"w-full max-w-6xl mb-4 relative z-20\">\n                <div className=\"flex items-center gap-4 bg-black/40 backdrop-blur-xl border border-white/5 rounded-2xl p-2 shadow-2xl overflow-x-auto no-scrollbar\">\n                    <Link href={`/${locale}/mastering/history`} className=\"flex items-center gap-2 px-4 py-2 border-r border-white/10 flex-shrink-0 hover:bg-white/5 transition-colors group\">\n                        <History size={14} className=\"text-cyan-400 group-hover:rotate-[-45deg] transition-transform\" />\n                        <span className=\"text-[10px] text-white/60 font-black tracking-widest uppercase\">Historial</span>\n                    </Link>\n                    <div className=\"flex gap-2 p-1\">\n                        {/* Merge mock list with real history for selection */}\n                        {history.slice(0, 5).map((project, index) => (\n                            <div key={`${project.id}-${index}`} className=\"flex items-center gap-1\">\n                                <button\n                                    onClick={async () => {\n                                        audioEngine.initContext();\n                                        setIsPlaying(false);\n                                        setSelectedSong(project.name);\n                                        setMetadataDNA(project.dna);\n                                        setSettings(project.settings);\n                                        const audioId = project.audioId || project.id;\n                                        const blob = await AudioStorage.getAudio(audioId);\n                                        if (blob) {\n                                            setAudioUrl(URL.createObjectURL(blob));\n                                            setCurrentAudioId(audioId);\n                                            setTimeout(() => setIsPlaying(true), 100);\n                                        } else if (project.audioUrl && !project.audioUrl.startsWith('blob:')) {\n                                            setAudioUrl(project.audioUrl);\n                                            setCurrentAudioId(audioId);\n                                            setTimeout(() => setIsPlaying(true), 100);\n                                        } else {\n                                            alert(\"El archivo de audio original ya no est disponible en la memoria local. Por favor, vuelve a importarlo.\");\n                                        }\n                                        if (audioRef.current) audioRef.current.currentTime = 0;\n                                    }}\n                                    className={`flex flex-col min-w-[140px] px-4 py-2 rounded-xl transition-all border ${selectedSong === project.name\n                                        ? 'bg-cyan-500/10 border-cyan-500/30 text-white shadow-[0_0_15px_rgba(6,182,212,0.1)]'\n                                        : 'bg-white/5 border-transparent text-white/40 hover:bg-white/10'\n                                        }`}\n                                >\n                                    <span className=\"text-[10px] font-bold truncate\">{project.name}</span>\n                                    <span className=\"text-[7px] font-mono opacity-40 uppercase tracking-tighter\">DNA: {project.dna}</span>\n                                </button>\n                                <button\n                                    title=\"Eliminar del historial\"\n                                    onClick={() => {\n                                        if (confirm(`Eliminar \"${project.name}\" del historial?`)) {\n                                            useMasteringStore.getState().deleteFromHistory(project.id);\n                                            if (selectedSong === project.name) setSelectedSong('');\n                                        }\n                                    }}\n                                    className=\"p-1 text-white/20 hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-all\"\n                                >\n                                    <Trash2 size={12} />\n                                </button>\n                            </div>\n                        ))}\n                        {/* Creator tracks */}\n                        {creatorTracks.map((track) => (\n                            <div key={`creator-${track.id}`} className=\"flex items-center gap-1\">\n                                <button\n                                    onClick={() => {\n                                        audioEngine.initContext();\n                                        setIsPlaying(false);\n                                        setSelectedSong(track.title);\n                                        setMetadataDNA(\"AI CREATOR\");\n                                        setAudioUrl(track.url);\n                                        setCurrentAudioId(track.id);\n                                        setTimeout(() => setIsPlaying(true), 100);\n                                        if (audioRef.current) audioRef.current.currentTime = 0;\n                                    }}\n                                    className={`flex flex-col min-w-[140px] px-4 py-2 rounded-xl transition-all border ${selectedSong === track.title\n                                        ? 'bg-orange-500/10 border-orange-500/30 text-white shadow-[0_0_15px_rgba(255,107,0,0.1)]'\n                                        : 'bg-white/5 border-transparent text-white/40 hover:bg-white/10'\n                                        }`}\n                                >\n                                    <span className=\"text-[10px] font-bold truncate\">{track.title}</span>\n                                    <span className=\"text-[7px] font-mono opacity-40 uppercase tracking-tighter\">SOURCE: AI CREATOR</span>\n                                </button>\n                                <button\n                                    title=\"Extraer stem de esta pista\"\n                                    onClick={() => { setStemsTrackId(track.id); setStemsModalOpen(true); }}\n                                    className=\"p-1 text-white/20 hover:text-green-400 hover:bg-green-500/10 rounded-lg transition-all\"\n                                >\n                                    <Layers size={12} />\n                                </button>\n                            </div>\n                        ))}\n                    </div>\n                    {/* Extraer Stems button + Import */}\n                    <div className=\"ml-auto flex items-center gap-2 shrink-0\">\n                        <button\n                            onClick={() => { setStemsTrackId(null); setStemsModalOpen(true); }}\n                            className=\"flex items-center gap-2 px-5 py-2 rounded-xl bg-green-600/20 hover:bg-green-600/40 border border-green-500/30 text-green-400 text-[10px] font-black tracking-widest uppercase transition-all shadow-[0_0_15px_rgba(34,197,94,0.1)]\"\n                        >\n                            <Layers size={14} /> Extraer Stems\n                        </button>\n                        <button onClick={handleImport} className=\"flex items-center gap-2 px-6 py-2 rounded-xl bg-cyan-500 hover:bg-cyan-400 text-black text-[10px] font-black tracking-widest uppercase transition-all shadow-[0_0_20px_rgba(6,182,212,0.3)]\">\n                            <Upload size={14} /> Importar\n                        </button>\n                    </div>\n                </div>\n            </div>\n\n            <div className=\"w-full flex items-center justify-center relative z-10 gap-8\">\n                {/* Left Speaker */}\n                <div className=\"flex-shrink-0 transform scale-110\">\n                    <StudioMonitor />\n                </div>\n\n                {/* Center Plugin Rack */}\n                <div className=\"flex-1 max-w-4xl relative\">\n                    {/* The Plugin Enclosure - LANDR Style */}\n                    <div className=\"bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-slate-800 via-slate-900 to-black rounded-xl shadow-[0_30px_60px_rgba(0,0,0,0.9),inset_0_1px_1px_rgba(255,255,255,0.05)] border border-slate-700/30 p-4 flex flex-col gap-4 w-full max-w-5xl mx-auto\">\n\n                        {/* Header Bar */}\n                        <div className=\"flex justify-between items-center px-4\">\n                            <div className=\"flex items-center gap-4\">\n                                <div className=\"w-8 h-8 rounded-full border border-white/20 flex items-center justify-center\">\n                                    <div className=\"w-5 h-5 rounded-full border border-white/40 border-t-transparent animate-spin-slow\" />\n                                </div>\n                                <span className=\"text-white font-medium tracking-widest text-sm opacity-90\">DA-GRABA Studio Mastering</span>\n                            </div>\n\n                            {/* Center Toggles */}\n                            <div className=\"absolute left-1/2 -translate-x-1/2 flex items-center gap-4 bg-white/5 rounded-full px-4 py-1.5 backdrop-blur-md border border-white/10\">\n                                <span className=\"text-[11px] font-bold text-cyan-300 uppercase tracking-widest mr-2 cursor-pointer shadow-[0_0_10px_rgba(103,232,249,0.3)]\">Master</span>\n                            </div>\n\n                            {/* Right Controls */}\n                            <div className=\"flex items-center gap-4\">\n                                <button className=\"text-xs text-white/50 hover:text-white transition-colors tracking-widest uppercase\">Gain Match</button>\n                                <button\n                                    onClick={() => {\n                                        const newIsOn = !isOn;\n                                        setIsOn(newIsOn);\n                                        setSettings(prev => ({\n                                            ...prev,\n                                            gateBypass: !newIsOn,\n                                            eqBypass: !newIsOn,\n                                            levelerBypass: !newIsOn,\n                                            compBypass: !newIsOn,\n                                            mbBypass: !newIsOn,\n                                            limBypass: !newIsOn\n                                        }));\n                                    }}\n                                    className={`text-xs px-3 py-1 rounded transition-colors tracking-widest uppercase border ${isOn ? 'border-cyan-500/50 text-cyan-400 bg-cyan-500/10' : 'border-white/20 text-white/50 hover:bg-white/5'}`}\n                                >\n                                    Bypass\n                                </button>\n                                <button\n                                    onClick={startAIMastering}\n                                    disabled={isAIMastering}\n                                    className={`px-3 py-1 rounded border flex items-center gap-2 text-xs font-bold tracking-widest transition-all ${isAIMastering\n                                        ? 'bg-orange-500/20 border-orange-500 text-orange-400 animate-pulse'\n                                        : 'bg-indigo-500/20 border-indigo-500/50 text-indigo-300 hover:bg-indigo-500/40 hover:text-white shadow-[0_0_15px_rgba(99,102,241,0.2)]'\n                                        }`}\n                                >\n                                    <Sparkles size={12} /> {isAIMastering ? 'AI WORKING' : 'AI MASTER'}\n                                </button>\n                                <div className=\"flex gap-2 text-white/30 ml-2 items-center relative\">\n                                    <span className=\"cursor-pointer hover:text-white transition-colors\" onClick={resetSettings}></span>\n                                    <span className=\"cursor-pointer hover:text-white transition-colors\"></span>\n                                    <button onClick={() => setMenuOpen(!menuOpen)} className=\"p-1 hover:bg-white/10 rounded-md transition-colors hover:text-white\">\n                                        <MoreHorizontal size={14} />\n                                    </button>\n\n                                    {menuOpen && (\n                                        <div className=\"absolute right-0 top-full mt-2 w-48 bg-[#0B1015] border border-white/10 rounded-xl shadow-[0_20px_50px_rgba(0,0,0,0.8)] overflow-hidden z-20 animate-in fade-in slide-in-from-top-2\">\n                                            <div className=\"px-3 py-2 text-[9px] font-bold tracking-widest text-cyan-400 uppercase border-b border-white/5 bg-white/5\">\n                                                Advanced Options\n                                            </div>\n                                            <button\n                                                onClick={resetSettings}\n                                                className=\"w-full text-left px-4 py-3 text-xs text-white/70 hover:bg-white/5 hover:text-white transition-colors border-b border-white/5\"\n                                            >\n                                                Reset to Default\n                                            </button>\n                                            <button\n                                                onClick={() => {\n                                                    alert(\"Preset guardado localmente (Simulado)\");\n                                                    setMenuOpen(false);\n                                                }}\n                                                className=\"w-full text-left px-4 py-3 text-xs text-white/70 hover:bg-white/5 hover:text-white transition-colors border-b border-white/5\"\n                                            >\n                                                Save Custom Preset\n                                            </button>\n                                            <button\n                                                onClick={() => {\n                                                    setSettings(prev => ({ ...prev, stereoWidth: 50, inputDrive: 20 }));\n                                                    setMenuOpen(false);\n                                                }}\n                                                className=\"w-full text-left px-4 py-3 text-xs text-white/70 hover:bg-white/5 hover:text-white transition-colors\"\n                                            >\n                                                Enable Auto-Widener\n                                            </button>\n                                        </div>\n                                    )}\n                                </div>\n                            </div>\n                        </div>\n\n                        <div className={`transition-opacity duration-500 flex flex-col gap-4 ${isOn ? 'opacity-100' : 'opacity-30 pointer-events-none'}`}>\n\n                            {/* Top Half: Massive Spectrum Analyzer */}\n                            <div className=\"h-40 md:h-48 relative bg-slate-900/50 rounded-lg overflow-hidden border-b border-white/5\">\n                                {isAIMastering && (\n                                    <div className=\"absolute inset-0 flex flex-col items-center justify-center bg-slate-900/80 backdrop-blur-sm z-10 animate-in fade-in\">\n                                        <div className=\"w-16 h-16 rounded-full border-2 border-indigo-500 border-t-transparent animate-spin mb-4\" />\n                                        <span className=\"text-xs font-mono text-indigo-300 tracking-widest text-center uppercase\">{aiStatus}</span>\n                                    </div>\n                                )}\n                                <SpectrumAnalyzer\n                                    analyzer={audioEngine.getTrackAnalyser('master-track')}\n                                    naked\n                                    isPlaying={isPlaying}\n                                />\n                                {/* Frequency Labels */}\n                                <div className=\"absolute bottom-2 left-0 right-0 flex justify-between px-8 pointer-events-none opacity-30 text-[9px] font-mono text-white\">\n                                    <span>20</span><span>50</span><span>100</span><span>200</span><span>500</span><span>1K</span><span>2K</span><span>5K</span><span>10K</span><span>20K</span>\n                                </div>\n                            </div>\n\n                            {/* Middle Toggles (Style) */}\n                            <div className=\"flex justify-center -mt-10 relative z-10\">\n                                <div className=\"flex bg-slate-800/80 backdrop-blur-xl rounded-full p-1 border border-slate-600/50 shadow-2xl\">\n                                    {['DGB_BOLERO', 'DGB_BACHATA', 'DGB_MERENGUE'].map((genre) => (\n                                        <button\n                                            key={genre}\n                                            onClick={() => {\n                                                setSelectedGenre(genre);\n                                                if (genre === 'DGB_BOLERO') {\n                                                    // Warm preset: boost low, cut high slightly, gentle comp\n                                                    setSettings(prev => ({ ...prev, eqHighpass: 65, eqTilt: 50, eqSideGain: 40, eqSideFreq: 0, compStrength: 25 }));\n                                                } else if (genre === 'DGB_BACHATA') {\n                                                    // Balanced preset: slight mid boost, medium comp\n                                                    setSettings(prev => ({ ...prev, eqHighpass: 55, eqTilt: 55, eqSideGain: 55, eqSideFreq: 10, compStrength: 45 }));\n                                                } else if (genre === 'DGB_MERENGUE') {\n                                                    // Open preset: neutral low, boost high, boost presence, strong comp\n                                                    setSettings(prev => ({ ...prev, eqHighpass: 50, eqTilt: 45, eqSideGain: 65, eqSideFreq: 30, compStrength: 70 }));\n                                                }\n                                            }}\n                                            className={`px-8 py-1.5 rounded-full text-xs font-medium tracking-wide transition-all ${selectedGenre === genre\n                                                ? 'bg-blue-600 shadow-[0_0_15px_rgba(37,99,235,0.6)] text-white'\n                                                : 'text-white/40 hover:text-white/80'\n                                                }`}\n                                        >\n                                            {genre === 'DGB_BOLERO' ? 'Warm' : genre === 'DGB_BACHATA' ? 'Balanced' : 'Open'}\n                                        </button>\n                                    ))}\n                                </div>\n                            </div>\n\n                            {/* Bottom Half: Control Grid */}\n                            <div className=\"grid grid-cols-12 gap-4 px-4 pb-4\">\n\n                                {/* EQUALIZER */}\n                                <div className=\"col-span-3 flex flex-col items-center gap-4\">\n                                    <span className=\"text-[9px] font-bold text-white/30 tracking-widest uppercase\">Equalizer</span>\n                                    <div className=\"flex gap-2\">\n                                        <MasteringKnob label=\"Low\" value={settings.eqHighpass} onChange={(v) => setSettings({ ...settings, eqHighpass: v })} size=\"sm\" />\n                                        <MasteringKnob label=\"Mid\" value={settings.eqTilt} onChange={(v) => setSettings({ ...settings, eqTilt: v })} size=\"sm\" />\n                                        <MasteringKnob label=\"High\" value={settings.eqSideGain} onChange={(v) => setSettings({ ...settings, eqSideGain: v })} size=\"sm\" />\n                                    </div>\n                                </div>\n\n                                {/* PRESENCE */}\n                                <div className=\"col-span-2 flex flex-col items-center gap-4 border-l border-white/5 pl-4\">\n                                    <span className=\"text-[9px] font-bold text-white/30 tracking-widest uppercase\">Presence</span>\n                                    <MasteringKnob label=\"Amount\" value={settings.eqSideFreq} onChange={(v) => setSettings({ ...settings, eqSideFreq: v })} size=\"md\" />\n                                </div>\n\n                                {/* DE-ESSER */}\n                                <div className=\"col-span-2 flex flex-col items-center gap-4 border-l border-white/5 pl-2\">\n                                    <span className=\"text-[9px] font-bold text-white/30 tracking-widest uppercase\">De-Esser</span>\n                                    <div className=\"flex gap-2\">\n                                        <MasteringKnob label=\"Amount\" value={settings.mbStrengthHigh} onChange={(v) => setSettings({ ...settings, mbStrengthHigh: v })} size=\"sm\" />\n                                        <MasteringKnob label=\"Freq\" value={settings.mbCrossoverHigh} onChange={(v) => setSettings({ ...settings, mbCrossoverHigh: v })} size=\"sm\" />\n                                    </div>\n                                </div>\n\n                                {/* DYNAMICS */}\n                                <div className=\"col-span-3 flex flex-col items-center gap-4 border-l border-white/5 pl-2\">\n                                    <span className=\"text-[9px] font-bold text-white/30 tracking-widest uppercase\">Dynamics</span>\n                                    <div className=\"flex gap-2\">\n                                        <MasteringKnob label=\"Comp\" value={settings.compStrength} onChange={(v) => setSettings({ ...settings, compStrength: v })} size=\"sm\" />\n                                        <MasteringKnob label=\"Chrc\" value={settings.compAttack} onChange={(v) => setSettings({ ...settings, compAttack: v })} size=\"sm\" />\n                                        <MasteringKnob label=\"Sat\" value={settings.inputDrive} onChange={(v) => setSettings({ ...settings, inputDrive: v })} size=\"sm\" />\n                                    </div>\n                                </div>\n\n                                {/* LOUDNESS (Rightmost) */}\n                                <div className=\"col-span-2 flex flex-col items-center justify-between border-l border-white/5 pl-4 h-full\">\n                                    <span className=\"text-[9px] font-bold text-white/30 tracking-widest uppercase\">Loudness</span>\n                                    <div className=\"flex items-center gap-4 w-full justify-center\">\n                                        <div className=\"flex flex-col items-center -mr-2\">\n                                            <MasteringKnob label=\"\" value={settings.levelerTarget} onChange={(v) => setSettings({ ...settings, levelerTarget: v })} size=\"lg\" />\n                                            <span className=\"text-[9px] text-white/40 font-medium tracking-widest mt-2\">\n                                                {(-14 + (settings.levelerTarget / 100) * 8).toFixed(1)} LUFS\n                                            </span>\n                                        </div>\n                                        {/* Fake LUFS Meter */}\n                                        <div className=\"flex flex-col items-center gap-1\">\n                                            <span className=\"text-[8px] font-mono text-cyan-400\">-0.2 dB</span>\n                                            <div className=\"w-2 h-24 bg-black rounded-sm relative overflow-hidden ring-1 ring-white/10\">\n                                                <div className=\"absolute bottom-0 w-full bg-gradient-to-t from-cyan-600 via-cyan-400 to-white transition-all shadow-[0_0_10px_rgba(6,182,212,0.8)]\" style={{ height: `${isPlaying ? 60 + Math.random() * 30 : 0}%` }} />\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n\n                            </div>\n\n                            {/* STEREO FIELD (Bottom Left) */}\n                            <div className=\"flex flex-col gap-2 px-8 pb-4\">\n                                <span className=\"text-[9px] font-bold text-white/30 tracking-widest uppercase\">Stereo Field</span>\n                                <div className=\"flex items-center gap-4 w-48\">\n                                    <span className=\"text-[9px] text-white/40\">Focus</span>\n                                    <input\n                                        type=\"range\"\n                                        min=\"0\" max=\"100\"\n                                        value={settings.stereoWidth}\n                                        onChange={(e) => setSettings({ ...settings, stereoWidth: parseFloat(e.target.value) })}\n                                        className=\"flex-1 h-0.5 bg-white/10 rounded-full appearance-none [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-2 [&::-webkit-slider-thumb]:h-2 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-blue-500 outline-none\"\n                                    />\n                                    <span className=\"text-[9px] text-blue-400 font-bold\">{settings.stereoWidth}% Wide</span>\n                                </div>\n                            </div>\n\n                        </div>\n                    </div>\n\n                    {/* ELEGANT MASTERING PLAYER */}\n                    <div className=\"mt-8 bg-black/40 backdrop-blur-3xl border border-white/5 rounded-3xl p-6 shadow-2xl ring-1 ring-white/10 animate-in fade-in slide-in-from-bottom-4 duration-700\">\n                        <div className=\"flex items-center gap-6\">\n                            {/* Track Info & Visualizer */}\n                            <div className=\"flex items-center gap-4 w-1/3\">\n                                <div className=\"w-16 h-16 bg-gradient-to-br from-cyan-600 to-blue-800 rounded-2xl flex items-center justify-center shadow-2xl border border-white/20 relative overflow-hidden group\">\n                                    <Music className=\"text-white/80 transition-transform group-hover:scale-110\" size={24} />\n                                    <div className=\"absolute inset-0 bg-white/5 opacity-0 group-hover:opacity-100 transition-opacity\" />\n                                </div>\n                                <div className=\"flex flex-col\">\n                                    <span className=\"text-white font-black tracking-widest text-sm uppercase truncate max-w-[150px]\">{selectedSong}</span>\n                                    <span className=\"text-cyan-400/60 font-mono text-[9px] tracking-widest mt-0.5\">DNA: {metadataDNA}</span>\n                                    <span className=\"text-white/20 font-mono text-[8px] uppercase mt-1\">24-BIT / 44.1KHZ</span>\n                                </div>\n                            </div>\n\n                            {/* Main Controls */}\n                            <div className=\"flex-1 flex flex-col items-center gap-3\">\n                                <div className=\"flex items-center gap-8\">\n                                    <button className=\"text-white/20 hover:text-white transition-colors\"><Repeat size={16} /></button>\n                                    <button\n                                        onClick={() => setIsPlaying(!isPlaying)}\n                                        className=\"w-14 h-14 bg-white rounded-full flex items-center justify-center shadow-[0_0_30px_rgba(255,255,255,0.2)] hover:scale-105 transition-all active:scale-95 group\"\n                                    >\n                                        {isPlaying ? <Pause size={24} fill=\"black\" className=\"text-black\" /> : <Play size={24} fill=\"black\" className=\"text-black ml-1\" />}\n                                    </button>\n                                    <button onClick={handleExport} className=\"text-white/20 hover:text-green-400 transition-colors\"><Download size={16} /></button>\n                                </div>\n\n                                {/* Elegant Seeker */}\n                                <div className=\"w-full flex items-center gap-4\">\n                                    <span className=\"text-[10px] font-mono text-white/30 w-8 text-right\">\n                                        {Math.floor((audioRef.current?.currentTime || 0) / 60)}:\n                                        {Math.floor((audioRef.current?.currentTime || 0) % 60).toString().padStart(2, '0')}\n                                    </span>\n                                    <div\n                                        onClick={(e) => {\n                                            const rect = e.currentTarget.getBoundingClientRect();\n                                            const x = e.clientX - rect.left;\n                                            const p = (x / rect.width) * 100;\n                                            handleSeek(p);\n                                        }}\n                                        className=\"flex-1 h-1.5 bg-white/5 rounded-full relative overflow-hidden group cursor-pointer\"\n                                    >\n                                        <div className=\"absolute inset-y-0 left-0 bg-gradient-to-r from-cyan-500 to-blue-600 shadow-[0_0_10px_rgba(6,182,212,0.5)]\" style={{ width: `${progress}%` }} />\n                                    </div>\n                                    <span className=\"text-[10px] font-mono text-white/30 w-8 text-left\">\n                                        {Math.floor(duration / 60)}:{Math.floor(duration % 60).toString().padStart(2, '0')}\n                                    </span>\n                                </div>\n                            </div>\n\n                            {/* Utilities */}\n                            <div className=\"w-1/3 flex items-center justify-end gap-6\">\n                                {/* L-R VU Meter */}\n                                <div className=\"flex flex-col gap-1.5 mr-2 pointer-events-none\">\n                                    {/* Left Channel */}\n                                    <div className=\"flex gap-0.5 items-center\">\n                                        <span className=\"text-[7px] text-white/30 font-mono w-2\">L</span>\n                                        <div className=\"flex gap-0.5\">\n                                            {[...Array(12)].map((_, i) => (\n                                                <div\n                                                    key={i}\n                                                    className={`w-1 h-3 rounded-full transition-all duration-300 ${isPlaying && i < (isPlaying ? 5 + Math.random() * 6 : 0) ? 'bg-green-500/80 shadow-[0_0_5px_rgba(34,197,94,0.3)]' :\n                                                        isPlaying && i < 10 ? 'bg-yellow-500/80' :\n                                                            'bg-white/5'\n                                                        }`}\n                                                />\n                                            ))}\n                                        </div>\n                                    </div>\n                                    {/* Right Channel */}\n                                    <div className=\"flex gap-0.5 items-center\">\n                                        <span className=\"text-[7px] text-white/30 font-mono w-2\">R</span>\n                                        <div className=\"flex gap-0.5\">\n                                            {[...Array(12)].map((_, i) => (\n                                                <div\n                                                    key={i}\n                                                    className={`w-1 h-3 rounded-full transition-all duration-300 ${isPlaying && i < (isPlaying ? 4 + Math.random() * 8 : 0) ? 'bg-green-500/80 shadow-[0_0_5px_rgba(34,197,94,0.3)]' :\n                                                        'bg-white/5'\n                                                        }`}\n                                                />\n                                            ))}\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <div className=\"flex items-center gap-3 bg-white/5 px-4 py-2 rounded-full border border-white/5 group\">\n                                    <Volume2 size={14} className=\"text-white/40 group-hover:text-white\" />\n                                    <input\n                                        type=\"range\"\n                                        min=\"0\"\n                                        max=\"1\"\n                                        step=\"0.01\"\n                                        value={volume}\n                                        onChange={(e) => {\n                                            const v = parseFloat(e.target.value);\n                                            setVolume(v);\n                                            if (audioRef.current) audioRef.current.volume = v;\n                                        }}\n                                        className=\"w-20 h-1 bg-white/10 rounded-full appearance-none cursor-pointer accent-white\"\n                                    />\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                {/* Right Speaker */}\n                <div className=\"flex-shrink-0 transform scale-110\">\n                    <StudioMonitor />\n                </div>\n            </div>\n\n            {/* FLOATING AI ENGINEER CHAT BUTTON AND INTERFACE */}\n            <div className=\"fixed bottom-12 right-12 z-[100] flex flex-col items-end gap-3\">\n                {chatOpen && (\n                    <div className=\"w-96 h-[500px] mb-6 animate-in slide-in-from-bottom-10 fade-in duration-500 origin-bottom-right\">\n                        <div className=\"w-full h-full bg-[#0B1015]/95 backdrop-blur-2xl border border-white/10 rounded-3xl flex flex-col overflow-hidden shadow-[0_40px_100px_rgba(0,0,0,0.8)] ring-1 ring-white/20\">\n                            {/* Header for the Mastering-specific Chat */}\n                            <div className=\"px-6 py-4 border-b border-white/5 bg-gradient-to-r from-cyan-600/20 to-blue-700/20 flex items-center justify-between\">\n                                <div className=\"flex items-center gap-3\">\n                                    <div className=\"w-8 h-8 rounded-full bg-cyan-500/20 flex items-center justify-center border border-cyan-500/30\">\n                                        <Sparkles size={14} className=\"text-cyan-400\" />\n                                    </div>\n                                    <div className=\"flex flex-col\">\n                                        <span className=\"text-[10px] font-black tracking-[0.2em] text-white uppercase\">John - Da Graba Eng.</span>\n                                        <span className=\"text-[7px] font-mono text-cyan-400/60 uppercase\">Especialista en Masterizacin</span>\n                                    </div>\n                                </div>\n                                <button onClick={() => setChatOpen(false)} className=\"p-1 hover:bg-white/5 rounded-md text-white/20 hover:text-white transition-colors\">\n                                    <ChevronLeft size={16} className=\"rotate-[-90deg]\" />\n                                </button>\n                            </div>\n\n                            {/* The StudioChat component itself should be refactored to be more modular \n                                but for now we'll use a copy of its logic or just embed it if it works.\n                                Given the current structure, I'll embed it but adjust its position via props if added.\n                            */}\n                            <div className=\"flex-1 overflow-hidden relative\">\n                                <StudioChat\n                                    embedded={true}\n                                    songName={selectedSong}\n                                    onExecuteMastering={startAIMastering}\n                                />\n                            </div>\n                        </div>\n                    </div>\n                )}\n\n                <button\n                    onClick={() => setChatOpen(!chatOpen)}\n                    className={`group flex items-center gap-4 px-8 py-4 rounded-full border transition-all duration-700 shadow-[0_20px_60px_rgba(0,0,0,0.6)] hover:shadow-[0_25px_80px_rgba(6,182,212,0.3)] ${chatOpen\n                        ? 'bg-orange-600 border-orange-400/50 scale-95'\n                        : 'bg-gradient-to-r from-cyan-600 to-blue-700 border-white/20 hover:scale-110 active:scale-95'\n                        }`}\n                >\n                    <div className=\"relative\">\n                        <MessageSquare size={20} className={`text-white transition-all duration-500 ${chatOpen ? 'rotate-90 opacity-0' : 'animate-pulse'}`} />\n                        <Activity size={20} className={`text-white absolute inset-0 transition-all duration-500 ${chatOpen ? 'rotate-0' : 'opacity-0 -rotate-90'}`} />\n                    </div>\n                    <div className=\"flex flex-col items-start leading-none pr-2\">\n                        <span className=\"text-[11px] font-black tracking-[0.2em] text-white uppercase drop-shadow-md\">ING DA GRABA MASTERING</span>\n                        <span className=\"text-[8px] font-mono text-white/40 uppercase mt-1 tracking-tighter\">Consultar con John</span>\n                    </div>\n                    <div className={`w-2 h-2 rounded-full ${isPlaying ? 'bg-green-500 animate-pulse shadow-[0_0_10px_rgba(34,197,94,0.8)]' : 'bg-white/20'}`} />\n                </button>\n            </div>\n            {/* STEMS MODAL */}\n            {stemsModalOpen && (\n                <div className=\"fixed inset-0 bg-black/80 backdrop-blur-sm z-[200] flex items-center justify-center p-4\">\n                    <div className=\"bg-[#0B1015] border border-white/10 rounded-2xl w-full max-w-lg shadow-2xl animate-in zoom-in-95 duration-200\">\n                        <div className=\"flex items-center justify-between px-6 py-4 border-b border-white/5\">\n                            <div className=\"flex items-center gap-3\">\n                                <div className=\"p-2 bg-green-500/10 rounded-lg\">\n                                    <Layers size={18} className=\"text-green-400\" />\n                                </div>\n                                <div>\n                                    <h3 className=\"text-sm font-black text-white tracking-widest uppercase\">Extraer Stem</h3>\n                                    <p className=\"text-[10px] text-white/40 mt-0.5\">Selecciona la cancin y descrgala</p>\n                                </div>\n                            </div>\n                            <button onClick={() => setStemsModalOpen(false)} className=\"p-2 text-white/20 hover:text-white hover:bg-white/5 rounded-full transition-all\">\n                                <X size={18} />\n                            </button>\n                        </div>\n\n                        <div className=\"p-6 flex flex-col gap-3 max-h-[400px] overflow-y-auto custom-scrollbar\">\n                            {/* Current loaded track */}\n                            {audioUrl && (\n                                <div className=\"flex flex-col gap-3 p-4 bg-white/5 border border-cyan-500/20 rounded-xl\">\n                                    <div className=\"flex flex-col\">\n                                        <span className=\"text-sm font-bold text-white\">{selectedSong}</span>\n                                        <span className=\"text-[9px] text-cyan-400/60 uppercase tracking-widest mt-0.5\">Pista actual en consola</span>\n                                    </div>\n                                    <div className=\"flex gap-2\">\n                                        <button\n                                            onClick={() => downloadStem(audioUrl, selectedSong)}\n                                            disabled={stemDownloading}\n                                            className=\"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-[#1A1A1A] hover:bg-[#222] border border-[#333] disabled:opacity-50 text-white/70 rounded-xl text-[10px] font-bold tracking-widest uppercase transition-all\"\n                                        >\n                                            <Download size={12} /> Descargar\n                                        </button>\n                                        <button\n                                            onClick={() => sendStemToStudio(audioUrl, selectedSong)}\n                                            className=\"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white rounded-xl text-[10px] font-black tracking-widest uppercase transition-all shadow-[0_0_15px_rgba(6,182,212,0.25)]\"\n                                        >\n                                            <ArrowRight size={12} /> Abrir en Studio\n                                        </button>\n                                    </div>\n                                </div>\n                            )}\n\n                            {/* Creator tracks */}\n                            {creatorTracks.length > 0 && (\n                                <>\n                                    <p className=\"text-[9px] font-bold text-white/30 uppercase tracking-widest px-1 mt-2\">Canciones de IA Creator</p>\n                                    {creatorTracks.map(track => (\n                                        <div key={track.id} className={`flex flex-col gap-3 p-4 rounded-xl border transition-all ${stemsTrackId === track.id\n                                            ? 'bg-orange-500/10 border-orange-500/30'\n                                            : 'bg-white/3 border-white/5 hover:bg-white/5'\n                                            }`}>\n                                            <div className=\"flex flex-col\">\n                                                <span className=\"text-sm font-bold text-white\">{track.title}</span>\n                                                <span className=\"text-[9px] text-white/30 uppercase tracking-widest mt-0.5\">{track.style || 'AI Generated'}</span>\n                                            </div>\n                                            <div className=\"flex gap-2\">\n                                                <button\n                                                    onClick={() => downloadStem(track.streamAudioUrl || track.url, track.title)}\n                                                    disabled={stemDownloading || (!track.url && !track.streamAudioUrl)}\n                                                    className=\"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-[#1A1A1A] hover:bg-[#222] border border-[#333] disabled:opacity-40 disabled:cursor-not-allowed text-white/70 rounded-xl text-[10px] font-bold tracking-widest uppercase transition-all\"\n                                                >\n                                                    <Download size={12} /> {(!track.url && !track.streamAudioUrl) ? 'Procesando...' : 'Descargar'}\n                                                </button>\n                                                <button\n                                                    onClick={() => sendStemToStudio(track.streamAudioUrl || track.url, track.title)}\n                                                    disabled={!track.url && !track.streamAudioUrl}\n                                                    className=\"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 disabled:opacity-40 disabled:cursor-not-allowed text-white rounded-xl text-[10px] font-black tracking-widest uppercase transition-all shadow-[0_0_15px_rgba(6,182,212,0.25)]\"\n                                                >\n                                                    <ArrowRight size={12} /> Abrir en Studio\n                                                </button>\n                                            </div>\n                                        </div>\n                                    ))}\n                                </>\n                            )}\n\n                            {!audioUrl && creatorTracks.length === 0 && (\n                                <div className=\"text-center py-8 text-white/20\">\n                                    <Layers size={40} className=\"mx-auto mb-3 opacity-30\" />\n                                    <p className=\"text-xs font-bold tracking-widest uppercase\">No hay canciones disponibles</p>\n                                    <p className=\"text-[10px] mt-1\">Importa una cancin o genera una en Crear</p>\n                                </div>\n                            )}\n                        </div>\n                    </div>\n                </div>\n            )}\n\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}}]
}