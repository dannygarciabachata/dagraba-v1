import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
import { UnreachableError } from '../../../../base/preconditions';
import { composeRefs } from '../../../../base/react/compose_refs';
import classNames from 'classnames';
import * as React from 'react';
import { useAnnounceWhen } from '../../a11y/announcer/announcer';
import { Box } from '../../box/box';
import { Button } from '../../button/button';
import { useFocusableRef } from '../../focusable/focusable';
import { AlertTriangleIcon } from '../../icons/alert_triangle/icon';
import { CheckIcon } from '../../icons/check/icon';
import { InfoIcon } from '../../icons/info/icon';
import { XIcon } from '../../icons/x/icon';
import { Column, Columns } from '../../layout/layout';
import { customProperties as linkCustomProperties } from '../../link/internal/link.css';
import { colorActionSecondaryFg, colorFeedbackCriticalSubtleFg, colorFeedbackInfoSubtleFg, colorFeedbackPositiveSubtleFg, colorFeedbackWarnSubtleFg } from '../../tokens/color';
import { InheritColor, Text } from '../../typography/typography';
import styles from './alert.css';
import { AlertMessages } from './alert.messages';
export const alertTones = [
    'positive',
    'warn',
    'critical',
    'info',
    'neutral'
];
const toneColors = {
    ['positive']: {
        fg: colorFeedbackPositiveSubtleFg,
        bg: 'feedbackPositiveSubtle'
    },
    ['warn']: {
        fg: colorFeedbackWarnSubtleFg,
        bg: 'feedbackWarnSubtle'
    },
    ['critical']: {
        fg: colorFeedbackCriticalSubtleFg,
        bg: 'feedbackCriticalSubtle'
    },
    ['info']: {
        fg: colorFeedbackInfoSubtleFg,
        bg: 'feedbackInfoSubtle'
    },
    ['neutral']: {
        fg: colorActionSecondaryFg,
        bg: 'neutralSubtle'
    }
};
export const AlertIcon = ({ tone, size = 'medium' })=>{
    switch(tone){
        case 'critical':
        case 'warn':
            return _jsx(AlertTriangleIcon, {
                size: size
            });
        case 'positive':
            return _jsx(CheckIcon, {
                size: size
            });
        case 'info':
            return _jsx(InfoIcon, {
                size: size
            });
        case 'neutral':
            return null;
        default:
            throw new UnreachableError(tone);
    }
};
export const Alert = ({ children, className, title, tone, dismissible, onDismiss, size = 'medium', rounded = true, showIcon = size !== 'small', Icon, focusRef, testId })=>{
    let iconElement;
    if (showIcon) {
        if (Icon) iconElement = _jsx(Icon, {
            size: size
        });
        else iconElement = _jsx(AlertIcon, {
            tone: tone,
            size: size
        });
    }
    const containerRef = useFocusableRef(focusRef);
    const [textContent, setTextContent] = React.useState('');
    const announcerRef = React.useCallback((node)=>{
        if (node) setTextContent(node.textContent ?? '');
    }, []);
    useAnnounceWhen(textContent, tone === 'critical' && !!textContent, {
        priority: 'high'
    });
    return _jsx(Box, {
        background: toneColors[tone].bg,
        borderRadius: rounded ? 'element' : 'none',
        paddingX: size === 'medium' ? '2u' : '1.5u',
        paddingY: size === 'medium' ? '2u' : '1u',
        width: "full",
        className: classNames(className, styles.alert, {
            [styles.small]: size === 'small'
        }),
        testId: testId,
        customProperties: {
            [linkCustomProperties.linkColor]: toneColors[tone].fg
        },
        role: "note",
        ref: composeRefs(containerRef, announcerRef),
        tabIndex: focusRef != null ? -1 : undefined,
        children: _jsx(Text, {
            tagName: "div",
            size: size,
            tone: InheritColor,
            children: _jsxs(Columns, {
                spacing: "1u",
                alignY: "baseline",
                children: [
                    iconElement && _jsx(Column, {
                        width: "content",
                        children: iconElement
                    }),
                    _jsxs(Column, {
                        children: [
                            title && _jsxs(_Fragment, {
                                children: [
                                    _jsx("strong", {
                                        children: title
                                    }),
                                    ' '
                                ]
                            }),
                            children
                        ]
                    }),
                    dismissible && _jsx(Column, {
                        width: "content",
                        children: _jsx(Button, {
                            variant: "tertiary",
                            className: styles.close,
                            onClick: onDismiss,
                            icon: XIcon,
                            ariaLabel: AlertMessages.dismiss(),
                            size: "small",
                            iconSize: size
                        })
                    })
                ]
            })
        })
    });
};
